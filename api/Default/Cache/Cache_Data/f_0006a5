(window.webpackJsonp=window.webpackJsonp||[]).push([[215],{TMLg:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var s=function(e){return e[e.None=0]="None",e[e.Left=1]="Left",e[e.Right=2]="Right",e}({})},pWIW:function(e,t,i){"use strict";i.r(t),i.d(t,"ROUTES",(function(){return Ps})),i.d(t,"ViewAndMarkupRoutingModule",(function(){return Ds}));var s=i("ofXK"),n=i("3Pt+"),a=i("Wp6s"),o=i("f0Cb"),r=i("7EHt"),l=i("NFeN"),c=i("STbY"),h=i("d3UM"),d=i("wZkO"),p=i("tyNb"),u=i("5iMO"),g=i("quZr"),b=i("1uah"),v=i("LRne"),S=i("IzEk"),m=i("eIep"),f=i("Qpiy"),C=i("YwUS"),O=i("Z9D8"),_=i("LUpO"),I=i("C4gn"),T=i("Tx8r"),R=i("i8JG"),E=i("DxXH"),y=i("qXoz"),w=i("tqyv"),M=i("c+03"),P=i("wpY2"),D=i("iwlc"),x=i("tCxB"),A=i("A3La"),N=i("Ejbi"),G=i("+eYH"),V=i("NEWU"),F=i("d09n"),k=i("41Lq");class L{constructor(e,t,i,s,n){this.fileObject=e,this.fileTypeCategory=t,this.graphicsMapURL=i,this.tagInterface=s,this.ready=n,this.setReady(n)}setReady(e){this.ready=!!e&&this.validate()}validate(){return void 0!==this.fileObject}}class U extends L{constructor(e,t,i,s,n,a,o,r){super(e,t,i,s,r),this.selectedMarkups=n,this.actionOBID=a,this.markupRenditionService=o,this.layerCount=0}updateLayerCount(){if(super.validate())if(this.selectedMarkups)if("No_Markup_Selected"===this.selectedMarkups)this.layerCount=0;else{const e=this.selectedMarkups.split(",");this.layerCount=e.length}else this.markupRenditionService.getMarkupLayers(this.fileObject.obid,this.fileObject.config).subscribe(e=>{e&&(this.layerCount=e.count)})}}class B extends L{constructor(e,t,i,s,n,a,o,r){super(e,i,a,o,r),this.versionOBID=t,this.navigationStrategy=s,this.URL=n}}var j=function(e){return e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e}({}),z=i("grnA"),H=function(e){return e[e.GoView=0]="GoView",e[e.Brava=1]="Brava",e}({}),W=i("72Rg"),Y=i("jYMS"),X=i("cdXO"),K=i("tk/3"),$=i("HDdC"),Z=i("z6cu"),q=i("J7mc"),J=i("fXoL");let Q=(()=>{class e{constructor(e){this.dataService=e}generateGraphicsMap(e){const t=new K.d({"Content-Type":"text/xml",Accept:"text/xml"});return this.dataService.get("GenerateGraphicsMapFromLabelDatabase(labelDatabaseOBID='"+e+"')",void 0,void 0,void 0,t)}checkDocumentForLabelDatabase(e,t,i){return $.a.create(s=>{this.getLabelDatabaseFileFromDocumentOBID(e,t,i).subscribe(e=>{let t="";e&&e instanceof Array&&e[0]&&(t=e[0].OBID),s.next(t),s.complete()},e=>{const t=new O.a(e,e.message,"label-database.service","checkDocumentForLabelDatabase");return Object(Z.a)(t)})})}checkFileForLabelDatabase(e,t,i){return $.a.create(s=>{this.getDocumentFromFileOBID(e,t).subscribe(e=>{e?this.checkDocumentForLabelDatabase(e.OBID,t,i).subscribe(e=>{let t="";e&&(t=e),s.next(t),s.complete()}):(s.next(""),s.complete())},e=>{const t=new O.a(e,e.message,"label-database.service","checkFileForLabelDatabase");return Object(Z.a)(t)})})}getLabelDatabaseFileFromDocumentOBID(e,t,i){const s=i.substr(0,i.lastIndexOf("."));return this.dataService.get(`Objects('${e}')/SPFFileComposition_21?\n$filter=startswith(Name, '${s}') and endswith(Name,'.MDB2')`,t,!0,void 0,void 0)}getDocumentFromFileOBID(e,t){return this.dataService.get(`Objects('${e}')/SPFFileComposition_12?$select=OBID`,t,!0,void 0,void 0)}}return e.\u0275fac=function(t){return new(t||e)(J.dc(q.a))},e.\u0275prov=J.Ob({token:e,factory:e.\u0275fac}),e})(),ee=(()=>{class e{constructor(e){this.odataService=e}getMarkupLayers(e,t){return this.odataService.get(`Objects('${e}')/SPFFileMarkup_12?$select=OBID&$count=true`,t,!0)}}return e.\u0275fac=function(t){return new(t||e)(J.dc(A.a))},e.\u0275prov=J.Ob({token:e,factory:e.\u0275fac}),e})();var te=i("o/8C"),ie=i("fnx3"),se=i("EiwA"),ne=i("XNiG"),ae=i("Cfvw"),oe=i("bOdf"),re=i("lJxs"),le=i("4B5/"),ce=i("6JPj"),he=i("9xZE"),de=i("k/hs"),pe=i("UVhF"),ue=i("ECFu"),ge=i("ti2P"),be=i("cee5"),ve=i("U7l/"),Se=i("N9DE"),me=i("ONOH"),fe=i("zj8V"),Ce=i("G3dd"),Oe=i("cp0P"),_e=i("NYVZ");let Ie=(()=>{class e{constructor(e){this.dynamicLoaderService=e}createGoViewControl(e,t){return Object(Oe.a)([this.dynamicLoaderService.lazyLoadGlobalScript("./viewers/goview/common/math.min.js"),this.dynamicLoaderService.lazyLoadGlobalScript("./viewers/goview/common/hammer.min.js"),this.dynamicLoaderService.lazyLoadGlobalScript("./viewers/goview/common/bluebird.min.js")]).pipe(Object(m.a)(()=>t?this.createGoView2D(e):this.createGoView(e)))}createGoView(e){return this.dynamicLoaderService.lazyLoadGlobalScript("./viewers/goview/goview/goview.js").pipe(Object(m.a)(()=>this.dynamicLoaderService.lazyLoadGlobalScript("./viewers/goview/goview/libs/mMapSDK.js")),Object(m.a)(()=>this.dynamicLoaderService.lazyLoadGlobalScript("./viewers/goview/goview/libs/mMapSDK.wrapper.js")),Object(m.a)(()=>this.dynamicLoaderService.lazyLoadGlobalScript("./viewers/goview/goview/libs/memoryManager.js")),Object(m.a)(()=>this.dynamicLoaderService.lazyLoadGlobalScript("./viewers/goview/goview/libs/string_tree.js")),Object(m.a)(()=>this.dynamicLoaderService.lazyLoadGlobalCss("./viewers/goview/goview/resources/css/GoviewNavigationUI.css")),Object(re.a)(()=>this.goViewFactory(e,"./viewers/goview/goview/resources/","./viewers/goview/goview/")))}createGoView2D(e){return this.dynamicLoaderService.lazyLoadGlobalScript("./libMCD.js").pipe(Object(m.a)(()=>this.dynamicLoaderService.lazyLoadGlobalScript("./viewers/goview/goview2d/goview.js")),Object(m.a)(()=>this.dynamicLoaderService.lazyLoadGlobalCss("./viewers/goview/goview2d/resources/css/GoviewNavigationUI.css")),Object(re.a)(()=>this.goViewFactory(e,"./viewers/goview/goview2d/resources/","./viewers/goview/goview2d/")))}goViewFactory(e,t,i){return new goview.GoView(e,t,i)}}return e.\u0275fac=function(t){return new(t||e)(J.dc(_e.a))},e.\u0275prov=J.Ob({token:e,factory:e.\u0275fac}),e})();var Te=i("Q4nN"),Re=i("wN6G");let Ee=(()=>{class e{constructor(e,t,i){this.odataService=e,this.dataService=t,this.crudService=i}getMethodData(){return $.a.create(e=>{this.odataService.get("Objects?$filter=contains(Interfaces,'ISPFMethod') and UID eq 'MTH_CreateMarkupSnapshot'","",!0).subscribe(t=>{e.next(t.value[0].OBID),e.complete()},e=>{const t=new O.a(e,e.message,"markup-snapshot.service","getMarkupSnapshotMethodData");return Object(Z.a)(t)})})}save(e,t,i){return this.dataService.post("SaveMarkupSnapshot",JSON.stringify({SnapshotOBID:e,PngBase64:t,CameraPosition:i}))}relateToTags(e,t){const i=[];t.forEach(t=>{i.push({thisEndObid:e,otherEndObid:t,relDefName:"SPFMarkupSnapshotFDWTag",directionIs12:!0})}),this.crudService.relateMany(i).subscribe()}}return e.\u0275fac=function(t){return new(t||e)(J.dc(A.a),J.dc(q.a),J.dc(Re.a))},e.\u0275prov=J.Ob({token:e,factory:e.\u0275fac}),e})();var ye=i("h5sD"),we=i("h915"),Me=i("mRmt");let Pe=(()=>{class e{constructor(e,t,i,s,n,a,o,r,l){this.graphicsMapService=e,this.uxtNotificationService=t,this.sdaTranslateService=i,this.loggingService=s,this.compositeService=n,this.publishedDocumentService=a,this.fdwDocumentService=o,this.exceptionService=r,this.gdsService=l,this.MAX_REPRESENTATIONS=1e3}initializeSearchProperties(e,t,i,s,n,a,o){this.maximumSearchResults=e,this.maximumSuggestions=t,this.graphicsMapLoaded=i,this.versionOBID=s,this.config=n,this.navigationStrategy=a,this.navigationDocuments=o}onSearchGraphicsMap(e,t){const i=[];let s;return this.loggingService.info("Searching map file for tags matching "+e),s=t?this.graphicsMapService.mapNodesWhereNameContains(e,this.maximumSearchResults):this.graphicsMapService.mapNodesWhereNameEquals(e),s.length>0&&s.forEach(e=>{i.push(e.getAttribute("GOID"))}),this.loggingService.info(`Found ${i.length.toString()} graphics in map file`),Object(v.a)(i)}onSearchDocument(e,t){const i={graphics:[],name:[],totalCount:void 0,displayCount:void 0};if(!this.hasNonWildcards(e))return this.uxtNotificationService.error(this.sdaTranslateService.get("GOVIEW_SEARCH_ALL_WILDCARDS","Searches containing only wildcards are not allowed")),Object(v.a)(i);this.uxtNotificationService.clearAll();const s=e.replace(/'/g,"''"),n=encodeURIComponent(s);return this.searchDocument(`t:t/Name eq '${n}'`,t?"&$top="+this.maximumSearchResults:"&$top="+this.MAX_REPRESENTATIONS).pipe(Object(re.a)(e=>{const t=e?e.totalCount:0,s=e?e.displayCount:0;return s>0&&(this.loggingService.info(`Displaying ${s.toString()} of ${t.toString()} matches found in database`),s<t&&this.uxtNotificationService.info(this.sdaTranslateService.getFormatted("GOVIEW_SEARCH_PARTIAL-DISPLAYED-TOTAL","Displaying maximum {0} of {1} matches",[s.toString(),t.toString()]))),e||i},e=>(this.exceptionService.handleException(new O.a(e)),Object(v.a)([]))))}filterTagNames(e){const t=new Array;if(this.graphicsMapLoaded){this.loggingService.info("Getting suggestions from map file for "+e);const i=this.graphicsMapService.mapNodesWhereNameContains(e,this.maximumSuggestions);return i&&i.forEach(e=>{t.push(this.graphicsMapService.getMapNodeName(e))}),this.loggingService.info(`Returning ${t.length.toString()} matches from map file`),Object(v.a)(t)}{if(!this.hasNonWildcards(e))return this.uxtNotificationService.error(this.sdaTranslateService.get("GOVIEW_SEARCH_ALL_WILDCARDS","Searches containing only wildcards are not allowed")),Object(v.a)(t);this.uxtNotificationService.clearAll();const i=e.replace(/'/g,"''"),s=`Name eq '${encodeURIComponent(i)}'`,n="$top="+this.maximumSuggestions;return this.loggingService.info("Getting suggestions from database for "+e),this.filterTagNamesInNavigableDocument(s,n).pipe(Object(re.a)(e=>e?(this.loggingService.info(`Returning ${e.length.toString()} matches from database`),e):void this.loggingService.info("Returning 0 matches from database"),e=>{this.exceptionService.handleException(new O.a(e))}))}}searchDocument(e,t){switch(this.navigationStrategy){case z.a.COMPOSITE:return this.compositeService.onSearch(this.versionOBID,this.config,e,t);case z.a.PUBLISHED:return this.publishedDocumentService.onSearch(this.navigationDocuments,this.config,e,t);case z.a.FDW:return this.fdwDocumentService.onSearch(this.navigationDocuments[0],this.config,e,t);case z.a.GDS:return this.gdsService.onSearch(this.config,e.substr(4),t);default:return Object(v.a)(void 0)}}hasNonWildcards(e){return new RegExp("[^%*]","g").test(e)}filterTagNamesInNavigableDocument(e,t){switch(this.navigationStrategy){case z.a.COMPOSITE:return this.compositeService.filterTagNames(this.versionOBID,this.config,e,t);case z.a.PUBLISHED:return this.publishedDocumentService.filterTagNames(this.navigationDocuments,this.config,e,t);case z.a.FDW:return this.fdwDocumentService.filterTagNames(this.navigationDocuments[0],this.config,e,t);case z.a.GDS:return this.gdsService.filterTagNames(this.config,e,t);default:return Object(v.a)(void 0)}}}return e.\u0275fac=function(t){return new(t||e)(J.dc(Te.a),J.dc(k.a),J.dc(N.a),J.dc(x.a),J.dc(we.a),J.dc(Me.a),J.dc(Y.a),J.dc(_.a),J.dc(X.a))},e.\u0275prov=J.Ob({token:e,factory:e.\u0275fac}),e})();var De=i("lUp+"),xe=i("pUtL"),Ae=i("G8aS"),Ne=Math.floor,Ge=Math.min,Ve=i("+Xah"),Fe=i("YHEm"),ke=function(e,t){var i=null==e?0:e.length;if(i){var s=function(e,t,i){var s=0,n=null==e?s:e.length;if("number"==typeof t&&t==t&&n<=2147483647){for(;s<n;){var a=s+n>>>1,o=e[a];null!==o&&!Object(Ae.a)(o)&&(i?o<=t:o<t)?s=a+1:n=a}return n}return function(e,t,i,s){t=i(t);for(var n=0,a=null==e?0:e.length,o=t!=t,r=null===t,l=Object(Ae.a)(t),c=void 0===t;n<a;){var h=Ne((n+a)/2),d=i(e[h]),p=void 0!==d,u=null===d,g=d==d,b=Object(Ae.a)(d);if(o)var v=s||g;else v=c?g&&(s||p):r?g&&p&&(s||!u):l?g&&p&&!u&&(s||!b):!u&&!b&&(s?d<=t:d<t);v?n=h+1:a=h}return Ge(a,4294967294)}(e,t,Ve.a,i)}(e,t);if(s<i&&Object(Fe.a)(e[s],t))return s}return-1},Le=i("xgIS"),Ue=i("GyhO"),Be=i("2ufx"),je=function(e){return e[e.REPORTS=0]="REPORTS",e[e.GROUPS=1]="GROUPS",e[e.ITEMS=2]="ITEMS",e}({}),ze=function(e){return e[e.OPEN=0]="OPEN",e[e.CLOSE=1]="CLOSE",e[e.CLEAR=2]="CLEAR",e}({}),He=function(e){return e[e.FREQDESC=0]="FREQDESC",e[e.FREQASC=1]="FREQASC",e[e.NAMEDESC=2]="NAMEDESC",e[e.NAMEASC=3]="NAMEASC",e}({}),We=i("+ooB"),Ye=i("jNCI"),Xe=i("dEBh"),Ke=i("hvSs"),$e=i("hYUb");let Ze=(()=>{class e{constructor(e,t,i,s,n,a,o,r){this.componentFactoryResolver=e,this.injector=t,this.modalService=i,this.exceptionService=s,this.sdaTranslateService=n,this.windowService=a,this.uxtNotificationService=o,this.dataService=r,this.SHARE_URL_MODAL_TITLE=this.sdaTranslateService.get("SHARE_URL_MODAL_TITLE","Share Url"),this.CLOSE=this.sdaTranslateService.get("CLOSE","Close"),this.VIR_NO_OPTIONS_SELECTED_URL=this.sdaTranslateService.get("VIR_NO_OPTIONS_SELECTED_URL","No options selected for URL"),this.SHARE_URL_SHOW_ERROR=this.sdaTranslateService.get("SHARE_URL_SHOW_ERROR","An error occurred on sharing URL"),this.searchReportName="VizSearch",this.window=this.windowService.Window}getGeneratedUrl(e,t,i){this.getGeneratedBaseUrl(i).pipe(Object(S.a)(1)).subscribe(i=>{const s=this.getGeneratedViCommand(e,t);s?this.showUrlModal(i+s):this.uxtNotificationService.info(this.VIR_NO_OPTIONS_SELECTED_URL)},e=>{throw new O.a(e)})}getViewMethodName(e){return e?this.dataService.get(`Objects('${e}')`).pipe(Object(m.a)(e=>Object(v.a)(e.Name))):Object(v.a)("ViewNavigateFiles")}getGeneratedBaseUrl(e){return this.getViewMethodName(e).pipe(Object(re.a)(e=>{let t="";const i=decodeURIComponent(this.window.location.href).split(";");try{let s=i[0];s=s.substring(0,s.indexOf("/#/")+3);let n=i.filter(e=>e.includes("objects="))[0];if(n)return n=JSON.parse(n.toString().substr("objects=".length)),t=`${s}launch/run;config=${n[0].config};objectObid=${n[0].obid};methodName=${e};data=`,t;throw new O.a(this.SHARE_URL_SHOW_ERROR,this.SHARE_URL_SHOW_ERROR,"share-url-action","onExecute")}catch(s){throw new O.a(s,this.SHARE_URL_SHOW_ERROR,"share-url-action","onExecute")}}))}getGeneratedViCommand(e,t){let i="";if(t!==this.searchReportName){if(!e.selected)return;i=e.reportDefn.InputParameters?JSON.stringify(Object({VIR:[t],PARAMS:e.reportDefn.InputParameters})):JSON.stringify(Object({VIR:[t]}))}else{const t=[];for(const i in e.children)e.children.hasOwnProperty(i)&&e.children[i].selected&&t.push(i);if(0===t.length)return;i=JSON.stringify(Object({VIS:t}))}return encodeURIComponent(i)}showUrlModal(e){const t=new We.a(this.SHARE_URL_MODAL_TITLE,Ke.a,this.componentFactoryResolver,this.injector);t.hideCancel=!0,t.okBtnText=this.CLOSE;const i=new $e.a(e,!1);t.data=i,this.modalService.showModal(t).catch(e=>{this.exceptionService.handleException(new O.a(e))})}}return e.\u0275fac=function(t){return new(t||e)(J.dc(J.j),J.dc(J.s),J.dc(Ye.a),J.dc(_.a),J.dc(N.a),J.dc(Xe.a),J.dc(k.a),J.dc(q.a))},e.\u0275prov=J.Ob({token:e,factory:e.\u0275fac}),e})();var qe=i("5+tZ"),Je=i("08BJ"),Qe=i("BltP");let et=(()=>{class e{constructor(e,t,i,s,n){this.reportsService=e,this.configService=t,this.sdaTranslateService=i,this.gdsService=s,this.dataService=n,this.REPORT_COLUMN_NAMES="SPF_ReportDetail_SPFRptDetDisplayAs",this.REPORT_COLUMN_IDS="SPF_ReportDetail_OBID",this.VIZ_REPORT_GOID_COLUMN="GOID",this.VIZ_REPORT_DOCID_COLUMN="DocID",this.VIZ_REPORT_NAME_COLUMN="Name",this.VIR_ITEMPROJECTSTATUS_REPORTNAME=this.sdaTranslateService.get("VIR_ITEMPROJECTSTATUS_REPORTNAME","Items by Design Status in Project"),this.SDX_ITEM_DESIGN_STATUS_ID="_SDXItemDesignStatus",this.SPFORIGINATHIGHERCONFIG="SPFOriginAtHigherConfig",this.SPFORIGINATHIGHERCONFIG_ID="SPF_IGraphics3D_SPFOriginAtHigherConfig",this.GRAPHICS3DGUID_ID="SPF_IGraphics3D_Graphics3DGUID",this.SPFMERGESTATUS="SPFMergeStatus"}getVizReports(e,t){return this.getVizReportsReport("Visual Intelligence Reports").pipe(Object(qe.a)(i=>{if(i){const s=[this.ensureItemsByDesignStatusReportId(),this.reportsService.executeReport(i,e)];return Object(Oe.a)(s).pipe(Object(m.a)(e=>Object(v.a)(this.getVizReportsFromResults(e[1].value,t))))}return Object(v.a)([])}))}executeVizReport(e,t,i,s){var n;const a=[],o=this.setParametersForColumn(e,this.VIZ_REPORT_DOCID_COLUMN,void 0===t?"*":t);o&&a.push(o),s&&s.forEach(t=>{const i=t.NAME,s=t.VALUE;if(i&&s){const t=this.setParametersForColumn(e,i,s);t&&(a.push(t),e.InputParameters||(e.InputParameters=[]),e.InputParameters.push({NAME:i,VALUE:s}))}}),(null===(n=e.PromptedCols)||void 0===n?void 0:n.length)>0&&this.ensureAllPromptedColsHaveParameter(e,a);const r={templateName:void 0,truncateDate:void 0,reportCategory:void 0,clientTimeZoneOffset:void 0,outPutType:void 0,splitMultiValueResults:!0};return this.ensureItemsByDesignStatusReportId().pipe(Object(m.a)(()=>this.isItemsByDesignStatusReport(e.Id)?this.executeItemDesignStatusReport(e,i=this.configService.selectedCreateConfig,a,r):this.reportsService.executeReportByArgs(e.Id,i,a,[],r)))}lookupResultColumnByDisplayAs(e,t){return e.find(e=>e.DisplayAs===t)}lookupResultColumnById(e,t){return e.find(e=>e.Id===t)}lookupGoidResultColumn(e){return this.lookupResultColumnByDisplayAs(e,this.VIZ_REPORT_GOID_COLUMN)}findGroupByColumnName(e){const t=e.find(e=>e.Name!==this.VIZ_REPORT_GOID_COLUMN&&e.Name!==this.VIZ_REPORT_NAME_COLUMN&&e.Name!==this.VIZ_REPORT_DOCID_COLUMN);return t?t.Name:void 0}getVizReportsFromResults(e,t){const i=[];void 0===t&&(t=!0);const s=this.lookupResultColumnById(e.ResultColumns,this.REPORT_COLUMN_NAMES);if(s){const n=s.Id,a=this.lookupResultColumnById(e.ResultColumns,this.REPORT_COLUMN_IDS);let o;e.Results.forEach(e=>{const s=e,r=s[n];let l=r.indexOf(this.VIZ_REPORT_GOID_COLUMN)>=0;if(t&&(l=l&&r.indexOf(this.VIZ_REPORT_DOCID_COLUMN)>=0),l&&this.isVizReportAvailable(e)){const t=this.getVizReportDetails(s,n,a.Id),r=this.isItemsByDesignStatusReport(e.Id)?this.VIR_ITEMPROJECTSTATUS_REPORTNAME:e.Name;o={Id:e.Id,Name:r,Details:t,HasClashes:!1},i.push(o)}})}return i}isVizReportAvailable(e){let t=!0;if(this.isItemsByDesignStatusReport(e.Id)){t=!1;const e=this.configService.selectedCreateConfig;if(e){const i=this.configService.getConfigLevel([e]);(null==i?void 0:i.length)>0&&(t=i[0].value===Qe.a.PROJECT)}}return t}getVizReportDetails(e,t,i){const s=[],n=e[i],a=e[t].split(","),o=n.split(",");if(a.length===o.length){let e;a.forEach((t,i)=>{e={Id:o[i],Name:t},s.push(e)})}return s}getVizReportsReport(e){return void 0===this.vizReportsReport?this.dataService.get(`Reports?$filter=DisplayName eq '${e}'`).pipe(Object(m.a)(e=>((null==e?void 0:e.length)>0&&(this.vizReportsReport=e[0]),Object(v.a)(this.vizReportsReport)))):Object(v.a)(this.vizReportsReport)}setParametersForColumn(e,t,i){const s=t.toLowerCase(),n=e.Details.find(e=>e.Name.toLowerCase()===s);return n?{Id:n.Id,Values:[{Operator:0,Value:i}]}:void 0}setMissingPrompt(e){return{Id:e,Values:[{Operator:0,Value:"*"}]}}ensureAllPromptedColsHaveParameter(e,t){e.PromptedCols.forEach(e=>{t.some(t=>t.Id===e)||t.push(this.setMissingPrompt(e))})}executeItemDesignStatusReport(e,t,i,s){let n;return this.configService.queryBySelectedConfigs||(n=this.configService.queryBySelectedConfigs,this.configService.queryBySelectedConfigs=!0),this.reportsService.executeReportByArgs(e.Id,t,i,[],s).pipe(Object(m.a)(i=>{void 0!==n&&(this.configService.queryBySelectedConfigs=n),e.Details=e.Details.filter((e,t)=>!(e.Name===this.SPFORIGINATHIGHERCONFIG||e.Name===this.SPFMERGESTATUS));const s=this.sdaTranslateService.get("VIR_DESIGNSTATUS","Design Status"),a=this.sdaTranslateService.get("VIR_DESIGNSTATUS_FLAGGEDFORREMOVAL","Flagged for Removal"),o=this.sdaTranslateService.get("VIR_DESIGNSTATUS_CLAIMED","Claimed"),r=this.sdaTranslateService.get("VIR_DESIGNSTATUS_ADDED","Added/New");return e.Details.push({Id:this.SDX_ITEM_DESIGN_STATUS_ID,Name:s}),i.value.ResultColumns.push({DisplayAs:s,Id:this.SDX_ITEM_DESIGN_STATUS_ID,ScopedByType:"StringType",IsDateTimeAsString:!1,IsDateAsString:!1,PropertyDefUID:void 0}),i.value.Results.forEach(e=>{let t;t="True"===e[this.SPFORIGINATHIGHERCONFIG_ID]?o:r,e[this.SDX_ITEM_DESIGN_STATUS_ID]=t}),this.gdsService.getTerminatedTags(t).pipe(Object(m.a)(e=>{if((null==e?void 0:e.length)>0){const t=i.value;t.Results.push(...e.map(e=>{const t={Id:e.OBID,Name:e.Name};return t[this.GRAPHICS3DGUID_ID]=e.Graphics3DGUID,t[this.SDX_ITEM_DESIGN_STATUS_ID]=a,t})),t.ResultCount=t.Results.length}return Object(v.a)(i)}))}))}ensureItemsByDesignStatusReportId(){return void 0===this.itemsByDesignStatusReportId?this.dataService.get("Objects?$filter=UID eq 'AHR_Items_by_Design_Status_in_Project' and contains(Interfaces,'ISPFAdhocReport')&$select=OBID").pipe(Object(m.a)(e=>{let t="";return(null==e?void 0:e.length)>0&&(t=e[0].OBID),this.itemsByDesignStatusReportId=t,Object(v.a)(t)})):Object(v.a)(this.itemsByDesignStatusReportId)}isItemsByDesignStatusReport(e){return this.itemsByDesignStatusReportId===e}}return e.\u0275fac=function(t){return new(t||e)(J.dc(Je.a),J.dc(me.a),J.dc(N.a),J.dc(X.a),J.dc(q.a))},e.\u0275prov=J.Ob({token:e,factory:e.\u0275fac}),e})();var tt=i("JIr8"),it=i("xVJr");let st=(()=>{class e{constructor(e,t,i){this.dataService=e,this.odataService=t,this.workspaceDefinitionService=i}getWorkspaceFilters(e,t){return Object(Oe.a)([this.getWorkspaceFiltersByType("SDxiHubViewFilters",e,t),this.getWorkspaceFiltersByType("SDxiHubAdvanced3DFilters",e,t)]).pipe(Object(m.a)(e=>{const t=[...e[0],...e[1]];return t.sort((e,t)=>{const i=e.Name,s=t.Name;return i<s?-1:i>s?1:0}),Object(v.a)(t)}))}runWorkspaceFilter(e,t){return this.workspaceDefinitionService.ensureWorkspaceDefinitionForFilter(e,t).pipe(Object(m.a)(e=>this.dataService.post("RunAdvanced3DFilterForGraphicsGUIDs",`{QueryName:'${e.Name}'}`)))}getWorkspaceFiltersByType(e,t,i){const s=i?`${e}?$filter=UID ne '${i}'&`:e+"?";return this.getWorkspaceFilterCount(s,t).pipe(Object(m.a)(e=>0===e?Object(v.a)([]):this.dataService.get(`${s}$top=${e}&$orderby=Name`,t)))}getWorkspaceFilterCount(e,t){return this.odataService.get(e+"$count=true&$top=0",t).pipe(Object(m.a)(e=>Object(v.a)(e.count)),Object(tt.a)(e=>(401!==e.statusCode&&Object(Z.a)(e),Object(v.a)(0))))}}return e.\u0275fac=function(t){return new(t||e)(J.dc(q.a),J.dc(A.a),J.dc(it.a))},e.\u0275prov=J.Ob({token:e,factory:e.\u0275fac}),e})(),nt=(()=>{class e{convertHexToRgb(e,t){const i=[],s=parseInt(e,16);let n=(s>>16&255)/255,a=(s>>8&255)/255,o=(255&s)/255;const r=t;return n=Number(n.toFixed(3)),a=Number(a.toFixed(3)),o=Number(o.toFixed(3)),i.push(n,a,o,r),i}checkForPartialMonikers(e){return e.startsWith(fe.g)}getPartialMoniker(e){let t;const i=e.indexOf(fe.g);return i>0&&(t=e.substr(i)),t}getChildrenGoids(e){const t=[];return Object.values(e.children).forEach(e=>{if(e&&!0===e.selected){const i=e.goid;void 0!==i&&t.push(...i)}}),t}getChildrenGoidsByFilter(e,t,i,s){const n=e.children;Object.keys(n).forEach(e=>{const a=n[e];!0===a.selected&&Array.isArray(a.goid)&&a.inFilter&&a.inFilter.hasOwnProperty(t)&&(a.inFilter[t]?i.push(...a.goid):s.push(...a.goid))})}countSelectedChildren(e){return Object.values(e).reduce((e,t)=>t.selected?e+1:e,0)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=J.Ob({token:e,factory:e.\u0275fac}),e})();var at=i("z8Lm");const ot=["colorpicker"];function rt(e,t){if(1&e){const e=J.Zb();J.Yb(0,"div"),J.Yb(1,"div",4),J.hc("click",(function(i){J.Kc(e);const s=t.index;return J.lc().clickColor(i,s)})),J.Xb(),J.Xb()}if(2&e){const e=t.$implicit,i=J.lc();J.Eb(1),J.Rc("background-color","#"+e)("cursor","pointer"),J.sc("ngClass",e===i.colors[i.startingColor]?"color-bubble color-bubble__selected":"color-bubble")}}let lt=(()=>{class e{constructor(){this.updateColor=new J.o,this.colors=fe.b}openColorPicker(e){this.startingColor=e.color,this.currentGroup=e.groupId,this.colorpicker.show(event)}clickColor(e,t){e&&(e.preventDefault(),e.cancelBubble=!0),this.startingColor!==t&&this.updateColor.emit({color:t,groupId:this.currentGroup}),this.colorpicker.hide()}closePicker(e){e&&(e.preventDefault(),e.cancelBubble=!0),this.colorpicker.hide()}onAfterShow(){if(null!==this.colorpicker.el.nativeElement){const e=this.colorpicker.el.nativeElement;e.children&&e.children.length>0&&(e.children[0].style.display="flex",e.children[0].style.justifyContent="center",e.children[0].style.alignItems="center")}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=J.Mb({type:e,selectors:[["sda-viz-panel-color-picker"]],viewQuery:function(e,t){var i;1&e&&J.bd(ot,!0),2&e&&J.Gc(i=J.ic())&&(t.colorpicker=i.first)},outputs:{updateColor:"updateColor"},decls:4,vars:3,consts:[[3,"click","onAfterShow"],["colorpicker",""],[1,"colorpicker__container"],[4,"ngFor","ngForOf"],[3,"ngClass","click"]],template:function(e,t){1&e&&(J.Yb(0,"p-overlayPanel",0,1),J.hc("click",(function(e){return t.closePicker(e)}))("onAfterShow",(function(){return t.onAfterShow()})),J.Yb(2,"div",2),J.Sc(3,rt,2,5,"div",3),J.Xb(),J.Xb()),2&e&&(J.Ib("colorpicker__overlay",!0),J.Eb(3),J.sc("ngForOf",t.colors))},directives:[at.a,s.s,s.q],styles:[".viz-panel__body[_ngcontent-%COMP%]{overflow-x:hidden;overflow-y:auto}[_nghost-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]     mat-expansion-panel-header{padding-left:12px}.viz-panel[_ngcontent-%COMP%]{transition:background .25s cubic-bezier(.18,.9,.18,.9);position:absolute;flex-direction:column;min-width:40px;justify-content:center;background-color:#fff;color:#000;font-size:13px;z-index:100!important}.viz-panel__hidden[_ngcontent-%COMP%]{display:none}.viz-panel__open[_ngcontent-%COMP%]{display:flex;height:100%}.viz-panel__header-body[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;width:inherit}.viz-panel__body[_ngcontent-%COMP%]{display:flex;flex:1;flex-direction:column;width:100%;min-height:0}.viz-panel__body__divider[_ngcontent-%COMP%]{height:2px;background-color:rgba(0,58,85,.5)}.viz-panel__body--hidden[_ngcontent-%COMP%], .viz-panel__resize-handle[_ngcontent-%COMP%]{display:none}@media screen and (min-width:1200px){.viz-panel__resize-handle[_ngcontent-%COMP%]{display:flex;align-items:center;background-color:#cad0d7;width:10px;height:100%;cursor:col-resize}}.viz-panel__icon-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:inherit;color:#515e6b}.viz-panel__resizing-icon[_ngcontent-%COMP%]{width:20px;height:20px}.viz-panel__search-expandable-group[_ngcontent-%COMP%]{overflow:visible}.viz-panel__search-expandable-group[_ngcontent-%COMP%]     .mat-expansion-panel-body{padding:0}.viz-panel__search-expandable-group__icon[_ngcontent-%COMP%]{width:18px;height:18px;margin:0 3px}.viz-panel__search-expandable-group-header[_ngcontent-%COMP%]{padding:6px 24px 6px 12px}.viz-panel__results[_ngcontent-%COMP%]{border-top:1px solid}.color-bubble[_ngcontent-%COMP%]{width:25px;height:25px;margin:6px 5px;border-radius:15px;text-align:center;vertical-align:middle;padding-top:3px;border:2px solid transparent;cursor:pointer}.color-bubble__selected[_ngcontent-%COMP%]{border-color:#000}.color-bubble[_ngcontent-%COMP%]:hover{border-color:#697a8b}.colorpicker__overlay[_ngcontent-%COMP%]     .ui-overlaypanel{position:absolute!important;left:inherit!important;width:100%;height:100%;justify-content:center;background-color:rgba(0,0,0,.2);cursor:default;color:unset!important}.colorpicker__overlay[_ngcontent-%COMP%]     .ui-overlaypanel-content{display:flex;flex-wrap:wrap;max-width:230px;height:-webkit-fit-content;height:fit-content;padding:10px!important;box-shadow:0 3px 3px 0 rgba(0,0,0,.2)!important;background-color:#fff}.colorpicker__container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}"]}),e})();var ct=i("VW6k");let ht=(()=>{class e{constructor(e){this.sdaTranslateService=e,this.showColorPicker=new J.o,this.SYMBOLOGY_TOOLTIP=this.sdaTranslateService.get("VIR_SYMBOLOGY_TOOLTIP","Change color"),this.colors=fe.b}showPicker(e){e&&(e.cancelBubble=!0);const t={color:this.colors.indexOf(this.itemColor.replace("#","")),groupId:this.groupId};this.showColorPicker.emit(t)}}return e.\u0275fac=function(t){return new(t||e)(J.Sb(N.a))},e.\u0275cmp=J.Mb({type:e,selectors:[["sda-viz-panel-symbology"]],inputs:{itemColor:"itemColor",groupId:"groupId"},outputs:{showColorPicker:"showColorPicker"},decls:1,vars:3,consts:[[1,"color-bubble",3,"title","click"]],template:function(e,t){1&e&&(J.Yb(0,"div",0),J.hc("click",(function(e){return t.showPicker(e)})),J.Xb()),2&e&&(J.Rc("background-color",t.itemColor),J.tc("title",t.SYMBOLOGY_TOOLTIP))},styles:[".viz-panel__body[_ngcontent-%COMP%]{overflow-x:hidden;overflow-y:auto}[_nghost-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]     mat-expansion-panel-header{padding-left:12px}.viz-panel[_ngcontent-%COMP%]{transition:background .25s cubic-bezier(.18,.9,.18,.9);position:absolute;flex-direction:column;min-width:40px;justify-content:center;background-color:#fff;color:#000;font-size:13px;z-index:100!important}.viz-panel__hidden[_ngcontent-%COMP%]{display:none}.viz-panel__open[_ngcontent-%COMP%]{display:flex;height:100%}.viz-panel__header-body[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;width:inherit}.viz-panel__body[_ngcontent-%COMP%]{display:flex;flex:1;flex-direction:column;width:100%;min-height:0}.viz-panel__body__divider[_ngcontent-%COMP%]{height:2px;background-color:rgba(0,58,85,.5)}.viz-panel__body--hidden[_ngcontent-%COMP%], .viz-panel__resize-handle[_ngcontent-%COMP%]{display:none}@media screen and (min-width:1200px){.viz-panel__resize-handle[_ngcontent-%COMP%]{display:flex;align-items:center;background-color:#cad0d7;width:10px;height:100%;cursor:col-resize}}.viz-panel__icon-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:inherit;color:#515e6b}.viz-panel__resizing-icon[_ngcontent-%COMP%]{width:20px;height:20px}.viz-panel__search-expandable-group[_ngcontent-%COMP%]{overflow:visible}.viz-panel__search-expandable-group[_ngcontent-%COMP%]     .mat-expansion-panel-body{padding:0}.viz-panel__search-expandable-group__icon[_ngcontent-%COMP%]{width:18px;height:18px;margin:0 3px}.viz-panel__search-expandable-group-header[_ngcontent-%COMP%]{padding:6px 24px 6px 12px}.viz-panel__results[_ngcontent-%COMP%]{border-top:1px solid}.color-bubble[_ngcontent-%COMP%]{width:25px;height:25px;margin:6px 5px;border-radius:15px;text-align:center;vertical-align:middle;padding-top:3px;border:2px solid transparent;cursor:pointer}"]}),e})();function dt(e,t){if(1&e){const e=J.Zb();J.Yb(0,"sda-viz-panel-symbology",6),J.hc("showColorPicker",(function(t){return J.Kc(e),J.lc().showPicker(t)})),J.Xb()}if(2&e){const e=J.lc();J.sc("itemColor",e.dataItem.reportColor)("groupId",e.dataItem.id)}}let pt=(()=>{class e{constructor(){this.panelToDisplay=je.REPORTS,this.eventItemSelected=new J.o,this.eventHandleSelectFitItems=new J.o,this.eventShowColorPicker=new J.o,this.toggleSelectState=new J.o,this.selectListItemsChecked=!1,this.isSelected=!1,this.itemsToMultiSelectFit=[]}rowClicked(e){e&&!e.disabled&&(this.eventItemSelected.emit(e.id),this.itemSelectedChanged(e),this.dataItem.fitSelected=!this.dataItem.fitSelected)}toggleCheck(e){event&&(event.cancelBubble=!0),this.dataItem.selected=e,this.toggleSelectState.emit([this.dataItem])}itemSelectedChanged(e){this.isSelected=!this.isSelected,this.eventHandleSelectFitItems.emit(e.id)}showPicker(e){this.eventShowColorPicker.emit(e)}isPanelDisplayedGroups(){return this.panelToDisplay===je.GROUPS}isPanelDisplayedItems(){return this.panelToDisplay===je.ITEMS}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=J.Mb({type:e,selectors:[["sda-viz-panel-list-item"]],inputs:{dataItem:"dataItem",panelToDisplay:"panelToDisplay"},outputs:{eventItemSelected:"eventItemSelected",eventHandleSelectFitItems:"eventHandleSelectFitItems",eventShowColorPicker:"eventShowColorPicker",toggleSelectState:"toggleSelectState"},decls:8,vars:8,consts:[[3,"ngClass","click"],[1,"viz-panel-list-item__switch",3,"isActive","title","isDisabled","isActiveChange"],[1,"viz-panel-list-item__text"],[1,"viz-panel-list-item__text-name",3,"title"],[1,"viz-panel-list-item__text-description"],["class","viz-panel-list-item__right",3,"itemColor","groupId","showColorPicker",4,"ngIf"],[1,"viz-panel-list-item__right",3,"itemColor","groupId","showColorPicker"]],template:function(e,t){1&e&&(J.Yb(0,"div",0),J.hc("click",(function(){return t.rowClicked(t.dataItem)})),J.Yb(1,"uxt-switch",1),J.hc("isActiveChange",(function(e){return t.toggleCheck(e)})),J.Xb(),J.Yb(2,"div",2),J.Yb(3,"h4",3),J.Uc(4),J.Xb(),J.Yb(5,"p",4),J.Uc(6),J.Xb(),J.Xb(),J.Xb(),J.Sc(7,dt,1,2,"sda-viz-panel-symbology",5)),2&e&&(J.sc("ngClass",t.isPanelDisplayedItems()&&t.dataItem.fitSelected?"viz-panel-list-item selected":"viz-panel-list-item"),J.Eb(1),J.sc("isActive",t.dataItem.selected)("title",t.dataItem.name)("isDisabled",t.dataItem.disabled),J.Eb(2),J.sc("title",t.dataItem.name),J.Eb(1),J.Vc(t.dataItem.name),J.Eb(2),J.Vc(t.dataItem.description),J.Eb(1),J.sc("ngIf",t.isPanelDisplayedGroups()&&void 0!==t.dataItem.reportColor))},directives:[s.q,ct.a,s.t,ht],styles:[".viz-panel-list-item__text-description[_ngcontent-%COMP%], .viz-panel-list-item__text-name[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}[_nghost-%COMP%]{position:relative;display:flex;flex:1;box-shadow:0 1px 5px rgba(0,0,0,.1);background-color:#fff;overflow:hidden;cursor:pointer;border-bottom:1px solid #cad0d7}.viz-panel-list-item[_ngcontent-%COMP%]{display:flex;width:100%;align-items:center}.viz-panel-list-item__switch[_ngcontent-%COMP%]{display:flex;flex:0 0 auto;padding:10px}.viz-panel-list-item__right[_ngcontent-%COMP%]{position:absolute;right:0;display:flex;align-items:center;padding-top:6px;padding-right:10px;background-color:#fff}.viz-panel-list-item__text[_ngcontent-%COMP%]{display:flex;flex:1 0 auto;flex-direction:column;font-size:14px;width:30px;margin:0 5px}.viz-panel-list-item__text-description[_ngcontent-%COMP%]{font-size:13px}.selected[_ngcontent-%COMP%]{background-color:#afe5ff}"]}),e})();function ut(e,t){if(1&e&&J.Tb(0,"mat-icon",6),2&e){const e=J.lc();J.sc("svgIcon",e.headerIcon)}}function gt(e,t){if(1&e){const e=J.Zb();J.Yb(0,"sda-viz-panel-list-item",7),J.hc("eventItemSelected",(function(t){return J.Kc(e),J.lc().handleItemSelection(t)}))("toggleSelectState",(function(t){return J.Kc(e),J.lc().toggleSelectState(t)})),J.Xb()}if(2&e){const e=t.$implicit,i=J.lc();J.sc("dataItem",e)("panelToDisplay",i.panelToDisplay)}}let bt=(()=>{class e{constructor(){this.panelToDisplay=je.REPORTS,this.itemSelected=new J.o,this.eventToggleSelectState=new J.o}handleItemSelection(e){this.itemSelected.emit(e)}toggleSelectState(e){this.eventToggleSelectState.emit(e)}close(){this.expansionPanel.close()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=J.Mb({type:e,selectors:[["sda-viz-panel-expandable-group"]],viewQuery:function(e,t){var i;1&e&&J.bd(r.c,!0),2&e&&J.Gc(i=J.ic())&&(t.expansionPanel=i.first)},inputs:{title:"title",subTitle:"subTitle",itemData:"itemData",panelToDisplay:"panelToDisplay",headerIcon:"headerIcon",panelExpanded:"panelExpanded",hideToggle:"hideToggle",disabled:"disabled"},outputs:{itemSelected:"itemSelected",eventToggleSelectState:"eventToggleSelectState"},decls:10,vars:7,consts:[[1,"viz-panel-expandable-group",3,"expanded","hideToggle","disabled"],["collapsedHeight","*","expandedHeight","*"],[1,"viz-panel-expandable-group__header"],["class","viz-panel-expandable-group__icon",3,"svgIcon",4,"ngIf"],[1,"viz-panel-expandable-group__title"],[3,"dataItem","panelToDisplay","eventItemSelected","toggleSelectState",4,"ngFor","ngForOf"],[1,"viz-panel-expandable-group__icon",3,"svgIcon"],[3,"dataItem","panelToDisplay","eventItemSelected","toggleSelectState"]],template:function(e,t){1&e&&(J.Yb(0,"mat-expansion-panel",0),J.Yb(1,"mat-expansion-panel-header",1),J.Yb(2,"mat-panel-title"),J.Yb(3,"div",2),J.Sc(4,ut,1,1,"mat-icon",3),J.Yb(5,"div",4),J.Uc(6),J.Yb(7,"mat-panel-description"),J.Uc(8),J.Xb(),J.Xb(),J.Xb(),J.Xb(),J.Xb(),J.Sc(9,gt,1,2,"sda-viz-panel-list-item",5),J.Xb()),2&e&&(J.sc("expanded",t.panelExpanded)("hideToggle",t.hideToggle)("disabled",t.disabled),J.Eb(4),J.sc("ngIf",t.headerIcon),J.Eb(2),J.Wc(" ",t.title," "),J.Eb(2),J.Vc(t.subTitle),J.Eb(1),J.sc("ngForOf",t.itemData))},directives:[r.c,r.g,r.h,s.t,r.f,s.s,l.a,pt],styles:[".viz-panel-expandable-group[_ngcontent-%COMP%]  .mat-expansion-panel-body{padding:0}.viz-panel-expandable-group__icon[_ngcontent-%COMP%]{width:18px;height:18px;margin:0 3px}.viz-panel-expandable-group__header[_ngcontent-%COMP%]{display:flex;align-items:center;padding:6px 0}.viz-panel-expandable-group__title[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}"]}),e})();var vt=i("TLn4"),St=i("I5S5");function mt(e,t){if(1&e){const e=J.Zb();J.Yb(0,"div",2),J.Yb(1,"p-chart",3),J.hc("onDataSelect",(function(t){return J.Kc(e),J.lc(2).selectPieChart(t)})),J.Xb(),J.Xb()}if(2&e){const e=J.lc(2);J.Eb(1),J.sc("data",e.pieChartData)("options",e.chartDisplayOptions)}}function ft(e,t){if(1&e&&(J.Yb(0,"div"),J.Sc(1,mt,2,2,"div",1),J.Xb()),2&e){const e=J.lc();J.Eb(1),J.sc("ngIf",e.isPanelDisplayedGroups())}}let Ct=(()=>{class e{constructor(){this.panelToDisplay=je.REPORTS,this.itemSelected=new J.o,this.pieChartData={labels:[],datasets:[]},this.chartDisplayOptions={legend:{display:!1},animation:{duration:700}}}ngOnInit(){this.setChartData(),this.ngOnInitCalled=!0}ngOnChanges(e){(e.reportData&&e.reportData.currentValue&&!this.showMergedConflictsReport||e.panelToDisplay&&e.panelToDisplay.currentValue||e.showMergedConflictsReport&&!0===e.showMergedConflictsReport.currentValue)&&this.ngOnInitCalled&&this.setChartData()}selectPieChart(e){e&&e.element&&e.element._view&&this.itemSelected.emit(e.element._view.label)}isPanelDisplayedGroups(){return this.panelToDisplay===je.GROUPS}setChartData(){if(this.panelToDisplay===je.GROUPS&&void 0!==this.reportData){this.clearPieChartData();const e=[],t=[],i=[];this.reportData.forEach(s=>{(this.showMergedConflictsReport||!this.showMergedConflictsReport&&s.selected)&&(e.push(s.name),t.push(s.count),i.push(s.reportColor))}),e.length>0&&(this.pieChartData={labels:e,datasets:[{data:t,backgroundColor:i,hoverBackgroundColor:i}]})}else this.clearPieChartData()}clearPieChartData(){this.pieChartData={labels:[],datasets:[]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=J.Mb({type:e,selectors:[["sda-viz-panel-group-chart"]],inputs:{reportData:"reportData",panelToDisplay:"panelToDisplay",displayChart:"displayChart",showMergedConflictsReport:"showMergedConflictsReport"},outputs:{itemSelected:"itemSelected"},features:[J.Cb],decls:1,vars:1,consts:[[4,"ngIf"],["class","viz-panel-group-chart__chart",4,"ngIf"],[1,"viz-panel-group-chart__chart"],["type","pie",3,"data","options","onDataSelect"]],template:function(e,t){1&e&&J.Sc(0,ft,2,1,"div",0),2&e&&J.sc("ngIf",t.displayChart)},directives:[s.t,St.b],styles:[".viz-panel-group-chart[_ngcontent-%COMP%]{background-color:#fff;display:flex;flex:1;flex-direction:column}.viz-panel-group-chart__chart[_ngcontent-%COMP%]{margin:10px 0}.viz-panel-group-chart__chart[_ngcontent-%COMP%]   p-chart[_ngcontent-%COMP%]     canvas{max-width:70%;height:auto!important;margin:15px auto}"]}),e})();var Ot=i("4CIq");const _t=["colorpicker"];function It(e,t){1&e&&(J.Yb(0,"div",3),J.Tb(1,"sda-loading-indicator",4),J.Xb()),2&e&&(J.Eb(1),J.sc("size",18))}function Tt(e,t){if(1&e){const e=J.Zb();J.Yb(0,"sda-button-plain",14),J.hc("click",(function(){return J.Kc(e),J.lc(2).selectFitClicked()})),J.Xb()}if(2&e){const e=J.lc(2);J.sc("title",e.VIR_FIT_SELECTION)("matSvgIcon","map")}}function Rt(e,t){if(1&e){const e=J.Zb();J.Yb(0,"sda-viz-panel-symbology",15),J.hc("showColorPicker",(function(t){return J.Kc(e),J.lc(2).showPicker(t)})),J.Xb()}if(2&e){const e=J.lc(2);J.sc("itemColor",e.activeGroupColor)("groupId",e.activeGroupId)}}function Et(e,t){if(1&e){const e=J.Zb();J.Yb(0,"div"),J.Yb(1,"sda-viz-panel-list-item",16),J.hc("eventItemSelected",(function(t){return J.Kc(e),J.lc(2).handleItemSelection(t)}))("eventHandleSelectFitItems",(function(t){return J.Kc(e),J.lc(2).handleSelectFitItems(t)}))("eventShowColorPicker",(function(t){return J.Kc(e),J.lc(2).showPicker(t)}))("toggleSelectState",(function(t){return J.Kc(e),J.lc(2).toggleSelectState(t)})),J.Xb(),J.Xb()}if(2&e){const e=t.$implicit,i=J.lc(2);J.Eb(1),J.sc("dataItem",e)("panelToDisplay",i.panelToDisplay)}}function yt(e,t){if(1&e){const e=J.Zb();J.Yb(0,"div",5),J.Yb(1,"div",6),J.Yb(2,"span",7),J.Uc(3),J.Xb(),J.Yb(4,"div",8),J.Sc(5,Tt,1,2,"sda-button-plain",9),J.Sc(6,Rt,1,2,"sda-viz-panel-symbology",10),J.Xb(),J.Xb(),J.Yb(7,"sda-viz-panel-group-chart",11),J.hc("itemSelected",(function(t){return J.Kc(e),J.lc().handleItemSelection(t)})),J.Xb(),J.Yb(8,"div",12),J.Sc(9,Et,2,2,"div",13),J.Xb(),J.Xb()}if(2&e){const e=J.lc();J.Eb(3),J.Vc(e.countString),J.Eb(2),J.sc("ngIf",e.itemsToSelectFit.length>0&&e.isPanelDisplayedItems()),J.Eb(1),J.sc("ngIf",e.isPanelDisplayedItems()),J.Eb(1),J.sc("reportData",e.reportData)("panelToDisplay",e.panelToDisplay)("displayChart",e.displayChart)("showMergedConflictsReport",e.showMergedConflictsReport),J.Eb(1),J.Rc("height",e.calculatedViewHeight,"px"),J.Eb(1),J.sc("ngForOf",e.reportData)}}let wt=(()=>{class e{constructor(e){this.sdaTranslateService=e,this.panelToDisplay=je.REPORTS,this.itemSelected=new J.o,this.showColorPicker=new J.o,this.eventToggleSelectState=new J.o,this.eventItemsToFit=new J.o,this.eventSelectFitAction=new J.o,this.colors=fe.b,this.VIR_ITEMS_PARTIAL_SELECTED_TOTAL=this.sdaTranslateService.get("VIR_ITEMS_PARTIAL-SELECTED-TOTAL","{0}/{1} items shown"),this.VIR_ITEMS_TOTAL=this.sdaTranslateService.get("VIR_ITEMS-TOTAL","{0} items"),this.VIR_GROUPS_PARTIAL_SELECTED_TOTAL=this.sdaTranslateService.get("VIR_GROUPS_PARTIAL-SELECTED-TOTAL","{0}/{1} groups shown"),this.VIR_GROUPS_TOTAL=this.sdaTranslateService.get("VIR_GROUPS-TOTAL","{0} groups"),this.VIR_FIT_SELECTION=this.sdaTranslateService.get("VIR_FIT_SELECTION","Fit selected item(s)"),this.itemsToSelectFit=[],this.searchReportId="VizSearch",this.viewerOffsetStandard=237,this.viewerOffsetSearch=287,this.viewerOffsetReport=197,this.viewerOffset=this.viewerOffsetStandard}ngOnChanges(e){if(e.panelToDisplay&&void 0!==e.panelToDisplay.previousValue)this.panelToDisplay===je.ITEMS&&this.clearItemsToSelectFit(),this.setPanelStyle();else if(e.reportData)for(const t in e.reportData.previousValue)this.panelToDisplay===je.ITEMS&&e.reportData.previousValue.hasOwnProperty(t)&&e.reportData.currentValue.length>0&&(this.reportData[t].fitSelected=e.reportData.previousValue[t].fitSelected);e.reportData&&void 0!==e.reportData.currentValue&&this.setCountString(),e.viewerHeight&&this.setViewHeight()}handleItemSelection(e){this.panelToDisplay===je.REPORTS&&this.itemSelected.emit(e),this.panelToDisplay===je.GROUPS&&this.itemSelected.emit(this.currentReport+"|"+e)}handleSelectFitItems(e){this.itemsToSelectFit.includes(e)?this.itemsToSelectFit=this.itemsToSelectFit.filter(t=>t!==e):this.itemsToSelectFit.push(e),this.eventItemsToFit.emit(this.itemsToSelectFit)}clearItemsToSelectFit(){this.itemsToSelectFit=[]}changeColor(e){this.colorpicker.toggle(e)}showPicker(e){this.showColorPicker.emit(e)}toggleSelectState(e){this.eventToggleSelectState.emit(e)}isPanelDisplayedItems(){return this.panelToDisplay===je.ITEMS}selectFitClicked(){this.eventSelectFitAction.emit()}setCountString(){let e=0;const t=this.reportData.length;this.panelToDisplay===je.REPORTS?this.setCountStringByPanel(t):(this.reportData.forEach(t=>{e+=t.selected?1:0}),e!==t?this.setCountStringByPanel(t,e):this.setCountStringByPanel(t))}setCountStringByPanel(e,t=e){const i=t===e,s=this.panelToDisplay===je.GROUPS?i?this.VIR_GROUPS_TOTAL:this.VIR_GROUPS_PARTIAL_SELECTED_TOTAL:i?this.VIR_ITEMS_TOTAL:this.VIR_ITEMS_PARTIAL_SELECTED_TOTAL,n=i?[e.toString()]:[t.toString(),e.toString()];this.countString=this.sdaTranslateService.getFormattedByString(s,n)}setPanelStyle(){this.viewerOffset=this.panelToDisplay===je.REPORTS?this.viewerOffsetStandard:this.panelToDisplay===je.GROUPS&&this.currentReport===this.searchReportId?this.viewerOffsetSearch:this.viewerOffsetReport,this.setViewHeight()}setViewHeight(){this.calculatedViewHeight=this.viewerHeight-this.viewerOffset}}return e.\u0275fac=function(t){return new(t||e)(J.Sb(N.a))},e.\u0275cmp=J.Mb({type:e,selectors:[["sda-viz-panel-list-group"]],viewQuery:function(e,t){var i;1&e&&J.bd(_t,!0),2&e&&J.Gc(i=J.ic())&&(t.colorpicker=i.first)},inputs:{reportData:"reportData",panelToDisplay:"panelToDisplay",currentReport:"currentReport",panelDataLoading:"panelDataLoading",activeGroupColor:"activeGroupColor",activeGroupId:"activeGroupId",displayChart:"displayChart",viewerHeight:"viewerHeight",showMergedConflictsReport:"showMergedConflictsReport"},outputs:{itemSelected:"itemSelected",showColorPicker:"showColorPicker",eventToggleSelectState:"eventToggleSelectState",eventItemsToFit:"eventItemsToFit",eventSelectFitAction:"eventSelectFitAction"},features:[J.Cb],decls:3,vars:2,consts:[[1,"viz-panel-list-group"],["class","viz-panel-list-group__loading",4,"ngIf"],["class","viz-panel-list-group__loaded",4,"ngIf"],[1,"viz-panel-list-group__loading"],[3,"size"],[1,"viz-panel-list-group__loaded"],[1,"viz-panel-list-group__count"],[1,"viz-panel-list-group__count__text"],[1,"viz-panel-list-group__symbology"],["class","viz-panel-list-group__button-fit",3,"title","matSvgIcon","click",4,"ngIf"],[3,"itemColor","groupId","showColorPicker",4,"ngIf"],[3,"reportData","panelToDisplay","displayChart","showMergedConflictsReport","itemSelected"],[1,"viz-panel-list-group__container"],[4,"ngFor","ngForOf"],[1,"viz-panel-list-group__button-fit",3,"title","matSvgIcon","click"],[3,"itemColor","groupId","showColorPicker"],[3,"dataItem","panelToDisplay","eventItemSelected","eventHandleSelectFitItems","eventShowColorPicker","toggleSelectState"]],template:function(e,t){1&e&&(J.Yb(0,"div",0),J.Sc(1,It,2,1,"div",1),J.Sc(2,yt,10,10,"div",2),J.Xb()),2&e&&(J.Eb(1),J.sc("ngIf",!0===t.panelDataLoading),J.Eb(1),J.sc("ngIf",!1===t.panelDataLoading))},directives:[s.t,vt.a,Ct,s.s,Ot.a,ht,pt],styles:[".viz-panel-list-group__container[_ngcontent-%COMP%]{overflow-x:hidden;overflow-y:auto}[_nghost-%COMP%]{position:relative;box-shadow:0 1px 5px rgba(0,0,0,.1);overflow:hidden;border-bottom:1px solid #cad0d7}.viz-panel-list-group[_ngcontent-%COMP%], [_nghost-%COMP%]{display:flex;flex:1;background-color:#fff}.viz-panel-list-group[_ngcontent-%COMP%]{flex-direction:column}.viz-panel-list-group__count[_ngcontent-%COMP%]{display:flex;border-bottom:1px solid #cad0d7;width:100%;min-height:40px}.viz-panel-list-group__count__text[_ngcontent-%COMP%]{display:flex;flex:1;align-items:center;font-size:13px;margin:3px 5px}.viz-panel-list-group__container[_ngcontent-%COMP%]{display:flex;flex:1;flex-direction:column;margin-right:1px}.viz-panel-list-group__loading[_ngcontent-%COMP%]{display:flex;justify-content:center}.viz-panel-list-group__loaded[_ngcontent-%COMP%]{display:flex;flex:1;flex-direction:column;min-height:0}.viz-panel-list-group__button[_ngcontent-%COMP%]{cursor:pointer;margin:8px 4px 4px}.viz-panel-list-group__top-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.viz-panel-list-group__symbology[_ngcontent-%COMP%]{position:fixed;right:0;display:flex;padding-right:10px;align-items:center}.viz-panel-list-group__button-fit[_ngcontent-%COMP%]{margin-right:12px}.viz-panel-list-group__button-fit[_ngcontent-%COMP%]     .button__mat-icon{width:24px!important;height:24px!important;fill:#697a8b}sda-loading-indicator[_ngcontent-%COMP%]{margin:91px 5px}.color-bubble[_ngcontent-%COMP%]{width:25px;height:25px;margin:3px 5px;border-radius:15px;text-align:center;vertical-align:middle;padding-top:3px}"]}),e})();function Mt(e,t){if(1&e){const e=J.Zb();J.Yb(0,"mat-icon",9),J.hc("click",(function(t){return J.Kc(e),J.lc().goPrev(t)})),J.Xb()}if(2&e){const e=J.lc();J.sc("title",e.TOOLTIP_BACK)}}function Pt(e,t){if(1&e){const e=J.Zb();J.Yb(0,"mat-icon",10),J.hc("click",(function(t){return J.Kc(e),J.lc().openClosePanel(t)})),J.Xb()}if(2&e){const e=J.lc();J.sc("title",e.TOOLTIP_OPEN)}}function Dt(e,t){if(1&e){const e=J.Zb();J.Yb(0,"mat-icon",11),J.hc("click",(function(t){return J.Kc(e),J.lc().openClosePanel(t)})),J.Xb()}if(2&e){const e=J.lc();J.sc("title",e.TOOLTIP_CLOSE)}}let xt=(()=>{class e{constructor(e){this.sdaTranslateService=e,this.panelToDisplay=je.REPORTS,this.panelState=ze.CLOSE,this.eventUpdatePanelToDisplay=new J.o,this.eventUpdatePanelState=new J.o,this.eventRefreshDisplay=new J.o,this.TOOLTIP_BACK=this.sdaTranslateService.get("VIR_HEADER_BACK","Previous"),this.TOOLTIP_OPEN=this.sdaTranslateService.get("VIR_HEADER_OPEN","Open panel"),this.TOOLTIP_CLOSE=this.sdaTranslateService.get("VIR_HEADER_CLOSE","Close panel")}goPrev(e){const t=this.panelToDisplay===je.ITEMS;this.panelToDisplay=this.panelToDisplay===je.ITEMS?je.GROUPS:je.REPORTS,e&&(e.cancelBubble=!0),this.eventUpdatePanelToDisplay.emit(this.panelToDisplay),t&&this.eventRefreshDisplay.emit()}openClosePanel(e){this.panelState=this.panelState===ze.OPEN?ze.CLOSE:ze.OPEN,e&&(e.cancelBubble=!0),this.eventUpdatePanelState.emit(this.panelState)}isPanelDisplayedReports(){return this.panelToDisplay===je.REPORTS}isPanelStateOpen(){return this.panelState===ze.OPEN}}return e.\u0275fac=function(t){return new(t||e)(J.Sb(N.a))},e.\u0275cmp=J.Mb({type:e,selectors:[["sda-viz-panel-header"]],inputs:{title1:"title1",title2:"title2",panelToDisplay:"panelToDisplay",panelState:"panelState"},outputs:{eventUpdatePanelToDisplay:"eventUpdatePanelToDisplay",eventUpdatePanelState:"eventUpdatePanelState",eventRefreshDisplay:"eventRefreshDisplay"},features:[J.Db([wt])],decls:11,vars:8,consts:[[1,"viz-panel-header",3,"click"],[1,"command-button"],["svgIcon","arrow-left","class","command-button__icon",3,"title","click",4,"ngIf"],[3,"ngClass"],[1,"viz-panel-header__title",3,"title"],[1,"viz-panel-header__sub-title",3,"title"],[1,"command-button","command-button--right"],["svgIcon","chevron-down","class","command-button__icon",3,"title","click",4,"ngIf"],["svgIcon","chevron-up","class","command-button__icon",3,"title","click",4,"ngIf"],["svgIcon","arrow-left",1,"command-button__icon",3,"title","click"],["svgIcon","chevron-down",1,"command-button__icon",3,"title","click"],["svgIcon","chevron-up",1,"command-button__icon",3,"title","click"]],template:function(e,t){1&e&&(J.Yb(0,"div",0),J.hc("click",(function(e){return t.openClosePanel(e)})),J.Yb(1,"div",1),J.Sc(2,Mt,1,1,"mat-icon",2),J.Xb(),J.Yb(3,"div",3),J.Yb(4,"h4",4),J.Uc(5),J.Xb(),J.Yb(6,"p",5),J.Uc(7),J.Xb(),J.Xb(),J.Yb(8,"div",6),J.Sc(9,Pt,1,1,"mat-icon",7),J.Sc(10,Dt,1,1,"mat-icon",8),J.Xb(),J.Xb()),2&e&&(J.Eb(2),J.sc("ngIf",!t.isPanelDisplayedReports()&&t.isPanelStateOpen()),J.Eb(1),J.sc("ngClass",t.isPanelDisplayedReports()?"viz-panel-header__text":"viz-panel-header__text viz-panel-header__text--right"),J.Eb(1),J.sc("title",t.title1),J.Eb(1),J.Vc(t.title1),J.Eb(1),J.sc("title",t.title2),J.Eb(1),J.Vc(t.title2),J.Eb(2),J.sc("ngIf",!t.isPanelStateOpen()),J.Eb(1),J.sc("ngIf",t.isPanelStateOpen()))},directives:[s.t,s.q,l.a],styles:[".viz-panel-header[_ngcontent-%COMP%], .viz-panel-header__sub-title[_ngcontent-%COMP%], .viz-panel-header__text[_ngcontent-%COMP%], .viz-panel-header__title[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}[_nghost-%COMP%]{position:relative;display:flex;height:49px;box-shadow:0 1px 5px rgba(0,0,0,.1);overflow:hidden;background:#6b8cad;border-bottom:#cad0d7;color:#fff}.viz-panel-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%;margin:3px 8px}.viz-panel-header__title[_ngcontent-%COMP%]{margin:0 5px;font-size:16px;color:#fff;line-height:1.2}.viz-panel-header__sub-title[_ngcontent-%COMP%]{flex-grow:1;margin:0 5px;font-size:12px;color:#fff;line-height:1.2}.viz-panel-header__text[_ngcontent-%COMP%]{align-items:center;padding-right:32px;overflow:hidden}.viz-panel-header__text--right[_ngcontent-%COMP%]{padding-left:32px}.command-button[_ngcontent-%COMP%]{position:absolute;top:10px;width:32px;cursor:pointer}.command-button--right[_ngcontent-%COMP%]{right:10px}.command-button__icon[_ngcontent-%COMP%]{width:32px;height:32px}"]}),e})();var At=i("/1cH"),Nt=i("JX91"),Gt=function(e){return e[e.SHOWHIDE=0]="SHOWHIDE",e[e.RESET=1]="RESET",e[e.URL=2]="URL",e[e.COLORS=3]="COLORS",e}({}),Vt=i("kmnG"),Ft=i("qFsG"),kt=i("FcA5"),Lt=i("MutI"),Ut=i("FKr1");function Bt(e,t){if(1&e&&(J.Yb(0,"span",16),J.Uc(1),J.Xb()),2&e){const e=J.lc(2);J.Eb(1),J.Vc(e.VIR_SEARCH_SUGGESTIONS_HELPER)}}function jt(e,t){if(1&e){const e=J.Zb();J.Yb(0,"mat-option",17),J.hc("onclick",(function(){return J.Kc(e),J.lc(2).searchModel(!1)})),J.Uc(1),J.Xb()}if(2&e){const e=t.$implicit;J.sc("value",e),J.Eb(1),J.Wc(" ",e," ")}}function zt(e,t){if(1&e){const e=J.Zb();J.Yb(0,"div",3),J.Yb(1,"form",4),J.Yb(2,"mat-form-field",5),J.Yb(3,"mat-label"),J.Uc(4),J.Xb(),J.Yb(5,"input",6),J.hc("keyup.enter",(function(){return J.Kc(e),J.lc().searchModel(!0)})),J.Xb(),J.Yb(6,"mat-autocomplete",7,8),J.hc("optionSelected",(function(){return J.Kc(e),J.lc().searchModel(!1)})),J.Sc(8,Bt,2,1,"span",9),J.Sc(9,jt,2,2,"mat-option",10),J.mc(10,"async"),J.Xb(),J.Xb(),J.Xb(),J.Yb(11,"sda-button-primary",11),J.hc("click",(function(){return J.Kc(e),J.lc().searchModel(!0)})),J.Xb(),J.Yb(12,"div",12),J.Yb(13,"mat-selection-list",13,14),J.hc("selectionChange",(function(){J.Kc(e);const t=J.Hc(14);return J.lc().selectedOptionsChange(t.selectedOptions.selected.length)})),J.Yb(15,"mat-list-option",15),J.Uc(16),J.Xb(),J.Xb(),J.Xb(),J.Xb()}if(2&e){const e=J.Hc(7),t=J.lc();J.Eb(4),J.Vc(t.VIR_SEARCH_MODEL),J.Eb(1),J.sc("formControl",t.formControl)("matAutocomplete",e),J.Eb(1),J.sc("panelWidth",e),J.Eb(2),J.sc("ngIf",!t.hasThreeCharacters),J.Eb(1),J.sc("ngForOf",J.nc(10,10,t.filteredOptions)),J.Eb(2),J.sc("ngClass",t.isPanelDisplayedReports&&""!==t.currentReport?"viz-panel-search-form__button":"viz-panel-search-form__button--right")("matSvgIcon","search"),J.Eb(4),J.sc("title",t.VIR_SEARCH_EQUAL_TO),J.Eb(1),J.Wc(" ",t.VIR_SEARCH_EQUAL_TO," ")}}function Ht(e,t){if(1&e){const e=J.Zb();J.Yb(0,"button",22),J.hc("click",(function(){J.Kc(e);const i=t.$implicit;return J.lc(2).overflowOptionClicked(i.key)})),J.Uc(1),J.Xb()}if(2&e){const e=t.$implicit;J.Eb(1),J.Wc(" ",e.value," ")}}function Wt(e,t){if(1&e&&(J.Yb(0,"div",18),J.Tb(1,"sda-button-plain",19),J.Yb(2,"mat-menu",null,20),J.Sc(4,Ht,2,1,"button",21),J.Xb(),J.Xb()),2&e){const e=J.Hc(3),t=J.lc();J.Eb(1),J.sc("matMenuTriggerFor",e)("matSvgIcon","overflow"),J.Eb(3),J.sc("ngForOf",t.overflowOptionItems)}}let Yt=(()=>{class e{constructor(e,t,i){this.searchGraphicsService=e,this.sdaTranslateService=t,this.uxtNotificationService=i,this.eventSearchEquals=new J.o,this.eventSearchContains=new J.o,this.eventUpdatePanelState=new J.o,this.eventToggleHideTransparent=new J.o,this.eventGenerateUrl=new J.o,this.formControl=new n.e,this.displayOptions=[],this.selectedOptions=!1,this.isPanelReports=!1,this.isPanelGroups=!1,this.hasThreeCharacters=!1,this.overflowOptionItems=[],this.VIR_SHOW_NONMATCHING_ITEMS=this.sdaTranslateService.get("VIR_SHOW_NONMATCHING_ITEMS","Show non-matching items"),this.VIR_HIDE_NONMATCHING_ITEMS=this.sdaTranslateService.get("VIR_HIDE_NONMATCHING_ITEMS","Hide non-matching items"),this.VIR_RESET_DEFAULT=this.sdaTranslateService.get("VIR_RESET_DEFAULT","Reset to default"),this.VIR_SEARCH_MODEL=this.sdaTranslateService.get("VIR_SEARCH_MODEL","Search 3D Model"),this.VIR_SEARCH_EQUAL_TO=this.sdaTranslateService.get("SEARCH_EQUAL_TO_OPERATOR","Use 'Is equal to' Operator"),this.VIR_SEARCH_SUGGESTIONS_HELPER=this.sdaTranslateService.get("VIR_SEARCH_SUGGESTIONS_HELPER","Search Suggestions (3 char min)"),this.NO_SEARCH_PHRASE=this.sdaTranslateService.get("GOVIEW_SEARCH_NO_SEARCH_PHRASE","Enter a search phrase"),this.VIR_GENERATE_SHARE_URL=this.sdaTranslateService.get("VIR_GENERATE_SHARE_URL","Generate Share URL"),this.searchReportName="VizSearch"}ngOnInit(){this.filteredOptions=this.formControl.valueChanges.pipe(Object(Nt.a)("*"),Object(m.a)(e=>this.getFilteredOptions(e)))}ngOnChanges(e){(e.hasOwnProperty("currentReport")||e.hasOwnProperty("activeFilter")||e.hasOwnProperty("isModelTransparent"))&&this.updateOverflowMenu()}selectedOptionsChange(e){this.selectedOptions=0!==e}searchModel(e){this.formControl.value&&""!==this.formControl.value&&!this.isSearchBusy?(e&&!this.selectedOptions?this.eventSearchContains.emit(this.formattedWildcardsValue(this.formControl.value)):e&&this.selectedOptions?this.eventSearchContains.emit(this.formControl.value):this.eventSearchEquals.emit(this.formControl.value),this.formControl.reset(),this.autocomplete.closePanel()):this.isSearchBusy||this.formControl.value&&""!==this.formControl.value||this.uxtNotificationService.info(this.NO_SEARCH_PHRASE)}overflowOptionClicked(e){e===Gt.SHOWHIDE?this.toggleHideTransparent():e===Gt.RESET?this.clearPanel():this.eventGenerateUrl.emit()}clearPanel(){this.eventUpdatePanelState.emit(ze.CLEAR),this.eventUpdatePanelState.emit(ze.OPEN)}toggleHideTransparent(){this.isModelTransparent=!this.isModelTransparent,this.eventToggleHideTransparent.emit(this.isModelTransparent),this.overflowOptionItems[0].value=this.isModelTransparent?this.VIR_HIDE_NONMATCHING_ITEMS:this.VIR_SHOW_NONMATCHING_ITEMS}getFilteredOptions(e){return""===e||null===e||e.length<3?(this.hasThreeCharacters=!1,Object(v.a)([""])):(this.hasThreeCharacters=!0,this.searchGraphicsService.filterTagNames(this.selectedOptions?e:this.formattedWildcardsValue(e)))}formattedWildcardsValue(e){return"*"+(e="*"===(e="*"===e[0]?e.slice(1):e)[e.length-1]?e.slice(0,e.length-1):e)+"*"}updateOverflowMenu(){this.overflowOptionItems.length=0,this.currentReport&&this.overflowOptionItems.push({key:Gt.SHOWHIDE,value:this.isModelTransparent?this.VIR_HIDE_NONMATCHING_ITEMS:this.VIR_SHOW_NONMATCHING_ITEMS}),this.overflowOptionItems.push({key:Gt.RESET,value:this.VIR_RESET_DEFAULT}),this.currentReport&&this.overflowOptionItems.push({key:Gt.URL,value:this.VIR_GENERATE_SHARE_URL})}}return e.\u0275fac=function(t){return new(t||e)(J.Sb(Pe),J.Sb(N.a),J.Sb(k.a))},e.\u0275cmp=J.Mb({type:e,selectors:[["sda-viz-panel-search"]],viewQuery:function(e,t){var i;1&e&&J.bd(At.c,!0),2&e&&J.Gc(i=J.ic())&&(t.autocomplete=i.first)},inputs:{isPanelDisplayedReports:"isPanelDisplayedReports",isPanelDisplayedGroups:"isPanelDisplayedGroups",currentReport:"currentReport",activeFilter:"activeFilter",isModelTransparent:"isModelTransparent",isSearchBusy:"isSearchBusy"},outputs:{eventSearchEquals:"eventSearchEquals",eventSearchContains:"eventSearchContains",eventUpdatePanelState:"eventUpdatePanelState",eventToggleHideTransparent:"eventToggleHideTransparent",eventGenerateUrl:"eventGenerateUrl"},features:[J.Cb],decls:3,vars:2,consts:[[1,"viz-panel-search"],["class","viz-panel-search__row-search",4,"ngIf"],["class","viz-panel-search__row-overflow",4,"ngIf"],[1,"viz-panel-search__row-search"],[1,"viz-panel-search-form"],[1,"viz-panel-search-form__form-field"],["type","text","matInput","","maxlength","40",1,"viz-panel-search-form__input",3,"formControl","matAutocomplete","keyup.enter"],[3,"panelWidth","optionSelected"],["auto","matAutocomplete"],["class","viz-panel-search-form__autocomplete-helper",4,"ngIf"],[3,"value","onclick",4,"ngFor","ngForOf"],[3,"ngClass","matSvgIcon","click"],[1,"viz-panel-search__options-left"],[3,"selectionChange"],["searchOptions",""],["checkboxPosition","before",3,"title"],[1,"viz-panel-search-form__autocomplete-helper"],[3,"value","onclick"],[1,"viz-panel-search__row-overflow"],[3,"matMenuTriggerFor","matSvgIcon"],["overflowMenu","matMenu"],["mat-menu-item","","class","viz-panel-search__overflow-menu-button",3,"click",4,"ngFor","ngForOf"],["mat-menu-item","",1,"viz-panel-search__overflow-menu-button",3,"click"]],template:function(e,t){1&e&&(J.Yb(0,"div",0),J.Sc(1,zt,17,12,"div",1),J.Sc(2,Wt,5,3,"div",2),J.Xb()),2&e&&(J.Eb(1),J.sc("ngIf",t.isPanelDisplayedReports||t.isPanelDisplayedGroups&&t.currentReport===t.searchReportName),J.Eb(1),J.sc("ngIf",t.isPanelDisplayedReports&&(t.currentReport||t.activeFilter)))},directives:[s.t,n.F,n.q,n.r,Vt.b,Vt.e,Ft.a,n.c,At.c,n.k,n.p,n.f,At.a,s.s,kt.a,s.q,Lt.g,Lt.e,Ut.i,Ot.a,c.d,c.e,c.b],pipes:[s.b],styles:["[_nghost-%COMP%]{position:relative;box-shadow:0 1px 5px rgba(0,0,0,.1);height:92px;overflow:hidden;border-bottom:1px solid #cad0d7}.viz-panel-search[_ngcontent-%COMP%], [_nghost-%COMP%]{display:flex;background-color:#fff}.viz-panel-search[_ngcontent-%COMP%]{flex:1;align-items:flex-start;min-width:10px;padding:0 10px}.viz-panel-search__row-search[_ngcontent-%COMP%]{display:flex;flex:1;justify-content:left;min-width:0;align-items:center;min-height:40px;max-height:70px}.viz-panel-search__row-overflow[_ngcontent-%COMP%]{display:flex;justify-content:right;align-items:center;min-height:40px;max-height:64px;margin-top:10px;margin-right:4px;background-color:initial;z-index:1000!important}.viz-panel-search__options-left[_ngcontent-%COMP%]{position:absolute;top:42px;left:0}.viz-panel-search__overflow-menu-button[_ngcontent-%COMP%]{text-transform:none}.viz-panel-search__overflow-menu-button[_ngcontent-%COMP%]:hover{background-color:#afe5ff}.viz-panel-search[_ngcontent-%COMP%]     .mat-list-base .mat-list-item, .viz-panel-search[_ngcontent-%COMP%]     .mat-list-base .mat-list-option{width:auto;height:32px;margin-left:-5px;background-color:initial;white-space:nowrap}.viz-panel-search[_ngcontent-%COMP%]     .mat-pseudo-checkbox{border:1px solid #697a8b!important}.viz-panel-search[_ngcontent-%COMP%]     .mat-pseudo-checkbox-checked{border:2px solid transparent!important}.viz-panel-search[_ngcontent-%COMP%]     .mat-list-text{font-size:13px}.viz-panel-search[_ngcontent-%COMP%]     .mat-form-field-underline{display:none}.viz-panel-search[_ngcontent-%COMP%]     .mat-form-field-label{padding:8px}.viz-panel-search[_ngcontent-%COMP%]     .button--plain .button__mat-icon{width:24px;height:24px;fill:#697a8b}.viz-panel-search[_ngcontent-%COMP%]     .button--primary .button__mat-icon{width:24px;height:24px;fill:#fff}.viz-panel-search-form[_ngcontent-%COMP%]{width:100%;min-width:10px;max-width:100%}.viz-panel-search-form__form-field[_ngcontent-%COMP%]{width:100%}.viz-panel-search-form__input[_ngcontent-%COMP%]{width:100%;min-width:auto!important;height:34px}.viz-panel-search-form__autocomplete-helper[_ngcontent-%COMP%]{justify-content:left;font-size:12px;color:grey;padding-left:8px}.viz-panel-search-form__button[_ngcontent-%COMP%], .viz-panel-search-form__button--right[_ngcontent-%COMP%]{height:42px}.viz-panel-search-form[_ngcontent-%COMP%]     .button--primary{width:56px;height:100%;border:0;border-radius:0}"]}),e})();function Xt(e,t){if(1&e){const e=J.Zb();J.Yb(0,"uxt-switch",11),J.hc("isActiveChange",(function(t){return J.Kc(e),J.lc(2).selectAll(t)})),J.Xb()}if(2&e){const e=J.lc(2);J.sc("isActive",e.selectedAll)("title",e.VIR_SELECTALL_TOOLTIP)}}function Kt(e,t){if(1&e&&J.Tb(0,"sda-button-plain",12),2&e){J.lc();const e=J.Hc(5),t=J.lc();J.sc("matMenuTriggerFor",e)("matSvgIcon","sort")("title",t.VIR_SORT_TOOLTIP)}}function $t(e,t){1&e&&J.Tb(0,"mat-icon",19)}function Zt(e,t){if(1&e){const e=J.Zb();J.Yb(0,"button",13),J.hc("click",(function(){J.Kc(e);const i=t.$implicit;return J.lc(2).sortOptionClicked(i.key)})),J.Yb(1,"div",14),J.Yb(2,"div",15),J.Tb(3,"mat-icon",16),J.Xb(),J.Uc(4),J.Xb(),J.Yb(5,"div",17),J.Sc(6,$t,1,0,"mat-icon",18),J.Xb(),J.Xb()}if(2&e){const e=t.$implicit;J.Eb(3),J.sc("svgIcon",e.icon),J.Eb(1),J.Wc(" ",e.value," "),J.Eb(2),J.sc("ngIf",e.selected)}}function qt(e,t){if(1&e){const e=J.Zb();J.Yb(0,"sda-button-plain",20),J.hc("click",(function(){return J.Kc(e),J.lc(2).setDisplayChart()})),J.Xb()}if(2&e){const e=J.lc(2);J.Ib("viz-panel-toolbar__command-button-icon--selected",e.displayChart),J.sc("matSvgIcon","pie-chart")("title",e.chartToolTip)}}function Jt(e,t){if(1&e){const e=J.Zb();J.Yb(0,"sda-button-plain",20),J.hc("click",(function(){return J.Kc(e),J.lc(2).switchReportConflicts()})),J.Xb()}if(2&e){const e=J.lc(2);J.Ib("viz-panel-toolbar__command-button-icon--selected",e.showMergedConflictsReport),J.sc("matSvgIcon","shuffle")("title",e.repeatedViewToolTip)}}function Qt(e,t){if(1&e){const e=J.Zb();J.Yb(0,"button",13),J.hc("click",(function(){J.Kc(e);const i=t.$implicit;return J.lc(2).overflowOptionClicked(i.key)})),J.Uc(1),J.Xb()}if(2&e){const e=t.$implicit;J.Eb(1),J.Wc(" ",e.value," ")}}function ei(e,t){if(1&e&&(J.Yb(0,"div",1),J.Sc(1,Xt,1,2,"uxt-switch",2),J.Yb(2,"div",3),J.Sc(3,Kt,1,3,"sda-button-plain",4),J.Yb(4,"mat-menu",5,6),J.Sc(6,Zt,7,3,"button",7),J.Xb(),J.Sc(7,qt,1,4,"sda-button-plain",8),J.Sc(8,Jt,1,4,"sda-button-plain",8),J.Tb(9,"sda-button-plain",9),J.Yb(10,"mat-menu",null,10),J.Sc(12,Qt,2,1,"button",7),J.Xb(),J.Xb(),J.Xb()),2&e){const e=J.Hc(11),t=J.lc();J.Eb(1),J.sc("ngIf",t.showSelectAll),J.Eb(2),J.sc("ngIf",t.isPanelDisplayedGroups()&&t.currentReport!==t.searchReportName),J.Eb(3),J.sc("ngForOf",t.sortOptionItems),J.Eb(1),J.sc("ngIf",t.isPanelDisplayedGroups()),J.Eb(1),J.sc("ngIf",t.isPanelDisplayedGroups()&&t.reportHasConflicts),J.Eb(1),J.sc("matMenuTriggerFor",e)("matSvgIcon","overflow"),J.Eb(3),J.sc("ngForOf",t.overflowOptionItems)}}let ti=(()=>{class e{constructor(e,t){this.sdaTranslateService=e,this.timeoutService=t,this.panelToDisplay=je.REPORTS,this.selectedAll=!0,this.showSelectAll=!0,this.eventSelectAllCurrentPanel=new J.o,this.eventToggleHideTransparent=new J.o,this.eventDisplayChart=new J.o,this.eventUpdatePanelState=new J.o,this.eventResetSymbology=new J.o,this.eventGenerateUrl=new J.o,this.eventToggleConflictsView=new J.o,this.eventSortGroups=new J.o,this.displayChart=!1,this.VIR_SHOW_PIE_TOOLTIP=this.sdaTranslateService.get("VIR_SHOW_CHART_TOOLTIP","Show chart"),this.VIR_HIDE_PIE_TOOLTIP=this.sdaTranslateService.get("VIR_HIDE_CHART_TOOLTIP","Hide chart"),this.VIR_RESET_DEFAULT=this.sdaTranslateService.get("VIR_RESET_DEFAULT","Reset to default"),this.VIR_SELECTALL_TOOLTIP=this.sdaTranslateService.get("VIR_SELECTALL_TOOLTIP","Toggle display of listed results"),this.VIR_SHOW_NONMATCHING_ITEMS=this.sdaTranslateService.get("VIR_SHOW_NONMATCHING_ITEMS","Show non-matching items"),this.VIR_HIDE_NONMATCHING_ITEMS=this.sdaTranslateService.get("VIR_HIDE_NONMATCHING_ITEMS","Hide non-matching items"),this.VIR_RESET_COLORS=this.sdaTranslateService.get("VIR_RESET_COLORS","Reset colors"),this.VIR_GENERATE_SHARE_URL=this.sdaTranslateService.get("VIR_GENERATE_SHARE_URL","Generate Share URL"),this.VIR_COMBINE_REPEATED_RESULTS=this.sdaTranslateService.get("VIR_COMBINE_REPEATED_RESULTS","Combine repeated results"),this.VIR_SHOW_REPEATED_RESULTS=this.sdaTranslateService.get("VIR_SHOW_REPEATED_RESULTS","Show repeated results"),this.VIR_SORT_BY_NAME=this.sdaTranslateService.get("VIR_SORT_BY_NAME","Name"),this.VIR_SORT_BY_FREQUENCY=this.sdaTranslateService.get("VIR_SORT_BY_FREQUENCY","Frequency"),this.VIR_SORT_TOOLTIP=this.sdaTranslateService.get("VIR_SORT_TOOLTIP","Sort"),this.overflowOptionItems=[],this.sortOptionItems=[{key:He.FREQDESC,value:this.VIR_SORT_BY_FREQUENCY,selected:!0,icon:"arrow-down"},{key:He.FREQASC,value:this.VIR_SORT_BY_FREQUENCY,selected:!1,icon:"arrow-up"},{key:He.NAMEDESC,value:this.VIR_SORT_BY_NAME,selected:!1,icon:"arrow-down"},{key:He.NAMEASC,value:this.VIR_SORT_BY_NAME,selected:!1,icon:"arrow-up"}],this.chartToolTip=this.VIR_SHOW_PIE_TOOLTIP,this.repeatedViewToolTip=this.VIR_SHOW_REPEATED_RESULTS,this.searchReportName="VizSearch"}ngAfterViewInit(){this.overflowOptionItems[0]={key:Gt.SHOWHIDE,value:this.isModelTransparent?this.VIR_HIDE_NONMATCHING_ITEMS:this.VIR_SHOW_NONMATCHING_ITEMS},this.overflowOptionItems[1]={key:Gt.RESET,value:this.VIR_RESET_DEFAULT},this.overflowOptionItems[2]={key:Gt.URL,value:this.VIR_GENERATE_SHARE_URL},this.handleResetColorsOption(this.showResetColors)}ngOnChanges(e){e.showResetColors&&e.showResetColors.currentValue&&this.handleResetColorsOption(e.showResetColors.currentValue),e.currentReportSortOption&&e.currentReportSortOption.currentValue!==e.currentReportSortOption.previousValue&&this.setSortOptionValues(e.currentReportSortOption.currentValue)}selectAll(e){this.eventSelectAllCurrentPanel.emit(e)}setDisplayChart(){this.displayChart=!this.displayChart,this.chartToolTip=this.displayChart?this.VIR_HIDE_PIE_TOOLTIP:this.VIR_SHOW_PIE_TOOLTIP,this.eventDisplayChart.emit(this.displayChart)}resetColors(){this.eventResetSymbology.emit(),this.overflowOptionItems.pop()}isPanelDisplayedReports(){return this.panelToDisplay===je.REPORTS}isPanelDisplayedGroups(){return this.panelToDisplay===je.GROUPS}switchReportConflicts(){this.eventToggleConflictsView.emit(),this.repeatedViewToolTip=this.repeatedViewToolTip===this.VIR_SHOW_REPEATED_RESULTS?this.VIR_COMBINE_REPEATED_RESULTS:this.VIR_SHOW_REPEATED_RESULTS}overflowOptionClicked(e){e===Gt.SHOWHIDE?this.toggleHideTransparent():e===Gt.RESET?this.clearPanel():e===Gt.URL?this.eventGenerateUrl.emit():this.resetColors()}sortOptionClicked(e){!0!==this.sortOptionItems.find(t=>t.key===e).selected&&(this.eventSortGroups.emit(e),this.timeoutService.setTimeout(()=>{this.setSortOptionValues(e)},300))}setSortOptionValues(e){this.sortOptionItems.forEach(t=>{t.selected=t.key===e})}toggleHideTransparent(){this.isModelTransparent=!this.isModelTransparent,this.eventToggleHideTransparent.emit(this.isModelTransparent),this.timeoutService.setTimeout(()=>{this.overflowOptionItems[0].value=this.isModelTransparent?this.VIR_HIDE_NONMATCHING_ITEMS:this.VIR_SHOW_NONMATCHING_ITEMS},300)}clearPanel(){this.eventUpdatePanelState.emit(ze.CLEAR),this.eventUpdatePanelState.emit(ze.OPEN)}handleResetColorsOption(e){e&&this.overflowOptionItems.length>0&&(this.overflowOptionItems[3]={key:Gt.COLORS,value:this.VIR_RESET_COLORS})}}return e.\u0275fac=function(t){return new(t||e)(J.Sb(N.a),J.Sb(be.a))},e.\u0275cmp=J.Mb({type:e,selectors:[["sda-viz-panel-toolbar"]],inputs:{panelToDisplay:"panelToDisplay",selectedAll:"selectedAll",showSelectAll:"showSelectAll",isModelTransparent:"isModelTransparent",showResetColors:"showResetColors",reportHasConflicts:"reportHasConflicts",showMergedConflictsReport:"showMergedConflictsReport",currentReport:"currentReport",currentReportSortOption:"currentReportSortOption"},outputs:{eventSelectAllCurrentPanel:"eventSelectAllCurrentPanel",eventToggleHideTransparent:"eventToggleHideTransparent",eventDisplayChart:"eventDisplayChart",eventUpdatePanelState:"eventUpdatePanelState",eventResetSymbology:"eventResetSymbology",eventGenerateUrl:"eventGenerateUrl",eventToggleConflictsView:"eventToggleConflictsView",eventSortGroups:"eventSortGroups"},features:[J.Cb],decls:1,vars:1,consts:[["class","viz-panel-toolbar",4,"ngIf"],[1,"viz-panel-toolbar"],["class","viz-panel-toolbar__switch",3,"isActive","title","isActiveChange",4,"ngIf"],[1,"viz-panel-toolbar__button-group"],["class","viz-panel-toolbar__button-plain viz-panel-toolbar__command-button-icon",3,"matMenuTriggerFor","matSvgIcon","title",4,"ngIf"],["xPosition","before"],["sortMenu","matMenu"],["mat-menu-item","","class","viz-panel-toolbar-sort-menu-button",3,"click",4,"ngFor","ngForOf"],["class","viz-panel-toolbar__button-plain viz-panel-toolbar__command-button-icon",3,"matSvgIcon","viz-panel-toolbar__command-button-icon--selected","title","click",4,"ngIf"],[1,"viz-panel-toolbar__button-plain","viz-panel-toolbar__command-button-icon",3,"matMenuTriggerFor","matSvgIcon"],["overflowMenu","matMenu"],[1,"viz-panel-toolbar__switch",3,"isActive","title","isActiveChange"],[1,"viz-panel-toolbar__button-plain","viz-panel-toolbar__command-button-icon",3,"matMenuTriggerFor","matSvgIcon","title"],["mat-menu-item","",1,"viz-panel-toolbar-sort-menu-button",3,"click"],[1,"viz-panel-toolbar-sort-menu-button__text-group"],[1,"viz-panel-toolbar-sort-menu-button__text-group__directions"],[3,"svgIcon"],[1,"viz-panel-toolbar-sort-menu-button__check-container"],["svgIcon","check",4,"ngIf"],["svgIcon","check"],[1,"viz-panel-toolbar__button-plain","viz-panel-toolbar__command-button-icon",3,"matSvgIcon","title","click"]],template:function(e,t){1&e&&J.Sc(0,ei,13,8,"div",0),2&e&&J.sc("ngIf",!t.isPanelDisplayedReports())},directives:[s.t,c.e,s.s,Ot.a,c.d,ct.a,c.b,l.a],styles:["[_nghost-%COMP%]{position:relative;display:flex;flex:1;box-shadow:0 1px 5px rgba(0,0,0,.1);background-color:#fff;height:48px;overflow:hidden;border-bottom:1px solid #cad0d7}.viz-panel-toolbar[_ngcontent-%COMP%]{display:flex;flex:1;justify-content:space-between;font-size:13px;width:100%;align-items:center;margin-left:5px}.viz-panel-toolbar__switch[_ngcontent-%COMP%]{display:flex;align-items:center;padding:5px;cursor:pointer}.viz-panel-toolbar__command-button-icon[_ngcontent-%COMP%]{cursor:pointer}.viz-panel-toolbar__command-button-icon[_ngcontent-%COMP%]  .button__mat-icon{width:24px;height:24px;color:#697a8b}.viz-panel-toolbar__command-button-icon--selected[_ngcontent-%COMP%]{margin:0 2px;border-radius:5px;background-color:#afe5ff;cursor:pointer}.viz-panel-toolbar__command-button-icon--selected[_ngcontent-%COMP%]  .button__mat-icon{color:#02adff}.viz-panel-toolbar__button-group[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;width:100%;margin-right:2px;overflow:auto}.viz-panel-toolbar__button-plain[_ngcontent-%COMP%]{margin:0 2px}.viz-panel-toolbar[_ngcontent-%COMP%]     .button .button--plain{min-width:48px;height:48px}.viz-panel-toolbar-sort-menu-button[_ngcontent-%COMP%]{display:flex;justify-content:space-between;text-transform:none}.viz-panel-toolbar-sort-menu-button__check-container[_ngcontent-%COMP%]{margin-left:24px}.viz-panel-toolbar-sort-menu-button__text-group[_ngcontent-%COMP%]{display:flex;align-items:center}.viz-panel-toolbar-sort-menu-button__text-group__directions[_ngcontent-%COMP%]{width:24px;margin-right:8px}.viz-panel-toolbar-sort-menu-button[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-right:0}.viz-panel-toolbar-sort-menu-button[_ngcontent-%COMP%]:hover{background-color:#afe5ff}"]}),e})();const ii=["vizColorPicker"],si=["filtersGroup"];function ni(e,t){if(1&e){const e=J.Zb();J.Yb(0,"div",9),J.hc("mousedown",(function(t){return J.Kc(e),J.lc().startResize(t)})),J.Yb(1,"div",10),J.hc("dblclick",(function(){return J.Kc(e),J.lc().autoResize()})),J.Tb(2,"mat-icon",11),J.Xb(),J.Xb()}}function ai(e,t){if(1&e){const e=J.Zb();J.Yb(0,"sda-viz-panel-expandable-group",12,13),J.hc("eventToggleSelectState",(function(t){return J.Kc(e),J.lc().toggleFilterSelectState(t)})),J.Xb()}if(2&e){const e=J.lc();J.sc("panelExpanded",!1)("headerIcon","filter")("title",e.VIR_WORKSPACE_FILTERS_HEADER)("subTitle",e.activeFilterString)("itemData",e.filtersData)("panelToDisplay",e.panelDisplayed)("hideToggle",e.isPanelDisplayedItems)("disabled",e.isPanelDisplayedItems)}}function oi(e,t){if(1&e){const e=J.Zb();J.Yb(0,"mat-expansion-panel",14),J.Yb(1,"mat-expansion-panel-header",15),J.Yb(2,"mat-panel-title"),J.Tb(3,"mat-icon",16),J.Uc(4),J.Xb(),J.Xb(),J.Yb(5,"sda-viz-panel-search",17),J.hc("isModelTransparentChange",(function(t){return J.Kc(e),J.lc().isModelTransparent=t}))("eventSearchEquals",(function(t){return J.Kc(e),J.lc().onSearchEquals(t)}))("eventSearchContains",(function(t){return J.Kc(e),J.lc().onSearchContains(t)}))("eventUpdatePanelState",(function(t){return J.Kc(e),J.lc().updatePanelState(t)}))("eventToggleHideTransparent",(function(){return J.Kc(e),J.lc().toggleHideTransparent()}))("eventGenerateUrl",(function(){return J.Kc(e),J.lc().generateUrl()})),J.Xb(),J.Xb()}if(2&e){const e=J.lc();J.Eb(3),J.sc("svgIcon","search"),J.Eb(1),J.Wc(" ",e.VIR_SEARCH_HEADER," "),J.Eb(1),J.sc("isPanelDisplayedReports",e.isPanelDisplayedReports)("isPanelDisplayedGroups",e.isPanelDisplayedGroups)("currentReport",e.currentReport)("activeFilter",e.activeFilter)("isModelTransparent",e.isModelTransparent)("isSearchBusy",e.isSearchBusy)}}function ri(e,t){if(1&e){const e=J.Zb();J.Yb(0,"sda-viz-panel-expandable-group",18),J.hc("itemSelected",(function(t){return J.Kc(e),J.lc().itemSelected(t)}))("eventToggleSelectState",(function(t){return J.Kc(e),J.lc().toggleSelectState(t)})),J.Xb()}if(2&e){const e=J.lc();J.sc("panelExpanded",!0)("headerIcon","report")("title",e.REPORTS)("subTitle",e.activeReportString)("itemData",e.reportData)("panelToDisplay",e.panelDisplayed)}}function li(e,t){if(1&e){const e=J.Zb();J.Yb(0,"div",19),J.Yb(1,"sda-viz-panel-toolbar",20),J.hc("isModelTransparentChange",(function(t){return J.Kc(e),J.lc().isModelTransparent=t}))("eventSelectAllCurrentPanel",(function(t){return J.Kc(e),J.lc().selectAllCurrentPanel(t)}))("eventToggleHideTransparent",(function(){return J.Kc(e),J.lc().toggleHideTransparent()}))("showColorPicker",(function(t){return J.Kc(e),J.lc().showColorPicker(t)}))("eventDisplayChart",(function(t){return J.Kc(e),J.lc().showDisplayChart(t)}))("eventUpdatePanelState",(function(t){return J.Kc(e),J.lc().updatePanelState(t)}))("eventResetSymbology",(function(){return J.Kc(e),J.lc().resetGroupColors()}))("eventGenerateUrl",(function(){return J.Kc(e),J.lc().generateUrl()}))("eventToggleConflictsView",(function(){return J.Kc(e),J.lc().toggleConflictsView()}))("eventSortGroups",(function(t){return J.Kc(e),J.lc().sortGroups(t)})),J.Xb(),J.Yb(2,"sda-viz-panel-list-group",21),J.hc("itemSelected",(function(t){return J.Kc(e),J.lc().itemSelected(t)}))("showColorPicker",(function(t){return J.Kc(e),J.lc().showColorPicker(t)}))("eventUpdateCurrentGroup",(function(t){return J.Kc(e),J.lc().updateCurrentGroup(t)}))("eventToggleSelectState",(function(t){return J.Kc(e),J.lc().toggleSelectState(t)}))("eventItemsToFit",(function(t){return J.Kc(e),J.lc().itemsToFitChanged(t)}))("eventSelectFitAction",(function(){return J.Kc(e),J.lc().fitSelection()})),J.Xb(),J.Yb(3,"sda-viz-panel-color-picker",22,23),J.hc("updateColor",(function(t){return J.Kc(e),J.lc().updateColor(t)})),J.Xb(),J.Xb()}if(2&e){const e=J.lc();J.Eb(1),J.sc("panelToDisplay",e.panelDisplayed)("showSelectAll",e.showSelectAll())("selectedAll",e.selectedAll)("isModelTransparent",e.isModelTransparent)("showResetColors",e.canResetColors)("reportHasConflicts",e.reportHasConflicts)("showMergedConflictsReport",e.showMergedConflictsReport)("currentReport",e.currentReport)("currentReportSortOption",e.currentReportSortOption),J.Eb(1),J.sc("reportData",e.reportData)("panelToDisplay",e.panelDisplayed)("currentReport",e.currentReport)("panelDataLoading",e.panelDataLoading)("activeGroupColor",e.activeGroupColor)("activeGroupId",e.activeGroupId)("displayChart",e.displayChart)("viewerHeight",e.viewerHeight)("showMergedConflictsReport",e.showMergedConflictsReport)}}let ci=(()=>{class e{constructor(e,t,i,s,n,a,o,r,l,c,h,d){this.sdaTranslateService=e,this.vizReportsService=t,this.searchGraphicsService=i,this.odataService=s,this.loadingOverlayService=n,this.vizPanelUtilities=a,this.documentService=o,this.loggingService=r,this.uxtNotificationService=l,this.timeoutService=c,this.vizShareUrlService=h,this.workspaceFilterService=d,this.eventCustomMaterialObject=new J.o,this.eventObjectsToHide=new J.o,this.eventObjectsToShow=new J.o,this.eventAssignToObjects=new J.o,this.eventRemoveFromObjects=new J.o,this.eventClearModel=new J.o,this.eventFitSelection=new J.o,this.eventSetModelUnselected=new J.o,this.eventVizPanelResized=new J.o,this.eventIsVizReportExecuted=new J.o,this.NOT_SET=this.sdaTranslateService.get("NOT_SET","Not Set"),this.VIR_WORKSPACE_FILTERS_HEADER=this.sdaTranslateService.get("VIR_WORKSPACE_FILTERS_HEADER","Filter"),this.VIR_SEARCH_HEADER=this.sdaTranslateService.get("VIR_SEARCH_HEADER","Search"),this.REPORTS=this.sdaTranslateService.get("REPORTS","Reports"),this.panelState=ze.CLOSE,this.panelDisplayed=je.REPORTS,this.title1="",this.title2="",this.activeReportString="",this.activeFilterString=this.NOT_SET,this.currentReport="",this.currentGroup="",this.panelDataLoading=!1,this.selectedAll=!0,this.reportData=[],this.rightPosition="0px",this.canResetColors=!1,this.allVizReports=[],this.reports={},this.isModelTransparent=!0,this.isSearchBusy=!1,this.isPanelDisplayedReports=!0,this.isPanelDisplayedGroups=!1,this.isPanelDisplayedItems=!1,this.isPanelOpen=!1,this.isPanelHidden=!1,this.activeGroupColor="",this.activeGroupId="",this.contentMenuWidth=286,this.contentMenuMinPossibleWidth=100,this.contentMenuMaxAllowedWidth=500,this.latestXPosition=0,this.isGrabbed=!1,this.itemsToFit=new Array,this.mergeReportConflicts=!0,this.reportHasConflicts=!1,this.showMergedConflictsReport=!1,this.searchReportId="VizSearch",this.VIR_MAIN_TITLE=this.sdaTranslateService.get("VIR_MAIN_TITLE","Visual Intelligence Reporting"),this.VIR_RUNNING_REPORT_NAME=this.sdaTranslateService.get("VIR_RUNNING_REPORT-NAME","Running report {0}"),this.VIR_GROUPED_BY=this.sdaTranslateService.get("VIR_GROUPED_BY-NAME","Grouped by {0}"),this.VIR_GROUPED_BY_2=this.sdaTranslateService.get("VIR_GROUPED_BY-REPORT_NAME-ATTRIBUTE_NAME","{0} (Grouped by {1})"),this.VIR_GROUPS_FOUND=this.sdaTranslateService.get("VIR_GROUPS_FOUND-COUNT","{0} groups found"),this.VIR_NO_TAGS_FOUND=this.sdaTranslateService.get("GOVIEW_SEARCH_NO_TAGS_FOUND","No tags matching '{0}' were found"),this.VIR_NO_REPORT_FOUND=this.sdaTranslateService.get("VIR_NO_REPORT_FOUND","No report matching '{0}' was found"),this.VIR_SINGLE_ITEM_COUNT=this.sdaTranslateService.get("VIR_SINGULAR_ITEM-COUNT","{0} item"),this.VIR_MULTIPLE_ITEM_COUNT=this.sdaTranslateService.get("VIR_MULTIPLE_ITEM-COUNT","{0} items"),this.VIR_SINGLE_ITEM_RATIO_COUNT=this.sdaTranslateService.get("VIR_PARTIAL_ITEM-SHOWN-TOTAL","{0} of {1} item shown"),this.VIR_MULTIPLE_ITEM_RATIO_COUNT=this.sdaTranslateService.get("VIR_PARTIAL_ITEMS-SHOWN-TOTAL","{0} of {1} items shown"),this.VIR_URL_INCORRECT=this.sdaTranslateService.get("VIR_URL_INCORRECT","URL command incorrectly formatted"),this.VIR_URL_NO_REPORT_DEFINED=this.sdaTranslateService.get("VIR_URL_NO_REPORT_DEFINED","URL VIR command requires non-blank value"),this.VIR_URL_NOT_SUPPORTED_FOR_COMPOSITE=this.sdaTranslateService.get("VIR_URL_NOT_SUPPORTED_FOR_COMPOSITE","URL VIR not supported for composite model"),this.VIR_SEARCHING_MODEL=this.sdaTranslateService.get("VIR_SEARCHING_MODEL","Searching 3D Model..."),this.VIR_SEARCH_RESULTS=this.sdaTranslateService.get("VIR_SEARCH_RESULTS","Search Results"),this.VIR_IN_FILTER_GROUP=this.sdaTranslateService.get("VIR_IN_FILTER-GROUP","{0} (in filter)"),this.VIR_NOT_IN_FILTER_GROUP=this.sdaTranslateService.get("VIR_NOT_IN_FILTER-GROUP","{0} (not in filter)"),this.VIR_APPLYING_FILTER_FILTER=this.sdaTranslateService.get("VIR_APPLYING_FILTER-FILTER","Applying filter {0}"),this.nextAvailableGroupId=1,this.groupNames={},this.colors=fe.b,this.selectedColors=new Array,this.resettingGroupColors=!1,this.isReportFirstRun=!1,this.searchGroups=[],this.isUrlCommand=!1,this.urlSearchCount=0,this.urlSearchTotal=0,this.searchResultsTotal=0,this.hasFirstSearchRun=!1,this.panelReady=!1,this.urlReportId="",this.isConflictsUrlReport=!1,this.conflictsReportData={},this.conflictsReportSuffix="-conflict",this.FILTERED_GROUP_DELIMITER="^",this.CLAIMED_TO_CONFIGS_PROPERTY="ClaimedToConfigs"}ngOnInit(){this.panelDisplayed=je.REPORTS,this.title1=this.VIR_MAIN_TITLE,this.title2="",this.navigationStrategy!==z.a.COMPOSITE&&(this.panelDataLoading=!0,this.getListOfFiltersAndReports()),this.navigationStrategy!==z.a.GDS&&this.odataService.get(`Objects('${this.docVersionOBID}')?$expand=EDG_VersionMaster`,this.config,void 0,void 0,void 0,!0).pipe(Object(S.a)(1)).subscribe(e=>{this.docMasterOBID=e.value.EDG_VersionMaster[0].UID})}ngAfterViewInit(){this.panelReady=!0}ngOnChanges(e){void 0!==e.triggerRefreshDisplayEvent&&void 0!==e.triggerRefreshDisplayEvent.previousValue&&e.triggerRefreshDisplayEvent.currentValue!==e.triggerRefreshDisplayEvent.previousValue&&this.refreshDisplay(),e.readyForUrlCommand&&!1===e.readyForUrlCommand.previousValue&&!0===e.readyForUrlCommand.currentValue&&this.handleUrlCommand()}updatePanelToDisplay(e){this.panelDisplayed===je.ITEMS&&(this.itemsToFit=[]),this.panelDisplayed=e,this.handlePanelDisplayed(),this.closeColorPicker(),e===je.REPORTS&&(this.displayChart=!1),this.updateReportData(this.currentReport,this.currentGroup),this.setTitlesPerPanel(this.reports[this.currentReport],this.currentGroup),e!==je.REPORTS&&this.handleSetSelectAllForPanel()}updatePanelState(e){e===ze.OPEN?(this.panelState=ze.OPEN,this.isPanelOpen=!0,this.expandUrlCommand||this.eventVizPanelResized.emit(this.contentMenuWidth)):e===ze.CLOSE?(this.closeColorPicker(),this.panelState=ze.CLOSE,this.isPanelOpen=!1,this.expandUrlCommand=void 0,this.eventVizPanelResized.emit(0)):(this.closeColorPicker(),this.showObjects([]),this.clearModel(),this.clearAllStoredData(),this.panelDisplayed=je.REPORTS,this.setTitlesPerPanel(),this.displayChart=!1,this.eventIsVizReportExecuted.emit(!1),this.handlePanelDisplayed(),this.searchGroups=[],this.hasFirstSearchRun=!1,this.isUrlCommand=!1,this.expandUrlCommand=void 0,this.navigationStrategy!==z.a.COMPOSITE&&this.getListOfFiltersAndReports())}itemSelected(e){if(this.panelDisplayed===je.GROUPS){this.panelDisplayed=je.ITEMS;const t=e.split("|");this.displayReportResults(t[0],t[1]),this.handleSetSelectAllForPanel()}if(this.panelDisplayed===je.REPORTS){const t=this.getReportById(e);this.reportHasConflicts=!1,t&&t.HasClashes&&(this.reportHasConflicts=!0,this.reports[e].active?this.showMergedConflictsReport=!0:(e+=this.conflictsReportSuffix,this.showMergedConflictsReport=!1)),Object.values(this.reports).forEach(e=>{e.selected=!1}),this.reports.hasOwnProperty(e)&&(this.reports[e].selected=!0),t&&(this.reports[e]?(this.panelDisplayed=je.GROUPS,this.updateReportData(e),this.refreshDisplay(),this.handleSetSelectAllForPanel()):(this.isReportFirstRun=!0,this.mergeReportConflicts=!0,this.getPromptedColsThenRunReport(t)))}this.handlePanelDisplayed()}selectAllCurrentPanel(e){let t=!1;if(this.panelDisplayed===je.GROUPS)this.updateGroupChildrenSelection(e),this.reports[this.currentReport].selected=e;else{const i=this.getReportById(this.currentReport);i&&i.HasClashes&&(this.setGroupSelectState(this.reports[this.currentReport],void 0,!1,!0),t=!0),this.updateGroupChildrenSelection(e,this.getReportGroupById(this.currentReport,this.currentGroup))}this.refreshDisplay(),(!t||t&&e)&&(this.selectedAll=!this.selectedAll)}toggleHideTransparent(){this.isModelTransparent=!this.isModelTransparent,this.isModelTransparent?this.showObjects([]):this.hideObjects([]),this.refreshDisplay()}showColorPicker(e){this.vizColorPicker.openColorPicker(e)}updateColor(e){const t=e.color,i=e.groupId,s=this.getReportGroupById(this.currentReport,i),n=this.getFilteredGroupInfo(i);if(n){n.inFilter?s.colorId=t:s.colorId2=t;const e=this.getGroupById(this.currentReport,i);this.updateGroupChildrenColor(e,t)}else s.colorId=t,this.updateGroupChildrenColor(s,t);-1===this.selectedColors.indexOf(this.colors[t])&&this.selectedColors.push(this.colors[t]),this.updateCanResetColors(i,t),this.updateReportData(this.currentReport,i),this.refreshDisplay()}resetGroupColors(){this.resettingGroupColors=!0,Object.values(this.reports[this.currentReport].children).forEach(e=>{if(this.activeFilter){const t=this.getReportGroupFilteredGroups(e,this.activeFilter);t&&(e.colorId!==e.defaultGroupColorId&&(e.colorId=e.defaultGroupColorId,this.updateGroupChildrenColor(t[0],e.defaultGroupColorId)),e.colorId2!==e.defaultGroupColorId2&&(e.colorId2=e.defaultGroupColorId2,this.updateGroupChildrenColor(t[1],e.defaultGroupColorId2)))}else e.colorId!==e.defaultGroupColorId&&(e.colorId=e.defaultGroupColorId,this.updateGroupChildrenColor(e,e.defaultGroupColorId))}),this.canResetColors=!1,this.updateReportGroupsData(this.currentReport),this.refreshDisplay(),this.resettingGroupColors=!1}addCustomMaterial(e,t,i){this.eventCustomMaterialObject.emit({materialID:e,color:t,transparency:i})}hideObjects(e){this.eventObjectsToHide.emit(e)}showObjects(e,t){void 0===t&&(t=!1),this.eventObjectsToShow.emit([e,t])}assignMaterialToObjects(e,t,i){if(i){if(void 0!==i.activeMaterial&&e===i.activeMaterial)return;i.activeMaterial=e}this.eventAssignToObjects.emit([e,t])}removeMaterialFromObjects(e,t){if(t){if(void 0===t.activeMaterial)return;t.activeMaterial=void 0}this.eventRemoveFromObjects.emit(e)}clearModel(){if(this.currentReport||this.activeFilter){const e=[];if(this.currentReport&&e.push(...this.allReportGoids()),this.activeFilter){const t=this.getFilterById(this.activeFilter).goids;t&&t.length>0&&e.push(...t)}const t=new Set(e);this.eventClearModel.emit(Array.from(t))}}fitSelection(){const e=this.getReportGroupById(this.currentReport,this.currentGroup),t=[];Object.values(e.children).forEach(e=>{this.itemsToFit.indexOf(e.id)>=0&&e.goid&&t.push(...e.goid)}),this.eventFitSelection.emit(t)}setModelUnselected(){this.addCustomMaterial(fe.p,this.vizPanelUtilities.convertHexToRgb(fe.o,.5),fe.n),this.eventSetModelUnselected.emit()}showDisplayChart(e){this.displayChart=e}toggleFilterSelectState(e){const t=this.getFilterById(e[0].id);this.setActiveFilter(t),(void 0===t.goids?this.runWorkspaceFilter(t,this.config):Object(v.a)(t.goids)).pipe(Object(S.a)(1)).subscribe(()=>{this.refreshDisplay()})}toggleSelectState(e){if(this.panelDisplayed===je.REPORTS){const t=this.currentReport=e[0].id;Object.values(this.reports).forEach(e=>{e.selected=!1}),this.reports.hasOwnProperty(t)?(this.setReportSelectState(t,e[0].selected),this.setSelectStateForMergedConflictReport(e[0].selected,t),this.refreshDisplay()):this.itemSelected(e[0].id)}if(this.panelDisplayed===je.GROUPS&&this.toggleSelectStateGroups(e),this.panelDisplayed===je.ITEMS){const t=this.getGroupById(this.currentReport,this.currentGroup),i=this.getReportById(this.currentReport);if(i&&i.HasClashes){const i=this.reports[this.currentReport];0===this.vizPanelUtilities.countSelectedChildren(t.children)&&this.setGroupSelectState(i,e,e[0].selected,!0)}this.setItemsSelectState(t,e,e[0].selected),this.handleSetSelectAllForPanel(),this.refreshDisplay()}}refreshDisplay(){this.currentReport?this.displayReportResults(this.currentReport,this.currentGroup):(this.showObjects([]),this.setModelUnselected(),this.applyFilter())}itemsToFitChanged(e){this.itemsToFit=e}autoResize(){this.contentMenuWidth=this.contentMenuWidth<this.contentMenuMaxAllowedWidth?this.contentMenuMaxAllowedWidth:this.contentMenuMinPossibleWidth,this.eventVizPanelResized.emit(this.contentMenuWidth)}startResize(e){e.preventDefault(),this.isGrabbed=!0,this.latestXPosition=e.clientX,this.mouseMoveSubscription$=Object(Le.a)(this.documentService.Document,"mousemove").subscribe(e=>this.widthResizing(e)),this.mouseUpSubscription$=Object(Le.a)(this.documentService.Document,"mouseup").subscribe(e=>this.blockResize(e))}updateCurrentGroup(e){this.currentGroup=e}onSearchEquals(e){e&&""!==e&&(this.isUrlCommand=!1,this.loadingOverlayService.showLoadingOverlay(this.VIR_SEARCHING_MODEL),this.onSearch(e,!1).pipe(Object(S.a)(1)).subscribe(e=>{this.loadingOverlayService.hideLoadingOverlay(),this.isSearchBusy=e}))}onSearchContains(e){e&&""!==e&&(this.isUrlCommand=!1,this.loadingOverlayService.showLoadingOverlay(this.VIR_SEARCHING_MODEL),this.onSearch(e,!0).pipe(Object(S.a)(1)).subscribe(e=>{this.loadingOverlayService.hideLoadingOverlay(),this.isSearchBusy=e}))}generateUrl(){this.vizShareUrlService.getGeneratedUrl(this.reports[this.currentReport],this.currentReport,this.methodOBID)}showSelectAll(){if(this.panelDisplayed===je.GROUPS){let e=!0;if(this.currentReport){const t=this.getReportById(this.currentReport);t&&(e=!t.HasClashes)}return e}return!0}toggleConflictsView(){this.showMergedConflictsReport=!this.showMergedConflictsReport,this.showMergedConflictsReport?(this.reports[this.currentReport].active=!1,this.currentReport=this.currentReport.replace(this.conflictsReportSuffix,""),this.reports[this.currentReport].active=!0,this.displayReportResults(this.currentReport)):(this.reports.hasOwnProperty(this.currentReport+this.conflictsReportSuffix)?(this.reports[this.currentReport].active=!1,this.currentReport=this.currentReport+this.conflictsReportSuffix,this.reports[this.currentReport].active=!0,this.displayReportResults(this.currentReport)):(this.reports[this.currentReport].active=!1,this.createConflictsReport(this.currentReport)),this.handleSetSelectAllForPanel())}sortGroups(e,t){this.reportData=this.internalSortGroups(e,t)}internalSortGroups(e,t){let i;switch(this.reports[this.currentReport].sortedBy=e,this.currentReportSortOption!==e&&(this.currentReportSortOption=e),e){case He.FREQDESC:i=this.sortGroupsByFrequency(He.FREQDESC,t);break;case He.FREQASC:i=this.sortGroupsByFrequency(He.FREQASC,t);break;case He.NAMEDESC:i=this.sortGroupsByName(He.NAMEDESC,t);break;case He.NAMEASC:i=this.sortGroupsByName(He.NAMEASC,t)}return i}isAnyGoidInFilter(e,t){return t.some(t=>ke(e,t)>=0)}updateTagsInFilter(e,t,i){const s=this.reports[e];if(s&&s.children){const e=this.getFilterById(t).goids;Object.values(s.children).forEach(s=>{s&&s.children&&Object.values(s.children).forEach(s=>{s.inFilter||(s.inFilter={}),!i&&s.inFilter.hasOwnProperty(t)||(s.inFilter[t]=this.isAnyGoidInFilter(e,s.goid))})})}}getTagsByFilter(e,t,i){const s=[];return e&&e.children&&Object.values(e.children).forEach(e=>{let n;e&&e.inFilter&&e.inFilter.hasOwnProperty(t)&&(n=e.inFilter[t]),(i&&!0===n||!i&&!1===n)&&s.push(e)}),s}onSearch(e,t){return this.searchGroups.indexOf(e.toLowerCase())>-1?Object(v.a)(!1):(this.isSearchBusy=!0,this.searchGraphicsService.onSearchDocument(e,t).pipe(Object(re.a)(t=>(t.totalCount>0?(this.processSearchResults(e,t),this.searchGroups.push(e.toLowerCase()),this.searchResultsTotal=this.searchResultsTotal+t.totalCount):0===t.totalCount&&this.uxtNotificationService.info(this.sdaTranslateService.getFormattedByString(this.VIR_NO_TAGS_FOUND,[e])),this.handleDisplaySearchResults(this.searchReportId),!1))))}widthResizing(e){e.preventDefault();const t=e.currentTarget.documentElement.clientWidth,i=t-this.contentMenuMinPossibleWidth,s=t-this.contentMenuMaxAllowedWidth;this.isGrabbed&&(e.clientX>t-this.contentMenuMinPossibleWidth?this.contentMenuWidth=this.contentMenuMinPossibleWidth:e.clientX<=i&&e.clientX>=s?(this.onResize(e.clientX-this.latestXPosition),this.latestXPosition=e.clientX):e.clientX<s&&(this.contentMenuWidth=this.contentMenuMaxAllowedWidth),this.eventVizPanelResized.emit(this.contentMenuWidth))}onResize(e){this.contentMenuWidth-=e}blockResize(e){this.isGrabbed=!1,this.mouseMoveSubscription$&&this.mouseMoveSubscription$.unsubscribe(),this.mouseUpSubscription$&&this.mouseUpSubscription$.unsubscribe()}updateCanResetColors(e,t){const i=this.reports[this.currentReport];let s,n=!1;const a=this.getFilteredGroupInfo(e);let o;a?(s=this.getReportGroupById(this.currentReport,a.reportGroupId),o=a.inFilter?s.defaultGroupColorId:s.defaultGroupColorId2):(s=this.getReportGroupById(this.currentReport,e),o=s.defaultGroupColorId),n=o!==t||Object.values(i.children).some(e=>e.defaultGroupColorId!==e.colorId),this.canResetColors=n}updateGroupChildrenColor(e,t){Object.values(e.children).forEach(e=>{e.colorId=t})}getListOfFilters(){return this.navigationStrategy===z.a.GDS?(this.loggingService.info("Querying for all available workspace filters"),this.workspaceFilterService.getWorkspaceFilters(this.config,this.excludedFilterUID)):Object(v.a)([])}getListOfFiltersAndReports(){this.panelDataLoading=!0,this.getListOfFilters().pipe(Object(S.a)(1)).subscribe(e=>{this.filtersData=e.map(e=>({id:e.Id,UID:e.UID,name:e.Name,description:void 0,selected:!1,reportColor:void 0,fitSelected:!1,goids:void 0})),this.getListOfReports()})}getListOfReports(){this.panelDataLoading=!0,this.loggingService.info("Querying for all available visual intelligence reports."),this.vizReportsService.getVizReports(this.config,this.navigationStrategy!==z.a.GDS).pipe(Object(S.a)(1)).subscribe(e=>{this.loggingService.info(`Visual intelligence reports query returned with ${e.length} result(s).`),this.allVizReports.push(...e),this.panelDataLoading=!1,this.expandUrlCommand?this.expandUrlCommand.VIR&&this.waitExecuteUrlReport():this.updateReportData()})}assignMaterialID(e,t){const i=this.colors[e];t?this.addCustomMaterial(e+100,this.vizPanelUtilities.convertHexToRgb(i,1),fe.n):this.addCustomMaterial(e,this.vizPanelUtilities.convertHexToRgb(i,1),0)}getNextColor(){let e=0,t=0;for(t=0;t<this.colors.length;t++)if(-1===this.selectedColors.indexOf(this.colors[t])){e=t,this.selectedColors.push(this.colors[t]);break}return e}getFilteredGroupId(e,t,i){return`${e}${this.FILTERED_GROUP_DELIMITER}${t}${this.FILTERED_GROUP_DELIMITER}${i?"+":"-"}`}getFilteredGroupInfo(e){if(e.indexOf(this.FILTERED_GROUP_DELIMITER)>0){const t=e.split(this.FILTERED_GROUP_DELIMITER);return{reportGroupId:t[0],filterId:t[1],inFilter:"+"===t[2]}}}getReportGroupById(e,t){const i=this.getFilteredGroupInfo(t);return i?this.reports[e].children[i.reportGroupId]:this.reports[e].children[t]}getGroupById(e,t){const i=this.getFilteredGroupInfo(t);if(i){const t=this.reports[e].children[i.reportGroupId].filteredGroups;let s;if(t&&t.hasOwnProperty(i.filterId)){const e=t[i.filterId];e&&2===e.length&&(s=e[i.inFilter?0:1])}return s}return this.reports[e].children[t]}getItemsPanelTitle(e,t){let i="";const s=this.getFilteredGroupInfo(t);return i=s?this.sdaTranslateService.getFormattedByString(s.inFilter?this.VIR_IN_FILTER_GROUP:this.VIR_NOT_IN_FILTER_GROUP,[e.children[s.reportGroupId].name]):e.children[t].name,i}getActiveReportString(){let e=this.NOT_SET;return this.currentReport&&(e=this.currentReport===this.searchReportId?this.VIR_SEARCH_RESULTS:this.reports[this.currentReport].label),e}getActiveFilterString(){let e=this.NOT_SET;if(this.activeFilter){const t=this.getFilterById(this.activeFilter);t&&(e=t.name)}return e}setTitlesPerPanel(e,t){this.panelDisplayed===je.REPORTS&&(this.title1=this.VIR_MAIN_TITLE,this.title2="",this.activeReportString=this.getActiveReportString(),this.activeFilterString=this.getActiveFilterString()),this.panelDisplayed===je.GROUPS&&(void 0!==e?this.title1=e.label:this.currentReport===this.searchReportId&&(this.title1=this.VIR_SEARCH_RESULTS),this.title2=this.currentReport!==this.searchReportId?this.sdaTranslateService.getFormattedByString(this.VIR_GROUPED_BY,[e.vizAttrName]):""),this.panelDisplayed===je.ITEMS&&(this.title1=this.getItemsPanelTitle(e,t),this.title2=this.currentReport!==this.searchReportId?this.sdaTranslateService.getFormattedByString(this.VIR_GROUPED_BY_2,[e.label,e.vizAttrName]):"")}getColorById(e){return"#"+this.colors[e]}getActiveGroupColor(e,t){let i;const s=this.getFilteredGroupInfo(t);if(s){const t=this.getReportGroupById(e,s.reportGroupId);i=!1===s.inFilter?t.colorId2:t.colorId}else i=this.getReportGroupById(e,t).colorId;return this.getColorById(i)}updateReportData(e,t){this.activeGroupColor="",this.activeGroupId="",this.panelDisplayed===je.REPORTS&&(this.reportData=this.getArrayForReports(),this.activeFilter&&this.currentReport&&this.getArrayForFilteredGroups(this.currentReport,this.activeFilter)),this.panelDisplayed===je.GROUPS&&this.updateReportGroupsData(e),this.panelDisplayed===je.ITEMS&&(this.reportData=this.getArrayForGroupObjects(e,t),this.currentGroup=t,this.activeGroupColor=this.getActiveGroupColor(e,t),this.activeGroupId=t)}updateReportGroupsData(e){this.currentReport=e,this.reportData=this.activeFilter?this.getArrayForFilteredGroups(e,this.activeFilter):this.getArrayForGroups(e)}getFilterById(e){return this.filtersData.find(t=>t.id===e)}getReportById(e){return this.allVizReports.find(t=>t.Id===e)}applyFilter(e){if(!e&&this.activeFilter&&(e=this.getFilterById(this.activeFilter).goids),e&&e.length>0){let t=!1;if(this.currentReport){const e=this.reports[this.currentReport];t=e&&e.selected}t?(this.addCustomMaterial(fe.e,this.vizPanelUtilities.convertHexToRgb(fe.c,1),fe.n),this.assignMaterialToObjects(fe.e,e)):(this.addCustomMaterial(fe.d,this.vizPanelUtilities.convertHexToRgb(fe.c,1),0),this.assignMaterialToObjects(fe.d,e))}}runWorkspaceFilter(e,t){return void 0!==e.goids?Object(v.a)(e.goids):(this.loadingOverlayService.showLoadingOverlay(this.sdaTranslateService.getFormattedByString(this.VIR_APPLYING_FILTER_FILTER,[this.replaceNonBreakingHyphens(e.name)])),this.workspaceFilterService.runWorkspaceFilter(e.UID,this.config).pipe(Object(S.a)(1),Object(re.a)(t=>(t.sort(),this.loadingOverlayService.hideLoadingOverlay(),e.goids=t,t))))}getPromptedColsThenRunReport(e){void 0===e.PromptedCols?this.odataService.get(`Objects('${e.Id}')?$expand=EDG_ReportParamsWithPrompt`,this.config,void 0,void 0,void 0,!0).pipe(Object(S.a)(1)).subscribe(t=>{e.PromptedCols=[],(null==t?void 0:t.value)&&t.value.EDG_ReportParamsWithPrompt.forEach(t=>{e.PromptedCols.push(t.OBID)}),this.runVizReport(e)}):this.runVizReport(e)}runVizReport(e){var t;const i=e.Name,s=e.Id;this.loadingOverlayService.showLoadingOverlay(this.sdaTranslateService.getFormattedByString(this.VIR_RUNNING_REPORT_NAME,[i])),this.selectedColors=[];const n=null===(t=this.expandUrlCommand)||void 0===t?void 0:t.PARAMS;this.loggingService.info(`Executing visual intelligence report ${i}.`),this.vizReportsService.executeVizReport(e,this.docMasterOBID,this.config,n).pipe(Object(S.a)(1)).subscribe(t=>{this.expandUrlCommand=void 0,this.loggingService.info(`Visual intelligence report ${i} execution completed with ${t.value.Results.length} results.`),this.loadingOverlayService.hideLoadingOverlay();const n=t.value.ResultColumns,a=this.vizReportsService.lookupGoidResultColumn(n);let o;if(!a)return void this.loggingService.info(`Visual intelligence report ${i} report definition configured incorrectly.`);o=a.Id;const r=this.vizReportsService.findGroupByColumnName(e.Details);if(!r)return void this.loggingService.info(`Visual intelligence report ${i} report definition configured incorrectly.`);const l=this.vizReportsService.lookupResultColumnByDisplayAs(n,r),c=this.reports[s]={label:i,reportDefn:e,selected:!0,graphicOidAttrName:o,vizAttrName:r,vizAttrLabel:l.DisplayAs,children:{},count:0,selectedCount:0,active:!1};this.defineGroup(c,"Null","Null"),c.count++,this.processReportResults(s,t.value.Results,o,l),this.panelDisplayed=je.GROUPS,this.handlePanelDisplayed(),this.displayReportResults(s),this.reportHasConflicts&&(this.storeConflictsData(e,o,r,l,t.value.Results),this.isConflictsUrlReport&&this.toggleConflictsView())})}storeConflictsData(e,t,i,s,n){this.conflictsReportData[e.Id]={Report:e,Results:n,GoidAttr:t,GroupByAttrName:i,ReportColumn:s}}createConflictsReport(e){const t=this.conflictsReportData[e];this.mergeReportConflicts=!1,this.isReportFirstRun=!0,this.selectedColors=[],this.reports[t.Report.Id+this.conflictsReportSuffix]={label:t.Report.Name,reportDefn:t.Report,selected:!0,graphicOidAttrName:t.GoidAttr,vizAttrName:t.ReportColumn.DisplayAs,vizAttrLabel:t.GroupByAttrName,children:{},count:0,selectedCount:0,active:!0},this.processReportResults(t.Report.Id+this.conflictsReportSuffix,t.Results,t.GoidAttr,t.ReportColumn),this.displayReportResults(t.Report.Id+this.conflictsReportSuffix),this.isReportFirstRun=!1}clearAllStoredData(){this.currentGroup="",this.currentReport="",this.allVizReports=[],this.activeFilter=void 0,this.filtersData=[],this.reports={},this.reportData=[],this.groupNames={},this.selectedColors=[],this.nextAvailableGroupId=1,this.canResetColors=!1,this.searchResultsTotal=0}defineGroup(e,t,i){const s={id:this.nextAvailableGroupId,color:0};e.children[t]={id:t,name:i,groupValue:this.nextAvailableGroupId.toString(),selected:!0,children:{},count:0,selectedCount:0,defaultGroupColorId:void 0,colorId:void 0,description:void 0,reportColor:void 0,fitSelected:!1},this.groupNames[t]=s,this.nextAvailableGroupId+=1}processReportResults(e,t,i,s){const n=this.getReportById(e),a=s.PropertyDefUID===this.CLAIMED_TO_CONFIGS_PROPERTY,o=this.reports[e];t.forEach(e=>{const t=e,r=s.Id,l=a?t[r].split(";"):t[r],c=t.Name,h=t.Id;let d;null===l||""===l?d=["Null"]:(Array.isArray(l)?this.mergeReportConflicts?(d=l,n.HasClashes=!0,this.reportHasConflicts=!0,this.showMergedConflictsReport=!0):d=[l.sort().toString()]:d=[l],d.forEach(e=>{this.groupNames.hasOwnProperty(e)&&o.children.hasOwnProperty(e)||(this.defineGroup(o,e,e),o.count++)}));const p=t[i];if(null!==p&&""!==p){let e=Array.isArray(p)?p:p.split(",");if(e[e.length-1].indexOf("@")>-1&&!this.vizPanelUtilities.checkForPartialMonikers(e[e.length-1])){const t=e.map(e=>this.vizPanelUtilities.getPartialMoniker(e));e=t}e=e.filter(e=>e&&e.length>0),d.forEach(t=>{const i=o.children[t];i.children[h]={id:h,name:c,description:"",reportColor:void 0,fitSelected:!1,selected:!0,colorId:i.colorId,goid:e},o.children[t].count++,o.children[t].selectedCount++})}}),o.sortedBy=He.FREQDESC,this.deleteNullReportGroup(o),this.mergeReportConflicts&&n.HasClashes?(this.selectedAll=!1,o.selectedCount=1,o.active=!0):(this.selectedAll=!0,o.selectedCount=o.count)}deleteNullReportGroup(e){e.children.hasOwnProperty("Null")&&0===e.children.Null.count&&(delete e.children.Null,e.count-=1)}processSearchResults(e,t){const i=this.searchReportId;this.addNewSearchReport(this.VIR_SEARCH_RESULTS,i,e),this.addNewSearchGroup(i,e);const s=t.graphics.length,n=this.getPartialMonikersForSearchGraphics(t.graphics,s);let a;for(let o=0;o<s;o++)a=[],a.push(n[o]),this.reports[i].children[e].children[n[o]]={id:n[o],name:t.name[o],description:"",reportColor:void 0,fitSelected:!1,selected:!0,colorId:this.reports[i].children[e].colorId,goid:a};1===s&&(this.isUrlCommand&&1===this.urlSearchTotal||!this.isUrlCommand)&&this.eventFitSelection.emit(n),this.reports[i].children[e].count=s,this.reports[i].children[e].selectedCount=s,this.currentReport=i,this.toggleOffAllReports(i)}addNewSearchReport(e,t,i){if(!this.getReportById(t)&&!this.hasFirstSearchRun){let s;this.hasFirstSearchRun=!0,s={Id:t,Name:e,Details:[{Id:i,Name:i}]},this.allVizReports.unshift(s),this.reports[t]={label:e,reportDefn:s,selected:!0,graphicOidAttrName:i,vizAttrName:i,vizAttrLabel:i,children:{},count:0,selectedCount:0}}}addNewSearchGroup(e,t){const i=this.reports[e];this.groupNames.hasOwnProperty(t)&&i.children.hasOwnProperty(t)||(this.defineGroup(i,t,t),i.count++);const s=this.reports[e].count-1;if(this.filtersData&&this.filtersData.length>0){const e=s%Math.floor(this.colors.length/2),n=i.children[t];n.colorId=n.defaultGroupColorId=2*e,n.colorId2=n.defaultGroupColorId2=n.colorId+1}else{const e=Math.max(0,Math.floor(s/this.colors.length));i.children[t].colorId=i.children[t].defaultGroupColorId=0===e?s:s-e*this.colors.length}}getPartialMonikersForSearchGraphics(e,t){return e[t-1].indexOf("@")>-1&&this.navigationStrategy!==z.a.COMPOSITE&&!this.vizPanelUtilities.checkForPartialMonikers(e[t-1])?e.map(e=>this.vizPanelUtilities.getPartialMoniker(e)):e}toggleOffAllReports(e){this.panelDisplayed===je.REPORTS&&(Object.values(this.reports).forEach(e=>{e.selected=!1}),this.reports[e].selected=!0)}handleDisplaySearchResults(e){this.isUrlCommand&&this.urlSearchCount++,this.searchResultsTotal>0&&(!this.isUrlCommand||this.urlSearchCount===this.urlSearchTotal)?(this.panelDisplayed=je.GROUPS,this.handlePanelDisplayed(),this.displayResultsTimeout(e)):this.urlSearchCount===this.urlSearchTotal&&0===this.searchResultsTotal&&(this.isUrlCommand=!1,this.loadingOverlayService.hideLoadingOverlay(),this.eventVizPanelResized.emit(this.contentMenuWidth))}displayResultsTimeout(e){this.panelReady?(this.displayReportResults(e),this.isUrlCommand&&(this.loadingOverlayService.hideLoadingOverlay(),this.eventVizPanelResized.emit(this.contentMenuWidth))):this.timeoutService.setTimeout(()=>{this.displayResultsTimeout(e)},300)}getArrayForReports(){const e=[];return this.allVizReports.forEach(t=>{const i=this.reports.hasOwnProperty(t.Id)&&void 0!==this.reports[t.Id].count?this.sdaTranslateService.getFormattedByString(this.VIR_GROUPS_FOUND,[this.reports[t.Id].count.toString()]):"";e.push({id:t.Id,name:t.Name,description:i,selected:!(void 0===this.reports[t.Id]||!this.reports[t.Id].selected),reportColor:void 0,fitSelected:!1})}),e}reportColorById(e){return void 0===e?void 0:"#"+this.colors[e]}initializeGroupsForFilter(e,t){const i=new Array(2);let s=this.getTagsByFilter(e,t,!0),n=s?s.length:0,a=0===n,o=this.getDescriptionForChildCount(n,n);const r=e.id,l=e.name,c=e.selected;let h=a?void 0:this.reportColorById(e.colorId),d={id:this.getFilteredGroupId(r,t,!0),name:l,description:o,reportColor:h,count:n,selectedCount:n,selected:c&&!a,fitSelected:!1,disabled:a,children:{},groupValue:void 0};return s.forEach(e=>{d.children[e.id]=e}),i[0]=d,s=this.getTagsByFilter(e,t,!1),n=s.length,a=0===n,o=this.getDescriptionForChildCount(n,n),h=a?void 0:this.reportColorById(e.colorId2),d={id:this.getFilteredGroupId(r,t,!1),name:this.sdaTranslateService.getFormattedByString(this.VIR_NOT_IN_FILTER_GROUP,[l]),description:o,reportColor:h,count:n,selectedCount:n,selected:c&&!a,fitSelected:!1,disabled:a,children:{},groupValue:void 0},s.forEach(e=>{d.children[e.id]=e}),i[1]=d,void 0===e.filteredGroups&&(e.filteredGroups={}),e.filteredGroups[t]=i,i}getReportGroupFilteredGroups(e,t){let i;return e.filteredGroups&&e.filteredGroups.hasOwnProperty(t)&&(i=Object.values(e.filteredGroups[t])),i}getArrayForFilteredGroups(e,t){let i=[],s=!1;this.updateTagsInFilter(e,t,!1);const n=this.reports[e],a=n.children;if(a&&Object.values(a).forEach(e=>{const n=this.getReportGroupFilteredGroups(e,t);n&&n.length>0?(n.forEach((t,i)=>{t.description=this.getDescriptionForChildCount(t.count,this.vizPanelUtilities.countSelectedChildren(t.children)),t.reportColor&&(t.reportColor=this.reportColorById(0===i?e.colorId:e.colorId2))}),i.push(...n)):(s=!0,i.push(...this.initializeGroupsForFilter(e,t)))}),i=this.internalSortGroups(n.sortedBy?n.sortedBy:He.FREQDESC,i),this.reportHasConflicts&&this.mergeReportConflicts&&s){this.selectedAll=!1,n.selectedCount=1;const e=i.find(e=>!e.disabled);e&&this.setFilteredGroupItemSelectState(n,[e],!0,!0)}return i}getArrayForGroups(e){let t;const i=this.reports[e];let s=[];if(i&&i.children&&(s=Object.values(i.children).map(e=>{const t=this.getDescriptionForChildCount(e.count,this.vizPanelUtilities.countSelectedChildren(e.children));return{id:e.id,name:e.name,description:t,reportColor:this.reportColorById(e.colorId),count:e.count,selected:e.selected,fitSelected:!1}}),e===this.searchReportId?(s.reverse(),t=s):t=this.internalSortGroups(i.sortedBy?i.sortedBy:He.FREQDESC,s)),this.reportHasConflicts&&this.mergeReportConflicts&&this.isReportFirstRun){this.selectedAll=!1,i.selectedCount=1;let e=!0;Object.values(s).forEach(t=>{e?(t.selected=!0,this.setGroupSelectState(i,[t],!0,!0),e=!1):t.selected=!1}),t=s}return t}getDescriptionForChildCount(e,t){let i;return i=t!==e?this.sdaTranslateService.getFormattedByString(1===e?this.VIR_SINGLE_ITEM_RATIO_COUNT:this.VIR_MULTIPLE_ITEM_RATIO_COUNT,[t.toString(),e.toString()]):this.sdaTranslateService.getFormattedByString(1===e?this.VIR_SINGLE_ITEM_COUNT:this.VIR_MULTIPLE_ITEM_COUNT,[e.toString()]),i}getArrayForGroupObjects(e,t){const i=this.getGroupById(e,t),s=[];return Object.values(i.children).forEach(e=>{s.push({name:e.name,id:e.id,reportColor:i.reportColor,selected:e.selected,fitSelected:!1,description:void 0})}),s}displayReportResults(e,t){this.updateReportData(e,t),this.setTitlesPerPanel(this.reports[e],t),(this.isReportFirstRun||""!==this.urlReportId)&&this.setColorsFirstRun(e),this.isModelTransparent?(this.showObjects([]),this.setModelUnselected(),this.applyFilter()):this.processGoids(e),this.activeFilter&&this.updateTagsInFilter(e,this.activeFilter,!1),Object.values(this.reports[e].children).forEach(e=>{this.unsetActiveMaterial(e),this.assignResultGroupsColors(e,t)}),""!==this.urlReportId&&(this.eventVizPanelResized.emit(this.contentMenuWidth),this.urlReportId="")}unsetActiveMaterial(e){e.activeMaterial=void 0,e.filteredGroups&&Object.values(e.filteredGroups).forEach(e=>{e.forEach(e=>{this.unsetActiveMaterial(e)})})}assignGoidColors(e,t,i,s){i.length>0?this.panelDisplayed===je.ITEMS?e.id!==s?(this.assignMaterialID(t,!0),this.assignMaterialToObjects(t+100,i,e)):(this.assignMaterialID(t,!1),this.assignMaterialToObjects(t,i,e)):(this.assignMaterialID(t,!1),this.removeMaterialFromObjects(i,e),this.assignMaterialToObjects(t,i,e)):this.removeMaterialFromObjects(i,e)}assignResultGroupsColors(e,t){if(this.activeFilter&&e.filteredGroups)return this.assignFilteredGroupsColors(e,t,this.activeFilter);const i=!1===this.resettingGroupColors?e.colorId:e.defaultGroupColorId,s=this.vizPanelUtilities.getChildrenGoids(e);e.selected&&this.assignGoidColors(e,i,s,t)}assignFilteredGroupsColors(e,t,i){Object.values(e.filteredGroups[i]).forEach(i=>{const s=this.getFilteredGroupInfo(i.id);let n;void 0!==e.colorId2||s.inFilter||(e.colorId2=e.defaultGroupColorId2=this.getNextColor(),void 0===i.reportColor&&(i.reportColor=this.reportColorById(e.colorId2))),n=!1===this.resettingGroupColors?s.inFilter?e.colorId:e.colorId2:s.inFilter?e.defaultGroupColorId:e.defaultGroupColorId2;const a=[],o=[];this.vizPanelUtilities.getChildrenGoidsByFilter(e,s.filterId,a,o),i.selected&&this.assignGoidColors(i,n,s.inFilter?a:o,t)})}setColorsFirstRun(e){const t=this.reports[e];let i,s=0;this.reportData.forEach((e,n)=>{const a=this.getFilteredGroupInfo(e.id);a?(i=t.children[a.reportGroupId],void 0===i.defaultGroupColorId&&(i.colorId=i.defaultGroupColorId=this.getNextColor()),void 0===i.defaultGroupColorId2&&(i.colorId2=i.defaultGroupColorId2=this.getNextColor()),e.disabled||(e.reportColor=this.reportColorById(a.inFilter?i.colorId:i.colorId2))):(n<this.colors.length&&(s=this.getNextColor()),e.reportColor=this.reportColorById(s),i=t.children[e.id],i.colorId=i.defaultGroupColorId=s)}),this.isReportFirstRun=!1,this.eventIsVizReportExecuted.emit(!0)}processGoids(e){const t=[];Object.values(this.reports[e].children).forEach(e=>{if(e.selected){const i=this.vizPanelUtilities.getChildrenGoids(e);t.push(...i)}}),t.length>0?this.showObjects(t,!0):this.hideObjects([])}setReportSelectState(e,t){if(this.reports.hasOwnProperty(e)){const i=this.reports[e];this.setGroupSelectState(i,void 0,t,!1),i.selected=t}}setFilteredGroupItemSelectState(e,t,i,s){if(t.forEach(e=>{Object.values(e.children).forEach(e=>{e.selected=i}),e.selectedCount=this.vizPanelUtilities.countSelectedChildren(e.children),e.selected=0!==e.selectedCount}),s&&i){const i=t[0].id,s=this.getFilteredGroupInfo(i),n=[];Object.values(e.children).forEach(e=>{e.filteredGroups&&Object.values(e.filteredGroups).forEach(e=>{n.push(...e.filter(e=>{const t=this.getFilteredGroupInfo(e.id);return s.filterId===t.filterId&&e.id!==i}))})}),n.length>0&&this.setFilteredGroupItemSelectState(e,n,!1,!1)}}setGroupSelectState(e,t,i,s){if(t&&t.length>0&&this.getFilteredGroupInfo(t[0].id))return this.setFilteredGroupItemSelectState(e,t,i,s);void 0===t||t.length===e.count?Object.keys(e.children).forEach(t=>{this.setGroupItemSelectState(e,t,i)}):(s&&i&&Object.keys(e.children).filter(e=>e!==t[0].id).forEach(t=>{this.setGroupItemSelectState(e,t,!1)}),this.setGroupItemSelectState(e,t[0].id,i))}setGroupItemSelectState(e,t,i){e.children.hasOwnProperty(t)&&(e.children[t].selected=i,this.setItemsSelectState(e.children[t],void 0,i))}setItemsSelectState(e,t,i){if(void 0===t||t.length===e.count)Object.values(e.children).forEach(e=>{e.selected=i});else{const s=t[0].id;e.children.hasOwnProperty(s)&&(e.children[s].selected=i)}e.selectedCount=this.vizPanelUtilities.countSelectedChildren(e.children),e.selected=0!==e.selectedCount}allReportGoids(){const e=[],t=this.reports[this.currentReport];return t&&Object.values(t.children).forEach(t=>{e.push(...this.vizPanelUtilities.getChildrenGoids(t))}),e}handleSetSelectAllForPanel(){const e=this.reports[this.currentReport];if(this.panelDisplayed===je.GROUPS){const t=this.activeFilter;this.selectedAll=t?!Object.values(e.children).some(e=>!e.filteredGroups||!e.filteredGroups.hasOwnProperty(t)||Object.values(e.filteredGroups[t]).some(e=>e.count!==e.selectedCount)):!Object.values(e.children).some(e=>e.count!==e.selectedCount)}else if(this.panelDisplayed===je.ITEMS){const e=this.getReportGroupById(this.currentReport,this.currentGroup);this.selectedAll=e.selectedCount===e.count}}updateGroupChildrenSelection(e,t){if(void 0===t){const t=this.reports[this.currentReport],i=this.activeFilter;i?Object.values(t.children).forEach(t=>{t.filteredGroups&&t.filteredGroups.hasOwnProperty(i)&&Object.values(t.filteredGroups[i]).forEach(t=>{this.updateGroupChildrenSelection(e,t)})}):Object.values(t.children).forEach(t=>{this.updateGroupChildrenSelection(e,t)})}else Object.values(t.children).forEach(t=>{t.selected=e}),t.selected=e,t.selectedCount=this.vizPanelUtilities.countSelectedChildren(t.children)}handlePanelDisplayed(){this.panelDisplayed!==je.GROUPS&&this.panelDisplayed!==je.ITEMS||!this.filtersGroup||this.filtersGroup.close(),this.isPanelDisplayedReports=this.panelDisplayed===je.REPORTS,this.isPanelDisplayedGroups=this.panelDisplayed===je.GROUPS,this.isPanelDisplayedItems=this.panelDisplayed===je.ITEMS}handleUrlCommand(){if(this.expandUrlCommand){if(!this.expandUrlCommand.VIR&&!this.expandUrlCommand.VIS)return void(this.expandUrlCommand=void 0);if(this.updatePanelState(ze.OPEN),this.expandUrlCommand.VIR)this.navigationStrategy===z.a.COMPOSITE?(this.uxtNotificationService.info(this.VIR_URL_NOT_SUPPORTED_FOR_COMPOSITE),this.waitResizePanel()):Array.isArray(this.expandUrlCommand.VIR)&&this.expandUrlCommand.VIR.length>0?""!==this.expandUrlCommand.VIR[0]?(this.isUrlCommand=!0,this.urlReportId=String(this.expandUrlCommand.VIR[0])):(this.uxtNotificationService.info(this.VIR_URL_NO_REPORT_DEFINED),this.waitResizePanel()):(this.uxtNotificationService.info(this.VIR_URL_INCORRECT),this.waitResizePanel());else if(Array.isArray(this.expandUrlCommand.VIS)&&this.expandUrlCommand.VIS.length>0){let e=[],t=[];e.push(...this.expandUrlCommand.VIS),e=e.filter(e=>""!==e),e.length>0?(this.loadingOverlayService.showLoadingOverlay(this.VIR_SEARCHING_MODEL),this.isUrlCommand=!0,this.urlSearchTotal=e.length,t=e.map(e=>this.onSearch(e.toString(),e.toString().indexOf("*")>-1)),Object(Ue.a)(...t).subscribe(e=>{e=e},e=>{},()=>{this.isSearchBusy=!1})):(this.uxtNotificationService.info(this.VIR_URL_INCORRECT),this.waitResizePanel())}else this.uxtNotificationService.info(this.VIR_URL_INCORRECT),this.waitResizePanel()}}waitResizePanel(){this.timeoutService.setTimeout(()=>{this.eventVizPanelResized.emit(this.contentMenuWidth)},1e3)}waitExecuteUrlReport(){if(0===this.expandUrlCommand.VIR.length||""===this.expandUrlCommand.VIR[0])return this.updateReportData(),void this.eventVizPanelResized.emit(this.contentMenuWidth);if(""!==this.urlReportId){this.urlReportId=this.urlReportId.toUpperCase();let e=!1;this.isConflictsUrlReport=this.urlReportId.endsWith(this.conflictsReportSuffix.toUpperCase()),this.isConflictsUrlReport&&(this.urlReportId=this.urlReportId.replace(this.conflictsReportSuffix.toUpperCase(),""));for(const t in this.allVizReports)if(this.allVizReports[t].Id.toUpperCase()===this.urlReportId){this.isReportFirstRun=!0,this.reportHasConflicts=!1,this.getPromptedColsThenRunReport(this.allVizReports[t]),e=!0;break}e||(this.updateReportData(),this.eventVizPanelResized.emit(this.contentMenuWidth),this.uxtNotificationService.info(this.sdaTranslateService.getFormattedByString(this.VIR_NO_REPORT_FOUND,[this.urlReportId])))}else this.timeoutService.setTimeout(()=>{this.waitExecuteUrlReport()},200)}setSelectStateForMergedConflictReport(e,t){if(e&&!this.activeFilter){const e=this.getReportById(this.currentReport);if(e&&e.HasClashes){const e=this.reports[t],i=e.children;for(const t in i)0===i[t].defaultGroupColorId?(i[t].selected=!0,this.setGroupSelectState(e,[i[t]],!0,!1)):(i[t].selected=!1,this.setGroupSelectState(e,[i[t]],!1,!1))}}}sortGroupsByFrequency(e,t){const i=t||this.reportData;return i.sort((t,i)=>{let s=e===He.FREQDESC?this.compare(i.count,t.count):this.compare(t.count,i.count);return 0===s&&(s=this.compare(t.name,i.name)),s}),i}sortGroupsByName(e,t){const i=t||this.reportData;return i.sort((t,i)=>e===He.NAMEDESC?this.compare(i.name,t.name):this.compare(t.name,i.name)),i}toggleSelectStateGroups(e){e[0].selected&&this.updateCurrentGroup(e[0].id);let t=!1;const i=this.getReportById(this.currentReport);i&&i.HasClashes&&(t=!0),this.setGroupSelectState(this.reports[this.currentReport],e,e[0].selected,t),this.handleSetSelectAllForPanel(),this.refreshDisplay()}closeColorPicker(){this.vizColorPicker&&this.vizColorPicker.closePicker()}replaceNonBreakingHyphens(e){return e.replace(/-/g,"\u2011")}setActiveFilter(e){let t,i;e&&e.selected&&(i=e.id,t=e.name,t&&(t=this.replaceNonBreakingHyphens(t))),this.filtersData.filter(e=>e.id!==i).forEach(e=>{e.selected=!1}),this.activeFilter=i,this.activeFilterString=t||this.NOT_SET}compare(e,t){return e<t?-1:e>t?1:0}}return e.\u0275fac=function(t){return new(t||e)(J.Sb(N.a),J.Sb(et),J.Sb(Pe),J.Sb(A.a),J.Sb(M.a),J.Sb(nt),J.Sb(Be.a),J.Sb(x.a),J.Sb(k.a),J.Sb(be.a),J.Sb(Ze),J.Sb(st))},e.\u0275cmp=J.Mb({type:e,selectors:[["sda-viz-panel"]],viewQuery:function(e,t){var i;1&e&&(J.bd(ii,!0),J.bd(si,!0)),2&e&&(J.Gc(i=J.ic())&&(t.vizColorPicker=i.first),J.Gc(i=J.ic())&&(t.filtersGroup=i.first))},inputs:{docVersionOBID:"docVersionOBID",config:"config",navigationStrategy:"navigationStrategy",triggerRefreshDisplayEvent:"triggerRefreshDisplayEvent",viewerHeight:"viewerHeight",expandUrlCommand:"expandUrlCommand",readyForUrlCommand:"readyForUrlCommand",methodOBID:"methodOBID",excludedFilterUID:"excludedFilterUID"},outputs:{eventCustomMaterialObject:"eventCustomMaterialObject",eventObjectsToHide:"eventObjectsToHide",eventObjectsToShow:"eventObjectsToShow",eventAssignToObjects:"eventAssignToObjects",eventRemoveFromObjects:"eventRemoveFromObjects",eventClearModel:"eventClearModel",eventFitSelection:"eventFitSelection",eventSetModelUnselected:"eventSetModelUnselected",eventVizPanelResized:"eventVizPanelResized",eventIsVizReportExecuted:"eventIsVizReportExecuted"},features:[J.Db([et,nt,Ze,st]),J.Cb],decls:9,vars:16,consts:[[3,"ngClass"],["class","viz-panel__resize-handle",3,"mousedown",4,"ngIf"],[1,"viz-panel__header-body"],[3,"title1","title2","panelState","panelToDisplay","eventUpdatePanelToDisplay","eventUpdatePanelState","eventRefreshDisplay"],[1,"viz-panel__body"],[3,"panelExpanded","headerIcon","title","subTitle","itemData","panelToDisplay","hideToggle","disabled","eventToggleSelectState",4,"ngIf"],["class","viz-panel__search-expandable-group",4,"ngIf"],[3,"panelExpanded","headerIcon","title","subTitle","itemData","panelToDisplay","itemSelected","eventToggleSelectState",4,"ngIf"],["class","viz-panel__results",4,"ngIf"],[1,"viz-panel__resize-handle",3,"mousedown"],[1,"viz-panel__icon-container",3,"dblclick"],["svgIcon","overflow",1,"viz-panel__resizing-icon"],[3,"panelExpanded","headerIcon","title","subTitle","itemData","panelToDisplay","hideToggle","disabled","eventToggleSelectState"],["filtersGroup",""],[1,"viz-panel__search-expandable-group"],["collapsedHeight","*","expandedHeight","*",1,"viz-panel__search-expandable-group-header"],[1,"viz-panel__search-expandable-group__icon",3,"svgIcon"],[3,"isPanelDisplayedReports","isPanelDisplayedGroups","currentReport","activeFilter","isModelTransparent","isSearchBusy","isModelTransparentChange","eventSearchEquals","eventSearchContains","eventUpdatePanelState","eventToggleHideTransparent","eventGenerateUrl"],[3,"panelExpanded","headerIcon","title","subTitle","itemData","panelToDisplay","itemSelected","eventToggleSelectState"],[1,"viz-panel__results"],[3,"panelToDisplay","showSelectAll","selectedAll","isModelTransparent","showResetColors","reportHasConflicts","showMergedConflictsReport","currentReport","currentReportSortOption","isModelTransparentChange","eventSelectAllCurrentPanel","eventToggleHideTransparent","showColorPicker","eventDisplayChart","eventUpdatePanelState","eventResetSymbology","eventGenerateUrl","eventToggleConflictsView","eventSortGroups"],[3,"reportData","panelToDisplay","currentReport","panelDataLoading","activeGroupColor","activeGroupId","displayChart","viewerHeight","showMergedConflictsReport","itemSelected","showColorPicker","eventUpdateCurrentGroup","eventToggleSelectState","eventItemsToFit","eventSelectFitAction"],[3,"updateColor"],["vizColorPicker",""]],template:function(e,t){1&e&&(J.Yb(0,"div",0),J.Sc(1,ni,3,0,"div",1),J.Yb(2,"div",2),J.Yb(3,"sda-viz-panel-header",3),J.hc("eventUpdatePanelToDisplay",(function(e){return t.updatePanelToDisplay(e)}))("eventUpdatePanelState",(function(e){return t.updatePanelState(e)}))("eventRefreshDisplay",(function(){return t.refreshDisplay()})),J.Xb(),J.Yb(4,"div",4),J.Sc(5,ai,2,8,"sda-viz-panel-expandable-group",5),J.Sc(6,oi,6,8,"mat-expansion-panel",6),J.Sc(7,ri,1,6,"sda-viz-panel-expandable-group",7),J.Sc(8,li,5,18,"div",8),J.Xb(),J.Xb(),J.Xb()),2&e&&(J.Rc("right",t.rightPosition)("width",t.contentMenuWidth,"px"),J.sc("ngClass",t.isPanelHidden?"viz-panel__hidden":t.isPanelOpen?"viz-panel__open":"viz-panel"),J.Eb(1),J.sc("ngIf",t.isPanelOpen),J.Eb(2),J.sc("title1",t.title1)("title2",t.title2)("panelState",t.panelState)("panelToDisplay",t.panelDisplayed),J.Eb(1),J.Ib("viz-panel__body--hidden",!t.isPanelOpen),J.Eb(1),J.sc("ngIf",t.filtersData&&t.filtersData.length>0),J.Eb(1),J.sc("ngIf",t.isPanelDisplayedReports||t.isPanelDisplayedGroups&&t.currentReport===t.searchReportId),J.Eb(1),J.sc("ngIf",t.isPanelDisplayedReports),J.Eb(1),J.sc("ngIf",!t.isPanelDisplayedReports))},directives:[s.q,s.t,xt,l.a,bt,r.c,r.g,r.h,Yt,ti,wt,lt],styles:[".viz-panel__body[_ngcontent-%COMP%]{overflow-x:hidden;overflow-y:auto}[_nghost-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]     mat-expansion-panel-header{padding-left:12px}.viz-panel[_ngcontent-%COMP%]{transition:background .25s cubic-bezier(.18,.9,.18,.9);position:absolute;flex-direction:column;min-width:40px;justify-content:center;background-color:#fff;color:#000;font-size:13px;z-index:100!important}.viz-panel__hidden[_ngcontent-%COMP%]{display:none}.viz-panel__open[_ngcontent-%COMP%]{display:flex;height:100%}.viz-panel__header-body[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;width:inherit}.viz-panel__body[_ngcontent-%COMP%]{display:flex;flex:1;flex-direction:column;width:100%;min-height:0}.viz-panel__body__divider[_ngcontent-%COMP%]{height:2px;background-color:rgba(0,58,85,.5)}.viz-panel__body--hidden[_ngcontent-%COMP%], .viz-panel__resize-handle[_ngcontent-%COMP%]{display:none}@media screen and (min-width:1200px){.viz-panel__resize-handle[_ngcontent-%COMP%]{display:flex;align-items:center;background-color:#cad0d7;width:10px;height:100%;cursor:col-resize}}.viz-panel__icon-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:inherit;color:#515e6b}.viz-panel__resizing-icon[_ngcontent-%COMP%]{width:20px;height:20px}.viz-panel__search-expandable-group[_ngcontent-%COMP%]{overflow:visible}.viz-panel__search-expandable-group[_ngcontent-%COMP%]     .mat-expansion-panel-body{padding:0}.viz-panel__search-expandable-group__icon[_ngcontent-%COMP%]{width:18px;height:18px;margin:0 3px}.viz-panel__search-expandable-group-header[_ngcontent-%COMP%]{padding:6px 24px 6px 12px}.viz-panel__results[_ngcontent-%COMP%]{border-top:1px solid}.color-bubble[_ngcontent-%COMP%]{width:25px;height:25px;margin:6px 5px;border-radius:15px;text-align:center;vertical-align:middle;padding-top:3px;border:2px solid transparent;cursor:pointer}"]}),e})();var hi=i("+T9e"),di=i("/RsI"),pi=i("ktwp");function ui(e,t){if(1&e&&J.Tb(0,"sda-power-bar-view",9),2&e){const e=J.lc(2);J.sc("leftControls",e.powerBarControls)}}function gi(e,t){if(1&e&&(J.Yb(0,"div",7),J.Sc(1,ui,1,1,"sda-power-bar-view",8),J.Xb()),2&e){const e=J.lc();J.Eb(1),J.sc("ngIf",e.isSearchable&&!e.isVizPanelAvailable)}}function bi(e,t){if(1&e){const e=J.Zb();J.Yb(0,"sda-hotspot-bubble",10),J.hc("toggleActionsMenu",(function(t){return J.Kc(e),J.lc().toggleTagActionsMenu(t)}))("detailsExpand",(function(t){return J.Kc(e),J.lc().tagDetailsExpand(t)}))("viewOffPageDocument",(function(t){return J.Kc(e),J.lc().viewOffPageDocument(t)}))("bubbleItemSelected",(function(t){return J.Kc(e),J.lc().bubbleItemSelected(t)})),J.Xb()}if(2&e){const e=J.lc();J.sc("bubbleText",e.bubbleText)("bubbleItems",e.bubbleItems)("bubblePositionX",e.bubblePosition.x)("bubblePositionY",e.bubblePosition.y)("isMenuActive",e.selectedTag)("selectedObject",e.selectedTag)("showViewOPCDocButton",e.showViewOffPageDocButton)}}function vi(e,t){if(1&e){const e=J.Zb();J.Yb(0,"sda-viz-panel",11),J.hc("eventCustomMaterialObject",(function(t){return J.Kc(e),J.lc().addCustomMaterial(t)}))("eventObjectsToHide",(function(t){return J.Kc(e),J.lc().hideObjects(t)}))("eventObjectsToShow",(function(t){return J.Kc(e),J.lc().showObjects(t)}))("eventAssignToObjects",(function(t){return J.Kc(e),J.lc().assignMaterialToObjects(t)}))("eventRemoveFromObjects",(function(t){return J.Kc(e),J.lc().removeMaterialFromObjects(t)}))("eventClearModel",(function(t){return J.Kc(e),J.lc().clearModel(t)}))("eventFitSelection",(function(t){return J.Kc(e),J.lc().fitSelection(t)}))("eventSetModelUnselected",(function(){return J.Kc(e),J.lc().setModelUnselected()}))("eventVizPanelResized",(function(t){return J.Kc(e),J.lc().vizPanelResized(t)}))("eventIsVizReportExecuted",(function(t){return J.Kc(e),J.lc().setIsVizReportExecuted(t)})),J.Xb()}if(2&e){const e=J.lc();J.sc("docVersionOBID",e.versionOBID)("config",e.config)("navigationStrategy",e.navigationStrategy)("viewerHeight",e.viewerHeight)("triggerRefreshDisplayEvent",e.triggerRefreshDisplayEvent)("expandUrlCommand",e.expandUrlCommand)("readyForUrlCommand",e.readyForUrlCommand)}}function Si(e,t){if(1&e){const e=J.Zb();J.Yb(0,"div",12),J.Yb(1,"div",13),J.Yb(2,"h2",14),J.Uc(3),J.Xb(),J.Yb(4,"mat-icon",15),J.hc("click",(function(t){return J.Kc(e),J.lc().tagDetailsShrink(t)}))("touchstart",(function(t){return J.Kc(e),J.lc().tagDetailsShrink(t)})),J.Xb(),J.Xb(),J.Tb(5,"sda-object-details",16),J.Xb()}if(2&e){const e=J.lc();J.Eb(2),J.tc("title",e.selectedTag.Name),J.Eb(1),J.Vc(e.selectedTag.Name),J.Eb(2),J.sc("id",e.selectedTag.OBID)("config",e.selectedTag.Config)}}function mi(e,t){if(1&e){const e=J.Zb();J.Yb(0,"p-dialog",17),J.hc("visibleChange",(function(t){return J.Kc(e),J.lc().showCreateSnapshotForm=t})),J.Yb(1,"sda-create-obj-view",18),J.hc("formCreated",(function(t){return J.Kc(e),J.lc().snapshotFormCreated(t)}))("onCancel",(function(){return J.Kc(e),J.lc().snapshotFormCancelled()})),J.Xb(),J.Xb()}if(2&e){const e=J.lc();J.sc("header",e.GOVIEW_CREATE_MARKUP_SNAPSHOT)("visible",e.showCreateSnapshotForm)("responsive",!0)("resizable",!1),J.Eb(1),J.sc("classDefUID",e.snapshotClassDefUID)("methodOBID",e.snapshotMethodOBID)("isCancelVisible",!0)}}class fi{}let Ci=(()=>{class e{constructor(e,t,i,s,n,a,o,r,l,c,h,d,p,u,g,b,v,S,m,f,C,O,_,I){this.elementRef=e,this.goViewService=t,this.graphicsMapService=i,this.sdaTranslateService=s,this.uxtNotificationService=n,this.labelDatabaseService=a,this.odataService=o,this.exceptionService=r,this.actionMenuProvider=l,this.contentMenuService=c,this.timeoutService=h,this.loadingOverlayService=d,this.location=p,this.loggingService=u,this.searchGraphicsService=g,this.ppmViewerService=b,this.navigationService=v,this.viewMarkupCacheService=S,this.configService=m,this.formService=f,this.markupSnapshotService=C,this.docOPCNavigationService=O,this.featureSetNavigationService=_,this.embeddedSnapshotService=I,this.snapshotCreated=new J.o,this.showGoView=new J.o,this.clearUrlParameters=new J.o,this.GOVIEW_SEARCH_PLACEHOLDER=this.sdaTranslateService.get("GOVIEW_SEARCH_PLACEHOLDER","Search 3D Model..."),this.GOVIEW_SEARCH2D_PLACEHOLDER=this.sdaTranslateService.get("GOVIEW_SEARCH2D_PLACEHOLDER","Search Drawing..."),this.GOVIEW_SEARCH_NO_TAGS_FOUND=this.sdaTranslateService.get("GOVIEW_SEARCH_NO_TAGS_FOUND","No tags matching '{0}' were found"),this.GOVIEW_SEARCH_NO_SEARCH_PHRASE=this.sdaTranslateService.get("GOVIEW_SEARCH_NO_SEARCH_PHRASE","Enter a search phrase"),this.GOVIEW_SELECT_ITEM_NOT_FOUND=this.sdaTranslateService.get("GOVIEW_SELECT_ITEM_NOT_FOUND","The item was not found in this file"),this.GOVIEW_HOTSPOTTED_ITEM_NOT_FOUND=this.sdaTranslateService.get("GOVIEW_HOTSPOTTED_ITEM_NOT_FOUND","The hotspotted item was not found"),this.GOVIEW_HOTSPOTTED_ITEM_NOT_FOUND_IN_MAP=this.sdaTranslateService.get("GOVIEW_HOTSPOTTED_ITEM_NOT_FOUND_IN_MAP","Data cannot be found for selected object"),this.VIR_URL_INCORRECT=this.sdaTranslateService.get("VIR_URL_INCORRECT","URL command incorrectly formatted"),this.GOVIEW_CREATE_MARKUP_SNAPSHOT=this.sdaTranslateService.get("GOVIEW_CREATE_MARKUP_SNAPSHOT","Create Markup Snapshot"),this.CREATE_OBJ_CREATED_SUCCESS=this.sdaTranslateService.get("CREATE_OBJ_CREATED_SUCCESS","Object successfully created"),this.URL_ACTION_UNAVAILABLE=this.sdaTranslateService.get("URL_ACTION_UNAVAILABLE-ACTION_NAME","URL action {0} not available"),this.isNavigationAllowed=!1,this.isSearchable=!1,this.isNavigable=!1,this.showBubble=!1,this.showViewOffPageDocButton=!1,this.showTagDetails=!1,this.powerBarControls=[],this.isVizPanelAvailable=!1,this.triggerRefreshDisplayEvent=!1,this.viewerHeight=0,this.readyForUrlCommand=!1,this.showCreateSnapshotForm=!1,this.snapshotClassDefUID="SPFMarkupSnapshot",this.goViewLoaded=!1,this.graphicsMapLoaded=!1,this.ignoreNextSelectionChangedEvent=!1,this.needsFit=!1,this.GOVIEW_CLEAR_SEARCH_RESULTS=this.sdaTranslateService.get("GOVIEW_CLEAR_SEARCH_RESULTS","Clear"),this.MAX_REPRESENTATIONS=1e3,this.GRAPHIC_SELECTION_OVERLAY_COUNT=10,this.creatingSnapshot=!1,this.bubbleItemSelectedSubject=new ne.a,this.bubblePosition=new fi,this.bubblePosition.x=0,this.bubblePosition.y=0}ngOnInit(){this.bubbleItemSelectedSubscription=this.bubbleItemSelectedSubject.pipe(Object(oe.a)(e=>this.onBubbleItemSelected(e))).subscribe(),this.loadingOverlayService.showLoadingOverlay(this.sdaTranslateService.get("PREPARING_FILES","Preparing files..."));try{this.checkIfNavigationAllowedByMethod().subscribe(e=>{this.isNavigationAllowed=e,this.graphicsMapURL&&this.graphicsMapURL.length>0?this.graphicsMapService.loadGraphicsMapUrl(this.graphicsMapURL).done(e=>{this.goidsToSelect=[],e&&(this.graphicsMapLoaded=!0,this.viewMarkupCacheService.selectedTagUIDs.length>0&&(this.goidsToSelect=this.ppmViewerService.getGoidsToSelect(this.viewMarkupCacheService.selectedTagUIDs))),this.checkIfNavigableByNavigationStrategyAndGraphicMap(),this.addDrawingOrModel()}):this.labelDatabaseOBID&&this.labelDatabaseOBID.length>0?this.labelDatabaseService.generateGraphicsMap(this.labelDatabaseOBID).subscribe(e=>{this.graphicsMapService.loadGraphicsMapXml(e)?(this.graphicsMapLoaded=!0,this.checkIfNavigableByNavigationStrategyAndGraphicMap(),this.displayMessageAboutUrlDataActionAvailability(),this.addDrawingOrModel()):this.loadingOverlayService.hideLoadingOverlay()}):(this.config||(this.config=this.configService.selectedCreateConfig),this.navigationService.getRelatedTagEdges(this.versionOBID,this.config).subscribe(e=>{this.relatedTagEdges=e}),this.ppmViewerService.initializeNavigation(this.navigationStrategy,this.versionOBID,this.config).subscribe(e=>{if(this.checkIfNavigableByNavigationStrategyAndGraphicMap(),e){let t;if(this.navigationDocuments=e,this.viewMarkupCacheService.shouldSelectTags&&this.viewMarkupCacheService.selectedTagUIDs&&this.viewMarkupCacheService.selectedTagUIDs.length>0?t={UID:this.viewMarkupCacheService.selectedTagUIDs}:this.urlTagsToSelect&&(this.swapExpandUrlForNamesToVIS(),!this.expandUrlCommand||this.expandUrlCommand.VIS||this.expandUrlCommand.VIR||(t=this.urlTagsToSelect)),t){const e=Object.keys(t)[0],i=this.ppmViewerService.queryGraphicsToSelect(t[e],this.MAX_REPRESENTATIONS,this.navigationDocuments,e);this.loggingService.info("Querying for graphic IDs."),i.subscribe(e=>{this.goidsToSelect=[],e.representations&&e.representations.length>0?(this.loggingService.info("Found graphic IDs."),this.selectedRepresentations=e.representations,this.goidsToSelect=e.IDs):e.IDs&&e.IDs.length>0?this.goidsToSelect=e.IDs:this.uxtNotificationService.info(this.GOVIEW_SELECT_ITEM_NOT_FOUND),this.addDrawingOrModel()},e=>{this.exceptionService.handleException(new O.a(e))})}else this.goidsToSelect=[],this.addDrawingOrModel()}else this.displayMessageAboutUrlDataActionAvailability(),this.goidsToSelect=[],this.addDrawingOrModel()})),this.fileType===T.a.BINZ&&this.markupSnapshotService.getMethodData().subscribe(e=>{this.snapshotMethodOBID=e})})}catch(e){this.loadingOverlayService.hideLoadingOverlay()}this.externalSnapshotRemote=this.embeddedSnapshotService.initializeSnapshotHandler(()=>this.takeSnapshotForRemote())}ngAfterViewInit(){this.showGoView.emit(),this.goViewDiv=this.elementRef.nativeElement.querySelector("#goview__content"),"/"!==this.goViewURL.substr(-1)&&(this.goViewURL+="/"),this.loggingService.info("Creating GoView control."),this.goViewService.createGoViewControl("goview__content",this.useGoView2d).subscribe(e=>{this.goView=e,this.goView.resize(),this.addModelLoadedListener(),this.addDrawingLoadedListener(),this.addScreenshotListener(),this.isPPM2DFile()&&(this.addFontNotFoundListener(),this.addDefaultFontNotFoundListener(),this.goViewURL=this.goViewURL+this.fileName,this.goViewURL=this.goViewURL.slice(0,this.goViewURL.length-1)),this.goViewLoaded=!0,this.loggingService.info("GoView control created."),this.addDrawingOrModel()})}ngAfterViewChecked(){this.urlCommandHasError&&(this.uxtNotificationService.info(this.VIR_URL_INCORRECT),this.urlCommandHasError=void 0,this.expandUrlCommand=void 0,this.clearUrlParameters.emit()),this.needsFit&&(this.timeoutService.setTimeout(()=>{this.fileType===T.a.VECZ?this.goView.fit2D():this.fileType===T.a.BINZ&&this.goView.fit()},1e3),this.clearBubble(),this.needsFit=!1),this.externalActionMonitor()}ngOnDestroy(){this.actionMenuProvider.clearAndCloseActionsMenu(),this.clearSubscriptions(),this.bubbleItemSelectedSubscription&&this.bubbleItemSelectedSubscription.unsubscribe(),this.killTimeout(),this.clearBubble(),this.goViewLoaded&&(this.goView.destroy(),window.Browser.workers=[],this.goView=void 0),this.externalSnapshotRemote&&this.externalSnapshotRemote.dispose()}setCameraPosition(e){try{const t=JSON.parse(e);this.goView.setCameraPosition(t),this.clearBubble()}catch(t){this.uxtNotificationService.error(this.sdaTranslateService.get("MARKUP_SNAPSHOT_INVALID_CAMERA_POS","Invalid camera position"))}}snapshotButtonClicked(){if(!this.creatingSnapshot)try{const e=this.goView.getCameraPosition(),t=JSON.stringify(e);if(JSON.parse(t),this.cameraPosition=t,this.isNavigable&&this.navigationStrategy===z.a.FDW){const e=100,t=this.getSelectSetObjects(this.goView);t&&t.length>e?this.uxtNotificationService.warning(this.sdaTranslateService.getFormatted("GOVIEW_SELECTED_GRAPHICS_EXCEEDS_LIMIT","Count of selected graphics ({0}) exceeds limit ({1})",[t.length.toString(),e.toString()])):(this.selectedGraphics=t,this.showCreateSnapshotForm=!0)}else this.showCreateSnapshotForm=!0}catch(e){this.uxtNotificationService.error(this.sdaTranslateService.get("MARKUP_SNAPSHOT_INVALID_CAMERA_POS","Invalid camera position"))}}snapshotFormCreated(e){this.showCreateSnapshotForm=!1,this.creatingSnapshot=!0;const t=new de.a("SPFFileMarkupSnapshot",!1,[this.fileObid]),i=new he.a;i.relationships.push(t),this.formService.createObjectFromForm(e,void 0,i).subscribe(e=>{this.snapshotOBID=e.OBID,this.goView.getScreenShotObj()})}snapshotFormCancelled(){this.cameraPosition=void 0,this.showCreateSnapshotForm=!1}takeSnapshotForRemote(){this.externalSnapshotRequested=!0,this.showCreateSnapshotForm=!1,this.goView.getScreenShotObj()}onScreenshot(e){this.creatingSnapshot&&(this.loadingOverlayService.showLoadingOverlay(),this.markupSnapshotService.save(this.snapshotOBID,e.value,this.cameraPosition).subscribe(()=>{this.uxtNotificationService.info(this.CREATE_OBJ_CREATED_SUCCESS),this.snapshotCreated.emit(this.snapshotOBID),this.afterSnapshotSaved(this.snapshotOBID),this.snapshotOBID=void 0,this.cameraPosition=void 0,this.selectedGraphics=void 0,this.loadingOverlayService.hideLoadingOverlay(),this.creatingSnapshot=!1})),this.externalSnapshotRequested&&(this.externalSnapshotRemote.send("data:image/png;base64,"+e.value),this.externalSnapshotRequested=!1)}ngOnChanges(e){if(e.expandUrlCommand&&e.expandUrlCommand.currentValue){const t=e.expandUrlCommand.currentValue;t.ITEMSBYUID&&t.ITEMSBYUID.length>0?this.urlTagsToSelect={UID:t.ITEMSBYUID}:t.ITEMSBYOBID&&t.ITEMSBYOBID.length>0?this.urlTagsToSelect={OBID:t.ITEMSBYOBID}:t.ITEMSBYNAME&&t.ITEMSBYNAME.length>0&&(this.urlTagsToSelect={Name:t.ITEMSBYNAME})}}snapshotGalleryResized(){this.clearBubble()}resizedWindow(){this.clearBubble()}onSearchModel(e,t){this.searchButton&&this.searchButton.isDisabled||(e&&e.length>0?(this.searchButton.isDisabled=!0,e=e.trim(),this.getSearchGoidsSubscription=this.graphicsMapLoaded?this.searchGraphicsService.onSearchGraphicsMap(e,t).subscribe(t=>{this.onSearchGraphicOIDs(t,e)}):this.searchGraphicsService.onSearchDocument(e,t).subscribe(t=>{this.onSearchGraphicOIDs(t.graphics,e)})):(this.loggingService.info("No search was provided"),this.uxtNotificationService.info(this.GOVIEW_SEARCH_NO_SEARCH_PHRASE)))}onGoViewClick(e){this.clearBubble(),this.ignoreNextSelectionChangedEvent=!1,this.bubblePosition.x=e.offsetX,this.bubblePosition.y=e.offsetY}onGoViewKeyUp(e){e.keyCode===ve.c&&this.clearBubble()}onGoViewTouchStart(e){if(this.clearBubble(),this.ignoreNextSelectionChangedEvent=!1,e.touches[0]){const t=this.goViewDiv.getBoundingClientRect();this.bubblePosition.x=e.touches[0].pageX-t.left,this.bubblePosition.y=e.touches[0].pageY-t.top}}onGoViewMouseWheel(e){this.clearBubble()}onGoViewMouseDown(e){1!==e.button&&2!==e.button||this.clearBubble()}onSelectionChanged(e){this.clearBubble();const t=this.getSelectSetObjects(e);(t?t.length:0)>0&&(this.bubbleText=void 0,this.bubbleItems=void 0,this.isNavigable?(this.showBubble=!0,this.navigationStrategy===z.a.GRAPHICSMAP?this.tagInterface&&this.tagInterface.length>0&&this.onTagSelection(t,this.tagInterface):this.onNavigableGraphicSelection(t)):this.isSearchable&&(this.showBubble=!0,this.onSearchableTagSelection(t))),this.loggingService.info("Completed graphic selection changed event.")}handleItemLoaded(){this.loggingService.info("The model or drawing is loaded."),this.checkAndEnableSearch(),this.goidsToSelect&&this.goidsToSelect.length>0&&this.goidsToSelect.length>fe.f&&!this.isPPM2DFile()&&this.fitToGraphics(this.goidsToSelect),(this.isSearchable||this.isNavigable)&&this.addSelectionChangedListener(),this.isVizPanelAvailable&&this.expandUrlCommand&&(this.readyForUrlCommand=!0),this.loadingOverlayService.hideLoadingOverlay()}toggleTagActionsMenu(e){this.selectedTag&&(this.actionsMenuContainsOBID(this.selectedTag.OBID)?this.contentMenuService.showActionsMenu(!0):(this.actionMenuProvider.clearItems(),this.addTagToActionMenu(this.selectedTag),this.contentMenuService.showActionsMenu()))}bubbleItemSelected(e){this.bubbleItemSelectedSubject.next(e)}tagDetailsExpand(e){this.selectedTag&&(this.showTagDetails=!0)}tagDetailsShrink(e){this.preventDefaultForTouch(e),this.showTagDetails=!1}handleFontNotFoundError(e){const t=this.sdaTranslateService.getFormatted("GOVIEW_WARNING_BAD_FONTS-FONTS-DEFAULT_FONT","Files for font(s) {0} are missing or corrupt. Defaulting to {1}.",[e.fonts.join(", "),e.defaultFont]),i=this.sdaTranslateService.get("GOVIEW_WARNING_BAD_FONTS","Fonts missing or corrupt. Using default font.");this.uxtNotificationService.info(i),console.log(t)}handleDefaultFontNotFoundError(e){const t=this.sdaTranslateService.getFormatted("GOVIEW_ERROR_MISSING_FONT-DEFAULT_FONT","Default font file {0} is missing or corrupt. Unable to view file.",[e.font]),i=this.sdaTranslateService.get("GOVIEW_ERROR_CANT_VIEW_NO_DEFAULT_FONT","Unable to view file. Default font missing.");this.uxtNotificationService.error(i),console.log(t),this.location.back()}viewOffPageDocument(e){this.navigationStrategy===z.a.FDW&&this.docOPCNavigationService.getViewOffPageDocFeature().subscribe(e=>{this.clearBubble(),e?(e.objects=new Array,e.objects.push({obid:this.selectedTag.OBID,name:this.selectedTag.Name,config:this.selectedTag.Config,entityType:this.selectedTag.Class}),this.featureSetNavigationService.navigateToFeature(e,!1)):this.uxtNotificationService.error(this.sdaTranslateService.get("VIEWER_ERROR_VIEW_OPC_DOC_METHOD_NOT_FOUND","Could not find ViewOffPageDocument method"))})}handleInvalidURLError(e){this.exceptionService.handleException(new O.a(e,"Incorrect input URL"===e.message?this.sdaTranslateService.get("GOVIEW_ERROR_INCORRECT_INPUT_URL","Incorrect input URL"):e.message))}addCustomMaterial(e){this.goView.defineCustomMaterial(e)}hideObjects(e){this.goView.hideObjects(e)}showObjects(e){this.goView.showObjects(e[0],e[1])}assignMaterialToObjects(e){this.goView.assignMaterialToObjects(e[0],e[1])}removeMaterialFromObjects(e){this.goView.removeMaterialFromObjects(e)}clearModel(e){this.goView.removeMaterialFromModel(),this.goView.removeMaterialFromObjects(e)}fitSelection(e){this.createSelectSet(e).pipe(Object(S.a)(1)).subscribe(()=>{e.length>1?this.clearBubble():void 0!==this.goViewDiv.offsetWidth&&(this.bubblePosition.x=this.goViewDiv.offsetWidth/2,this.bubblePosition.y=this.goViewDiv.offsetHeight/2),this.goView.fit()})}setModelUnselected(){this.clearModel([]),this.goView.assignMaterialToModel(fe.p)}setIsVizReportExecuted(e){this.isVizReportExecuted=e}isPPM2DFile(){return this.fileType===T.a.VECZ}vizPanelResized(e){this.clearBubble()}addScreenshotListener(){let e=!1;this.externalSnapshotRemote?(e=!0,this.externalSnapshotRemote.ready(!0)):this.fileType===T.a.BINZ&&(e=!0),e&&(this.goView.disableCapture=!1,this.goView.addListener("screenShot",e=>{this.onScreenshot(e)}))}addDrawingOrModel(){if(this.goViewLoaded&&(this.graphicsMapLoaded||this.goidsToSelect)){this.isVizPanelAvailable=this.checkVizPanelAvailable();const t=this.goidsToSelect&&this.goidsToSelect.length>0;if(this.isPPM2DFile())try{t?(this.ignoreNextSelectionChangedEvent=!0,this.goView.add2DDrawing(this.goViewURL,this.goidsToSelect)):this.goView.add2DDrawing(this.goViewURL)}catch(e){this.handleInvalidURLError(e)}else if(t)this.ignoreNextSelectionChangedEvent=!0,this.add3DModel().subscribe(e=>{});else try{this.loggingService.info("Calling GoView.add3DModel."),this.goView.add3DModel(this.goViewURL)}catch(e){this.handleInvalidURLError(e)}}}getSelectSetObjects(e){let t=[];return t=this.isPPM2DFile()?e.getSelectSetObjects2D():e.getSelectSetObjects(),this.ppmViewerService.removeDuplicatesFromArray(t)}actionsMenuContainsOBID(e){return void 0!==this.actionMenuProvider.getItems().find(t=>t.obid===e)}onTagSelection(e,t){this.clearSubscriptions(),this.killTimeout();let i=[];if(e&&e.length>0){const t=e[0].startsWith(fe.g);e.forEach(e=>{i=i.concat(this.graphicsMapService.getMapNodesByGraphicOid(e,t))})}if(i&&i.length>0){const e=this.ppmViewerService.getUidClauseFromMapNodes(i);if(e){if(e.length>512)return console.log("The number of UIDs returned by this search is too large, so no query will be performed"),void this.clearBubble();this.odataSubscription=this.odataService.get(`Objects?$filter=(${e})and contains(Interfaces,'${t}')`,this.config).subscribe(e=>{this.clearSubscriptions(),e.value.length>0?1===e.value.length?(this.setSelectedTag(e.value[0]),this.bubbleText=this.selectedTag.Name?this.selectedTag.Name:""):this.clearBubble():this.terminateBubbleWithMessage(this.GOVIEW_HOTSPOTTED_ITEM_NOT_FOUND)},e=>{this.clearBubble(),this.exceptionService.handleException(new O.a(e))})}}else this.terminateBubbleWithMessage(this.GOVIEW_HOTSPOTTED_ITEM_NOT_FOUND_IN_MAP)}add3DModel(){if(this.selectedRepresentations&&this.selectedRepresentations.length>0)return this.loggingService.info("Calling get3DRangeForRepresentations to retrieve range information."),this.ppmViewerService.get3DRangeForRepresentations(this.selectedRepresentations,this.navigationStrategy,this.config).pipe(Object(re.a)(e=>{try{return this.loggingService.info("Calling GoView.add3DModel."),e?this.goView.add3DModel(this.goViewURL,this.goidsToSelect,e):this.goView.add3DModel(this.goViewURL,this.goidsToSelect)}catch(t){return this.handleInvalidURLError(t),t}}));{const e=`UID eq '${encodeURIComponent(this.viewMarkupCacheService.selectedTagUIDs[0])}'`;return this.ppmViewerService.get3DRange(`Objects?$filter=(${e}) and contains(Interfaces,'I3DRange')`,this.config).pipe(Object(re.a)(e=>{try{return this.loggingService.info("Calling GoView.add3DModel."),e?this.goView.add3DModel(this.goViewURL,this.goidsToSelect,e):this.goView.add3DModel(this.goViewURL,this.goidsToSelect)}catch(t){return this.handleInvalidURLError(t),t}}))}}onNavigableGraphicSelection(e){this.clearSubscriptions(),this.killTimeout();const t=e?e.length:0;if(t>10)return console.log(`The number of GraphicOIDs (${e.length}) has exceeded the limit (10) so no query will be performed`),void this.clearBubble();this.ppmViewerService.getTagsFromGraphics(this.navigationDocuments,e,this.config).subscribe(i=>{const s=i?i.length:0;0===s?this.terminateBubbleWithMessage(this.GOVIEW_HOTSPOTTED_ITEM_NOT_FOUND):1===s&&i[0]&&"FDWDocOPC"===i[0].Class?(this.setSelectedTag(i[0]),this.bubbleText=this.selectedTag.Name?this.selectedTag.Name:"",this.showViewOffPageDocButton=!0):1===s||1===t?this.navigationService.getBubbleItems(i,this.navigationStrategy,this.relatedTagEdges).subscribe(t=>{t&&t.length>0?(1!==t.length&&this.navigationStrategy===z.a.FDW||(t[0].GraphicOIDs=e),this.bubbleItems=t,this.setSelectedTag(t[0])):(this.bubbleText=void 0,this.bubbleItems=void 0,this.clearBubble())}):this.terminateBubbleWithMessage(void 0)},e=>{this.clearBubble(),this.exceptionService.handleException(new O.a(e))})}addDrawingLoadedListener(){this.goView.addListener("drawingLoaded",()=>this.handleItemLoaded())}addModelLoadedListener(){this.goView.addListener("modelLoaded",()=>this.handleItemLoaded())}addFontNotFoundListener(){this.goView.addListener("fontsNotFound",e=>{this.handleFontNotFoundError(e)})}addDefaultFontNotFoundListener(){this.goView.addListener("defaultFontNotFound",e=>{this.handleDefaultFontNotFoundError(e)})}addSelectionChangedListener(){const e=this.isPPM2DFile()?"selectionChanged2D":"selectionChanged";this.goView.addListener(e,()=>{this.loggingService.info("Graphic selection changed."),this.ignoreNextSelectionChangedEvent?this.ignoreNextSelectionChangedEvent=!1:this.onSelectionChanged(this.goView)})}addTransparencyChangedListener(){this.goView.addListener("transparencyChanged",()=>this.handleTransparencyChanged())}handleTransparencyChanged(){this.goView.defineCustomMaterial(fe.j),this.goView.defineCustomMaterial(fe.l),this.isVizReportExecuted?this.triggerRefreshDisplayEvent=!this.triggerRefreshDisplayEvent:this.searchResults&&this.searchResults.length>0&&this.refreshSearchResults()}refreshSearchResults(){this.goView.assignMaterialToModel(fe.m),this.goView.assignMaterialToObjects(fe.k,this.searchResults)}fitToGraphics(e){if(this.isPPM2DFile())this.set2DSheets(e),this.loggingService.info(`Creating a select set of ${e.length.toString()} graphics`),this.createSelectSet2D(e),this.loggingService.info("Select set created, fitting to selected graphics"),this.goView.fit2D(),this.loggingService.info("Fitted to the graphics in the select set");else{this.clearSearchResults(),this.loggingService.info("Setting non matching items to transparent"),this.goView.assignMaterialToModel(fe.m),this.loggingService.info(`Assigning material to ${e.length.toString()} search results`),this.goView.assignMaterialToObjects(fe.k,e),this.loggingService.info("Material assigned to search results"),this.searchResults=e,this.clearSearchResultsButton&&(this.clearSearchResultsButton.isDisabled=!1);const t=e.length,i=fe.f;t>i?(this.loggingService.info(`There were more than ${i} graphics so don't try to select/fit`),this.ignoreNextSelectionChangedEvent=!0,this.goView.clearSelectionList()):(this.loggingService.info(`Creating a select set of ${t.toString()} graphics`),this.createSelectSet(e).pipe(Object(S.a)(1)).subscribe(()=>{this.loggingService.info("Select set created, fitting to selected graphics"),this.goView.fit(),this.loggingService.info("Fitted to the graphics in the select set")}))}}set2DSheets(e){const t=new Set,i=this.goView.activeSheet;let s;this.loggingService.info("The active sheet is "+i);const n=[];e.forEach(e=>{const i=this.goView.getSheetNameFromGraphic(e);i&&i.length>0&&t.add(i)}),1===t.size?s=t.values().next().value:t.size>1&&(s=t.has(i)?i:t.values().next().value,t.forEach(e=>{e!==s&&n.push(e)})),this.loggingService.info("The sheet to display is "+s),s&&i!==s&&(this.uxtNotificationService.info(this.sdaTranslateService.getFormatted("GOVIEW_SHEET_CHANGED-SHEET_NAME","Active sheet changed to {0}",[s])),this.goView.activeSheet=s),n.length>0&&this.uxtNotificationService.info(this.sdaTranslateService.getFormatted("GOVIEW_TAGS_ON_OTHER_SHEETS-SHEET_NAMES","Other tags on sheets: {0}",[n.toString()]))}clearSearchResults(){this.goView.removeMaterialFromModel(),this.searchResults&&(this.goView.removeMaterialFromObjects(this.searchResults),this.searchResults=void 0),this.clearSearchResultsButton&&(this.clearSearchResultsButton.isDisabled=!0)}checkIfNavigationAllowedByMethod(){return this.navigationService.allowNavigation(this.config).pipe(Object(re.a)(e=>e))}checkIfNavigableByNavigationStrategyAndGraphicMap(){if(this.isNavigationAllowed){const e=this.navigationStrategy!==z.a.GRAPHICSMAP||this.graphicsMapLoaded&&this.graphicsMapService.hasMapNodeUidAttribute();this.isNavigable=e}else this.isNavigable=!1}checkVizPanelAvailable(){return this.isNavigable&&this.fileType===T.a.BINZ&&this.navigationStrategy!==z.a.GRAPHICSMAP}checkAndEnableSearch(){const e=this.graphicsMapLoaded&&this.graphicsMapService.hasMapNodeNameAttribute();if(this.isSearchable=!!this.isNavigationAllowed&&(e||this.navigationStrategy!==z.a.GRAPHICSMAP),this.isSearchable&&(this.addTransparencyChangedListener(),this.goView.defineCustomMaterial(fe.j),this.goView.defineCustomMaterial(fe.l),this.initializeSearchServiceProperties(),!this.isVizPanelAvailable)){const t=this.isPPM2DFile()?this.GOVIEW_SEARCH2D_PLACEHOLDER:this.GOVIEW_SEARCH_PLACEHOLDER;this.createPowerBarSearch(t,e?fe.i:fe.h),this.goidsToSelect&&this.goidsToSelect.length>0||(this.needsFit=!0)}}clearSubscriptions(){this.odataSubscription&&this.odataSubscription.unsubscribe(),this.getSearchGoidsSubscription&&this.getSearchGoidsSubscription.unsubscribe()}clearBubble(){this.showBubble=!1,this.showViewOffPageDocButton=!1}terminateBubbleWithMessage(e){this.killTimeout(),this.setSelectedTag(void 0),this.showTagDetails=!1,this.bubbleText=e,this.bubbleItems=void 0,this.terminateBubbleTimeout=this.timeoutService.setTimeout(()=>{this.clearBubble(),this.terminateBubbleTimeout=void 0},ve.a)}preventDefaultForTouch(e){"touchstart"===e.type.toLowerCase()&&e.preventDefault()}killTimeout(){this.terminateBubbleTimeout&&(this.timeoutService.clearTimeout(this.terminateBubbleTimeout),this.terminateBubbleTimeout=void 0)}onSearchableTagSelection(e){if(1===e.length){const t=this.graphicsMapService.getMapNodesByGraphicOid(e[0].toString());if(t&&t.length>0){const e=this.graphicsMapService.getMapNodeName(t[0]);e?(0===this.bubblePosition.x&&0===this.bubblePosition.y&&(this.bubblePosition.x=300,this.bubblePosition.y=90),this.bubbleText=e):this.terminateBubbleWithMessage(this.GOVIEW_HOTSPOTTED_ITEM_NOT_FOUND_IN_MAP)}else this.terminateBubbleWithMessage(this.GOVIEW_HOTSPOTTED_ITEM_NOT_FOUND_IN_MAP)}else this.clearBubble()}onSearchGraphicOIDs(e,t){if(e&&e.length>0)this.clearBubble(),void 0!==this.goViewDiv.offsetWidth&&(this.bubblePosition.x=this.goViewDiv.offsetWidth/2,this.bubblePosition.y=this.goViewDiv.offsetHeight/2),this.fitToGraphics(e);else{this.clearSearchResults();const e=this.GOVIEW_SEARCH_NO_TAGS_FOUND.replace("{0}",t);this.uxtNotificationService.info(e)}this.searchButton.isDisabled=!1}addTagToActionMenu(e){const t={};t.OBID=e.OBID,this.actionMenuProvider.addItem(new G.a(this.selectedTag.OBID,this.selectedTag.Name,this.selectedTag.Config,void 0,this.selectedTag.Class,t))}setSelectedTag(e){this.selectedTag=e,this.actionMenuProvider.clearAndCloseActionsMenu(),e&&this.addTagToActionMenu(e)}initializeSearchServiceProperties(){this.graphicsMapLoaded?this.searchGraphicsService.initializeSearchProperties(this.maximumSearchResults,this.maximumSuggestions,this.graphicsMapLoaded):this.searchGraphicsService.initializeSearchProperties(this.maximumSearchResults,this.maximumSuggestions,this.graphicsMapLoaded,this.versionOBID,this.config,this.navigationStrategy,this.navigationDocuments)}createPowerBarSearch(e,t){this.powerBarControls=[],this.powerBarAutoComplete=new ue.a(e=>this.searchGraphicsService.filterTagNames(e),e=>{this.onSearchModel(e)},e=>{this.onSearchModel(e,!0)},e,void 0,void 0,t),this.powerBarControls.push(this.powerBarAutoComplete),this.searchButton=new ge.a(()=>{this.onSearchModel(this.powerBarAutoComplete.searchTerm,!0)},void 0,"fa fa-search"),this.powerBarControls.push(this.searchButton),this.isPPM2DFile()||(this.clearSearchResultsButton=new ge.a(()=>{this.clearSearchResults()},this.GOVIEW_CLEAR_SEARCH_RESULTS,void 0,void 0,void 0,!0),this.powerBarControls.push(this.clearSearchResultsButton))}externalActionMonitor(){this.viewMarkupCacheService.isActionInitiatedExternally&&(this.viewMarkupCacheService.isActionInitiatedExternally=!1,this.viewMarkupCacheService.shouldSelectTags?this.ppmViewerService.queryGraphicsToSelect(this.viewMarkupCacheService.selectedTagUIDs,this.MAX_REPRESENTATIONS,this.navigationDocuments).subscribe(e=>{this.goidsToSelect=[],e&&e.representations&&e.representations.length>0?this.goidsToSelect=e.IDs:this.uxtNotificationService.info(this.GOVIEW_SELECT_ITEM_NOT_FOUND),this.showGoView.emit(),this.isPPM2DFile()?(this.ignoreNextSelectionChangedEvent=!0,this.clearBubble(),this.loadingOverlayService.hideLoadingOverlay(),this.createSelectSet2D(this.goidsToSelect),this.timeoutService.setTimeout(()=>{this.goView.fit2D()})):this.createSelectSet(this.goidsToSelect).pipe(Object(S.a)(1)).subscribe(()=>{this.clearBubble(),this.loadingOverlayService.hideLoadingOverlay(),this.goView.fit()})},e=>{this.exceptionService.handleException(new O.a(e))}):(this.goView.clearSelectionList(),this.isPPM2DFile()?this.goView.fit2D():this.goView.fit()))}afterSnapshotSaved(e){this.selectedGraphics&&this.selectedGraphics.length>0&&this.ppmViewerService.getTagsFromGraphics(this.navigationDocuments,this.selectedGraphics,this.config).subscribe(t=>{if(t&&t.length>0){const i=[];t.forEach(e=>{i.includes(e.OBID)||i.push(e.OBID)}),this.markupSnapshotService.relateToTags(e,i)}})}selectBubbleItemGraphics(e){const t=e.Name.replace(/-/g,"\u2011"),i=this.sdaTranslateService.getFormatted("GOVIEW_SELECTING_GRAPHICS-TAG","Selecting graphics for {0}",[t]);return e.GraphicOIDs?this.selectGraphics(e.GraphicOIDs,this.GRAPHIC_SELECTION_OVERLAY_COUNT,i):e.Edge?this.ppmViewerService.getGraphicsByEdgeDef(e.OBID,e.Edge.GraphicsEdgeDef,e.Config,this.MAX_REPRESENTATIONS,this.navigationDocuments).pipe(Object(S.a)(1),Object(m.a)(t=>(e.GraphicOIDs=t,this.selectGraphics(e.GraphicOIDs,this.GRAPHIC_SELECTION_OVERLAY_COUNT,i)))):this.navigationStrategy===z.a.FDW?this.ppmViewerService.queryGraphicsToSelect([e.UID],this.MAX_REPRESENTATIONS,this.navigationDocuments).pipe(Object(S.a)(1),Object(m.a)(e=>this.selectGraphics(e.IDs,this.GRAPHIC_SELECTION_OVERLAY_COUNT,i))):Object(v.a)(!1)}selectGraphics(e,t,i){return this.ignoreNextSelectionChangedEvent=!0,this.goView.clearSelectionList(),this.ignoreNextSelectionChangedEvent=!0,this.isPPM2DFile()?this.createSelectSet2D(e):this.createSelectSet(e,t,i)}createSelectSet(e,t,i){const s=void 0!==t&&(e?e.length:0)>=t;return s&&this.loadingOverlayService.showLoadingOverlay(i),Object(ae.a)(this.goView.createSelectSet(e)).pipe(Object(S.a)(1),Object(m.a)(e=>(s&&this.loadingOverlayService.hideLoadingOverlay(),Object(v.a)("Success"===e.status))))}createSelectSet2D(e){const t=this.goView.createSelectSet2D(e);return Object(v.a)("Success"===t.status)}onBubbleItemSelected(e){return this.actionMenuProvider.clearAndCloseActionsMenu(),this.selectedTag=e,this.addTagToActionMenu(e),this.selectBubbleItemGraphics(e)}swapExpandUrlForNamesToVIS(){this.expandUrlCommand&&this.expandUrlCommand.ITEMSBYNAME&&this.checkVizPanelAvailable()&&(this.expandUrlCommand={VIS:this.expandUrlCommand.ITEMSBYNAME})}displayMessageAboutUrlDataActionAvailability(){if(this.expandUrlCommand){const e=[];this.expandUrlCommand.ITEMSBYNAME?e.push("ITEMSBYNAME"):this.expandUrlCommand.ITEMSBYOBID?e.push("ITEMSBYOBID"):this.expandUrlCommand.ITEMSBYUID?e.push("ITEMSBYUID"):this.expandUrlCommand.VIS?e.push("VIS"):this.expandUrlCommand.VIR&&e.push("VIR"),this.uxtNotificationService.info(this.sdaTranslateService.getFormattedByString(this.URL_ACTION_UNAVAILABLE,e))}}}return e.\u0275fac=function(t){return new(t||e)(J.Sb(J.l),J.Sb(Ie),J.Sb(Te.a),J.Sb(N.a),J.Sb(k.a),J.Sb(Q),J.Sb(A.a),J.Sb(_.a),J.Sb(le.a),J.Sb(ce.a),J.Sb(be.a),J.Sb(M.a),J.Sb(s.n),J.Sb(x.a),J.Sb(Pe),J.Sb(ie.a),J.Sb(ye.a),J.Sb(se.a),J.Sb(me.a),J.Sb(pe.a),J.Sb(Ee),J.Sb(Ce.a),J.Sb(I.a),J.Sb(Se.a))},e.\u0275cmp=J.Mb({type:e,selectors:[["sda-goview"]],inputs:{goViewURL:"goViewURL",graphicsMapURL:"graphicsMapURL",labelDatabaseOBID:"labelDatabaseOBID",maximumSuggestions:"maximumSuggestions",maximumSearchResults:"maximumSearchResults",fileType:"fileType",fileName:"fileName",versionOBID:"versionOBID",config:"config",tagInterface:"tagInterface",isVizReportExecuted:"isVizReportExecuted",navigationStrategy:"navigationStrategy",expandUrlCommand:"expandUrlCommand",urlCommandHasError:"urlCommandHasError",useGoView2d:"useGoView2d",fileObid:"fileObid"},outputs:{snapshotCreated:"snapshotCreated",showGoView:"showGoView",clearUrlParameters:"clearUrlParameters"},features:[J.Db([Ie,Te.a,Q,Pe,ie.a,Ee]),J.Cb],decls:7,vars:7,consts:[["class","goview-search",4,"ngIf"],[1,"goview"],["id","goview__content",1,"goview-content",3,"resize","click","keyup","touchstart","mousewheel","mousedown","orientationchange"],[3,"bubbleText","bubbleItems","bubblePositionX","bubblePositionY","isMenuActive","selectedObject","showViewOPCDocButton","toggleActionsMenu","detailsExpand","viewOffPageDocument","bubbleItemSelected",4,"ngIf"],[3,"docVersionOBID","config","navigationStrategy","viewerHeight","triggerRefreshDisplayEvent","expandUrlCommand","readyForUrlCommand","eventCustomMaterialObject","eventObjectsToHide","eventObjectsToShow","eventAssignToObjects","eventRemoveFromObjects","eventClearModel","eventFitSelection","eventSetModelUnselected","eventVizPanelResized","eventIsVizReportExecuted",4,"ngIf"],["id","tag-properties-container","class","tag-properties",4,"ngIf"],["modal","true","appendTo","body",3,"header","visible","responsive","resizable","visibleChange",4,"ngIf"],[1,"goview-search"],[3,"leftControls",4,"ngIf"],[3,"leftControls"],[3,"bubbleText","bubbleItems","bubblePositionX","bubblePositionY","isMenuActive","selectedObject","showViewOPCDocButton","toggleActionsMenu","detailsExpand","viewOffPageDocument","bubbleItemSelected"],[3,"docVersionOBID","config","navigationStrategy","viewerHeight","triggerRefreshDisplayEvent","expandUrlCommand","readyForUrlCommand","eventCustomMaterialObject","eventObjectsToHide","eventObjectsToShow","eventAssignToObjects","eventRemoveFromObjects","eventClearModel","eventFitSelection","eventSetModelUnselected","eventVizPanelResized","eventIsVizReportExecuted"],["id","tag-properties-container",1,"tag-properties"],[1,"properties-nav"],[1,"properties-nav__title",3,"title"],["svgIcon","shrink",1,"properties-nav__icon",3,"click","touchstart"],[1,"properties-list",3,"id","config"],["modal","true","appendTo","body",3,"header","visible","responsive","resizable","visibleChange"],[3,"classDefUID","methodOBID","isCancelVisible","formCreated","onCancel"]],template:function(e,t){1&e&&(J.Sc(0,gi,2,1,"div",0),J.Yb(1,"div",1),J.Yb(2,"div",2),J.hc("resize",(function(){return t.resizedWindow()}),!1,J.Jc)("click",(function(e){return t.onGoViewClick(e)}))("keyup",(function(e){return t.onGoViewKeyUp(e)}))("touchstart",(function(e){return t.onGoViewTouchStart(e)}))("mousewheel",(function(e){return t.onGoViewMouseWheel(e)}))("mousedown",(function(e){return t.onGoViewMouseDown(e)}))("orientationchange",(function(){return t.resizedWindow()}),!1,J.Jc),J.Sc(3,bi,1,7,"sda-hotspot-bubble",3),J.Xb(),J.Sc(4,vi,1,7,"sda-viz-panel",4),J.Xb(),J.Sc(5,Si,6,4,"div",5),J.Sc(6,mi,2,7,"p-dialog",6)),2&e&&(J.sc("ngIf",t.isSearchable),J.Eb(1),J.Ib("goview--short",t.isSearchable&&!t.isVizPanelAvailable),J.Eb(2),J.sc("ngIf",t.showBubble),J.Eb(1),J.sc("ngIf",t.isVizPanelAvailable),J.Eb(1),J.sc("ngIf",t.showTagDetails),J.Eb(1),J.sc("ngIf",t.showCreateSnapshotForm))},directives:[s.t,De.a,xe.a,ci,l.a,hi.a,di.a,pi.a],styles:["sda-object-details[_ngcontent-%COMP%]{overflow-x:hidden;overflow-y:auto}.properties-nav__title[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.goview[_ngcontent-%COMP%]{display:flex;height:100%}.goview--short[_ngcontent-%COMP%]{height:calc(100% - 48px)}.goview-search[_ngcontent-%COMP%]     .power-bar-button{padding-top:6px;background-color:#0087c8;color:#fff;border:0;text-shadow:none}.goview-search[_ngcontent-%COMP%]     .power-bar-button:not([disabled]):not(.sda-button--primary):hover{background-color:#0070a6!important;color:#fff!important}.goview-content[_ngcontent-%COMP%]{background-color:#000;position:relative;flex:1;min-height:0}.tag-properties[_ngcontent-%COMP%]{position:fixed;top:100px;left:24.5%;right:24.5%;bottom:6%;display:flex;flex-direction:column;overflow:hidden;background-color:#fff;border:3px solid #069;border-radius:15px;z-index:200!important}.tag-properties[_ngcontent-%COMP%]     .form__content{width:100%}.properties-nav[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:space-between;margin-bottom:4px;padding:8px 16px}.properties-nav__title[_ngcontent-%COMP%]{width:95%;font-size:20px;font-weight:500}.properties-nav__icon[_ngcontent-%COMP%]{align-self:flex-start;cursor:pointer;fill:#1f8cdf}sda-object-details[_ngcontent-%COMP%]{display:flex;flex:1;flex-direction:column;border:1px solid #ccc}"]}),e})();var Oi=i("dt5s"),_i=i("E9dD"),Ii=i("ZLgS"),Ti=i("Cy33"),Ri=i("TMLg"),Ei=i("BLbD");const yi=[[["",8,"sda-layout-region-left"]],[["",8,"sda-layout-region-right"]]],wi=[".sda-layout-region-left",".sda-layout-region-right"];let Mi=(()=>{class e{constructor(e){this.windowService=e,this.resPanelMaxWidth=400,this.resPanelDefaultWidth=400,this.resPanelMinWidth=400,this.resizable=!0,this.disableRegion=Ri.a.None,this.hideResizePanel=!1,this.onResized=new J.o,this.orientation=Ti.a.Right,this.showContentOverlay=!1,this.layoutRegion=Ri.a,this.COLLAPSED_CLIENT_BREAKPOINT=850}ngOnChanges(e){e.hideResizePanel&&void 0!==e.hideResizePanel.previousValue&&(this.showContentOverlay=!0!==e.hideResizePanel.currentValue&&this.windowService.Window.innerWidth<=this.COLLAPSED_CLIENT_BREAKPOINT)}onSideBarResized(e){this.hideResizePanel||(this.showContentOverlay=this.windowService.Window.innerWidth<=this.COLLAPSED_CLIENT_BREAKPOINT&&e>0,this.onResized.emit())}updaterResizePanelArgs(){this.hideResizePanel||this.resizePanel.resetMinValue(this.windowService.Window.innerWidth<this.COLLAPSED_CLIENT_BREAKPOINT?0:this.resPanelMinWidth)}ngAfterViewInit(){this.updaterResizePanelArgs()}}return e.\u0275fac=function(t){return new(t||e)(J.Sb(Xe.a))},e.\u0275cmp=J.Mb({type:e,selectors:[["sda-right-split-template"]],viewQuery:function(e,t){var i;1&e&&J.bd(Ii.a,!0),2&e&&J.Gc(i=J.ic())&&(t.resizePanel=i.first)},hostBindings:function(e,t){1&e&&J.hc("resize",(function(){return t.updaterResizePanelArgs()}),!1,J.Jc)},inputs:{styleClass:"styleClass",resPanelMaxWidth:"resPanelMaxWidth",resPanelDefaultWidth:"resPanelDefaultWidth",resPanelMinWidth:"resPanelMinWidth",resizable:"resizable",disableRegion:"disableRegion",hideResizePanel:"hideResizePanel"},outputs:{onResized:"onResized"},features:[J.Cb],ngContentSelectors:wi,decls:9,vars:12,consts:[[1,"layout",3,"ngClass"],[1,"layout__left"],[3,"toggle","position"],[1,"layout__right"],[3,"resizable","orientation","defaultValue","minValue","maxValue","onResized"],["resizePanel",""]],template:function(e,t){1&e&&(J.rc(yi),J.Yb(0,"div",0),J.Yb(1,"div",1),J.qc(2),J.Tb(3,"sda-blanket",2),J.Xb(),J.Yb(4,"div",3),J.Yb(5,"sda-resize-panel",4,5),J.hc("onResized",(function(e){return t.onSideBarResized(e)})),J.qc(7,1,["class","sda-resize-panel-content"]),J.Xb(),J.Tb(8,"sda-blanket",2),J.Xb(),J.Xb()),2&e&&(J.sc("ngClass",t.styleClass),J.Eb(3),J.sc("toggle",t.showContentOverlay||t.disableRegion===t.layoutRegion.Left)("position","absolute"),J.Eb(1),J.Rc("display",!0===t.hideResizePanel?"none":"inline"),J.Eb(1),J.sc("resizable",t.resizable)("orientation",t.orientation)("defaultValue",t.resPanelDefaultWidth)("minValue",t.resPanelMinWidth)("maxValue",t.resPanelMaxWidth),J.Eb(3),J.sc("toggle",t.disableRegion===t.layoutRegion.Right)("position","absolute"))},directives:[s.q,Ei.a,Ii.a],styles:["[_nghost-%COMP%]{flex:1}.layout[_ngcontent-%COMP%], [_nghost-%COMP%]{display:flex;width:100%;height:100%}.layout[_ngcontent-%COMP%]{position:relative}.layout[_ngcontent-%COMP%]     .blanket{z-index:100!important}.layout__right[_ngcontent-%COMP%]{position:relative;display:flex;height:100%}.layout__right[_ngcontent-%COMP%]     .sda-layout-region-right{display:flex;flex-direction:column;width:100%}.layout__right[_ngcontent-%COMP%]     .resize-panel__handle{z-index:200!important}.layout__left[_ngcontent-%COMP%]{position:relative;display:flex;width:100%;min-width:0}.layout__left[_ngcontent-%COMP%]     .sda-layout-region-left{display:flex;flex-direction:column;width:100%}"]}),e})();var Pi=i("sZbH"),Di=i("cy33"),xi=i("0EQZ"),Ai=i("FvrZ"),Ni=i("8yBR"),Gi=i("bTqV"),Vi=i("bSwM"),Fi=i("Jgl7");function ki(e,t){if(1&e){const e=J.Zb();J.Yb(0,"mat-tree-node",3),J.Tb(1,"button",4),J.Yb(2,"mat-checkbox",5),J.hc("change",(function(){J.Kc(e);const i=t.$implicit;return J.lc().leafItemSelectionToggle(i)})),J.Tb(3,"sda-object-icon",6),J.Uc(4),J.Xb(),J.Xb()}if(2&e){const e=t.$implicit,i=J.lc();J.Eb(2),J.sc("checked",i.checklistSelection.isSelected(e)),J.Eb(1),J.sc("imageName",e.Class),J.Eb(1),J.Wc(" ",e.Name," ")}}function Li(e,t){1&e&&(J.Yb(0,"mat-tree-node",7),J.Tb(1,"button",4),J.Xb())}function Ui(e,t){if(1&e){const e=J.Zb();J.Yb(0,"mat-checkbox",12),J.hc("change",(function(){J.Kc(e);const t=J.lc().$implicit;return J.lc().itemSelectionToggle(t)})),J.Tb(1,"sda-object-icon",13),J.Uc(2),J.Xb()}if(2&e){const e=J.lc().$implicit,t=J.lc();J.sc("checked",t.descendantsAllSelected(e))("indeterminate",t.descendantsPartiallySelected(e)),J.Eb(1),J.sc("imageName",e.Class),J.Eb(1),J.Wc(" ",e.Name," ")}}function Bi(e,t){if(1&e&&(J.Tb(0,"sda-object-icon",14),J.Uc(1)),2&e){const e=J.lc().$implicit;J.sc("imageName",e.Class),J.Eb(1),J.Wc(" ",e.Name," ")}}function ji(e,t){if(1&e&&(J.Yb(0,"mat-tree-node",7),J.Yb(1,"button",8),J.Tb(2,"mat-icon",9),J.Xb(),J.Sc(3,Ui,3,4,"mat-checkbox",10),J.Sc(4,Bi,2,2,"ng-template",null,11,J.Tc),J.Xb()),2&e){const e=t.$implicit,i=J.Hc(5),s=J.lc();J.Eb(1),J.Fb("aria-label","Toggle "+e.item),J.Eb(1),J.sc("svgIcon",s.treeControl.isExpanded(e)?"chevron-down":"chevron-right"),J.Eb(1),J.sc("ngIf",0!=e.level)("ngIfElse",i)}}let zi=(()=>{class e{constructor(e){this.zone=e,this.isCompact=!1,this.nodeSelection=new J.o,this.checklistSelection=new xi.c(!0),this.getLevel=e=>e.level,this.isExpandable=e=>e.expandable,this.getChildren=e=>e.Children,this.hasChild=(e,t)=>t.expandable,this.hasNoContent=(e,t)=>""===t.Name,this.transformer=(e,t)=>{var i;const s=this.nestedNodeMap.get(e),n=s&&s.Id===e.Id?s:{Name:e.Name,Id:e.Id,Class:e.Class,Config:e.Config,Children:e.Children,level:void 0,expandable:void 0};return n.level=t,n.expandable=!!(null===(i=e.Children)||void 0===i?void 0:i.length),this.flatNodeMap.set(n,e),this.nestedNodeMap.set(e,n),n},this.flatNodeMap=new Map,this.nestedNodeMap=new Map,this.treeFlattener=new Ni.d(this.transformer,this.getLevel,this.isExpandable,this.getChildren),this.treeControl=new Ai.j(this.getLevel,this.isExpandable),this.dataSource=new Ni.c(this.treeControl,this.treeFlattener)}ngOnInit(){this.dataSource.data=[this.selectionTree]}ngAfterViewInit(){this.treeControl.dataNodes.forEach(e=>{e.level<2&&this.treeControl.expand(e)})}leafItemSelectionToggle(e){this.checklistSelection.toggle(e),this.checkAllParentsSelection(e);const t=this.checklistSelection.isSelected(e);this.nodeSelection.emit({Id:e.Id,Name:e.Name,Class:e.Class,Config:e.Config,Children:e.Children,Parent:this.getParentNode(e),Selected:t})}getNodeById(e,t){let i;return this.treeControl.dataNodes.forEach(s=>{s.Id===e&&(t||(i=s),t&&this.checklistSelection.isSelected(s)&&(i=s))}),i}descendantsAllSelected(e){const t=this.treeControl.getDescendants(e);return t.length>0&&t.every(e=>this.checklistSelection.isSelected(e))}descendantsPartiallySelected(e){return this.treeControl.getDescendants(e).some(e=>this.checklistSelection.isSelected(e))&&!this.descendantsAllSelected(e)}itemSelectionToggle(e){this.checklistSelection.toggle(e);const t=this.treeControl.getDescendants(e),i=this.checklistSelection.isSelected(e);i?this.checklistSelection.select(...t):this.checklistSelection.deselect(...t),t.forEach(e=>this.checklistSelection.isSelected(e)),this.checkAllParentsSelection(e),this.nodeSelection.emit({Id:e.Id,Name:e.Name,Class:e.Class,Config:e.Config,Children:e.Children,Parent:this.getParentNode(e),Selected:i})}clearAllSelections(){this.zone.run(()=>{this.checklistSelection.clear()})}getParentNodeByNodeId(e,t){let i;const s=this.getNodeById(e,t);return(!t||t&&s)&&(i=this.getParentNode(s)),i}getAllDescendentIds(e){return this.treeControl.getDescendants(this.getNodeById(e,!1)).map(e=>e.Id)}getAllDescendents(e){return this.treeControl.getDescendants(this.getNodeById(e,!1)).map(e=>({OBID:e.Id,Name:e.Name,Config:e.Config}))}getAllAncestors(e){const t=[];let i=this.getParentNode(this.getNodeById(e,!1));for(;i;)0!==i.level&&t.push({OBID:i.Id,Name:i.Name,Config:i.Config}),i=this.getParentNode(i);return t}getHighestSelectedAncestor(e){let t;t=this.getNodeById(e,!1);let i=t;for(;i;)i=this.getParentNodeByNodeId(i.Id,!0),i&&i.level>0&&this.checklistSelection.isSelected(i)&&(t=i);return{Id:t.Id,Name:t.Name,Class:t.Class,Config:t.Config,Children:t.Children,Parent:this.getParentNode(t),Selected:!0}}getHighestDeselectedAncestor(e){let t;t=this.getNodeById(e,!1);let i=t;for(;i;)i=this.getParentNodeByNodeId(i.Id,!1),i&&i.level>0&&1===i.Children.length?t=i:i=void 0;return{Id:t.Id,Name:t.Name,Class:t.Class,Config:t.Config,Children:t.Children,Parent:this.getParentNode(t),Selected:!1}}checkAllParentsSelection(e){let t=this.getParentNode(e);for(;t;)this.checkRootNodeSelection(t),t=this.getParentNode(t)}checkRootNodeSelection(e){const t=this.checklistSelection.isSelected(e),i=this.treeControl.getDescendants(e),s=i.length>0&&i.every(e=>this.checklistSelection.isSelected(e));t&&!s?this.checklistSelection.deselect(e):!t&&s&&this.checklistSelection.select(e)}getParentNode(e){const t=this.getLevel(e);if(!(t<1))for(let i=this.treeControl.dataNodes.indexOf(e)-1;i>=0;i--){const e=this.treeControl.dataNodes[i];if(this.getLevel(e)<t)return e}}}return e.\u0275fac=function(t){return new(t||e)(J.Sb(J.B))},e.\u0275cmp=J.Mb({type:e,selectors:[["sda-gvc-select-panel-tree"]],inputs:{isCompact:"isCompact",selectionTree:"selectionTree"},outputs:{nodeSelection:"nodeSelection"},decls:4,vars:4,consts:[[3,"dataSource","treeControl"],["matTreeNodeToggle","","matTreeNodePadding","",4,"matTreeNodeDef"],["matTreeNodePadding","",4,"matTreeNodeDef","matTreeNodeDefWhen"],["matTreeNodeToggle","","matTreeNodePadding",""],["mat-icon-button","","disabled",""],[1,"checklist-leaf-node",3,"checked","change"],[1,"mat-icon-rtl-mirror",3,"imageName"],["matTreeNodePadding",""],["mat-icon-button","","matTreeNodeToggle",""],[3,"svgIcon"],[3,"checked","indeterminate","change",4,"ngIf","ngIfElse"],["unselectable_node",""],[3,"checked","indeterminate","change"],[3,"imageName"],[1,"gvc-tree-icon",3,"imageName"]],template:function(e,t){1&e&&(J.Yb(0,"mat-tree",0),J.Sc(1,ki,5,3,"mat-tree-node",1),J.Sc(2,Li,2,0,"mat-tree-node",2),J.Sc(3,ji,6,4,"mat-tree-node",2),J.Xb()),2&e&&(J.sc("dataSource",t.dataSource)("treeControl",t.treeControl),J.Eb(2),J.sc("matTreeNodeDefWhen",t.hasNoContent),J.Eb(1),J.sc("matTreeNodeDefWhen",t.hasChild))},directives:[Ni.b,Ni.h,Ni.g,Ni.k,Ni.j,Gi.a,Vi.a,Fi.a,l.a,s.t],styles:["[_nghost-%COMP%]{display:flex;flex:1;flex-direction:column}.gvc-select-panel-tree[_ngcontent-%COMP%]{display:flex;flex-grow:1;z-index:100!important}.gvc-tree-icon[_ngcontent-%COMP%]{flex-shrink:0}"]}),e})(),Hi=(()=>{class e{constructor(e){this.sdaTranslateService=e,this.closeSelectPanel=new J.o,this.title=this.sdaTranslateService.get("GVC_MENU_SELECT_HIERARCHY","Select by Hierarchy"),this.closeToolTip=this.sdaTranslateService.get("CLOSE","Close")}closePanel(){this.closeSelectPanel.emit()}}return e.\u0275fac=function(t){return new(t||e)(J.Sb(N.a))},e.\u0275cmp=J.Mb({type:e,selectors:[["sda-gvc-select-panel-header"]],outputs:{closeSelectPanel:"closeSelectPanel"},decls:5,vars:3,consts:[[1,"gvc-select-panel-header"],[1,"gvc-select-panel-header__title",3,"title"],[1,"command-button"],["svgIcon","close",1,"command-button__icon",3,"title","click"]],template:function(e,t){1&e&&(J.Yb(0,"div",0),J.Yb(1,"h4",1),J.Uc(2),J.Xb(),J.Yb(3,"div",2),J.Yb(4,"mat-icon",3),J.hc("click",(function(){return t.closePanel()})),J.Xb(),J.Xb(),J.Xb()),2&e&&(J.Eb(1),J.sc("title",t.title),J.Eb(1),J.Vc(t.title),J.Eb(2),J.sc("title",t.closeToolTip))},directives:[l.a],styles:[".gvc-select-panel-header[_ngcontent-%COMP%], .gvc-select-panel-header__title[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}[_nghost-%COMP%]{position:relative;display:flex;height:49px;box-shadow:0 1px 5px rgba(0,0,0,.1);overflow:hidden;background-color:#6b8cad;border-bottom:#cad0d7;color:#fff}.gvc-select-panel-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%;margin:3px 8px}.gvc-select-panel-header__title[_ngcontent-%COMP%]{margin:0 5px;font-size:16px;color:#fff;line-height:1.2}.command-button[_ngcontent-%COMP%]{width:32px;cursor:pointer}.command-button__icon[_ngcontent-%COMP%]{width:32px;height:32px}"]}),e})(),Wi=(()=>{class e{constructor(e){this.sdaTranslateService=e,this.closeSelectPanel=new J.o,this.nodeSelection=new J.o,this.closeToolTip=this.sdaTranslateService.get("CLOSE","Close")}closePanel(){this.closeSelectPanel.emit()}onNodeSelection(e){this.nodeSelection.emit(e)}clearAllSelections(){this.selectPanelTree.clearAllSelections()}}return e.\u0275fac=function(t){return new(t||e)(J.Sb(N.a))},e.\u0275cmp=J.Mb({type:e,selectors:[["sda-gvc-select-panel"]],viewQuery:function(e,t){var i;1&e&&J.bd(zi,!0),2&e&&J.Gc(i=J.ic())&&(t.selectPanelTree=i.first)},inputs:{displayPanel:"displayPanel",panelContent:"panelContent",selectionTree:"selectionTree",panelHeight:"panelHeight"},outputs:{closeSelectPanel:"closeSelectPanel",nodeSelection:"nodeSelection"},decls:5,vars:3,consts:[[1,"gvc-select"],[1,"gvc-select__header",3,"closeSelectPanel"],[1,"gvc-select__panel",3,"selectionTree","nodeSelection"],["selectPanelTree",""]],template:function(e,t){1&e&&(J.Yb(0,"div",0),J.Yb(1,"sda-gvc-select-panel-header",1),J.hc("closeSelectPanel",(function(){return t.closePanel()})),J.Xb(),J.Yb(2,"sda-gvc-select-panel-tree",2,3),J.hc("nodeSelection",(function(e){return t.onNodeSelection(e)})),J.Uc(4," > "),J.Xb(),J.Xb()),2&e&&(J.Eb(2),J.Rc("height",t.panelHeight-49+"px"),J.sc("selectionTree",t.selectionTree))},directives:[Hi,zi],styles:["[_nghost-%COMP%]{display:flex}.gvc-select[_ngcontent-%COMP%], [_nghost-%COMP%]{flex-direction:column}.gvc-select[_ngcontent-%COMP%]{min-width:40px;height:100%;justify-content:center;background-color:#fff;color:#000;font-size:13px;z-index:100!important}.gvc-select__header[_ngcontent-%COMP%]{position:relative;display:flex;flex:1;flex-grow:0;width:100%}.gvc-select__panel[_ngcontent-%COMP%]{display:flex;flex:1;flex-direction:column;width:100%;height:100px;min-height:0;overflow:auto;z-index:100!important}"]}),e})();var Yi=i("brUY");const Xi=["selectByHierarchyPanel"];function Ki(e,t){if(1&e&&J.Tb(0,"sda-power-bar-view",12),2&e){const e=J.lc();J.sc("leftControls",e.powerBarControls)}}function $i(e,t){if(1&e){const e=J.Zb();J.Yb(0,"lib-gvc-angular-wrapper",13),J.hc("componentRef",(function(t){return J.Kc(e),J.lc().onComponentRef(t)}))("selectionChanged",(function(t){return J.Kc(e),J.lc().handleSelection(t)}))("modelOpened",(function(t){return J.Kc(e),J.lc().handleModelOpened(t)}))("onStreamingStopped",(function(){return J.Kc(e),J.lc().handleStreamingStopped()}))("click",(function(t){return J.Kc(e),J.lc().handleClick(t)}))("touchstart",(function(t){return J.Kc(e),J.lc().handleTouchstart(t)}))("resize",(function(){return J.Kc(e),J.lc().windowResize()}),!1,J.Jc)("orientationchange",(function(){return J.Kc(e),J.lc().onOrientationChange()}),!1,J.Jc),J.Xb()}if(2&e){const e=J.lc();J.sc("width",e.width)("height",e.height)("models",e.models)("defaultSettings",e.defaultSettings)("home",!0)("fit",!0)("clip",!0)("measure",!0)("fly",!0)("refresh",e.showRefresh)("snapshot",!1)("isolate",e.showIsolate)("undo",!0)("redo",!0)("navigator",!0)("resources",e.resources)("axisDataPath",e.axisDataPath)("axisFontPath",e.axisFontPath)("language",e.language)("hideModelsMenu",!0)("zoomArea",!0)("customCommands",e.customCommands)}}function Zi(e,t){if(1&e){const e=J.Zb();J.Yb(0,"sda-hotspot-bubble",14),J.hc("toggleActionsMenu",(function(t){return J.Kc(e),J.lc().toggleTagActionsMenu(t)}))("detailsExpand",(function(t){return J.Kc(e),J.lc().tagDetailsExpand(t)}))("bubbleItemSelected",(function(t){return J.Kc(e),J.lc().onBubbleItemSelected(t)}))("closeBubble",(function(){return J.Kc(e),J.lc().clearBubble()})),J.Xb()}if(2&e){const e=J.lc();J.sc("bubbleText",e.bubbleText)("bubbleItems",e.bubbleItems)("bubblePositionX",e.bubblePosition.x)("bubblePositionY",e.bubblePosition.y)("isMenuActive",e.selectedTag)("showCloseButton",!0)("selectedObject",e.selectedTag)}}function qi(e,t){if(1&e){const e=J.Zb();J.Yb(0,"sda-viz-panel",15,16),J.hc("eventCustomMaterialObject",(function(t){return J.Kc(e),J.lc().addCustomMaterial(t)}))("eventObjectsToHide",(function(t){return J.Kc(e),J.lc().hideObjects(t)}))("eventObjectsToShow",(function(t){return J.Kc(e),J.lc().showObjects(t)}))("eventAssignToObjects",(function(t){return J.Kc(e),J.lc().assignMaterialToObjects(t)}))("eventRemoveFromObjects",(function(t){return J.Kc(e),J.lc().removeMaterialFromObjects(t)}))("eventClearModel",(function(t){return J.Kc(e),J.lc().clearModel(t)}))("eventFitSelection",(function(t){return J.Kc(e),J.lc().fitSelection(t)}))("eventSetModelUnselected",(function(){return J.Kc(e),J.lc().setModelUnselected()}))("eventVizPanelResized",(function(t){return J.Kc(e),J.lc().vizPanelResized(t)})),J.Xb()}if(2&e){const e=J.lc();J.sc("docVersionOBID",e.versionOBID)("config",e.config)("navigationStrategy",e.navigationStrategy)("viewerHeight",e.height)("triggerRefreshDisplayEvent",e.triggerRefreshDisplayEvent)("expandUrlCommand",e.expandUrlCommand)("readyForUrlCommand",e.readyForUrlCommand)("methodOBID",e.methodOBID)("excludedFilterUID",e.activeFilterUID)}}function Ji(e,t){if(1&e){const e=J.Zb();J.Yb(0,"sda-gvc-select-panel",17,18),J.hc("closeSelectPanel",(function(){return J.Kc(e),J.lc().onSelectCommandClicked()}))("nodeSelection",(function(t){return J.Kc(e),J.lc().onNodeSelection(t)})),J.Xb()}if(2&e){const e=J.lc();J.sc("panelHeight",e.height)("displayPanel",e.selectCommandIsActive)("selectionTree",e.selectionTree)}}function Qi(e,t){if(1&e){const e=J.Zb();J.Yb(0,"div",19),J.Yb(1,"div",20),J.Yb(2,"h2",21),J.Uc(3),J.Xb(),J.Yb(4,"mat-icon",22),J.hc("click",(function(t){return J.Kc(e),J.lc().tagDetailsShrink(t)}))("touchstart",(function(t){return J.Kc(e),J.lc().tagDetailsShrink(t)})),J.Xb(),J.Xb(),J.Tb(5,"sda-object-details",23),J.Xb()}if(2&e){const e=J.lc();J.Eb(2),J.sc("title",e.selectedTag.Name),J.Eb(1),J.Wc(" ",e.selectedTag.Name," "),J.Eb(2),J.sc("id",e.selectedTag.OBID)("config",e.selectedTag.Config)}}function es(e,t){if(1&e){const e=J.Zb();J.Yb(0,"p-dialog",24),J.hc("visibleChange",(function(t){return J.Kc(e),J.lc().showCreateSnapshotForm=t})),J.Yb(1,"sda-create-obj-view",25),J.hc("formCreated",(function(t){return J.Kc(e),J.lc().snapshotFormCreated(t)}))("onCancel",(function(){return J.Kc(e),J.lc().snapshotFormCancelled()})),J.Xb(),J.Xb()}if(2&e){const e=J.lc();J.sc("header",e.GOVIEW_CREATE_MARKUP_SNAPSHOT)("visible",e.showCreateSnapshotForm)("responsive",!0)("resizable",!1),J.Eb(1),J.sc("classDefUID",e.snapshotClassDefUID)("methodOBID",e.snapshotMethodOBID)("isCancelVisible",!0)}}let ts=(()=>{class e{constructor(e,t,i,s,n,a,o,r,l,c,h,d,p,u,g,b,v,S,m,f,C,O,_){this.loadingOverlayService=e,this.graphicsMapService=t,this.ppmViewerService=i,this.loggingService=s,this.exceptionService=n,this.actionMenuProvider=a,this.timeoutService=o,this.sdaTranslateService=r,this.contentMenuService=l,this.labelDatabaseService=c,this.uxtNotificationService=h,this.gvcService=d,this.gdsService=p,this.searchGraphicsService=u,this.windowService=g,this.elementRef=b,this.navigationService=v,this.viewMarkupCacheService=S,this.formService=m,this.markupSnapshotService=f,this.zone=C,this.configService=O,this.filterService=_,this.snapshotCreated=new J.o,this.selectCommandStarted=new J.o,this.selectCommandStopped=new J.o,this.models=[],this.defaultSettings=[Oi.GVC_ENUM.Settings.TRANSPARENCY,Oi.GVC_ENUM.Settings.AMBIENT_OCCLUSION,Oi.GVC_ENUM.Settings.ANTI_ALIAS,Oi.GVC_ENUM.Settings.NAVIGATOR,Oi.GVC_ENUM.Settings.DISPLAY_AXIS],this.axisFontPath="",this.axisDataPath="",this.language=Oi.GVC_ENUM.Language.EN_US,this.isNavigable=!1,this.isSearchable=!1,this.isNavigationAllowed=!1,this.showTagDetails=!1,this.showBubble=!1,this.isVizPanelAvailable=!1,this.shouldClearReportsEvent=!1,this.triggerRefreshDisplayEvent=!1,this.GOVIEW_HOTSPOTTED_ITEM_NOT_FOUND=this.sdaTranslateService.get("GOVIEW_HOTSPOTTED_ITEM_NOT_FOUND","The hotspotted item was not found"),this.GOVIEW_SELECT_ITEM_NOT_FOUND=this.sdaTranslateService.get("GOVIEW_SELECT_ITEM_NOT_FOUND","The item was not found in this file"),this.GOVIEW_HOTSPOTTED_ITEM_NOT_FOUND_IN_MAP=this.sdaTranslateService.get("GOVIEW_HOTSPOTTED_ITEM_NOT_FOUND_IN_MAP","Data cannot be found for selected object"),this.GOVIEW_SEARCH_PLACEHOLDER=this.sdaTranslateService.get("GOVIEW_SEARCH_PLACEHOLDER","Search 3D Model..."),this.GOVIEW_SEARCH_NO_SEARCH_PHRASE=this.sdaTranslateService.get("GOVIEW_SEARCH_NO_SEARCH_PHRASE","Enter a search phrase"),this.GOVIEW_SEARCH_NO_TAGS_FOUND=this.sdaTranslateService.get("GOVIEW_SEARCH_NO_TAGS_FOUND","No tags matching '{0}' were found"),this.VIR_URL_INCORRECT=this.sdaTranslateService.get("VIR_URL_INCORRECT","URL command incorrectly formatted"),this.HIERARCHY_PROCESSING=this.sdaTranslateService.get("HIERARCHY_PROCESSING","Processing hierarchy selection or deselection"),this.isItemPinned=!1,this.powerBarControls=[],this.readyForUrlCommand=!1,this.showIsolate=!0,this.showRefresh=!1,this.GOVIEW_CREATE_MARKUP_SNAPSHOT=this.sdaTranslateService.get("GOVIEW_CREATE_MARKUP_SNAPSHOT","Create Markup Snapshot"),this.CREATE_OBJ_CREATED_SUCCESS=this.sdaTranslateService.get("CREATE_OBJ_CREATED_SUCCESS","Object successfully created"),this.SELECT_TITLE=this.sdaTranslateService.get("GVC_MENU_SELECT_HIERARCHY","Select by Hierarchy"),this.NO_HIERARCHY_AVAILABLE=this.sdaTranslateService.get("GVC_NO_HIERARCHY_AVAILABLE","No hierarchy is available"),this.resPanelDefaultWidth="350",this.resPanelMinWidth="100",this.resPanelMaxWidth="600",this.hideResizePanel=!0,this.showCreateSnapshotForm=!1,this.snapshotClassDefUID="SPFMarkupSnapshot",this.customCommands=new Array,this.selectCommandIsActive=!1,this.graphicsMapLoaded=!1,this.vizPanelWidth=0,this.suspendSelectionHandling=!1,this.needsSelectWhenLoaded=!1,this.MAX_REPRESENTATIONS=1e3,this.definedMaterials=[],this.currentSize=[void 0,void 0],this.GOVIEW_CLEAR_SEARCH_RESULTS=this.sdaTranslateService.get("GOVIEW_CLEAR_SEARCH_RESULTS","Clear"),this.GVC_FITTING_TO_ITEMS=this.sdaTranslateService.get("GVC_FITTING_TO_ITEMS","Fitting to selected items"),this.GVC_ASSIGNING_MATERIAL=this.sdaTranslateService.get("GVC_ASSIGNING_MATERIAL","Assigning material"),this.monikerIdentityCache={},this.openingModelTimeout=3e4,this.selectedTags={},this.SELECTEDTAGS_KEY_DELIMITER=",",this.hierarchyGraphics={},this.selectedGraphicsCache={},this.showingTerminatedGraphics=!1,this.bubblePosition=new fi,this.bubblePosition.x=200,this.bubblePosition.y=200,this.monikersToIdsSubject=new ne.a}set content(e){e&&(this.selectByHierarchyPanel=e)}onComponentRef(e){null!==e&&(this.gvcRef=e)}ngOnInit(){this.monikersToIdsSubscription=this.monikersToIdsSubject.pipe(Object(oe.a)(e=>this.onMonikersToIds(e))).subscribe();let e=`${this.windowService.Window.location.origin}${this.windowService.Window.location.pathname}`;e.endsWith("/")||(e+="/"),this.language=this.getGvcLanguage(),this.resources=e+"gvc-resources/",this.gvcLoaded$=this.gvcService.loadDependencies().pipe(Object(re.a)(()=>!0),Object(tt.a)(()=>(this.exceptionService.handleException(new O.a(this.sdaTranslateService.get("GVC_DEPS_FAIL","Failed to load GVC dependencies"))),Object(v.a)(!1)))),this.navigationStrategy=this.viewFile.navigationStrategy,this.config=this.viewFile.fileObject.config,this.versionOBID=this.viewFile.versionOBID,this.loadingOverlayService.showLoadingOverlay(this.sdaTranslateService.get("GVC_PREPARING_MODEL","Preparing model...")),this.selectCommand=new Oi.GVCCustomCommand("SDx-gvc-select",this.SELECT_TITLE,"select",Oi.GVC_ENUM.ModelDimensions.ALL,Oi.GVC_ENUM.AccessProtocol.ALL,this.onSelectCommandClicked.bind(this),void 0,!1),this.customCommands.push(this.selectCommand),this.getModelAndPrepareNavigation().pipe(Object(S.a)(1)).subscribe(e=>{this.loadingOverlayService.hideLoadingOverlay(),e&&(this.showRefresh=this.shouldShowRefresh(),this.idMap=e.idMap,this.addModel(e))},e=>{this.loadingOverlayService.hideLoadingOverlay(),this.exceptionService.handleException(new O.a(e))}),this.markupSnapshotService.getMethodData().subscribe(e=>{this.snapshotMethodOBID=e}),this.getHierarchy(this.viewFile.URL,this.viewFile.fileObject.config).pipe(Object(S.a)(1)).subscribe(e=>{e&&(this.selectionTree=e)})}ngAfterViewInit(){this.urlCommandHasError&&this.uxtNotificationService.info(this.VIR_URL_INCORRECT),this.nativeElement=this.elementRef.nativeElement}ngAfterViewChecked(){const e=parseInt(this.rightResizePanel.resizePanel.panelWidth,10),t=[this.hideResizePanel?this.nativeElement.offsetWidth-this.vizPanelWidth:this.nativeElement.offsetWidth-e,this.nativeElement.offsetHeight];t.some((e,t)=>e!==this.currentSize[t])&&(this.currentSize=t,this.timeoutService.setTimeout(()=>{this.width=t[0],this.height=t[1]})),this.externalActionMonitor()}ngDoCheck(){this.showBubble&&void 0===this.bubblePositionTimer&&(this.bubblePositionTimer=this.timeoutService.setTimeout(()=>{this.setBubblePosition(),this.bubblePositionTimer=void 0},250))}ngOnDestroy(){this.selectedTags&&(Object.values(this.selectedTags).forEach(e=>{this.removeTagFromActionMenu(e)}),this.selectedTags={}),this.monikersToIdsSubscription&&this.monikersToIdsSubscription.unsubscribe(),void 0!==this.monikerLookup&&this.monikerLookup.isLoaded&&this.monikerLookup.closeBinFile(),this.getSearchGoidsSubscription&&this.getSearchGoidsSubscription.unsubscribe(),this.loadingOverlayService.hideLoadingOverlay()}windowResize(){this.clearBubble()}onOrientationChange(){this.clearBubble()}handleModelOpened(e){this.zone.run(()=>{this.loadingOverlayService.hideLoadingOverlay()}),this.openingModelTimer&&(this.timeoutService.clearTimeout(this.openingModelTimer),this.openingModelTimer=void 0),this.isVizPanelAvailable&&this.expandUrlCommand&&(this.readyForUrlCommand=!0),this.isSearchable&&!this.isVizPanelAvailable&&(this.addCustomMaterial(fe.j),this.addCustomMaterial(fe.l)),this.hideTerminatedObjectGraphics()}handleStreamingStopped(){var e;this.needsSelectWhenLoaded&&(this.needsSelectWhenLoaded=!1,(null===(e=this.goidsToSelect)||void 0===e?void 0:e.length)>0&&this.monikersToIds(this.goidsToSelect).subscribe(e=>{if(e){const t=[].concat(...Object.values(e));this.selectAndFit(t,!0)}}))}handleSelection(e){this.updateSelectedGraphicsCache(e),this.zone.run(()=>{if(!this.suspendSelectionHandling&&!this.isWalking()){this.clearBubble();const t=e.graphicId;if(-1===t)e.isSelected||this.unselectAllTags(!0);else{if(e.isSelected){e.isMultiSelect||this.unselectAllTags(!1);const i=this.getSelectionBatchId(e);this.idToMoniker(t,i).subscribe(e=>{if(e){const i=[e];this.bubbleText=void 0,this.bubbleItems=void 0,this.isNavigable?(this.showBubble=!0,this.navigationStrategy===z.a.GRAPHICSMAP?this.viewFile.tagInterface&&this.onTagSelection(i,this.viewFile.tagInterface,t):this.onNavigableGraphicSelection(i,t)):this.isSearchable&&(this.showBubble=!0,this.onSearchableTagSelection(i))}})}else this.unselectTag(t);this.loggingService.info("Completed graphic selection changed event.")}}})}handleClick(e){this.clearBubble(),this.setBubblePosition(e)}handleTouchstart(e){this.clearBubble(),e.touches.length>0&&this.setBubblePosition(e.touches[0])}toggleTagActionsMenu(e){this.selectedTag&&(this.actionMenuContainsOBID(this.selectedTag.OBID)?this.contentMenuService.showActionsMenu(!0):(this.addTagToActionMenu(this.selectedTag),this.contentMenuService.showActionsMenu()))}tagDetailsExpand(e){this.selectedTag&&(this.showTagDetails=!0)}clearBubble(){this.showBubble=!1,this.activeBubbleItem=void 0}tagDetailsShrink(e){this.preventDefaultForTouch(e),this.showTagDetails=!1}addCustomMaterial(e){const t=e.materialID.toString(),i=e.color,s=e.transparency;if(-1===this.definedMaterials.indexOf(t)){const e=new _i.Material(t);e.diffuse=new _i.MCDColor(i[0],i[1],i[2],i[3]),e.transparency=s,this.gvcRef.mcdView.model.defineMaterial(e),this.definedMaterials.push(t)}}hideObjects(e){e&&(0===e.length?(this.gvcRef.mcdView.model.hideObjects([]),this.showIsolate=!1):this.monikersToIdsSubject.next({monikers:e,callbackData:void 0,callback:(e,t,i)=>{(null==t?void 0:t.length)>0&&(this.gvcRef.mcdView.model.hideObjects(t),this.showIsolate=!1)}}))}showObjects(e){const t=e[0],i=e[1];t&&(0===t.length?(this.gvcRef.mcdView.model.showObjects([],i),this.terminatedGraphics?this.showingTerminatedGraphics||this.hideObjects(this.terminatedGraphics):this.showIsolate=!0):this.monikersToIdsSubject.next({monikers:t,callbackData:i,callback:(e,t,s)=>{(null==t?void 0:t.length)>0&&(i&&this.hideObjects([]),this.gvcRef.mcdView.model.showObjects(t,i))}}))}assignMaterialToObjects(e){const t=e[0].toString(),i=e[1];this.loadingOverlayService.showLoadingOverlay(this.GVC_ASSIGNING_MATERIAL),(null==i?void 0:i.length)>0&&(this.unhideTerminatedGraphics(i),this.monikersToIdsSubject.next({monikers:i,callbackData:t,callback:(e,t,i)=>{(null==t?void 0:t.length)>0&&this.gvcRef.mcdView.model.applyMaterialToSelectedObjects(t,i,this.viewFile.fileObject.obid),this.loadingOverlayService.hideLoadingOverlay()}}))}removeMaterialFromObjects(e){(null==e?void 0:e.length)>0&&this.monikersToIdsSubject.next({monikers:e,callbackData:void 0,callback:(e,t,i)=>{this.gvcRef.mcdView.model.removeMaterialFromObjects(t,this.viewFile.fileObject.obid)}})}clearModel(e){this.gvcRef.mcdView.model.removeMaterialFromModel(this.viewFile.fileObject.obid),e&&this.removeMaterialFromObjects(e)}fitSelection(e){(null==e?void 0:e.length)>0&&(this.viewFile.fileTypeCategory===T.a.GDS?this.fitSelectionGds(e):this.monikersToIds(e).subscribe(e=>{if(e&&Object.keys(e).length>0){const t=[].concat(...Object.values(e));if(t.length>0){this.clearBubble();const e=t.length>1;e||(this.bubblePosition.x=this.width/2,this.bubblePosition.y=this.height/2),this.selectAndFit(t,e)}}}))}setModelUnselected(){this.clearModel([]),this.gvcRef.mcdView.model.applyMaterialToModel(fe.p.toString())}vizPanelResized(e){this.vizPanelWidth=e,this.clearBubble()}onSearchModel(e,t){this.searchButton&&this.searchButton.isDisabled||(e?(this.searchButton.isDisabled=!0,e=e.trim(),this.getSearchGoidsSubscription=this.graphicsMapLoaded?this.searchGraphicsService.onSearchGraphicsMap(e,t).subscribe(t=>{this.onSearchGraphicOIDs(t,e)}):this.searchGraphicsService.onSearchDocument(e,t).subscribe(t=>{this.onSearchGraphicOIDs(t.graphics,e)})):(this.loggingService.info("No search was provided"),this.uxtNotificationService.info(this.GOVIEW_SEARCH_NO_SEARCH_PHRASE)))}setCameraPosition(e){try{const t=JSON.parse(e);void 0!==t&&(void 0===t.m_cameraFrom?this.gvcRef.mcdView.camera.moveToCameraState(t,!0):this.gvcRef.mcdView.camera.setGoViewCamera(t),this.clearBubble())}catch(t){this.uxtNotificationService.error(this.sdaTranslateService.get("MARKUP_SNAPSHOT_INVALID_CAMERA_POS","Invalid camera position"))}}snapshotButtonClicked(){this.gvcRef.mcdView.snapshot||this.gvcRef.mcdView.createSnapshot(this.handleSnapshot.bind(this)),this.isNavigable&&this.navigationStrategy===z.a.FDW?Object(Oe.a)(this.getCameraState(),this.getSelectedGraphics()).subscribe(([e,t])=>{(null==t?void 0:t.length)>100?this.uxtNotificationService.warning(this.sdaTranslateService.getFormatted("GOVIEW_SELECTED_GRAPHICS_EXCEEDS_LIMIT","Count of selected graphics ({0}) exceeds limit ({1})",[t.length.toString(),100..toString()])):(this.selectedGraphics=t,this.cameraState=JSON.stringify(e),this.showCreateSnapshotForm=!0)}):this.getCameraState().subscribe(e=>{this.cameraState=JSON.stringify(e),this.showCreateSnapshotForm=!0})}handleSnapshot(e){this.markupSnapshotService.save(this.snapshotOBID,e.options.data,this.cameraState).subscribe(()=>{this.uxtNotificationService.info(this.CREATE_OBJ_CREATED_SUCCESS),this.snapshotCreated.emit(this.snapshotOBID),this.afterSnapshotSaved(this.snapshotOBID),this.snapshotOBID=void 0,this.cameraState=void 0,this.selectedGraphics=void 0})}snapshotFormCreated(e){const t=new de.a("SPFFileMarkupSnapshot",!1,[this.viewFile.fileObject.obid]),i=new he.a;i.relationships.push(t),this.formService.createObjectFromForm(e,void 0,i).subscribe(e=>{this.showCreateSnapshotForm=!1,this.snapshotOBID=e.OBID,this.gvcRef.mcdView.snapshot.start()})}snapshotFormCancelled(){this.cameraState=void 0,this.showCreateSnapshotForm=!1}snapshotGalleryResized(){this.clearBubble()}onBubbleItemSelected(e){let t;this.selectedTag=e,this.activeBubbleItem&&(t=this.activeBubbleItem,this.removeTagFromSelectedTags(this.activeBubbleItem)),this.addTagToActionMenu(e),t&&this.removeTagFromActionMenu(t),this.selectBubbleItemGraphics(e).pipe(Object(S.a)(1)).subscribe(t=>{(null==t?void 0:t.length)>0&&(this.selectedTags[t.join(this.SELECTEDTAGS_KEY_DELIMITER)]=e)})}onSelectCommandClicked(){this.selectionTree?this.selectCommandIsActive?(this.selectCommandIsActive=!this.selectCommandIsActive,this.selectCommand.stop(),this.gvcRef.closeMenu(),this.hideResizePanel=!0,this.toggleVizPanelDisplay(),this.selectCommandStopped.emit()):(this.selectCommandIsActive=!this.selectCommandIsActive,this.selectCommand.start(),this.gvcRef.closeMenu(),this.hideResizePanel=!1,this.toggleVizPanelDisplay(),this.selectCommandStarted.emit()):this.uxtNotificationService.info(this.NO_HIERARCHY_AVAILABLE)}onNodeSelection(e){if(e){this.loadingOverlayService.showLoadingOverlay(this.HIERARCHY_PROCESSING);const t=this.viewFile.fileObject.config;let i=e;i=e.Selected?this.selectByHierarchyPanel.selectPanelTree.getHighestSelectedAncestor(e.Id):this.selectByHierarchyPanel.selectPanelTree.getHighestDeselectedAncestor(e.Id),this.hierarchyGraphics[i.Id]?this.handleHierarchySelection(i,this.hierarchyGraphics[i.Id]):this.gdsService.getTagsInHierarchy(i.Id,t,this.selectionTree).pipe(Object(S.a)(1)).subscribe(e=>{if((null==e?void 0:e.length)>0){const t=e.map(e=>e.Graphics3DGUID);i.Graphics||(i.Graphics=new Set(t)),this.setHierarchyGraphicsFromHierarchyNode(i,t,this.selectionTree),this.handleHierarchySelection(i,t)}else this.adjustMenuSelectionsForNodeSelection(i),this.loadingOverlayService.hideLoadingOverlay()},e=>{this.loadingOverlayService.hideLoadingOverlay()})}}handleHierarchySelection(e,t){const i={OBID:e.Id,Name:e.Name,Config:e.Config};e.Selected?this.selectGraphics(t,i).pipe(Object(S.a)(1)).subscribe(()=>{this.adjustMenuSelectionsForNodeSelection(e),this.loadingOverlayService.hideLoadingOverlay()}):this.deselectGraphics(t,i).pipe(Object(S.a)(1)).subscribe(()=>{this.adjustMenuSelectionsForNodeSelection(e),this.loadingOverlayService.hideLoadingOverlay()})}setHierarchyGraphicsFromHierarchyNode(e,t,i){this.hierarchyGraphics[e.Id]=t,this.selectByHierarchyPanel.selectPanelTree.getAllDescendentIds(e.Id).forEach(e=>{const t=this.gdsService.findTreeNodeById(i,e);if(t&&t.Children.length>0){const e=new Set;this.gatherTreeNodeChildGraphics(t,e),t.Graphics=e}this.hierarchyGraphics[e]||(this.hierarchyGraphics[e]=t.Graphics?Array.from(t.Graphics):[])})}gatherTreeNodeChildGraphics(e,t){e.Graphics&&Array.from(e.Graphics).forEach(e=>{t.add(e)}),e.Children.forEach(e=>{this.gatherTreeNodeChildGraphics(e,t)})}adjustMenuSelectionsForNodeSelection(e){const t=[],i=[];e.Selected?(this.selectByHierarchyPanel.selectPanelTree.checklistSelection.selected.forEach(e=>{!this.findTagInSelectedTags(e.Id)&&e.level>0&&t.push({OBID:e.Id,Name:e.Name,Config:e.Config})}),t.forEach(e=>{this.updateSelectedTagsForHierarchyItems(this.hierarchyGraphics[e.OBID],e)})):(i.push(this.getBaseObjectFromHierarchyNode(e)),i.push(...this.selectByHierarchyPanel.selectPanelTree.getAllDescendents(e.Id)),i.push(...this.selectByHierarchyPanel.selectPanelTree.getAllAncestors(e.Id)),i.forEach(e=>{this.updateDeselectedTagsForHierarchyItems(this.hierarchyGraphics[e.OBID],e)}))}findTagInSelectedTags(e){return Object.values(this.selectedTags).find(t=>t.OBID===e)}toggleVizPanelDisplay(){this.hideResizePanel?(this.vizPanelResized(this.savedVizPanelWidth),this.savedVizPanelWidth=0,this.vizPanel.isPanelHidden=!1):(this.savedVizPanelWidth=this.vizPanelWidth,this.vizPanelResized(0),this.vizPanel.isPanelHidden=!0)}shouldShowRefresh(){return this.viewFile.fileTypeCategory===T.a.GDS}idToMoniker(e,t){if(this.viewFile.fileTypeCategory===T.a.GDS)return this.gdsService.renderIdToMoniker(this.idMap,e,t);{let t;return-1!==e&&void 0!==this.monikerLookup&&this.monikerLookup.isLoaded&&(t=this.monikerLookup.findMoniker(e.toString())),Object(v.a)(t)}}monikersToIds(e){if(this.viewFile.fileTypeCategory===T.a.GDS)return this.monikersToRenderIds(this.idMap,e);{const t={};return e&&void 0!==this.monikerLookup&&this.monikerLookup.isLoaded&&e.forEach(e=>{const i=this.monikerLookup.findGraphic(e);if(void 0!==i){let s;Array.isArray(i)?s=i:i.length>0&&(s=[parseInt(i,10)]),t[e]=s}}),Object(v.a)(t)}}monikersToIdentities(e,t){const i=[],s=t.filter(e=>!this.monikerIdentityCache.hasOwnProperty(e)||(i.push(...this.monikerIdentityCache[e]),!1));return(null==s?void 0:s.length)>0?this.gdsService.monikersToIdentities(e,s).pipe(Object(S.a)(1),Object(re.a)(e=>(0===Object.keys(e).length&&s.forEach(t=>{e[t]=[]}),this.monikerIdentityCache=Object.assign(this.monikerIdentityCache,e),i.push(...[].concat(...Object.values(e))),i))):Object(v.a)(i)}monikersToRenderIds(e,t){return this.monikersToIdentities(e,t).pipe(Object(S.a)(1),Object(m.a)(e=>{const t={};return e&&e.forEach(e=>{const i=e.Name.slice(1,-1);t.hasOwnProperty(i)?t[i].push(e.RenderId):t[i]=[e.RenderId]}),Object(v.a)(t)}))}gdsMonikersToMcdSelections(e,t){return this.monikersToIdentities(e,t).pipe(Object(S.a)(1),Object(m.a)(e=>{let t=[];return e&&(t=e.map(e=>this.gdsService.identityToMcdObjectSelection(e))),Object(v.a)(t)}))}onMonikersToIds(e){const t=e.monikers;if(this.viewFile.fileTypeCategory===T.a.GDS)return this.monikersToRenderIds(this.idMap,t).pipe(Object(re.a)(i=>{const s=[].concat(...Object.values(i));return e.callback(t,s,e.callbackData),s}));{const i=[];return t&&void 0!==this.monikerLookup&&this.monikerLookup.isLoaded&&t.forEach(e=>{const t=this.monikerLookup.findGraphic(e);void 0!==t&&(Array.isArray(t)?i.push(...t):t.length>0&&i.push(parseInt(t,10)))}),e.callback(t,i,e.callbackData),Object(v.a)(i)}}loadGraphicsMap(e){const t=this.graphicsMapService.loadGraphicsMapUrl(e).promise();return Object(ae.a)(t)}prepareNavigation(){const e=this.getSelectedUIDs();if(this.viewFile.fileTypeCategory===T.a.GDS)return this.ppmViewerService.initializeNavigation(this.navigationStrategy,this.versionOBID,this.config).pipe(Object(m.a)(()=>(null==e?void 0:e.length)>0?this.gdsService.uidsToGraphicOidsAndTags(e,this.config).pipe(Object(m.a)(e=>(e&&(this.goidsAndTagsToSelect=e),Object(v.a)(!0)))):Object(v.a)(!0)));const t=this.viewFile.graphicsMapURL,i=this.viewFile.labelDatabaseOBID;return(null==t?void 0:t.length)>0?this.loadGraphicsMap(t).pipe(Object(re.a)(t=>(t&&(this.graphicsMapLoaded=!0,(null==e?void 0:e.length)>0&&(this.goidsToSelect=this.ppmViewerService.getGoidsToSelect(e))),!0))):i?this.labelDatabaseService.generateGraphicsMap(i).pipe(Object(m.a)(e=>this.graphicsMapService.loadGraphicsMapXml(e)?(this.graphicsMapLoaded=!0,Object(v.a)(!0)):Object(v.a)(!0))):this.ppmViewerService.initializeNavigation(this.navigationStrategy,this.versionOBID,this.config).pipe(Object(m.a)(t=>{if(t){if(this.navigationDocuments=t,(null==e?void 0:e.length)>0&&t.length>0){const t=this.ppmViewerService.queryGraphicsToSelect(e,this.MAX_REPRESENTATIONS,this.navigationDocuments);return this.loggingService.info("Querying for graphic IDs."),t.pipe(Object(m.a)(e=>{var t;return this.goidsToSelect=[],(null===(t=e.representations)||void 0===t?void 0:t.length)>0?(this.loggingService.info("Found graphic IDs."),this.selectedRepresentations=e.representations,this.goidsToSelect=e.IDs):this.uxtNotificationService.info(this.GOVIEW_SELECT_ITEM_NOT_FOUND),Object(v.a)(!0)}))}return this.goidsToSelect=[],Object(v.a)(!0)}return this.goidsToSelect=[],Object(v.a)(!0)}))}addModel(e){this.checkIfNavigable().subscribe(t=>{this.isNavigable=t,this.isVizPanelAvailable=this.checkVizPanelAvailable(),this.isSearchable=this.checkIfSearchable(),this.initMonikerLookup(this.viewFile.URL).subscribe(t=>{this.monikerLookup=t,this.isSearchable&&(this.graphicsMapLoaded?this.searchGraphicsService.initializeSearchProperties(this.maximumSearchResults,this.maximumSuggestions,this.graphicsMapLoaded):this.searchGraphicsService.initializeSearchProperties(this.maximumSearchResults,this.maximumSuggestions,this.graphicsMapLoaded,this.versionOBID,this.config,this.navigationStrategy,this.navigationDocuments),this.isVizPanelAvailable||this.createPowerBarSearch(this.GOVIEW_SEARCH_PLACEHOLDER,fe.i)),this.loggingService.info("Add model to GVC"),this.axisDataPath=this.resources+"axis/Axis.json",this.axisFontPath=this.resources+"fonts/arial_narrow.slug",this.loadingOverlayService.showLoadingOverlay(this.sdaTranslateService.get("GVC_OPENING_MODEL","Opening model...")),this.openingModelTimer=this.timeoutService.setTimeout(()=>{this.openingModelTimer=void 0,this.loadingOverlayService.hideLoadingOverlay(),this.uxtNotificationService.warning(this.sdaTranslateService.get("GVC_OPENING_MODEL_WARNING","Opening the model is taking longer than expected"))},this.openingModelTimeout),this.goidsAndTagsToSelect&&Object.keys(this.goidsAndTagsToSelect).length>0?this.monikersToMcdSelections(Object.keys(this.goidsAndTagsToSelect)).subscribe(t=>{t&&(e.selectionIds=t,Object.keys(this.goidsAndTagsToSelect).forEach(e=>{const i=t.find(t=>e===t.moniker.slice(1,-1));i&&(this.selectedGraphicsCache[i.id.toString()]=!0,this.selectTag(this.goidsAndTagsToSelect[e],i.id))})),this.models=[e]}):this.goidsToSelect&&this.goidsToSelect.length>0?this.monikersToMcdSelections(this.goidsToSelect).subscribe(t=>{t&&(e.selectionIds=t),this.models=[e]}):this.models=[e]})})}getRange(){var e;if((null===(e=this.selectedRepresentations)||void 0===e?void 0:e.length)>0)return this.loggingService.info("Calling get3DRangeForRepresentations to retrieve range information."),this.ppmViewerService.get3DRangeForRepresentations(this.selectedRepresentations,this.navigationStrategy,this.config);{const e=this.getSelectedUIDs(),t=`UID eq '${encodeURIComponent(e[0])}'`;return this.ppmViewerService.get3DRange(`Objects?$filter=(${t}) and contains(Interfaces,'I3DRange')`,this.config)}}mcdRange(e){return new _i.MCDRange(e.min[0],e.min[1],e.min[2],e.max[0],e.max[1],e.max[2])}onNavigableGraphicSelection(e,t){if(this.killTimeout(),(null==e?void 0:e.length)>10)return console.log(`The number of GraphicOIDs (${e.length}) has exceeded the limit (10) so no query will be performed`),void this.clearBubble();this.ppmViewerService.getTagsFromGraphics(this.navigationDocuments,e,this.config).pipe(Object(S.a)(1)).subscribe(i=>{this.isGraphicInSelectedCache(t)&&((null==i?void 0:i.length)>0?this.navigationService.getBubbleItems(i,this.navigationStrategy,void 0).pipe(Object(S.a)(1)).subscribe(i=>{(null==i?void 0:i.length)>0?(1!==i.length&&this.navigationStrategy===z.a.FDW||(i[0].GraphicOIDs=e),this.bubbleItems=i,this.selectTag(i[0],t),this.activeBubbleItem=this.bubbleItems[0]):(this.bubbleText=void 0,this.bubbleItems=void 0,this.clearBubble())}):this.terminateBubbleWithMessage(this.GOVIEW_HOTSPOTTED_ITEM_NOT_FOUND))},e=>{this.clearBubble(),this.exceptionService.handleException(new O.a(e))})}onTagSelection(e,t,i){this.killTimeout();let s=[];if(e.forEach(e=>{s=s.concat(this.graphicsMapService.getMapNodesByGraphicOid(e,!0))}),(null==s?void 0:s.length)>0){const e=this.ppmViewerService.getUidClauseFromMapNodes(s);if(e){if(e.length>512)return console.log("The number of UIDs returned by this search is too large, so no query will be performed"),void this.clearBubble();this.ppmViewerService.queryForTagByInterfaceAndUid(e,t,this.config).pipe(Object(S.a)(1)).subscribe(e=>{var t;(null===(t=null==e?void 0:e.value)||void 0===t?void 0:t.length)>0?1===e.value.length?(this.selectTag(e.value[0],i),this.bubbleText=this.selectedTag.Name?this.selectedTag.Name:""):this.clearBubble():this.terminateBubbleWithMessage(this.GOVIEW_HOTSPOTTED_ITEM_NOT_FOUND)},e=>{this.clearBubble(),this.exceptionService.handleException(new O.a(e))})}}else this.terminateBubbleWithMessage(this.GOVIEW_HOTSPOTTED_ITEM_NOT_FOUND_IN_MAP)}onSearchableTagSelection(e){if(1===e.length){const t=this.graphicsMapService.getMapNodesByGraphicOid(e[0].toString());if((null==t?void 0:t.length)>0){const e=this.graphicsMapService.getMapNodeName(t[0]);e?(0===this.bubblePosition.x&&0===this.bubblePosition.y&&(this.bubblePosition.x=300,this.bubblePosition.y=90),this.bubbleText=e):this.terminateBubbleWithMessage(this.GOVIEW_HOTSPOTTED_ITEM_NOT_FOUND_IN_MAP)}else this.terminateBubbleWithMessage(this.GOVIEW_HOTSPOTTED_ITEM_NOT_FOUND_IN_MAP)}else this.clearBubble()}checkIfNavigable(){return this.navigationService.allowNavigation(this.config).pipe(Object(re.a)(e=>(this.isNavigationAllowed=e,!!this.isNavigationAllowed&&(this.navigationStrategy!==z.a.GRAPHICSMAP||this.graphicsMapLoaded&&this.graphicsMapService.hasMapNodeUidAttribute()))))}checkVizPanelAvailable(){return this.isNavigable&&this.navigationStrategy!==z.a.GRAPHICSMAP}checkIfSearchable(){return!!this.isNavigationAllowed&&(this.graphicsMapLoaded&&this.graphicsMapService.hasMapNodeNameAttribute()||this.navigationStrategy!==z.a.GRAPHICSMAP)}createGVCMonikerConverter(){return new Oi.GVCMonikerConverter}monikerLookupOpenBinFile(e,t){const i=e.openBinFile(t);return Object(ae.a)(i)}initMonikerLookup(e){if(this.viewFile.fileTypeCategory===T.a.GDS)return Object(v.a)(void 0);{const t=this.createGVCMonikerConverter();return this.monikerLookupOpenBinFile(t,e).pipe(Object(m.a)(e=>Object(v.a)(t)))}}terminateBubbleWithMessage(e){this.killTimeout(),this.selectTag(void 0,void 0),this.bubbleText=e,this.bubbleItems=void 0,this.terminateBubbleTimeout=this.timeoutService.setTimeout(()=>{this.clearBubble(),this.terminateBubbleTimeout=void 0},ve.a)}unselectTag(e){let t=!1;if(!this.isGraphicInSelectedCache(e)){const i=e.toString();this.selectedTags.hasOwnProperty(i)&&(this.removeTagFromActionMenu(this.selectedTags[i])&&(t=!0),delete this.selectedTags[i]),Object.keys(this.selectedTags).forEach(e=>{let s=e.split(this.SELECTEDTAGS_KEY_DELIMITER);(null==s?void 0:s.length)>0&&s.indexOf(i)>=0&&(this.removeTagFromActionMenu(this.selectedTags[e])&&(t=!0),s.length>1&&(s=s.filter(e=>!this.selectedTags.hasOwnProperty(e))),this.batchDeselect(s.map(e=>parseInt(e,10))).pipe(Object(S.a)(1)).subscribe(t=>{delete this.selectedTags[e],t&&s.forEach(e=>{this.selectedGraphicsCache[e]=!1})}))}),t||this.idToMoniker(e,void 0).subscribe(e=>{e&&this.gdsService.getTagsFromGraphics([e],this.config).subscribe(e=>{e&&e.length>0&&this.removeTagFromActionMenu({OBID:e[0].OBID,Name:e[0].Name,Config:e[0].Config})})})}return t}unselectAllTags(e){e?this.actionMenuProvider.clearAndCloseActionsMenu():this.actionMenuProvider.clearItems(),this.selectedTags={},this.selectedTag=void 0,this.selectCommandIsActive&&this.selectByHierarchyPanel.selectPanelTree.clearAllSelections()}selectTag(e,t){if((!e||this.isGraphicInSelectedCache(t))&&(this.selectedTag=e,e)){0===Object.keys(this.selectedTags).length&&this.actionMenuProvider.clearItems();const i=t.toString();this.selectedTags.hasOwnProperty(i)||(this.selectedTags[i]=e),this.addTagToActionMenu(e)}}addTagToActionMenu(e){const t={};t.OBID=e.OBID,this.actionMenuProvider.addItem(new G.a(e.OBID,e.Name,e.Config,void 0,void 0,t))}removeTagFromActionMenu(e){let t=!1;return e&&this.actionMenuContainsOBID(e.OBID)&&(this.actionMenuProvider.removeItem(new G.a(e.OBID,e.Name,e.Config)),t=!0),t}removeTagFromSelectedTags(e){Object.keys(this.selectedTags).filter(t=>this.selectedTags[t].OBID===e.OBID).forEach(e=>{delete this.selectedTags[e]})}killTimeout(){this.terminateBubbleTimeout&&(this.timeoutService.clearTimeout(this.terminateBubbleTimeout),this.terminateBubbleTimeout=void 0)}actionMenuContainsOBID(e){return void 0!==this.actionMenuProvider.getItems().find(t=>t.obid===e)}preventDefaultForTouch(e){"touchstart"===e.type.toLowerCase()&&e.preventDefault()}clearSelectionList(){const e=this.gvcRef.mcdView.model.clearSelectionList();return Object(ae.a)(e)}batchSelect(e,t){const i=this.gvcRef.mcdView.model.batchSelect(e,t);return Object(ae.a)(i)}batchDeselect(e,t){const i=this.gvcRef.mcdView.model.batchDeselect(e,t);return Object(ae.a)(i)}selectObject(e,t,i){const s=this.gvcRef.mcdView.model.selectObject(e,t,i);return Object(ae.a)(s)}selectAndFit(e,t){try{t&&(this.suspendSelectionHandling=!0),this.clearSelectionList().subscribe(()=>{const i=e.map((e,t)=>this.selectObject(e,0!==t));Object(Ue.a)(...i).subscribe(void 0,e=>{t&&(this.suspendSelectionHandling=!1)},()=>{t&&(this.suspendSelectionHandling=!1),this.timeoutService.setTimeout(()=>{this.gvcRef.mcdView.camera.fit()})})})}catch(i){t&&(this.suspendSelectionHandling=!1)}}selectAndFitSelections(e){return this.clearSelectionList().pipe(Object(S.a)(1),Object(m.a)(()=>{const t=e.map((e,t)=>this.selectObject(e.id,0!==t,e.range));return Object(Ue.a)(...t).pipe(Object(S.a)(1),Object(m.a)(()=>(this.timeoutService.setTimeout(()=>{this.gvcRef.mcdView.camera.fit()}),Object(v.a)(!0))))}))}createPowerBarSearch(e,t){this.powerBarControls=[],this.powerBarAutoComplete=new ue.a(e=>this.searchGraphicsService.filterTagNames(e),e=>{this.onSearchModel(e)},e=>{this.onSearchModel(e,!0)},e,void 0,void 0,t),this.powerBarControls.push(this.powerBarAutoComplete),this.searchButton=new ge.a(()=>{this.onSearchModel(this.powerBarAutoComplete.searchTerm,!0)},void 0,"fa fa-search"),this.powerBarControls.push(this.searchButton),this.clearSearchResultsButton=new ge.a(()=>{this.clearSearchResults()},this.GOVIEW_CLEAR_SEARCH_RESULTS,void 0,void 0,void 0,!0),this.powerBarControls.push(this.clearSearchResultsButton)}onSearchGraphicOIDs(e,t){if((null==e?void 0:e.length)>0)this.clearBubble(),this.bubblePosition.x=this.width/2,this.bubblePosition.y=this.height/2,this.fitToGraphics(e);else{this.clearSearchResults();const e=this.GOVIEW_SEARCH_NO_TAGS_FOUND.replace("{0}",t);this.uxtNotificationService.info(e)}this.searchButton.isDisabled=!1}clearSearchResults(){this.clearModel(this.searchResults),this.searchResults=void 0,this.clearSearchResultsButton&&(this.clearSearchResultsButton.isDisabled=!0)}fitToGraphics(e){this.clearSearchResults(),this.loggingService.info("Setting non matching items to transparent"),this.gvcRef.mcdView.model.applyMaterialToModel(fe.m.toString()),this.loggingService.info(`Assigning material to ${e.length.toString()} search results`),this.assignMaterialToObjects([fe.k,e]),this.loggingService.info("Material assigned to search results"),this.searchResults=e,this.clearSearchResultsButton.isDisabled=!1;const t=e.length,i=fe.f;t>i?(this.loggingService.info(`There were more than ${i} graphics so don't try to select/fit`),this.suspendSelectionHandling=!0,this.clearSelectionList().subscribe(()=>{this.suspendSelectionHandling=!1})):(this.loggingService.info(`Creating a select set of ${t.toString()} graphics`),this.monikersToIds(e).subscribe(e=>{if(e){const t=[].concat(...Object.values(e));this.selectAndFit(t,!0)}}))}isWalking(){let e=!1;return this.gvcRef&&this.gvcRef.state&&this.gvcRef.state.navigator&&this.gvcRef.state.navigator.isWalkingViewActive&&(e=!0),e}externalActionMonitor(){this.viewMarkupCacheService.isActionInitiatedExternally&&(this.viewMarkupCacheService.isActionInitiatedExternally=!1,this.ppmViewerService.queryGraphicsToSelect(this.viewMarkupCacheService.selectedTagUIDs,this.MAX_REPRESENTATIONS,this.navigationDocuments).subscribe(e=>{var t;this.clearBubble(),this.loadingOverlayService.hideLoadingOverlay(),(null===(t=e.representations)||void 0===t?void 0:t.length)>0?this.monikersToIds(e.IDs).subscribe(e=>{if(e){const t=[].concat(...Object.values(e));this.selectAndFit(t,!0)}}):this.uxtNotificationService.info(this.GOVIEW_SELECT_ITEM_NOT_FOUND)},e=>{this.exceptionService.handleException(new O.a(e))}))}monikersToMcdSelections(e){var t;return this.viewFile.fileTypeCategory===T.a.GDS?this.gdsMonikersToMcdSelections(this.idMap,e):(null===(t=this.goidsToSelect)||void 0===t?void 0:t.length)>0?this.getRange().pipe(Object(m.a)(e=>this.monikerLookup.isLoaded?e?this.monikersToIds(this.goidsToSelect).pipe(Object(m.a)(t=>{const i=[];if(t){const s=this.mcdRange(e);Object.keys(t).forEach(e=>{const n=t[e];n&&n.forEach(t=>{const n=new _i.MCDObjectSelection(e);n.Reset(t,s),i.push(n)})})}return Object(v.a)(i)})):(this.needsSelectWhenLoaded=!0,Object(v.a)(void 0)):Object(v.a)(void 0))):this.monikersToIds(e).pipe(Object(m.a)(e=>{const t=[];return Object.keys(e).forEach(i=>{const s=new _i.MCDRange(0,0,0,0,0,0),n=e[i];n&&n.forEach(e=>{const n=new _i.MCDObjectSelection(i);n.Reset(e,s),t.push(n)})}),Object(v.a)(t)}))}getModelAndPrepareNavigation(){return this.getModelObject().pipe(Object(m.a)(e=>this.prepareNavigation().pipe(Object(m.a)(t=>Object(v.a)(t?e:void 0)))))}getModelObject(){let e;if(this.viewFile.fileTypeCategory===T.a.GDS){const t=this.viewFile.URL,i=this.viewFile.fileObject.obid;return this.gdsService.getFilterUidFromGdsUrl(t).pipe(Object(S.a)(1)).subscribe(e=>{this.activeFilterUID=e}),this.gdsService.getGdsAuthToken(t).pipe(Object(S.a)(1),Object(m.a)(s=>this.gdsService.postGdsQuery(t,s).pipe(Object(S.a)(1),Object(m.a)(()=>(e=new Oi.GVCModelObject(i,this.viewFile.fileObject.name,t,Oi.GVC_ENUM.ModelType.PARAMETRICS,Oi.GVC_ENUM.AccessProtocol.WEB_API),e.idMap=new _i.GDS3DIdMap,e.idMap.Initialize(i,t),e.idMap.SetAuth(s),e.authorizationToken=s,Object(v.a)(e))))))}return this.showRefresh=!1,this.viewFile.URL.endsWith("/")||(this.viewFile.URL+="/"),e=new Oi.GVCModelObject(this.viewFile.fileObject.obid,this.viewFile.fileObject.name,this.viewFile.URL,Oi.GVC_ENUM.ModelType.PARAMETRICS,Oi.GVC_ENUM.AccessProtocol.FILE),Object(v.a)(e)}getSelectionBatchId(e){let t;if(e&&e.extraData&&e.extraData.hasOwnProperty("batches")){const i=e.extraData.batches;i&&Array.isArray(i)&&1===i.length&&(t=i[0])}return t}getGvcLanguage(){let e=Oi.GVC_ENUM.Language.EN_US;return this.sdaTranslateService.locale&&(e=this.sdaTranslateService.locale),e}getSelectedUIDs(){var e;let t;return this.viewMarkupCacheService.shouldSelectTags&&(null===(e=this.viewMarkupCacheService.selectedTagUIDs)||void 0===e?void 0:e.length)>0&&(t=this.viewMarkupCacheService.selectedTagUIDs),t}getCameraState(){const e=this.gvcRef.mcdView.camera.getCameraState();return Object(ae.a)(e)}getSelectedGraphics(){return $.a.create(e=>{this.gvcRef.mcdView.model.getSelectedObjectsAndRange().then(t=>{const i=[];if(t&&t instanceof Array&&t.length>0){const e=t[0];(null==e?void 0:e.length)>0&&e.forEach(e=>{e.ids.forEach(e=>{i.push(e)})})}e.next(i),e.complete()})})}afterSnapshotSaved(e){var t;if((null===(t=this.selectedGraphics)||void 0===t?void 0:t.length)>0){const t=[];this.selectedGraphics.forEach(e=>{const i=this.idToMoniker(e,0);t.push(i)}),Object(Oe.a)(...t).subscribe(t=>{this.ppmViewerService.getTagsFromGraphics(this.navigationDocuments,t,this.config).subscribe(t=>{if((null==t?void 0:t.length)>0){const i=[];t.forEach(e=>{i.includes(e.OBID)||i.push(e.OBID)}),this.markupSnapshotService.relateToTags(e,i)}})})}}fitSelectionGds(e){this.loadingOverlayService.showLoadingOverlay(this.GVC_FITTING_TO_ITEMS),this.monikersToMcdSelections(e).pipe(Object(S.a)(1),Object(m.a)(e=>(null==e?void 0:e.length)>0?(this.clearBubble(),this.suspendSelectionHandling=e.length>1,this.suspendSelectionHandling||(this.bubblePosition.x=this.width/2,this.bubblePosition.y=this.height/2),this.selectAndFitSelections(e)):Object(v.a)(!1))).subscribe(e=>{this.suspendSelectionHandling=!1,this.loadingOverlayService.hideLoadingOverlay()},e=>{this.suspendSelectionHandling=!1,this.loadingOverlayService.hideLoadingOverlay()})}updateSelectedTagsForHierarchyItems(e,t){e?this.monikersToMcdSelections(e).subscribe(e=>{const i=[];e.forEach(e=>{i.push(e.id)}),t&&(this.addTagToActionMenu(t),i.length>0&&(i.sort(),this.selectedTags[i.join(this.SELECTEDTAGS_KEY_DELIMITER)]=t))}):t&&this.addTagToActionMenu(t)}selectGraphics(e,t){return this.suspendSelectionHandling=!0,this.monikersToMcdSelections(e).pipe(Object(m.a)(e=>this.batchSelect(e).pipe(Object(m.a)(i=>{let s;return this.suspendSelectionHandling=!1,i&&(s=[],e.forEach(e=>{const t=e.id;this.selectedGraphicsCache[t.toString()]=!0,s.push(t)})),t&&(this.addTagToActionMenu(t),(null==s?void 0:s.length)>0&&(s.sort(),this.selectedTags[s.join(this.SELECTEDTAGS_KEY_DELIMITER)]=t)),Object(v.a)(s)}),Object(tt.a)(()=>(this.suspendSelectionHandling=!1,Object(v.a)(void 0))))))}updateDeselectedTagsForHierarchyItems(e,t){e?this.monikersToMcdSelections(e).subscribe(e=>{const i=e.map(e=>e.id);t&&(this.removeTagFromActionMenu(t),(null==i?void 0:i.length)>0&&(i.sort(),delete this.selectedTags[i.join(this.SELECTEDTAGS_KEY_DELIMITER)]))}):t&&this.removeTagFromActionMenu(t)}deselectGraphics(e,t){return this.suspendSelectionHandling=!0,this.monikersToMcdSelections(e).pipe(Object(m.a)(e=>{const i=e.map(e=>e.id);return this.batchDeselect(i).pipe(Object(re.a)(e=>(this.suspendSelectionHandling=!1,t&&(this.removeTagFromActionMenu(t),i.sort(),delete this.selectedTags[i.join(this.SELECTEDTAGS_KEY_DELIMITER)]),e)),Object(tt.a)(()=>(this.suspendSelectionHandling=!1,Object(v.a)(!1))))}))}clearActiveBubbleSelection(){return this.activeBubbleItem?this.deselectGraphics(this.activeBubbleItem.GraphicOIDs):Object(v.a)(!1)}changeBubbleSelection(e){return this.clearActiveBubbleSelection().pipe(Object(S.a)(1),Object(m.a)(()=>this.selectGraphics(e.GraphicOIDs).pipe(Object(S.a)(1),Object(re.a)(t=>(this.activeBubbleItem=e,t)))))}selectBubbleItemGraphics(e){let t=e.Name;return t=t?t.replace(/-/g,"\u2011"):"",e.GraphicOIDs?this.changeBubbleSelection(e):e.Edge?(this.loadingOverlayService.showLoadingOverlay(this.sdaTranslateService.getFormatted("GOVIEW_SELECTING_GRAPHICS-TAG","Selecting graphics for {0}",[t])),this.ppmViewerService.getGraphicsByEdgeDef(e.OBID,e.Edge.GraphicsEdgeDef,e.Config,this.MAX_REPRESENTATIONS,this.navigationDocuments).pipe(Object(S.a)(1),Object(m.a)(t=>(e.GraphicOIDs=t,this.changeBubbleSelection(e).pipe(Object(re.a)(e=>(this.loadingOverlayService.hideLoadingOverlay(),e))))),Object(tt.a)(()=>(this.loadingOverlayService.hideLoadingOverlay(),Object(v.a)(void 0))))):this.navigationStrategy===z.a.FDW?this.ppmViewerService.queryGraphicsToSelect([e.UID],this.MAX_REPRESENTATIONS,this.navigationDocuments).pipe(Object(S.a)(1),Object(m.a)(e=>this.selectGraphics(e.IDs))):Object(v.a)(void 0)}setBubblePosition(e){if(this.nativeElement){const t=this.nativeElement,i=t.offsetLeft,s=t.offsetTop,n=t.offsetWidth,a=t.offsetHeight;e&&(this.bubbleOffsetX=(e.clientX-i)/n,this.bubbleOffsetY=(e.clientY-s)/a),this.bubblePosition.x=i+this.bubbleOffsetX*n,this.bubblePosition.y=s+this.bubbleOffsetY*a}}isGraphicInSelectedCache(e){const t=e.toString();return this.selectedGraphicsCache.hasOwnProperty(t)&&this.selectedGraphicsCache[t]}updateSelectedGraphicsCache(e){-1===e.graphicId?e.isSelected||(this.selectedGraphicsCache={}):(e.isMultiSelect||(this.selectedGraphicsCache={}),this.selectedGraphicsCache[e.graphicId.toString()]=e.isSelected)}hideTerminatedObjectGraphics(){const e=this.configService.getConfigLevel([this.config]);(null==e?void 0:e.length)>0&&e[0].value===Qe.a.PROJECT&&this.gdsService.getTerminatedTags(this.config).pipe(Object(m.a)(e=>{this.terminatedTags=e;const t=[];return null==e||e.forEach(e=>{e.hasOwnProperty("Graphics3DGUID")&&t.push(e.Graphics3DGUID)}),Object(v.a)(t)})).subscribe(e=>{(null==e?void 0:e.length)>0&&(this.terminatedGraphics=e.sort(),this.hideObjects(e))})}unhideTerminatedGraphics(e){var t;if((null===(t=this.terminatedGraphics)||void 0===t?void 0:t.length)>0){const t=e.filter(e=>ke(this.terminatedGraphics,e)>=0);t.length>0&&(this.showingTerminatedGraphics=!0,this.showObjects([t,!1]))}}getHierarchyInfoForGdsUrl(e,t){const i=this.gdsService.getGdsQuery(e);return i?this.gdsService.getWorkspaceDefinitionFilter(i,t).pipe(Object(m.a)(e=>e?this.gdsService.getFilterByUidOrName(e,t).pipe(Object(m.a)(e=>{if(e){const i=this.gdsService.getPlantForConfig(t);return e.Config?this.filterService.getModelNames(i,e.OBID):this.filterService.getModelNames(i)}return Object(v.a)(void 0)})):Object(v.a)(void 0))):this.filterService.getModelNames(t)}getHierarchy(e,t){return this.getHierarchyInfoForGdsUrl(e,t).pipe(Object(m.a)(e=>{var i,s;return(null===(i=null==e?void 0:e.SystemHierarchyRootNodes)||void 0===i?void 0:i.length)>0?(null===(s=e.SelectedSystemHiearchyRootNodes)||void 0===s?void 0:s.length)>0?this.gdsService.getHierarchyDescendants(e.SelectedSystemHiearchyRootNodes,t).pipe(Object(m.a)(i=>{const s=this.configService.getConfigByUid(t),n={Name:s.DisplayName,Id:t,Class:s.IconName,Config:t,Children:void 0};return this.gdsService.getHierarchyAncestorNodes(e.SelectedSystemHiearchyRootNodes,t).pipe(Object(m.a)(e=>{var t;return n.Children=Object.values(e).filter(e=>!e.Parent),null==i||i.forEach(t=>{e.hasOwnProperty(t.Id)&&(e[t.Id].Children=t.Children)}),(null===(t=null==n?void 0:n.Children)||void 0===t?void 0:t.length)>0?Object(v.a)(n):Object(v.a)(void 0)}))})):this.gdsService.getHierarchyDescendants(e.SystemHierarchyRootNodes,t).pipe(Object(m.a)(e=>{const i=this.configService.getConfigByUid(t),s={Name:i.DisplayName,Id:t,Class:i.IconName,Config:t,Children:e};return Object(v.a)(s)})):Object(v.a)(void 0)}))}displayTree(e,t){t+=1,e.Children.forEach(e=>{this.displayTree(e,t)})}getBaseObjectFromHierarchyNode(e){return{OBID:e.Id,Name:e.Name,Config:e.Config}}}return e.\u0275fac=function(t){return new(t||e)(J.Sb(M.a),J.Sb(Te.a),J.Sb(ie.a),J.Sb(x.a),J.Sb(_.a),J.Sb(le.a),J.Sb(be.a),J.Sb(N.a),J.Sb(ce.a),J.Sb(Q),J.Sb(k.a),J.Sb(Di.a),J.Sb(X.a),J.Sb(Pe),J.Sb(Xe.a),J.Sb(J.l),J.Sb(ye.a),J.Sb(se.a),J.Sb(pe.a),J.Sb(Ee),J.Sb(J.B),J.Sb(me.a),J.Sb(Pi.a))},e.\u0275cmp=J.Mb({type:e,selectors:[["sda-gvc"]],viewQuery:function(e,t){var i;1&e&&(J.bd(Mi,!0),J.bd(ci,!0),J.bd(Xi,!0)),2&e&&(J.Gc(i=J.ic())&&(t.rightResizePanel=i.first),J.Gc(i=J.ic())&&(t.vizPanel=i.first),J.Gc(i=J.ic())&&(t.content=i.first))},inputs:{viewFile:"viewFile",maximumSuggestions:"maximumSuggestions",maximumSearchResults:"maximumSearchResults",expandUrlCommand:"expandUrlCommand",urlCommandHasError:"urlCommandHasError",methodOBID:"methodOBID"},outputs:{snapshotCreated:"snapshotCreated",selectCommandStarted:"selectCommandStarted",selectCommandStopped:"selectCommandStopped"},features:[J.Db([Te.a,ie.a,Q,Pe,Ee])],decls:13,vars:13,consts:[[3,"hideResizePanel","resPanelDefaultWidth","resPanelMinWidth","resPanelMaxWidth"],["rightResizePanel",""],[1,"sda-layout-region-left"],[3,"leftControls",4,"ngIf"],[1,"view-viz-panel"],["class","gvc-content",3,"width","height","models","defaultSettings","home","fit","clip","measure","fly","refresh","snapshot","isolate","undo","redo","navigator","resources","axisDataPath","axisFontPath","language","hideModelsMenu","zoomArea","customCommands","componentRef","selectionChanged","modelOpened","onStreamingStopped","click","touchstart","resize","orientationchange",4,"ngIf"],[3,"bubbleText","bubbleItems","bubblePositionX","bubblePositionY","isMenuActive","showCloseButton","selectedObject","toggleActionsMenu","detailsExpand","bubbleItemSelected","closeBubble",4,"ngIf"],[3,"docVersionOBID","config","navigationStrategy","viewerHeight","triggerRefreshDisplayEvent","expandUrlCommand","readyForUrlCommand","methodOBID","excludedFilterUID","eventCustomMaterialObject","eventObjectsToHide","eventObjectsToShow","eventAssignToObjects","eventRemoveFromObjects","eventClearModel","eventFitSelection","eventSetModelUnselected","eventVizPanelResized",4,"ngIf"],[1,"sda-layout-region-right"],["class","view-viz-panel",3,"panelHeight","displayPanel","selectionTree","closeSelectPanel","nodeSelection",4,"ngIf"],["id","tag-properties-container","class","tag-properties",4,"ngIf"],["modal","true","appendTo","body",3,"header","visible","responsive","resizable","visibleChange",4,"ngIf"],[3,"leftControls"],[1,"gvc-content",3,"width","height","models","defaultSettings","home","fit","clip","measure","fly","refresh","snapshot","isolate","undo","redo","navigator","resources","axisDataPath","axisFontPath","language","hideModelsMenu","zoomArea","customCommands","componentRef","selectionChanged","modelOpened","onStreamingStopped","click","touchstart","resize","orientationchange"],[3,"bubbleText","bubbleItems","bubblePositionX","bubblePositionY","isMenuActive","showCloseButton","selectedObject","toggleActionsMenu","detailsExpand","bubbleItemSelected","closeBubble"],[3,"docVersionOBID","config","navigationStrategy","viewerHeight","triggerRefreshDisplayEvent","expandUrlCommand","readyForUrlCommand","methodOBID","excludedFilterUID","eventCustomMaterialObject","eventObjectsToHide","eventObjectsToShow","eventAssignToObjects","eventRemoveFromObjects","eventClearModel","eventFitSelection","eventSetModelUnselected","eventVizPanelResized"],["vizPanel",""],[1,"view-viz-panel",3,"panelHeight","displayPanel","selectionTree","closeSelectPanel","nodeSelection"],["selectByHierarchyPanel",""],["id","tag-properties-container",1,"tag-properties"],[1,"properties-nav"],[1,"properties-nav__title",3,"title"],["svgIcon","shrink",1,"properties-nav__icon",3,"click","touchstart"],[1,"properties-list",3,"id","config"],["modal","true","appendTo","body",3,"header","visible","responsive","resizable","visibleChange"],[3,"classDefUID","methodOBID","isCancelVisible","formCreated","onCancel"]],template:function(e,t){1&e&&(J.Yb(0,"sda-right-split-template",0,1),J.Yb(2,"div",2),J.Sc(3,Ki,1,1,"sda-power-bar-view",3),J.Yb(4,"div",4),J.Sc(5,$i,1,22,"lib-gvc-angular-wrapper",5),J.mc(6,"async"),J.Sc(7,Zi,1,7,"sda-hotspot-bubble",6),J.Sc(8,qi,2,9,"sda-viz-panel",7),J.Xb(),J.Xb(),J.Yb(9,"div",8),J.Sc(10,Ji,2,3,"sda-gvc-select-panel",9),J.Xb(),J.Xb(),J.Sc(11,Qi,6,4,"div",10),J.Sc(12,es,2,7,"p-dialog",11)),2&e&&(J.sc("hideResizePanel",t.hideResizePanel)("resPanelDefaultWidth",t.resPanelDefaultWidth)("resPanelMinWidth",t.resPanelMinWidth)("resPanelMaxWidth",t.resPanelMaxWidth),J.Eb(3),J.sc("ngIf",t.isSearchable&&!t.isVizPanelAvailable),J.Eb(2),J.sc("ngIf",J.nc(6,11,t.gvcLoaded$)),J.Eb(2),J.sc("ngIf",t.showBubble),J.Eb(1),J.sc("ngIf",t.isVizPanelAvailable),J.Eb(2),J.sc("ngIf",t.selectCommandIsActive),J.Eb(1),J.sc("ngIf",t.showTagDetails),J.Eb(1),J.sc("ngIf",t.showCreateSnapshotForm))},directives:[Mi,s.t,De.a,Yi.a,xe.a,ci,Wi,l.a,hi.a,di.a,pi.a],pipes:[s.b],styles:["sda-object-details[_ngcontent-%COMP%]{overflow-x:hidden;overflow-y:auto}.properties-nav__title[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}[_nghost-%COMP%]{display:flex;flex:1;flex-direction:column}.view-viz-panel[_ngcontent-%COMP%]{display:flex;height:100%}.gvc-content[_ngcontent-%COMP%]{position:relative;flex:1;min-height:0}.tag-properties[_ngcontent-%COMP%]{position:fixed;top:100px;left:24.5%;right:24.5%;bottom:6%;display:flex;flex-direction:column;overflow:hidden;background-color:#fff;border:3px solid #069;border-radius:15px;z-index:200!important}.tag-properties[_ngcontent-%COMP%]     .form__content{width:100%}.properties-nav[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:space-between;margin-bottom:4px;padding:8px 16px}.properties-nav__title[_ngcontent-%COMP%]{width:95%;font-size:20px;font-weight:500}.properties-nav__icon[_ngcontent-%COMP%]{align-self:flex-start;cursor:pointer;fill:#1f8cdf}sda-object-details[_ngcontent-%COMP%]{display:flex;flex:1;flex-direction:column;border:1px solid #ccc}"]}),e})();class is{constructor(e,t,i,s,n,a){this.obid=e,this.name=t,this.creationUser=i,this.cameraPosition=s,this.owner=n,this.ownerId=a,this.visible=!0,this.layerCount=0}}var ss=i("PEjJ"),ns=i("hqbt"),as=i("jhN1"),os=i("DJR3"),rs=i("JrsU");function ls(e,t){if(1&e&&(J.Yb(0,"div"),J.Yb(1,"p",6),J.Uc(2),J.Xb(),J.Yb(3,"p",7),J.Uc(4),J.Xb(),J.Xb()),2&e){const e=t.$implicit;J.Eb(2),J.Vc(e.key),J.Eb(2),J.Vc(e.value)}}let cs=(()=>{class e{constructor(e,t,i){this.odataService=e,this.dateFormatService=t,this.sdaTranslateService=i,this.markupLayersLinkClicked=new J.o,this.columnItemKeyValuePairs=[],this.markupLayersText=this.sdaTranslateService.get("MARKUP_SNAPSHOT_GALLERY_CARD_LAYERS","Markup Layers: "),this.excludedColumnItemKeys=["CI_Name","CI_OwnerLogin"]}ngOnInit(){const e=new K.d({Prefer:'odata.include-annotations="*"'});this.odataService.get(`Objects('${this.snapshotObid}')`,this.config,!1,this.columnSet,e).subscribe(e=>{e&&e.value&&this.readNameValuePairs(e.value)})}onMarkupLayersLinkClicked(e){e.button===j.Left&&(this.markupLayersLinkClicked.emit(),e.stopPropagation())}readNameValuePairs(e){Object.keys(e).filter(e=>e.endsWith("Intergraph.SPF.Server.API.Model.DisplayName")).forEach(t=>{const i=t.indexOf("@"),s=t.substr(0,i);if(s&&e[s]&&!this.excludedColumnItemKeys.includes(s)){const i=e[t];let n=e[s];!1===isNaN(Date.parse(n))&&(n=this.dateFormatService.convertToSPFDateTimeFormat(n)),this.columnItemKeyValuePairs.push(new rs.a(i,n))}})}}return e.\u0275fac=function(t){return new(t||e)(J.Sb(A.a),J.Sb(os.a),J.Sb(N.a))},e.\u0275cmp=J.Mb({type:e,selectors:[["sda-snapshot-gallery-card-properties"]],inputs:{snapshotObid:"snapshotObid",config:"config",columnSet:"columnSet",layerCount:"layerCount"},outputs:{markupLayersLinkClicked:"markupLayersLinkClicked"},features:[J.Db([])],decls:7,vars:3,consts:[[1,"snapshot-card-properties","accordion--white"],["expandedHeight","48px"],["mat-button","",1,"snapshot-card-properties__btn",3,"click"],["svgIcon","edit",1,"snapshot-card-properties__icon"],[1,"snapshot-card-properties__divider"],[4,"ngFor","ngForOf"],[1,"snapshot-card-properties__name"],[1,"snapshot-card-properties__value"]],template:function(e,t){1&e&&(J.Yb(0,"mat-expansion-panel",0),J.Yb(1,"mat-expansion-panel-header",1),J.Yb(2,"button",2),J.hc("click",(function(e){return t.onMarkupLayersLinkClicked(e)})),J.Tb(3,"mat-icon",3),J.Uc(4),J.Xb(),J.Xb(),J.Tb(5,"div",4),J.Sc(6,ls,5,2,"div",5),J.Xb()),2&e&&(J.Eb(4),J.Xc(" ",t.markupLayersText,"",t.layerCount," "),J.Eb(2),J.sc("ngForOf",t.columnItemKeyValuePairs))},directives:[r.c,r.g,Gi.a,l.a,s.s],styles:[".snapshot-card-properties__value[_ngcontent-%COMP%]{overflow-wrap:break-word;word-wrap:break-word;word-break:break-word}[_nghost-%COMP%]     .mat-expansion-indicator:after{color:#697a8b!important;width:3px!important;height:3px!important;margin-bottom:3px;-webkit-transform:rotate(45deg)!important;transform:rotate(45deg)!important}.snapshot-card-properties__btn[_ngcontent-%COMP%]{font-weight:400;font-size:14px;color:#02adff;margin-left:6px;padding:0 8px;border:none;border-radius:5px;background:transparent;text-transform:none}.snapshot-card-properties__btn[_ngcontent-%COMP%]:hover{background-color:#afe5ff}.snapshot-card-properties__icon[_ngcontent-%COMP%]{margin-right:2px;margin-left:-2px}.snapshot-card-properties__divider[_ngcontent-%COMP%]{border-bottom:1px solid #cad0d7;margin:0 -16px}.snapshot-card-properties__name[_ngcontent-%COMP%]{color:#697a8b;margin:4px 8px 0}.snapshot-card-properties__value[_ngcontent-%COMP%]{letter-spacing:.11px;color:#070809;margin:0 8px}.snapshot-card-properties__value[_ngcontent-%COMP%]:last-of-type{margin-bottom:8px}.snapshot-card-properties[_ngcontent-%COMP%]   .mat-expansion-panel-header[_ngcontent-%COMP%]{padding-left:0}"]}),e})();function hs(e,t){if(1&e){const e=J.Zb();J.Yb(0,"div",4),J.hc("click",(function(t){return J.Kc(e),J.lc().onThumbnailClicked(t)})),J.Tb(1,"div",5),J.Tb(2,"mat-icon",6),J.Xb()}if(2&e){const e=J.lc();J.Rc("background-image",e.backgroundImage,J.Lb),J.Eb(1),J.Ib("snapshot-card__overlay--hidden",!e.selected),J.Eb(1),J.Ib("snapshot-card__overlay-icon--hidden",!e.selected)}}let ds=(()=>{class e{constructor(e,t,i,s,n){this.retrieveFileUrlsService=e,this.odataService=t,this.sdaTranslateService=i,this.exceptionService=s,this.domSanitizer=n,this.thumbnailClicked=new J.o,this.markupLayersLinkClicked=new J.o,this.cardButtonClicked=new J.o,this.backgroundImage=void 0}ngOnInit(){this.getObidForThumbnail().subscribe(e=>{this.retrieveFileUrlsService.retrieveFileURLs(e,this.config,[R.a.PRIMARY],!0).subscribe(e=>{e&&e[0]&&(this.backgroundImage=this.domSanitizer.bypassSecurityTrustStyle(`url(${e[0].URL})`))},e=>{const t=new O.a(e,this.sdaTranslateService.get("EXCEPTION_AN_ERROR_OCCURRED","An error occurred"));this.exceptionService.handleException(t)})})}onThumbnailClicked(e){e.button===j.Left&&this.thumbnailClicked.emit(this.snapshotObid)}onMarkupLayersLinkClicked(){this.markupLayersLinkClicked.emit(this.snapshotObid)}onCardButtonClicked(e){e.button===j.Left&&this.cardButtonClicked.emit(this.snapshotObid)}getObidForThumbnail(){return $.a.create(e=>{this.odataService.get(`Objects('${this.snapshotObid}')/SPFFileThumbnail_12?$select=OBID`,this.config,!1).subscribe(t=>{e.next(t&&t.value&&t.value.OBID?t.value.OBID:this.snapshotObid),e.complete()})})}}return e.\u0275fac=function(t){return new(t||e)(J.Sb(y.a),J.Sb(A.a),J.Sb(N.a),J.Sb(_.a),J.Sb(as.b))},e.\u0275cmp=J.Mb({type:e,selectors:[["sda-snapshot-gallery-card"]],inputs:{snapshotName:"snapshotName",snapshotObid:"snapshotObid",config:"config",selected:"selected",columnSet:"columnSet",layerCount:"layerCount"},outputs:{thumbnailClicked:"thumbnailClicked",markupLayersLinkClicked:"markupLayersLinkClicked",cardButtonClicked:"cardButtonClicked"},features:[J.Db([])],decls:8,vars:7,consts:[[1,"snapshot-card"],[1,"snapshot-card__btn",3,"matSvgIcon","click"],["class","snapshot-card__thumbnail-container",3,"background-image","click",4,"ngIf"],[3,"snapshotObid","config","columnSet","layerCount","markupLayersLinkClicked"],[1,"snapshot-card__thumbnail-container",3,"click"],[1,"snapshot-card__overlay"],["svgIcon","active-work-item",1,"snapshot-card__overlay-icon"]],template:function(e,t){1&e&&(J.Yb(0,"mat-card",0),J.Yb(1,"mat-card-header"),J.Yb(2,"mat-card-title"),J.Uc(3),J.Xb(),J.Yb(4,"sda-button-plain",1),J.hc("click",(function(e){return t.onCardButtonClicked(e)})),J.Xb(),J.Xb(),J.Sc(5,hs,3,6,"div",2),J.Yb(6,"mat-card-content"),J.Yb(7,"sda-snapshot-gallery-card-properties",3),J.hc("markupLayersLinkClicked",(function(){return t.onMarkupLayersLinkClicked()})),J.Xb(),J.Xb(),J.Xb()),2&e&&(J.Eb(3),J.Vc(t.snapshotName),J.Eb(1),J.sc("matSvgIcon","list"),J.Eb(1),J.sc("ngIf",t.backgroundImage),J.Eb(2),J.sc("snapshotObid",t.snapshotObid)("config",t.config)("columnSet",t.columnSet)("layerCount",t.layerCount))},directives:[a.a,a.c,a.e,Ot.a,s.t,a.b,cs,l.a],styles:[".mat-card[_ngcontent-%COMP%]{width:312px;margin:8px;padding:0}.mat-card[_ngcontent-%COMP%]   .mat-card-title[_ngcontent-%COMP%]{width:243px;font-size:14px;margin:8px 0 8px -9px!important}.snapshot-card__btn[_ngcontent-%COMP%]     .button--plain{color:#697a8b}.snapshot-card__thumbnail-container[_ngcontent-%COMP%]{width:100%;height:176px;background-color:#cad0d7;background-repeat:no-repeat;background-position:50%}.snapshot-card__overlay[_ngcontent-%COMP%]{position:absolute;width:inherit;height:inherit;opacity:.45;background-color:#3cc0ff}.snapshot-card__overlay--hidden[_ngcontent-%COMP%]{display:none}.snapshot-card__overlay-icon[_ngcontent-%COMP%]{position:absolute;top:125px;left:156px;width:40px;height:40px;margin-top:-20px;margin-left:-20px;color:#fff}.snapshot-card__overlay-icon--hidden[_ngcontent-%COMP%]{display:none}"]}),e})();function ps(e,t){if(1&e){const e=J.Zb();J.Yb(0,"sda-snapshot-gallery-card",1),J.hc("thumbnailClicked",(function(t){return J.Kc(e),J.lc().onThumbnailClicked(t)}))("markupLayersLinkClicked",(function(t){return J.Kc(e),J.lc().onMarkupLayersLinkClicked(t)}))("cardButtonClicked",(function(t){return J.Kc(e),J.lc().onCardButtonClicked(t)})),J.Xb()}if(2&e){const e=t.$implicit,i=J.lc();J.Ib("snapshot-gallery-card--hidden",!e.visible),J.sc("snapshotName",e.name)("snapshotObid",e.obid)("config",i.config)("columnSet",i.columnSet)("selected",i.selectedObid===e.obid)("layerCount",e.layerCount)}}let us=(()=>{class e{constructor(e,t,i,s,n,a){this.odataService=e,this.securityService=t,this.actionMenuProvider=i,this.contentMenuService=s,this.dataRefreshService=n,this.markupRenditionService=a,this.cardCountChanged=new J.o,this.thumbnailClicked=new J.o,this.markupLayersLinkClicked=new J.o,this.cardDeleted=new J.o,this.allSnapshots=new Array,this.selectFields="?$select=Name,OBID,CreationUser,CameraPosition,CI_Owner,CI_OwnerLogin",this.userId=this.securityService.getUserId(),this.itemRemovedSubscription=this.dataRefreshService.itemsRemoved$.subscribe(e=>{e.forEach(e=>{const t=this.allSnapshots.findIndex(t=>t.obid===e);t>=0&&(this.allSnapshots.splice(t,1),this.cardCountChanged.emit(this.allSnapshots.length),this.cardDeleted.emit(e),e===this.selectedObid&&this.clearSelected())})})}ngOnInit(){this.loadSnapshots()}ngOnChanges(e){e.filter&&!e.filter.firstChange?this.filterSnapshots():e.snapshotCompositionObid&&!e.snapshotCompositionObid.firstChange&&this.loadSnapshots()}loadSnapshots(){this.refreshSnapshots().subscribe(e=>{this.filterSnapshots(),this.cardCountChanged.emit(this.allSnapshots.length)})}ngOnDestroy(){this.clearSelected(),this.itemRemovedSubscription.unsubscribe()}onThumbnailClicked(e){const t=this.findSnapshot(e);t&&(this.selectCard(t),this.thumbnailClicked.emit(t.cameraPosition))}onMarkupLayersLinkClicked(e){const t=this.findSnapshot(e);t&&this.markupLayersLinkClicked.emit(t)}onCardButtonClicked(e){let t=!0;if(this.contentMenuService.isActionsMenuOpen()&&1===this.actionMenuProvider.length()&&this.actionMenuProvider.getItem(0).obid===e&&(this.actionMenuProvider.closeActionMenu(),t=!1),t){const t=this.findSnapshot(e);t&&(this.setActionsMenu(t),this.contentMenuService.showActionsMenu())}}clearSelected(){this.actionMenuProvider.clearAndCloseActionsMenu(),this.selectedObid=void 0,this.actionMenuProvider.clearItems()}onGalleryCollapsed(){this.actionMenuProvider.closeActionMenu()}addCard(e){this.odataService.get(`Objects('${e}')${this.selectFields}`,this.config,!1,this.columnSet).subscribe(e=>{e&&e.value&&(this.addItem(e.value),this.filterSnapshots(),this.cardCountChanged.emit(this.allSnapshots.length))})}refreshLayerCount(e){const t=this.findSnapshot(e);t&&this.markupRenditionService.getMarkupLayers(e,this.config).subscribe(e=>{e&&(t.layerCount=e.count)})}selectCard(e){e&&(this.selectedObid=e.obid,this.setActionsMenu(e))}addItem(e){const t=new is(e.OBID,e.Name,e.CreationUser,e.CameraPosition,e.CI_Owner,e.CI_OwnerLogin);this.allSnapshots.push(t),this.refreshLayerCount(e.OBID)}filterSnapshots(){this.allSnapshots.forEach(e=>{e.visible=this.filterIncludes(e)})}filterIncludes(e){switch(this.filter){case"createdBy":return this.userIdEquals(e.creationUser);case"ownedBy":return this.userIdEquals(e.ownerId);default:return!0}}userIdEquals(e){return 0===this.userId.localeCompare(e,void 0,{sensitivity:"accent"})}refreshSnapshots(){return $.a.create(e=>{this.allSnapshots.length=0,void 0===this.columnSet&&(this.columnSet="CS_SPFMarkupSnapshot"),this.odataService.get(`Objects('${this.snapshotCompositionObid}')/SPFFileMarkupSnapshot_12${this.selectFields}&$orderby=CreationDate+asc`,this.config,!1,this.columnSet).subscribe(t=>{let i=0;if(t&&t.value&&t.value){const e=t.value;e instanceof Array&&(i=e.length,e.forEach(e=>{this.addItem(e)}))}e.next(i),e.complete()})})}setActionsMenu(e){this.actionMenuProvider.clearItems();const t={};t.OBID=e.obid,this.actionMenuProvider.addItem(new G.a(e.obid,e.name,this.config,void 0,void 0,t))}findSnapshot(e){return this.allSnapshots.find(t=>t.obid===e)}}return e.\u0275fac=function(t){return new(t||e)(J.Sb(A.a),J.Sb(ns.a),J.Sb(le.a),J.Sb(ce.a),J.Sb(ss.a),J.Sb(ee))},e.\u0275cmp=J.Mb({type:e,selectors:[["sda-snapshot-gallery-cards"]],inputs:{config:"config",snapshotCompositionObid:"snapshotCompositionObid",filter:"filter",columnSet:"columnSet"},outputs:{cardCountChanged:"cardCountChanged",thumbnailClicked:"thumbnailClicked",markupLayersLinkClicked:"markupLayersLinkClicked",cardDeleted:"cardDeleted"},features:[J.Db([]),J.Cb],decls:1,vars:1,consts:[["class","snapshot-gallery-card",3,"snapshot-gallery-card--hidden","snapshotName","snapshotObid","config","columnSet","selected","layerCount","thumbnailClicked","markupLayersLinkClicked","cardButtonClicked",4,"ngFor","ngForOf"],[1,"snapshot-gallery-card",3,"snapshotName","snapshotObid","config","columnSet","selected","layerCount","thumbnailClicked","markupLayersLinkClicked","cardButtonClicked"]],template:function(e,t){1&e&&J.Sc(0,ps,1,8,"sda-snapshot-gallery-card",0),2&e&&J.sc("ngForOf",t.allSnapshots)},directives:[s.s,ds],styles:[".snapshot-gallery-card--hidden[_ngcontent-%COMP%]{display:none}.snapshot-gallery-card[_ngcontent-%COMP%]:last-of-type{margin-bottom:8px}"]}),e})();var gs=i("eruR"),bs=i("zCQ7");function vs(e,t){if(1&e&&(J.Yb(0,"mat-option",5),J.Uc(1),J.Xb()),2&e){const e=t.$implicit;J.sc("value",e.key),J.Eb(1),J.Wc(" ",e.value," ")}}let Ss=(()=>{class e{constructor(e,t,i,s){this.dataService=e,this.featureSetDataService=t,this.sdaTranslateService=i,this.uxtNotificationService=s,this.snapshotButtonClicked=new J.o,this.filterSelectionChanged=new J.o,this.hasCreateAccess=!1,this.filterText=this.sdaTranslateService.get("MARKUP_SNAPSHOT_GALLERY_TOOLBAR_SHOW","Show"),this.filters=new Map([["all",this.sdaTranslateService.get("ALL","All")],["createdBy",this.sdaTranslateService.get("MARKUP_SNAPSHOT_FILTER_CREATED_BY","Created by Me")],["ownedBy",this.sdaTranslateService.get("MARKUP_SNAPSHOT_FILTER_OWNED_BY","Owned by Me")]]),this.selectedFilter="all"}ngOnInit(){this.dataService.get("Objects?$filter=UID eq 'MTH_CreateMarkupSnapshot' and contains(Interfaces, 'ISPFMethod')",this.config,!0).subscribe(e=>{if(e&&e.length>0)if(e[0].SPFSuppressInWebClient){const e=this.sdaTranslateService.get("REQUESTED_METHOD_UNAVAILABLE","Requested method unavailable");this.uxtNotificationService.info(e)}else this.featureSetDataService.validateUserHasAccessToMethod("CreateObjAndRel",e[0].OBID,[],this.config).subscribe(e=>{this.hasCreateAccess=e})})}onSnapshotButtonClicked(e){e.button===j.Left&&this.snapshotButtonClicked.emit()}onSelectionChanged(e){this.filterSelectionChanged.emit(e.value)}}return e.\u0275fac=function(t){return new(t||e)(J.Sb(q.a),J.Sb(gs.a),J.Sb(N.a),J.Sb(k.a))},e.\u0275cmp=J.Mb({type:e,selectors:[["sda-snapshot-gallery-toolbar"]],inputs:{config:"config",snapshotCompositionObid:"snapshotCompositionObid"},outputs:{snapshotButtonClicked:"snapshotButtonClicked",filterSelectionChanged:"filterSelectionChanged"},features:[J.Db([])],decls:8,vars:7,consts:[[1,"snapshot-gallery-toolbar"],[1,"snapshot-gallery-toolbar__text"],[3,"value","valueChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[1,"snapshot-gallery-toolbar__btn",3,"isDisabled","matSvgIcon","click"],[3,"value"]],template:function(e,t){1&e&&(J.Yb(0,"div",0),J.Yb(1,"div",1),J.Uc(2),J.Xb(),J.Yb(3,"mat-form-field"),J.Yb(4,"mat-select",2),J.hc("valueChange",(function(e){return t.selectedFilter=e}))("selectionChange",(function(e){return t.onSelectionChanged(e)})),J.Sc(5,vs,2,2,"mat-option",3),J.mc(6,"keyvalue"),J.Xb(),J.Xb(),J.Yb(7,"sda-button",4),J.hc("click",(function(e){return t.onSnapshotButtonClicked(e)})),J.Xb(),J.Xb()),2&e&&(J.Eb(2),J.Wc(" ",t.filterText," "),J.Eb(2),J.sc("value",t.selectedFilter),J.Eb(1),J.sc("ngForOf",J.nc(6,5,t.filters)),J.Eb(2),J.sc("isDisabled",!t.hasCreateAccess)("matSvgIcon","camera"))},directives:[Vt.b,h.a,s.s,bs.a,Ut.i],pipes:[s.l],styles:[".snapshot-gallery-toolbar[_ngcontent-%COMP%]{display:flex;flex-direction:row;background:#fff;padding-top:1px;padding-left:16px;border-top:1px solid #cad0d7;border-right:1px solid #cad0d7}.snapshot-gallery-toolbar__text[_ngcontent-%COMP%]{margin:19px 0 0;font-size:14px}.snapshot-gallery-toolbar__btn[_ngcontent-%COMP%]{width:40px;height:40px;margin-top:8px}.snapshot-gallery-toolbar__btn[_ngcontent-%COMP%]     .button--default{color:#697a8b;background-color:initial}.snapshot-gallery-toolbar__btn[_ngcontent-%COMP%]     .button{width:40px;height:40px;padding:0}.snapshot-gallery-toolbar__btn[_ngcontent-%COMP%]     .mat-icon{width:24px;height:24px}.snapshot-gallery-toolbar[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:208px;height:40px;margin:8px;border-radius:2px;border:1px solid #cad0d7}.snapshot-gallery-toolbar[_ngcontent-%COMP%]     .mat-option-text, .snapshot-gallery-toolbar[_ngcontent-%COMP%]     .mat-select-value{font-size:14px}.snapshot-gallery-toolbar[_ngcontent-%COMP%]     .mat-form-field-underline{display:none}.snapshot-gallery-toolbar[_ngcontent-%COMP%]     .mat-form-field-infix{border:0;margin:4px 0 0 8px}"]}),e})();function ms(e,t){if(1&e){const e=J.Zb();J.Yb(0,"div",7),J.hc("click",(function(t){return J.Kc(e),J.lc().onExpandButtonClicked(t)})),J.Tb(1,"sda-button-plain",8),J.Yb(2,"div",9),J.Uc(3),J.Xb(),J.Xb()}if(2&e){const e=J.lc();J.Eb(1),J.sc("matSvgIcon","chevron-right"),J.Eb(2),J.Wc(" ",e.galleryDetails," ")}}let fs=(()=>{class e{constructor(e,t){this.sdaTranslateService=e,this.changeDetection=t,this.galleryTitle=this.sdaTranslateService.get("MARKUP_SNAPSHOT_GALLERY_TITLE","Snapshot Gallery"),this.galleryLoading=this.sdaTranslateService.get("MARKUP_SNAPSHOT_GALLERY_LOADING","Loading Snapshot Gallery..."),this.galleryDetails=this.galleryLoading,this.selectedFilter="all",this.snapshotButtonClicked=new J.o,this.thumbnailClicked=new J.o,this.markupLayersLinkClicked=new J.o,this.snapshotDeleted=new J.o,this.snapshotGalleryResized=new J.o,this.openedValue=!1,this.firstCardCountChange=!0}ngOnChanges(e){e.snapshotCompositionObid&&!e.snapshotCompositionObid.firstChange&&this.resetGallery()}onCardCountChanged(e){this.firstCardCountChange&&(this.opened=e>0,this.firstCardCountChange=!1),this.galleryDetails=this.sdaTranslateService.getFormatted("MARKUP_SNAPSHOT_GALLERY_DETAILS-COUNT","Snapshot Gallery - {0} Snapshots",[e.toString()]),this.changeDetection.detectChanges()}onCardDeleted(e){this.snapshotDeleted.emit(e)}onSnapshotButtonClicked(){this.snapshotButtonClicked.emit()}onFilterSelectionChanged(e){this.selectedFilter=e,this.changeDetection.detectChanges()}onThumbnailClicked(e){this.thumbnailClicked.emit(e)}onMarkupLayersLinkClicked(e){this.markupLayersLinkClicked.emit(e)}closePanel(){this.cardsComponent.onGalleryCollapsed(),this.opened=!1}onExpandButtonClicked(e){e.button===j.Left&&(this.opened=!0)}clearSelected(){this.cardsComponent.clearSelected()}addSnapshot(e){this.cardsComponent.addCard(e)}refreshLayerCount(e){this.cardsComponent.refreshLayerCount(e)}selectSnapshot(e){this.cardsComponent.selectCard(e)}get opened(){return this.openedValue}set opened(e){e!==this.openedValue&&(this.openedValue=e,this.snapshotGalleryResized.emit())}resetGallery(){this.opened=void 0,this.selectedFilter="all",this.galleryDetails=this.galleryLoading}}return e.\u0275fac=function(t){return new(t||e)(J.Sb(N.a),J.Sb(J.h))},e.\u0275cmp=J.Mb({type:e,selectors:[["sda-markup-snapshot-gallery"]],viewQuery:function(e,t){var i;1&e&&J.bd(us,!0),2&e&&J.Gc(i=J.ic())&&(t.cardsComponent=i.first)},inputs:{config:"config",snapshotCompositionObid:"snapshotCompositionObid"},outputs:{snapshotButtonClicked:"snapshotButtonClicked",thumbnailClicked:"thumbnailClicked",markupLayersLinkClicked:"markupLayersLinkClicked",snapshotDeleted:"snapshotDeleted",snapshotGalleryResized:"snapshotGalleryResized"},features:[J.Db([]),J.Cb],decls:9,vars:10,consts:[[1,"snapshot-gallery"],[1,"snapshot-gallery__panel",3,"expanded","expandedChange","closed"],["expandedHeight","46px"],[3,"config","snapshotCompositionObid","snapshotButtonClicked","filterSelectionChanged"],[1,"snapshot-gallery__cards"],[3,"config","filter","snapshotCompositionObid","cardCountChanged","cardDeleted","thumbnailClicked","markupLayersLinkClicked"],["class","sidebar",3,"click",4,"ngIf"],[1,"sidebar",3,"click"],[1,"sidebar__btn",3,"matSvgIcon"],[1,"sidebar__details"]],template:function(e,t){1&e&&(J.Yb(0,"div",0),J.Yb(1,"mat-expansion-panel",1),J.hc("expandedChange",(function(e){return t.opened=e}))("closed",(function(){return t.closePanel()})),J.Yb(2,"mat-expansion-panel-header",2),J.Yb(3,"mat-panel-title"),J.Uc(4),J.Xb(),J.Xb(),J.Yb(5,"sda-snapshot-gallery-toolbar",3),J.hc("snapshotButtonClicked",(function(){return t.onSnapshotButtonClicked()}))("filterSelectionChanged",(function(e){return t.onFilterSelectionChanged(e)})),J.Xb(),J.Yb(6,"div",4),J.Yb(7,"sda-snapshot-gallery-cards",5),J.hc("cardCountChanged",(function(e){return t.onCardCountChanged(e)}))("cardDeleted",(function(e){return t.onCardDeleted(e)}))("thumbnailClicked",(function(e){return t.onThumbnailClicked(e)}))("markupLayersLinkClicked",(function(e){return t.onMarkupLayersLinkClicked(e)})),J.Xb(),J.Xb(),J.Xb(),J.Xb(),J.Sc(8,ms,4,2,"div",6)),2&e&&(J.Ib("snapshot-gallery--hidden",!t.opened),J.Eb(1),J.sc("expanded",t.opened),J.Eb(3),J.Wc(" ",t.galleryTitle," "),J.Eb(1),J.sc("config",t.config)("snapshotCompositionObid",t.snapshotCompositionObid),J.Eb(2),J.sc("config",t.config)("filter",t.selectedFilter)("snapshotCompositionObid",t.snapshotCompositionObid),J.Eb(1),J.sc("ngIf",!t.opened))},directives:[r.c,r.g,r.h,Ss,us,s.t,Ot.a],styles:[".sidebar__details[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis}.snapshot-gallery[_ngcontent-%COMP%]{width:340px;height:100%}.snapshot-gallery--hidden[_ngcontent-%COMP%]{display:none}.snapshot-gallery__panel[_ngcontent-%COMP%]   .mat-expansion-panel-header[_ngcontent-%COMP%]{font:500 16px/19px Roboto;padding:16px;background-color:#6b8cad;border-bottom:#cad0d7}.snapshot-gallery__panel[_ngcontent-%COMP%]   .mat-expansion-panel-header[_ngcontent-%COMP%]:hover{background-color:#6b8cad!important}.snapshot-gallery__panel[_ngcontent-%COMP%]   .mat-expansion-panel-header[_ngcontent-%COMP%]   .mat-expansion-panel-header-title[_ngcontent-%COMP%]{color:#fff}.snapshot-gallery__cards[_ngcontent-%COMP%]{height:calc(100% - 106px);overflow-y:auto;border-top:1px solid #cad0d7;border-right:1px solid #cad0d7}.snapshot-gallery[_ngcontent-%COMP%]   .mat-expansion-panel.mat-expanded[_ngcontent-%COMP%]{background-color:#ebedf0;height:100%;border-radius:0}.snapshot-gallery[_ngcontent-%COMP%]   .mat-expansion-panel.mat-expanded[_ngcontent-%COMP%]     .mat-expansion-panel-content{height:inherit}.snapshot-gallery[_ngcontent-%COMP%]   .mat-expansion-panel.mat-expanded[_ngcontent-%COMP%]     .mat-expansion-panel-body{height:inherit;padding:0}.snapshot-gallery[_ngcontent-%COMP%]   .mat-expansion-panel.mat-expanded[_ngcontent-%COMP%]     .mat-expansion-indicator:after{color:#fff;width:5px;height:5px;vertical-align:unset!important;-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}.sidebar[_ngcontent-%COMP%]{width:44px;height:100%;cursor:pointer;border-right:1px solid #cad0d7}.sidebar__details[_ngcontent-%COMP%]{max-height:calc(100% - 40px);padding:4px 12px;-webkit-writing-mode:vertical-lr;-ms-writing-mode:tb-lr;writing-mode:vertical-lr;-webkit-transform:rotate(180deg);transform:rotate(180deg);white-space:nowrap}.sidebar[_ngcontent-%COMP%]     .button__mat-icon{width:27px;height:27px;margin-left:-4px}.sidebar[_ngcontent-%COMP%]     .button--plain{color:#697a8b}.sidebar[_ngcontent-%COMP%]     .button--plain:hover{background-color:unset!important}"]}),e})();var Cs=i("pk7s");const Os=["tabs"];function _s(e,t){if(1&e&&(J.Uc(0),J.Yb(1,"span",13),J.Uc(2),J.Xb()),2&e){const e=J.lc(2);J.Wc(" ",e.MARKUP_TAB_TITLE,""),J.Eb(2),J.Vc(null==e.bravaFile?null:e.bravaFile.layerCount)}}function Is(e,t){if(1&e){const e=J.Zb();J.Yb(0,"div",8),J.Yb(1,"mat-tab-group",9,10),J.hc("selectedIndexChange",(function(t){return J.Kc(e),J.lc().handleTabChange(t)})),J.Tb(3,"mat-tab",11),J.Yb(4,"mat-tab"),J.Sc(5,_s,3,2,"ng-template",12),J.Xb(),J.Xb(),J.Xb()}if(2&e){const e=J.lc();J.Eb(3),J.sc("label",e.VIEW_TAB_TITLE)}}function Ts(e,t){if(1&e){const e=J.Zb();J.Yb(0,"sda-markup-snapshot-gallery",14),J.hc("snapshotButtonClicked",(function(){return J.Kc(e),J.lc().onSnapshotButtonClicked()}))("thumbnailClicked",(function(t){return J.Kc(e),J.lc().onThumbnailClicked(t)}))("markupLayersLinkClicked",(function(t){return J.Kc(e),J.lc().onMarkupLayersLinkClicked(t)}))("snapshotDeleted",(function(t){return J.Kc(e),J.lc().onSnapshotDeleted(t)}))("snapshotGalleryResized",(function(){return J.Kc(e),J.lc().onSnapshotGalleryResized()})),J.Xb()}if(2&e){const e=J.lc();J.sc("config",null==e.goViewFile||null==e.goViewFile.fileObject?null:e.goViewFile.fileObject.config)("snapshotCompositionObid",e.snapshotCompositionObid)}}function Rs(e,t){if(1&e){const e=J.Zb();J.Yb(0,"sda-goview",15),J.hc("snapshotCreated",(function(t){return J.Kc(e),J.lc().onSnapshotCreated(t)}))("showGoView",(function(){return J.Kc(e),J.lc().showGoView()}))("clearUrlParameters",(function(){return J.Kc(e),J.lc().clearUrlParameters()})),J.Xb()}if(2&e){const e=J.lc();J.sc("goViewURL",e.goViewFile.URL)("graphicsMapURL",e.goViewFile.graphicsMapURL)("labelDatabaseOBID",e.goViewFile.labelDatabaseOBID)("maximumSuggestions",15)("maximumSearchResults",300)("fileType",e.goViewFile.fileTypeCategory)("fileName",e.goViewFile.fileObject.name)("fileObid",e.goViewFile.fileObject.obid)("versionOBID",e.goViewFile.versionOBID)("config",e.goViewFile.fileObject.config)("tagInterface",e.goViewFile.tagInterface)("navigationStrategy",e.goViewFile.navigationStrategy)("expandUrlCommand",e.expandUrlCommand)("urlCommandHasError",e.urlCommandHasError)("useGoView2d",e.gvcEnabled)}}function Es(e,t){if(1&e){const e=J.Zb();J.Yb(0,"sda-gvc",16),J.hc("snapshotCreated",(function(t){return J.Kc(e),J.lc().onSnapshotCreated(t)})),J.Xb()}if(2&e){const e=J.lc();J.sc("viewFile",e.goViewFile)("maximumSuggestions",15)("maximumSearchResults",300)("methodOBID",e.methodOBID)("expandUrlCommand",e.expandUrlCommand)("urlCommandHasError",e.urlCommandHasError)}}function ys(e,t){if(1&e){const e=J.Zb();J.Yb(0,"sda-brava-view",17),J.hc("isMarkupDirtyChange",(function(t){return J.Kc(e),J.lc().markupIsDirty=t}))("isShowingFormChange",(function(t){return J.Kc(e),J.lc().isShowingForm=t}))("layerCountChanged",(function(){return J.Kc(e),J.lc().updateLayerCount()}))("showBrava",(function(){return J.Kc(e),J.lc().showBrava()})),J.Xb()}if(2&e){const e=J.lc();J.sc("fileName",e.bravaFile.fileObject.name)("fileOBID",e.bravaFile.fileObject.obid)("fileEntityType",e.bravaFile.fileObject.entityType)("config",e.bravaFile.fileObject.config)("actionOBID",e.bravaFile.actionOBID)("preSelectedMarkups",e.bravaFile.selectedMarkups)("graphicsMapURL",e.bravaFile.graphicsMapURL)("tagInterface",e.bravaFile.tagInterface)("tabViewEnabled",e.tabViewEnabled)("isMarkupDirty",e.markupIsDirty)("isShowingForm",e.isShowingForm)("parentClientAPI",e.parentClientAPI)("parentMethodOBID",e.parentMethodOBID)("parentObjects",e.parentObjects)("routeSnapshot",e.routeSnapshot)("expandUrlCommand",e.bravaExpandUrlCommand)("urlCommandHasError",e.bravaUrlCommandHasError)}}let ws=(()=>{class e{constructor(e,t,i,s,n,a,o,r,l,c,h,d,p,u,g,b,v,S,m,f,C,O){this.applicationSettingsService=e,this.route=t,this.location=i,this.retrieveFileURLsService=s,this.uxtNotificationService=n,this.sdaTranslateService=a,this.exceptionService=o,this.loadingOverlayService=r,this.labelDatabaseService=l,this.helpService=c,this.treeviewColumnsetService=h,this.saveChangesDialogService=d,this.loggingService=p,this.markupRenditionService=u,this.ppmViewerService=g,this.odataService=b,this.viewMarkupCacheService=v,this.serverInformationService=S,this.gdsService=m,this.changeDetection=f,this.navigateTelemetryService=C,this.featureSetNavigationService=O,this.isAlternateFileEntity=!1,this.VIEW_TAB_TITLE=this.sdaTranslateService.get("VIEW","View"),this.MARKUP_TAB_TITLE=this.sdaTranslateService.get("MARKUP","Markup"),this.tabViewEnabled=!1,this.activeViewer=H.GoView,this.leftMouseButtonDown=!1,this.VIEW_MARKUP_TITLE=this.sdaTranslateService.get("VIEW_MARKUP_TITLE","View and Markup"),this.REMOVED_RENAMED_EMPTY=this.sdaTranslateService.get("REMOVED_RENAMED_EMPTY","File has been removed, renamed or empty"),this.graphicsMapURL="",this.urlCommandHasError=!1,this.bravaUrlCommandHasError=!1,this.FileTypeCategory=T.a,this.gvcEnabled=!1,this.helpService.setHandlers(W.b)}ngOnInit(){this.showGVC=!1,this.routeSnapshot=this.route.snapshot,this.paramSubscription=Object(b.a)(this.route.paramMap,this.route.data).subscribe(([e,t])=>{if(!t[V.z]||e.get(V.w))return;let i,s,n;if(e.has("gdsConnection"))i=JSON.parse(e.get("gdsConnection")),this.viewMarkupCacheService.currentViewVersion=i.obid;else if(e.has("gdsFilter"))s=JSON.parse(e.get("gdsFilter")),this.viewMarkupCacheService.currentViewVersion=s.obid;else{if(!e.has("file"))return void this.uxtNotificationService.info("No file object specified");if(this.fileObject=JSON.parse(e.get("file")),this.viewMarkupCacheService.currentViewFile=this.fileObject.obid,!e.has("fileComposition"))return void this.uxtNotificationService.info("No fileComposition object specified");this.fileCompositionObject=JSON.parse(e.get("fileComposition")),this.viewMarkupCacheService.currentViewVersion=this.fileCompositionObject.obid}e.has("action")&&(this.actionObject=JSON.parse(e.get("action"))),this.resetCurrentFileInformation(),this.parentClientAPI=e.get("ParentClientAPI"),this.parentMethodOBID=e.get("ParentMethodOBID"),this.methodOBID=e.get("MethodOBID"),this.parentObjects=e.get("ParentObjects"),this.objects=t[V.z],n=this.objects.filter(e=>"SPFMarkupFile"===e.entityType||"No_Markup_Selected"===e.obid).map(e=>e.obid),this.objects=this.objects.filter(e=>"SPFMarkupFile"!==e.entityType&&"No_Markup_Selected"!==e.obid).map(e=>e),n&&n.length>0&&(this.selectedMarkups=n.join(",")),this.handleParamMapData(e.get(V.v)),this.displayName=e.get(V.x),this.actionItemCreateMethod=e.get(V.d),this.tagInterface=e.has(V.e)?e.get(V.e):"",this.isGvcEnabled().pipe(Object(S.a)(1)).subscribe(e=>{this.gvcEnabled=e,i?this.gdsConnectionViewAndMarkup(i):s?this.gdsFilterViewAndMarkup(s):this.nonGDSConnectionViewAndMarkup()})})}ngOnDestroy(){this.viewMarkupCacheService.currentViewVersion=void 0,this.viewMarkupCacheService.currentViewFile=void 0,this.paramSubscription&&this.paramSubscription.unsubscribe(),this.displayNameSubscription&&this.displayNameSubscription.unsubscribe()}canDeactivate(e){let t=Promise.resolve(!0);return!(e&&e.url&&e.url.toLowerCase().indexOf(V.w.toLowerCase()+"=true")>=0)&&!this.isShowingForm&&this.markupIsDirty&&this.bravaFile&&this.bravaFile.ready&&(this.gallerySelectCurrentBravaFile(),t=this.saveChangesDialogService.showDialog()),t}onSnapshotButtonClicked(){this.activeViewer===H.GoView?!0===this.showGVC?this.gvcComponent.snapshotButtonClicked():this.goViewComponent.snapshotButtonClicked():this.uxtNotificationService.warning(this.sdaTranslateService.get("VIEW_MARKUP_SELECT_THUMBNAIL","Select a thumbnail to return to the model"))}onSnapshotGalleryResized(){this.goViewComponent?this.goViewComponent.snapshotGalleryResized():this.gvcComponent&&this.gvcComponent.snapshotGalleryResized()}handleTabChange(e){let t=!1;if(1===e&&(t=!0,!this.bravaFile.ready)){const e=this.bravaFile.fileObject.name,t=e.substring(e.lastIndexOf(".")+1);this.navigateTelemetryService.sendNavigateEvent(this.getTelemetryData("Brava",this.bravaFile.fileObject,t.toUpperCase())),this.bravaFile.setReady(!0),this.loadingOverlayService.hideLoadingOverlay()}this.setBravaVisibility(t)}showGoView(){if(this.tabViewEnabled&&this.tabs)this.tabs.selectedIndex=0;else{const e=document.getElementById("goViewContainer");e&&"none"===e.style.display&&this.setBravaVisibility(!1)}}showBrava(){this.setBravaVisibility(!0)}clearUrlParameters(){this.urlCommandHasError&&(this.bravaUrlCommandHasError=!1),this.expandUrlCommand&&(this.bravaExpandUrlCommand=void 0)}updateLayerCount(){this.tabViewEnabled&&this.bravaFile.updateLayerCount(),this.snapshotGallery&&this.snapshotGallery.refreshLayerCount(this.bravaFile.fileObject.obid)}onThumbnailClicked(e){this.leftMouseButtonDown=!1,this.removeGoViewMouseListeners(),this.setBravaVisibility(!1),!0===this.showGVC?this.gvcComponent.setCameraPosition(e):this.goViewComponent.setCameraPosition(e),this.addGoViewMouseListeners()}onMarkupLayersLinkClicked(e){this.leftMouseButtonDown=!1,this.removeGoViewMouseListeners(),this.bravaFile?this.bravaFile.fileObject.obid!==e.obid?this.canDeactivate(void 0).then(t=>{t&&this.galleryLoadSnapshotInBrava(e)}):this.gallerySelectCurrentBravaFile():this.galleryLoadSnapshotInBrava(e)}onSnapshotCreated(e){this.snapshotGallery.addSnapshot(e)}removeGoViewMouseListeners(){const e=document.getElementById("goViewContainer");e&&(e.removeEventListener("mousedown",e=>this.contentPanelMouseDown(e),!0),e.removeEventListener("mouseup",e=>this.contentPanelMouseUp(e),!0),e.removeEventListener("mousemove",e=>this.contentPanelMouseMove(e),!0),e.removeEventListener("mousewheel",e=>this.contentPanelMouseWheel(e),!0),e.removeEventListener("touchmove",e=>this.contentPanelTouchMove(e),!0))}addGoViewMouseListeners(){const e=document.getElementById("goViewContainer");e&&(e.addEventListener("mousedown",e=>this.contentPanelMouseDown(e),!0),e.addEventListener("mouseup",e=>this.contentPanelMouseUp(e),!0),e.addEventListener("mousemove",e=>this.contentPanelMouseMove(e),!0),e.addEventListener("mousewheel",e=>this.contentPanelMouseWheel(e),!0),e.addEventListener("touchmove",e=>this.contentPanelTouchMove(e),!0))}contentPanelMouseDown(e){e.button===j.Left&&(this.leftMouseButtonDown=!0)}contentPanelMouseUp(e){e.button===j.Left&&(this.leftMouseButtonDown=!1)}contentPanelMouseMove(e){this.leftMouseButtonDown&&this.snapshotGallery.clearSelected()}contentPanelMouseWheel(e){this.snapshotGallery.clearSelected()}contentPanelTouchMove(e){this.snapshotGallery.clearSelected()}onSnapshotDeleted(e){this.activeViewer===H.Brava&&this.bravaFile&&this.bravaFile.fileObject&&this.bravaFile.fileObject.obid===e&&(this.setBravaVisibility(!1),this.bravaFile=void 0,this.uxtNotificationService.info(this.sdaTranslateService.get("VIEW_MARKUP_RETURNED_TO_MODEL","Returned to model view")))}nonGDSConnectionViewAndMarkup(){this.odataService.get(`Objects('${this.fileObject.obid}')`,this.fileObject.config,!1).pipe(Object(m.a)(e=>{if(e&&e.value&&e.value.OBID)return this.odataService.get(`Objects('${this.fileObject.obid}')?$select=SPFLocalFileName`,this.fileObject.config,!1);throw new O.a(this.REMOVED_RENAMED_EMPTY,void 0,"view-markup.component","viewAndMarkupFile")}),Object(m.a)(e=>e?(this.fileObject.name=e.value.SPFLocalFileName,this.viewAndMarkup(this.fileObject,this.fileCompositionObject)):Object(v.a)(void 0))).subscribe(e=>{void 0!==e&&this.loggingService.info("viewAndMarkup:status="+e)},e=>{this.exceptionService.handleException(e),this.featureSetNavigationService.navigateBack()})}viewAndMarkup(e,t){return this.setPageTitle(t),this.viewAndMarkupFile(e,t)}gdsConnectionViewAndMarkup(e){this.applicationSettingsService.setPageTitle(this.viewMarkupCacheService.shouldSelectTags||!this.viewMarkupCacheService.shouldSelectTags&&this.expandUrlCommand?this.displayName:`${this.VIEW_MARKUP_TITLE} ${e.name}`),this.gdsService.getGDSConnectionUrl(e).pipe(Object(S.a)(1)).subscribe(t=>{this.setGoViewFile(e,void 0,t,this.tagInterface,T.a.GDS,z.a.GDS,void 0,!1),this.showPpmViewer()},e=>{this.exceptionService.handleException(e),this.featureSetNavigationService.navigateBack()})}getGdsFilterUid(e){return this.odataService.get(`Objects('${e.obid}')?$select=UID`,e.config).pipe(Object(m.a)(e=>{var t;return Object(v.a)(null===(t=null==e?void 0:e.value)||void 0===t?void 0:t.UID)}))}gdsFilterSetViewFile(e){return this.gdsService.getGdsConnection(e.config).pipe(Object(m.a)(t=>{if(t){const i=new G.a(t.OBID,t.Name,e.config,void 0,void 0,t.GDSConnectionUrl?{GDSConnectionUrl:t.GDSConnectionUrl}:void 0);return this.getGdsFilterUid(e).pipe(Object(m.a)(e=>this.gdsService.getGDSConnectionUrl(i,e).pipe(Object(m.a)(e=>(this.setGoViewFile(i,void 0,e,this.tagInterface,T.a.GDS,z.a.GDS,void 0,!1),Object(v.a)(!0))))))}return this.loadingOverlayService.hideLoadingOverlay(),this.uxtNotificationService.error(this.sdaTranslateService.get("VIEW_IN_DOCUMENT_NO_GDS_AT_CONFIG","No GDS Connection available at object config")),this.featureSetNavigationService.navigateBack(),Object(v.a)(!1)}))}gdsFilterViewAndMarkup(e){this.gdsFilterSetViewFile(e).pipe(Object(S.a)(1)).subscribe(t=>{t&&(this.applicationSettingsService.setPageTitle(`${this.VIEW_MARKUP_TITLE} ${e.name}`),this.showPpmViewer())},e=>{this.exceptionService.handleException(e),this.featureSetNavigationService.navigateBack()})}getObjectItemDescription(e){return e&&e.data&&e.data.hasOwnProperty("Description")?e.data.Description:""}getFilePurposes(e,t){const i=[];return e!==T.a.NONPPM&&i.push(R.a.PRIMARY),t===z.a.GRAPHICSMAP&&i.push(R.a.GRAPHICSMAP),i}viewAndMarkupFile(e,t){return this.ppmViewerService.getNavigationStrategy(t).pipe(Object(m.a)(i=>{const s=E.a.getFileTypeCategory(e.name),n=this.getFilePurposes(s,i);return n?(this.loadingOverlayService.showLoadingOverlay(this.sdaTranslateService.get("PREPARING_FILES","Preparing files...")),this.loggingService.info("Calling RetrieveFileUris for file '"+e.name),this.retrieveFileURLsService.retrieveFileURLs(e.obid,e.config,n,!1).pipe(Object(m.a)(n=>{let a,o;return this.loggingService.info(`File URIs retrieved for file '${e.name}'.`),n.length>0&&n.forEach(e=>{"SPFFileGraphicsMap"===e.Name||"GraphicsMap"===e.Name?o=e.URL:"MarkupRendition"===e.Purpose?this.markupRenditionObject=e:a=e.URL}),this.viewFile(a,o,e,t,s,i),Object(v.a)(!0)}))):Object(v.a)(!1)}))}viewFile(e,t,i,s,n,a){const o=i.name.substring(i.name.lastIndexOf(".")+1);switch(n){case T.a.BINZ:case T.a.VECZ:e&&(this.setGoViewFile(i,s,e,this.tagInterface,n,a,t),this.navigateTelemetryService.sendNavigateEvent(this.getTelemetryData("GoView",i,o.toUpperCase())),t||n===T.a.VECZ||a!==z.a.GRAPHICSMAP?this.initTabOrSingleView(i,this.fileCompositionObject):this.handleGetLabelDatabase(i));break;case T.a.NONPPM:let r,l=this.selectedMarkups;this.actionObject&&(r=this.actionObject.obid,this.actionObject.data&&this.actionObject.data.hasOwnProperty("markup")&&(l=this.actionObject.data.markup)),this.setBravaFile(i,this.tagInterface,t,l,r,!0),this.navigateTelemetryService.sendNavigateEvent(this.getTelemetryData("Brava",i,o.toUpperCase()));break;default:const c=this.sdaTranslateService.getFormatted("UNSUPPORTED_FILE-FILE_TYPE","Viewing a {0} file is not supported",[E.a.getFileType(i.name).toLocaleUpperCase()]);this.uxtNotificationService.info(c)}this.loadingOverlayService.hideLoadingOverlay()}getTelemetryData(e,t,i){return{viewer:e,fileType:i,displayName:this.displayName,fileEntityType:t.entityType,tagInterface:this.tagInterface,eventName:"FileView"}}handleGetLabelDatabase(e){this.loggingService.info("Querying for label database."),this.labelDatabaseService.checkFileForLabelDatabase(e.obid,e.config,e.name).subscribe(t=>{this.loggingService.info("Label database found."),this.goViewFile.labelDatabaseOBID=t,this.initTabOrSingleView(e,this.fileCompositionObject)},e=>{this.exceptionService.handleException(e)})}setBravaFile(e,t,i,s,n,a){this.bravaFile=new U(e,T.a.NONPPM,i,t,s,n,this.markupRenditionService,a)}setGoViewFile(e,t,i,s,n,a,o,r){this.goViewFile=new B(e,t?t.obid:void 0,n,a,i,o,s,r)}resetCurrentFileInformation(){this.bravaFile=void 0,this.goViewFile=void 0,this.tabViewEnabled=!1,this.snapshotCompositionObid=void 0}setPageTitle(e){let t;const i=this.getObjectItemDescription(e);this.displayNameSubscription=this.treeviewColumnsetService.GetDisplayNames([e.obid],e.config,"").subscribe(s=>{this.viewMarkupCacheService.shouldSelectTags?(this.displayAs=s[0].DisplayAs.replace(", "+i,"").replace(e.name+" ",""),t=this.displayName):(this.displayAs=s[0].DisplayAs.replace(", "+i,""),t=this.actionItemCreateMethod?this.displayName:this.VIEW_MARKUP_TITLE),this.displayAs&&(t+=" "+this.displayAs),this.displayNameSubscription&&(this.displayNameSubscription.unsubscribe(),this.displayNameSubscription=void 0),this.applicationSettingsService.setPageTitle(t)},e=>{this.exceptionService.handleException(new O.a(e)),this.displayNameSubscription&&(this.displayNameSubscription.unsubscribe(),this.displayNameSubscription=void 0),this.location.back()})}setBravaVisibility(e){this.activeViewer=!0===e?H.Brava:H.GoView;const t=document.getElementById("bravaContainer");if(t){let i="",s="";e||(i="absolute",s="-999em"),t.style.position=i,t.style.left=s}this.setGoViewVisibility(!e)}setGoViewVisibility(e){const t=document.getElementById("goViewContainer");t&&(t.style.display=e?"flex":"none")}initTabOrSingleView(e,t){if(this.goViewFile.fileTypeCategory===T.a.VECZ){if(this.markupRenditionObject&&this.markupRenditionObject.URL.length>0){const t=new G.a(this.markupRenditionObject.Id,this.markupRenditionObject.Name,e.config,this.markupRenditionObject.Name);this.setBravaFile(t,this.tagInterface,void 0,this.selectedMarkups),this.tabViewEnabled=!0,this.updateLayerCount()}else this.bravaFile=void 0,this.uxtNotificationService.warning(this.sdaTranslateService.get("UNABLE_MARKUP_RENDITION","Unable to retrieve the markup rendition"));this.showPpmViewer()}else this.snapshotCompositionObid=e.obid,this.showPpmViewer(),this.setBravaVisibility(!1),this.bravaFile=void 0}handleParamMapData(e){this.urlCommandHasError=!1,this.expandUrlCommand=void 0;const t=this.getJson(e);if(t&&0!==Object.getOwnPropertyNames(t).length){const e=t;if(e.selectUIDs)this.viewMarkupCacheService.selectedTagUIDs=e.selectUIDs,this.viewMarkupCacheService.shouldSelectTags=!0;else if(!this.isCollaborationUrlCommand(t)){this.viewMarkupCacheService.shouldSelectTags=!1;let e=t.toString();"{"!==e[0]&&(e="{"+e+"}");const i=this.getJson(e);if(i){for(const e in i)e!==e.toUpperCase()&&(Object.defineProperty(i,e.toUpperCase(),Object.getOwnPropertyDescriptor(i,e)),delete i[e]);this.expandUrlCommand=this.setUrlCommand(i),this.bravaExpandUrlCommand=this.expandUrlCommand}this.expandUrlCommand||(this.urlCommandHasError=!0,this.bravaUrlCommandHasError=!0,console.log("URL data parameter "+t.toString()+" does not use correct JSON input syntax."))}}else this.viewMarkupCacheService.shouldSelectTags=!1}getJson(e){try{return JSON.parse(e)}catch(t){return}}gallerySelectCurrentBravaFile(){if(this.snapshotCompositionObid&&this.bravaFile){const e=new is(this.bravaFile.fileObject.obid,this.bravaFile.fileObject.name,void 0,void 0,void 0,void 0);this.snapshotGallery.selectSnapshot(e),this.setBravaVisibility(!0)}}galleryLoadSnapshotInBrava(e){this.bravaFile&&(this.bravaFile=void 0,this.changeDetection.detectChanges()),this.markupIsDirty=!1;const t=new G.a(e.obid,e.name,this.fileObject.config,e.name,"SPFMarkupSnapshot");this.viewFile(void 0,void 0,t,void 0,T.a.NONPPM,void 0),this.snapshotGallery.selectSnapshot(e),this.setBravaVisibility(!0)}showPpmViewer(){this.showGVC=this.gvcEnabled&&this.goViewFile.fileTypeCategory!==T.a.VECZ,this.goViewFile.setReady(!0)}isGvcEnabled(){return this.serverInformationService.getServerInformation().pipe(Object(m.a)(e=>{let t=!1;if(e&&e.DatabaseVariants){const i=e.DatabaseVariants.split(",");t=i.indexOf("SDX3DPAB")>=0||i.indexOf("SDXIHUB")>=0}return Object(v.a)(t)}))}setUrlCommand(e){const t=e;return t.VIR||t.VIS||t.ITEMSBYUID||t.ITEMSBYOBID||t.ITEMSBYNAME?(this.expandUrlCommand=t,t):void 0}isCollaborationUrlCommand(e){return void 0!==e.markupContextOBID||void 0!==e.objectOBIDForRenditionGeneration||void 0!==e.documentReviewVersionOBID}}return e.\u0275fac=function(t){return new(t||e)(J.Sb(C.a),J.Sb(p.a),J.Sb(s.n),J.Sb(y.a),J.Sb(k.a),J.Sb(N.a),J.Sb(_.a),J.Sb(M.a),J.Sb(Q),J.Sb(D.a),J.Sb(F.a),J.Sb(P.a),J.Sb(x.a),J.Sb(ee),J.Sb(ie.a),J.Sb(A.a),J.Sb(se.a),J.Sb(f.a),J.Sb(X.a),J.Sb(J.h),J.Sb(te.a),J.Sb(I.a))},e.\u0275cmp=J.Mb({type:e,selectors:[["sda-view-markup"]],viewQuery:function(e,t){var i;1&e&&(J.bd(Ci,!0),J.bd(fs,!0),J.bd(Os,!0),J.bd(ts,!0)),2&e&&(J.Gc(i=J.ic())&&(t.goViewComponent=i.first),J.Gc(i=J.ic())&&(t.snapshotGallery=i.first),J.Gc(i=J.ic())&&(t.tabs=i.first),J.Gc(i=J.ic())&&(t.gvcComponent=i.first))},features:[J.Db([w.a,Q,E.a,ee,Y.a])],decls:8,vars:11,consts:[["id","viewAndMarkupTabView",4,"ngIf"],[1,"gallery-viewer"],[3,"config","snapshotCompositionObid","snapshotButtonClicked","thumbnailClicked","markupLayersLinkClicked","snapshotDeleted","snapshotGalleryResized",4,"ngIf"],["id","goViewContainer",1,"gallery-viewer__container"],["class","gallery-viewer__goview",3,"goViewURL","graphicsMapURL","labelDatabaseOBID","maximumSuggestions","maximumSearchResults","fileType","fileName","fileObid","versionOBID","config","tagInterface","navigationStrategy","expandUrlCommand","urlCommandHasError","useGoView2d","snapshotCreated","showGoView","clearUrlParameters",4,"ngIf"],["class","gallery-viewer__gvc",3,"viewFile","maximumSuggestions","maximumSearchResults","methodOBID","expandUrlCommand","urlCommandHasError","snapshotCreated",4,"ngIf"],["id","bravaContainer",1,"gallery-viewer__container"],[3,"fileName","fileOBID","fileEntityType","config","actionOBID","preSelectedMarkups","graphicsMapURL","tagInterface","tabViewEnabled","isMarkupDirty","isShowingForm","parentClientAPI","parentMethodOBID","parentObjects","routeSnapshot","expandUrlCommand","urlCommandHasError","isMarkupDirtyChange","isShowingFormChange","layerCountChanged","showBrava",4,"ngIf"],["id","viewAndMarkupTabView"],["animationDuration","0ms",3,"selectedIndexChange"],["tabs",""],[3,"label"],["mat-tab-label",""],["id","badge"],[3,"config","snapshotCompositionObid","snapshotButtonClicked","thumbnailClicked","markupLayersLinkClicked","snapshotDeleted","snapshotGalleryResized"],[1,"gallery-viewer__goview",3,"goViewURL","graphicsMapURL","labelDatabaseOBID","maximumSuggestions","maximumSearchResults","fileType","fileName","fileObid","versionOBID","config","tagInterface","navigationStrategy","expandUrlCommand","urlCommandHasError","useGoView2d","snapshotCreated","showGoView","clearUrlParameters"],[1,"gallery-viewer__gvc",3,"viewFile","maximumSuggestions","maximumSearchResults","methodOBID","expandUrlCommand","urlCommandHasError","snapshotCreated"],[3,"fileName","fileOBID","fileEntityType","config","actionOBID","preSelectedMarkups","graphicsMapURL","tagInterface","tabViewEnabled","isMarkupDirty","isShowingForm","parentClientAPI","parentMethodOBID","parentObjects","routeSnapshot","expandUrlCommand","urlCommandHasError","isMarkupDirtyChange","isShowingFormChange","layerCountChanged","showBrava"]],template:function(e,t){1&e&&(J.Sc(0,Is,6,1,"div",0),J.Yb(1,"div",1),J.Sc(2,Ts,1,2,"sda-markup-snapshot-gallery",2),J.Yb(3,"div",3),J.Sc(4,Rs,1,15,"sda-goview",4),J.Sc(5,Es,1,6,"sda-gvc",5),J.Xb(),J.Yb(6,"div",6),J.Sc(7,ys,1,17,"sda-brava-view",7),J.Xb(),J.Xb()),2&e&&(J.sc("ngIf",t.tabViewEnabled),J.Eb(1),J.Ib("gallery-viewer--short",t.tabViewEnabled),J.Eb(1),J.sc("ngIf",t.snapshotCompositionObid),J.Eb(1),J.Ib("gallery-viewer__container--hidden",!(t.snapshotCompositionObid||null!=t.goViewFile&&t.goViewFile.ready)),J.Eb(1),J.sc("ngIf",(null==t.goViewFile?null:t.goViewFile.ready)&&!t.showGVC),J.Eb(1),J.sc("ngIf",(null==t.goViewFile?null:t.goViewFile.ready)&&t.showGVC),J.Eb(1),J.Ib("gallery-viewer__container--hidden",!(t.snapshotCompositionObid||null!=t.bravaFile&&t.bravaFile.ready)),J.Eb(1),J.sc("ngIf",null==t.bravaFile?null:t.bravaFile.ready))},directives:[s.t,d.c,d.a,d.d,fs,Ci,ts,Cs.a],styles:["[_nghost-%COMP%]{display:flex;flex:1;flex-direction:column;min-width:0}[_nghost-%COMP%]     .ui-dialog{z-index:1200!important}[_nghost-%COMP%]     .create-object__item{max-height:calc(100% - 48px)}[_nghost-%COMP%]     #viewAndMarkupTabView .mat-tab-label{padding:0}[_nghost-%COMP%]     #viewAndMarkupTabView .mat-tab-label-content{height:100%}#viewAndMarkupTabView[_ngcontent-%COMP%]   #badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;align-self:flex-start;min-width:16px;height:16px;line-height:16px;font-size:10px;background-color:#03a9f4;color:#fff;margin:5px 0 0 5px;padding:0 5px;border-radius:50%}.gallery-viewer[_ngcontent-%COMP%]{display:flex;height:100%}.gallery-viewer--short[_ngcontent-%COMP%]{height:calc(100% - 44px)}.gallery-viewer__container[_ngcontent-%COMP%]{flex:1;flex-direction:column;width:100%}.gallery-viewer__container--hidden[_ngcontent-%COMP%]{display:none}.gallery-viewer__goview[_ngcontent-%COMP%], .gallery-viewer__gvc[_ngcontent-%COMP%]{height:100%}"]}),e})();var Ms=i("Ky52");const Ps=[{path:"",component:ws,resolve:{objects:u.a},canDeactivate:[g.a]}];let Ds=(()=>{class e{}return e.\u0275mod=J.Qb({type:e}),e.\u0275inj=J.Pb({factory:function(t){return new(t||e)},imports:[[s.c,Ms.a,n.j,n.z,d.e,a.d,l.b,h.b,o.a,r.b,c.c,p.k.forChild(Ps)],p.k,a.d,r.b,c.c]}),e})()}}]);