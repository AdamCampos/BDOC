(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{B0So:function(e,t,i){"use strict";i.d(t,"a",(function(){return _}));var s=i("XIp8"),a=i("LRne"),n=i("NXyV"),r=i("EY2u"),o=i("z6cu"),c=i("cp0P"),d=i("IzEk"),l=i("vkgz"),h=i("eIep"),p=i("JIr8"),D=i("C8de"),u=i("799W"),m=i("POgZ"),I=i("MKMw"),R=i("Z9D8"),S=i("LUpO"),O=i("2ufx"),f=i("kx0E"),C=i("A1MZ"),x=i("Ejbi"),g=i("FedY"),v=i("41Lq"),w=i("RA+h"),E=i("AxFE"),B=i("oOhx"),b=i("Epp+"),T=i("fXoL");let _=(()=>{class e extends u.a{constructor(e,t,i,s,a,n,r,o,c,d,l){super(s,o,a,l),this.listEditColumnService=e,this.matrixDataService=t,this.matrixColumnService=i,this.exceptionService=s,this.documentService=a,this.sdaTranslateService=n,this.listEditDependentItemsService=r,this.dataFormatService=o,this.listEditDataService=c,this.notificationService=d,this.guidService=l,this.isCopied=!1,this.MATRIX_FAILED_TO_LOAD_DATA=this.sdaTranslateService.get("MATRIX_FAILED_TO_LOAD_DATA","Unable to load recipients"),this.LIST_EDIT_FAILED_TO_READ_DATA=this.sdaTranslateService.get("LIST_EDIT_FAILED_TO_READ_DATA","Failed reading existing data"),this.LIST_EDIT_UNABLE_TO_SAVE_CHANGES=this.sdaTranslateService.get("LIST_EDIT_UNABLE_TO_SAVE_CHANGES","Failed to save your changes"),this.LIST_EDIT_SAVE_SUCCESSFUL=this.sdaTranslateService.get("LIST_EDIT_SAVE_SUCCESSFUL","The changes have been saved successfully"),this.matrixRowPageNumber=0,this.matrixRowPageSize=Settings.application.defaultPageSize}read(){return this.data.length?(super.next(this.data),Object(a.a)(!0)):(this.isLoading=!0,this.matrixDataService.getMatrixRowsCount(this.matrixOBID).pipe(Object(d.a)(1),Object(l.a)(e=>{this.matrixRowPageSize=e.count}),Object(h.a)(e=>function(e,t=r.a,i=r.a){return Object(n.a)(()=>e()?t:i)}(()=>this.matrixRowPageSize>0,this.matrixDataService.getMatrixRowRecipientsMaxCount(this.matrixOBID,this.matrixRowPageSize),Object(a.a)(void 0))),Object(h.a)(e=>this.getMatrixRowsForRecipients(e)),Object(h.a)(e=>(this.responseRows=e,this.getDropDownOptionsForMatrixColumns())),Object(h.a)(()=>this.updateDependentRelItemsForMatrixColumns()),Object(h.a)(()=>this.processRowResultsResolveDuplicates()),Object(p.a)(e=>(this.responseRows=[],this.exceptionService.handleException(new R.a(e,this.LIST_EDIT_FAILED_TO_READ_DATA)),Object(a.a)(!1)))))}saveChanges(){return this.data.filter(e=>e.RecipientsUpdated||e.rowGUID).forEach(e=>{e.OBID&&e.RecipientsUpdated&&this.addupdatedRecipientsOfExistingRowToCRUD(e),e.rowGUID&&this.addupdatedRecipientsOfNewRowToCRUD(e)}),this.hasChanges()?this.addItemsToCRUD():Object(a.a)(!0)}validateData(){return!0}addRow(){const e=this.getNewRow();this.matrixColumnService.matrixColumns.forEach(t=>{e[t.field]="*",t.columnItemDetails.ScopedByInfo.IsEnum&&t.columnItemDetails.DependencyDetails&&(e[t.field+w.b]=t.columnItemDetails.ScopedByInfo.EnumTypeName)}),e.Recipients={},this.matrixColumnService.validReasonForReceipts.forEach(t=>{e.Recipients[t.OBID]=new Array}),this.addNewOrDuplicateRowsToModifiedData(e),this.addNewGridContent(e,0),this.listEditCRUDItems.createdrowswithrecipients.push({key:e,value:[]}),this.checkDataItemIsValid(this.matrixColumnService.matrixColumns),super.next(this.data)}removeRow(e){if(e){const t=this.findIndexForTheSelectedItem(e);if(-1!==t){let i=-1;e.rowGUID&&e.rowGUID.length>0&&(i=this.listEditCRUDItems.createdrowswithrecipients.findIndex(t=>e.rowGUID===t.key.rowGUID)),-1!==i&&this.listEditCRUDItems.createdrowswithrecipients.splice(i,1),e.OBID&&e.OBID.length>0&&this.listEditCRUDItems.terminatedObjects.push({OBID:e.OBID,Name:""}),this.removeDeletedRowsFromModifiedData(e),this.data.splice(t,1),super.next(this.data)}}}duplicateRow(e){const t=this.getDuplicateRow(e);t&&(t.Recipients&&this.matrixColumnService.validReasonForReceipts.forEach(e=>{const i=t.Recipients[e.OBID];i&&i.length>0&&i.forEach(e=>{e.RecipientObid=void 0})}),this.addNewOrDuplicateRowsToModifiedData(t),this.addDupeGridContent(e,t),t.isValid="false",this.listEditCRUDItems.createdrowswithrecipients.push({key:t,value:[]}),super.next(this.data))}hasChanges(){return this.listEditCRUDItems.hasValue()||this.modifiedData.length>0}itemHasChanges(e){let t=!1;if("Recipients"===e.columnSetField){const i=this.originalData.filter(t=>t.OBID===e.dataItem.OBID)[0];if(i)t=this.checkRecipientsHasChanged(i,e);else if(e.dataItem.rowGUID){const i=e.dataItem;i.RecipientsUpdated=!0,this.modifiedData.includes(i.rowGUID+"_Recipients")||this.modifiedData.push(i.rowGUID+"_Recipients"),t=!0}}else t=super.itemHasChanges(e);return t}getUniqueUsers(){const e=new Set,t=[];return this.data.forEach(i=>{this.matrixColumnService.validReasonForReceipts.forEach(s=>{i.Recipients[s.OBID]&&i.Recipients[s.OBID].length>0&&i.Recipients[s.OBID].forEach(i=>{e.has(i.OBID)||i.IsTerminated||(e.add(i.OBID),t.push({name:i.Name,OBID:i.OBID}))})})}),t.sort((e,t)=>g.a.sortByString(e.name,t.name)),t}removeAllRecipients(e){this.data.forEach(t=>{this.matrixColumnService.validReasonForReceipts.forEach(i=>{const s=t.Recipients[i.OBID].findIndex(t=>t.Name===e.name);if(-1!==s){const e=t.Recipients[i.OBID][s];e.IsTerminated=!0,e.RecipientObid||t.Recipients[i.OBID].splice(s,1),t.RecipientsUpdated=!0}})}),super.next(this.data)}highlightOrUnhighlightAllRecipients(e){this.data.forEach(t=>{this.matrixColumnService.validReasonForReceipts.forEach(i=>{if(!e.isHighlighted){const e=t.Recipients[i.OBID].findIndex(e=>!0===e.IsHighlighted);-1!==e&&(t.Recipients[i.OBID][e].IsHighlighted=!1)}const s=t.Recipients[i.OBID].findIndex(t=>t.OBID===e.obid);-1!==s&&(t.Recipients[i.OBID][s].IsHighlighted=!e.isHighlighted)})}),this.highlightedRecipientOBID=e.isHighlighted?void 0:e.obid,super.next(this.data)}copyAssignments(e,t,i){let s;s=this.data.findIndex(t.OBID?e=>e.OBID===t.OBID:e=>e.rowGUID===t.rowGUID);const a=this.data[s].Recipients[i].findIndex(t=>t.OBID===e.obid);-1!==a&&(this.copiedRecipient=this.data[s].Recipients[i][a]),this.isCopied=!0}appendAssignments(e){let t=!1;return this.data.forEach(i=>{this.matrixColumnService.validReasonForReceipts.forEach(s=>{if(e){const a=i.Recipients[s.OBID].findIndex(e=>e.OBID===this.copiedRecipient.OBID),n=i.Recipients[s.OBID].findIndex(t=>t.OBID===e.obid),r=i.Recipients[s.OBID].findIndex(e=>e.IsHighlighted);-1===a||-1!==n||i.Recipients[s.OBID][a].IsTerminated||(i.Recipients[s.OBID].push({RecipientObid:void 0,RFRObid:s.OBID,OBID:e.obid,Name:e.name,UID:e.uid,ClassDef:e.classDef,IsHighlighted:!0}),i.RecipientsUpdated=!0,this.highlightedRecipientOBID=e.obid,t=!0),-1!==r&&r!==n&&(i.Recipients[s.OBID][r].IsHighlighted=!1),this.isCopied=!1}})}),super.next(this.data),t}getMatrixClassDefUID(){return this.matrixDataService.getMatrixClassDefUID(this.matrixOBID)}hasDuplicates(e){let t=!1;const i=[];return this.data.forEach(s=>{let a="";e.forEach(e=>{a+=s[e.field]}),s.FullString=a,i[a]?(t=!0,this.data.map(e=>{e.FullString===a&&(e.isValid="false")})):(i[a]=!0,this.data.map(e=>{e.FullString===a&&(e.isValid="true")}))}),t}addNewOrDuplicateRowsToModifiedData(e){this.matrixColumnService.matrixColumns.forEach(t=>{this.itemHasChanges({dataItem:e,columnSetField:t.field})}),this.itemHasChanges({dataItem:e,columnSetField:"Recipients"})}removeDeletedRowsFromModifiedData(e){if(this.matrixColumnService.matrixColumns.forEach(t=>{if(this.modifiedData.includes(e.rowGUID+"_"+t.field)){const i=this.modifiedData.findIndex(i=>i===e.rowGUID+"_"+t.field);this.modifiedData.splice(i,1)}}),this.modifiedData.includes(e.rowGUID+"_Recipients")){const t=this.modifiedData.findIndex(t=>t===e.rowGUID+"_Recipients");this.modifiedData.splice(t,1)}}checkRecipientsHasChanged(e,t){let i=!1;if(i=this.hasRecipientsChanged(e[t.columnSetField],t.dataItem[t.columnSetField],e.OBID),t.dataItem.RecipientsUpdated=i,i)this.modifiedData.includes(e.OBID+"_Recipients")||this.modifiedData.push(e.OBID+"_Recipients");else{const t=this.modifiedData.findIndex(t=>t===e.OBID+"_Recipients");-1!==t&&this.modifiedData.splice(t,1)}return i}processRowResults(){const e=this.responseRows;for(let t=0;t<e.length;t++){const i={};this.constructRowRecipientsFromResponse(e[t].SPFDistributionMatrixRowRecipient_12,i),e[t].Recipients={},this.matrixColumnService.validReasonForReceipts.forEach(s=>{e[t].Recipients[s.OBID]=i.hasOwnProperty(s.OBID)?[...i[s.OBID]]:new Array}),this.matrixColumnService.matrixColumns.forEach(i=>{i.columnItemDetails.ScopedByInfo.IsEnum&&i.columnItemDetails.DependencyDetails&&(e[t][i.field+w.b]=i.columnItemDetails.ScopedByInfo.EnumTypeName),e[t].FullString="",e[t].isValid="true",e[t][i.field]=e[t][i.columnItemDetails.PropertyDefUID]})}}constructRowRecipientsFromResponse(e,t){if(e&&e.length>0)for(let i=0;i<e.length;i++){const s=e[i];if(!s.SPFRecipientUser_12||!s.SPFRecipientRFR_12)throw new R.a(this.MATRIX_FAILED_TO_LOAD_DATA);{const e=s.SPFRecipientRFR_12.OBID,i={RecipientObid:s.OBID,RFRObid:e,OBID:s.SPFRecipientUser_12.OBID,Name:s.SPFRecipientUser_12.Name,UID:s.SPFRecipientUser_12.UID,ClassDef:s.SPFRecipientUser_12.Class};t.hasOwnProperty(e)||(t[e]=new Array),t[e].push(i)}}}addupdatedRecipientsOfExistingRowToCRUD(e){const t=e.Recipients;this.matrixColumnService.validReasonForReceipts.forEach(i=>{t[i.OBID]&&(t[i.OBID].filter(e=>e.IsTerminated).forEach(e=>{this.listEditCRUDItems.terminatedObjects.push({OBID:e.RecipientObid,Name:""})}),t[i.OBID].filter(e=>!e.RecipientObid).forEach(t=>{t.RFRObid=i.OBID,t.RowObid=e.OBID,this.listEditCRUDItems.createdRecipientObjects.push(t)}))})}addupdatedRecipientsOfNewRowToCRUD(e){const t=e.Recipients;this.matrixColumnService.validReasonForReceipts.forEach(i=>{t[i.OBID]&&t[i.OBID].filter(e=>!e.RecipientObid).forEach(t=>{t.RFRObid=i.OBID;const s=this.listEditCRUDItems.createdrowswithrecipients.find(t=>t.key===e);t.IsTerminated||s.value.push(t)})})}addItemsToCRUD(){return this.isLoading=!0,this.listEditCRUDItems.classDefForNewRecipients="SPFMatrixRowRecipient",this.listEditCRUDItems.classDefForNewRows="SDXDocumentReviewMatrixRow",this.listEditCRUDItems.matrixOBID=this.matrixOBID,this.listEditDataService.crudItems(this.listEditCRUDItems,this.listEditColumnService.columns,!0).pipe(Object(h.a)(e=>{let t=!0;return e.forEach(e=>{e.hasErrored&&(this.exceptionService.handleException(new R.a(e.exception)),t=!1)}),Object(a.a)(t)}),Object(h.a)(e=>e?(this.notificationService.success(this.LIST_EDIT_SAVE_SUCCESSFUL),this.reset(),this.highlightedRecipientOBID=void 0,this.copiedRecipient=void 0,this.read()):Object(a.a)(!1)),Object(d.a)(1),Object(p.a)(e=>{const t=new R.a(e,this.LIST_EDIT_UNABLE_TO_SAVE_CHANGES,"MatrixService","saveChanges");return Object(o.a)(this.exceptionService.handleException(t))}))}hasRecipientsChanged(e,t,i){const s=t;return this.convertRecipientsToString(e)!==this.convertRecipientsToString(s)}convertRecipientsToString(e){const t=new Array;let i=Object.keys(e);return i=i.sort(),i.forEach(i=>{e[i]&&e[i].length>0&&(t.push(i),t.push(...e[i].filter(e=>!e.IsTerminated).map(e=>e.OBID).sort()))}),t.join(",")}getMatrixRowsForRecipients(e){if(e&&e.length){let t=0;const i=0;for(let s=0;s<e.length;s++){const i=e[s]["SPFDistributionMatrixRowRecipient_12@odata.count"];i>t&&(t=i)}return this.matrixDataService.getMatrixRows(this.matrixOBID,this.matrixColumnService.matrixColumns,this.matrixRowPageSize,this.matrixRowPageNumber,t,i)}return Object(a.a)([])}getDropDownOptionsForMatrixColumns(){return this.listEditDependentItemsService.getDropDownOptionsInBulk("*",this.matrixColumnService.matrixColumns.filter(e=>this.isMultiSelectColumn(e)))}updateDependentRelItemsForMatrixColumns(){const e=[];return this.matrixColumnService.matrixColumns.forEach(t=>{this.isMultiSelectColumn(t)&&this.responseRows.forEach(i=>{e.push(this.listEditDependentItemsService.updateDependentRelItems(t,i,void 0,[],","))})}),e.length>0?Object(c.a)(...e):Object(a.a)(void 0)}processRowResultsResolveDuplicates(){try{this.processRowResults()}catch(e){this.responseRows=[],this.exceptionService.handleException(new R.a(e,this.LIST_EDIT_FAILED_TO_READ_DATA))}return this.data=this.responseRows,this.originalData=Object(s.a)(this.responseRows),this.isLoading=!1,this.hasDuplicates(this.matrixColumnService.matrixColumns),super.next(this.responseRows),Object(a.a)(!0)}isMultiSelectColumn(e){return e.controlType===D.a.RELATIONSHIP_MULTI_QUERY||e.controlType===D.a.REL_DEF||e.controlType===D.a.RELATIONSHIP_FIND_MULTISELECT}}return e.\u0275fac=function(t){return new(t||e)(T.dc(m.a),T.dc(b.a),T.dc(B.a),T.dc(S.a),T.dc(O.a),T.dc(x.a),T.dc(I.a),T.dc(f.a),T.dc(E.a),T.dc(v.a),T.dc(C.a))},e.\u0275prov=T.Ob({token:e,factory:e.\u0275fac}),e})()},"Epp+":function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var s=i("KrX4"),a=i("J7mc"),n=i("A3La"),r=i("ONOH"),o=i("fXoL");let c=(()=>{class e{constructor(e,t,i,s){this.dataService=e,this.configService=t,this.odataService=i,this.batchChangesetService=s}getMatrixColumnSet(e){return this.dataService.get("GetMatrixColumnSet?matrixOBID='"+e+"'")}getValidRecipients(){return this.dataService.get("Objects?$filter=contains(Interfaces, 'ISPFReasonForReceipt') and\n\t\t (SDxDistributionMatrixRestrictedReasonForReceipt_21/any(x0:x0/UID eq 'SDXDocumentReviewMatrix'))&$select=OBID,Name,UID&$orderby=Name+desc")}getMatrixRowRecipientsMaxCount(e,t){return this.dataService.get(`Objects?$filter=contains(Interfaces, 'ISPFDistributionMatrixRow')and (SPFDistributionMatrixRow_21/any(x0:x0/OBID eq '${e}'))&$count=true&$top=${t}&$expand=SPFDistributionMatrixRowRecipient_12($count=true;$top=0)&$select=OBID`)}getMatrixRowsCount(e){return this.odataService.get(`Objects?$filter=contains(Interfaces, 'ISPFDistributionMatrixRow')and (SPFDistributionMatrixRow_21/any(x0:x0/OBID eq '${e}'))&$count=true&$top=0`)}getMatrixRows(e,t,i,s,a,n){const r=[];t.forEach(e=>{r.push(e.columnItemDetails.PropertyDefUID)});const o=r.join(",");return this.dataService.get(`Objects?$filter=contains(Interfaces, 'ISPFDistributionMatrixRow')and (SPFDistributionMatrixRow_21/any(x0:x0/OBID eq '${e}'))&$count=true&$top=${i}&$skip=${s*i}&$expand=SPFDistributionMatrixRowRecipient_12($count=true;$top=${a};$skip=${n*a};$select=OBID;$expand=SPFRecipientRFR_12($select=OBID,Name),SPFRecipientUser_12($select=OBID,Name,SPFLoginName,Class,UID))&$select=OBID,`+o)}copyDistributionMatrixFromCRUDObject(e,t,i,s,a,n){const r=this.batchChangesetService.getRequestContent(e,!0);return this.dataService.post("CopyDistributionMatrix",JSON.stringify({copyContent:r,SourceOBID:t,matrixRowReldef:i,matrixRowRecipientReldef:s,matrixRecipientsCopyRel:a,copyStructure:n}),this.configService.selectedCreateConfig,!0,"",void 0,!0)}getAvailablePropertiesWithSearchCriteria(e,t,i,s,a){t=s?t:t.concat("*");const n=a?a.$top:void 0,r=a?a.$skip:void 0;let o=`Objects?$filter=contains(Interfaces, 'IPropertyDef')and EDG_SPFPropertyClassDef/any(x0:x0/UID eq '${e}')and (`+i.map(e=>e+" eq '"+t+"'").join(" or ")+")&$expand=Exposes_21($select=UID,Name,DisplayName),ScopedBy_12($select=Class)&$select=OBID,UID,Name,DisplayName,Class&$count=true";return n&&(o+="&$top="+n),r&&(o+="&$skip="+r),this.odataService.get(o)}getExistingMatrixProperty(e,t){return this.dataService.get(`Objects?$filter=contains(Interfaces, 'IPropertyDef')and ${t}/any(x0:x0/OBID eq '${e}')&$top=1&$select=OBID,UID,Name,DisplayName,Class`)}getExisingColumnItem(e){return this.dataService.get(`Objects?$filter=contains(Interfaces, 'ISPFColumnItem')and SPFCIPropertyDefUID eq '${e}'&$expand=SPFColumnSetColumnItem_21($select=OBID)&$top=1&$select=OBID`)}getAvailableRelationshipsWithSearchCriteria(e,t,i,s,a,n){return this.odataService.post("GetAvailableReldefsForMatrixclassDef()",JSON.stringify({MatrixClassDefUID:e,searchText:t,filters:i,useEqualTo:s,Top:a,Skip:n}))}getMatrixClassDefUID(e){return this.dataService.get(`Objects?$filter=(OBID eq '${e}')&$top=1&$select=Class`)}}return e.\u0275fac=function(t){return new(t||e)(o.dc(a.a),o.dc(r.a),o.dc(n.a),o.dc(s.a))},e.\u0275prov=o.Ob({token:e,factory:e.\u0275fac}),e})()},oOhx:function(e,t,i){"use strict";i.d(t,"a",(function(){return S}));var s=i("LRne"),a=i("IzEk"),n=i("eIep"),r=i("lJxs"),o=i("vkgz"),c=i("WjcW"),d=i("qSfU"),l=i("k/hs"),h=i("POgZ"),p=i("Z9D8"),D=i("LUpO"),u=i("HLw3"),m=i("Ejbi"),I=i("Epp+"),R=i("fXoL");let S=(()=>{class e{constructor(e,t,i,s,a){this.listEditColumnService=e,this.matrixDataService=t,this.batchRequestFactory=i,this.sdaTranslateService=s,this.exceptionService=a,this.restrictedColumnTypes=["DateTimeType","YMDType","DoubleType","UoMListType"],this.MATRIX_COLUMN_ALREADY_EXISTS=this.sdaTranslateService.get("MATRIX_COLUMN_ALREADY_EXISTS","Matrix column already exists")}getMatrixColumns(e){return this.listEditColumnService.columnSetUID=e.ColumnSetUID,this.columnSetOBID=e.ColumnSetOBID,this.listEditColumnService.createColumnsFromColumnSet(e,!0)}loadMatrixColumns(e){return this.matrixDataService.getValidRecipients().pipe(Object(a.a)(1),Object(n.a)(t=>(this.validReasonForReceipts=t,this.matrixDataService.getMatrixColumnSet(e))),Object(n.a)(e=>this.getMatrixColumns(e)),Object(r.a)(e=>e.filter(e=>this.isnotUomAndDateType(e))),Object(o.a)(e=>{this.matrixColumns=e}))}createColumnAndMatrixProperty(e,t,i){const a=e.getData();if(a){if(a.Class&&"PropertyDef"===a.Class){const e=a;return this.restrictedColumnTypes.includes(e.ScopedBy_12.Class)?(this.exceptionService.handleException(new p.a(void 0,this.sdaTranslateService.get("UNSUPPORTED_COLUMNTYPE","Column you were trying to add is not supported"))),Object(s.a)(void 0)):this.getOrCreateColumnItem(e.OBID,e.Name,e.DisplayName,void 0,"SPFPropertyMapsTo_21",t,i)}if(a.ClassDef&&"RelDef"===a.ClassDef)return this.getOrCreateColumnItem(a.OBID,a.Name,a.DisplayAs,a.Direction,"SPFRelDefMapsTo_21",t,i)}return Object(s.a)(void 0)}removeColumnFromMatrix(e,t){return this.matrixDataService.getExisingColumnItem(e.columnItemDetails.PropertyDefUID).pipe(Object(n.a)(i=>{if(i&&1===i.length){const s=this.batchRequestFactory.createBatchRequest(),a=s.createChangeset();return a.addUnrelate(i[0].OBID,this.columnSetOBID,"SPFColumnSetColumnItem",!1,!0),t&&t.filter(e=>e.OBID).length>0&&t.filter(e=>e.OBID).forEach(t=>{const i=new c.a(void 0);i.properties.push(new d.a(e.columnItemDetails.PropertyDefUID,"*")),a.addUpdateRequest(t.OBID,i)}),s.addChangeset(a),s.execute()}return Object(s.a)(void 0)}))}isnotUomAndDateType(e){return e.columnItemDetails.ScopedByInfo&&!this.restrictedColumnTypes.includes(e.columnItemDetails.ScopedByInfo.ScopedById)&&!e.columnItemDetails.ScopedByInfo.IsUom}getOrCreateColumnItem(e,t,i,a,r,o,c){let d;return this.matrixDataService.getExistingMatrixProperty(e,r).pipe(Object(n.a)(e=>e&&e.length>0?(d=e[0],this.matrixDataService.getExisingColumnItem(d.UID)):Object(s.a)(void 0)),Object(n.a)(n=>n&&n.length>0&&n[0].SPFColumnSetColumnItem_21.some(e=>e.OBID===this.columnSetOBID)?(this.exceptionService.handleException(new p.a(this.MATRIX_COLUMN_ALREADY_EXISTS)),Object(s.a)(void 0)):this.createRequiredObjectsRequestAndReturn(n,c,d,o,i,t,e,a)))}createRequiredObjectsRequestAndReturn(e,t,i,s,a,n,r,o){const c=this.batchRequestFactory.createBatchRequest(),d=c.createChangeset(),l=c.createChangeset();if(e&&1===e.length&&i)l.addRelateRequest(e[0].OBID,this.columnSetOBID,"SPFColumnSetColumnItem",!1,void 0,String(s.columnItemDetails.OrderValue+1),void 0,new Map([["SPFColumnDisplayAs",this.getColumnDisplayName(i.DisplayName,a,i.Name)]])),c.addChangeset(l),this.updateRowObjectsAndaddTochangeset(i.Name,c,t);else if(i)this.createColumnItemAndRelatetoColumnSet(i.Name,l,s,this.getColumnDisplayName(i.DisplayName,a,i.Name)),c.addChangeset(l),this.updateRowObjectsAndaddTochangeset(i.Name,c,t);else{const e="SDXMatrix"+n,i=this.createMatrixPropertyDef(e,s,a);d.addCreateRequest(i),o?d.addRelateRequest(0,r,"SPFRelDefMapsTo",!1,void 0,void 0,void 0,new Map([["SPFMapDirection","+"===o?"e1Dir21":"e1Dir12"]])):d.addRelateRequest(0,r,"SPFPropertyMapsTo",!1,void 0,void 0,void 0,void 0),this.createColumnItemAndRelatetoColumnSet(e,l,s,this.getColumnDisplayName(a,a,e)),c.addChangeset(d),c.addChangeset(l),this.updateRowObjectsAndaddTochangeset(e,c,t)}return c.execute()}getColumnDisplayName(e,t,i){return this.matrixColumns.some(i=>i.title===e||i.title===t)?i:e||t||i}updateRowObjectsAndaddTochangeset(e,t,i){if(i&&i.filter(e=>e.OBID).length>0){const s=t.createChangeset();i.filter(e=>e.OBID).forEach(t=>{const i=new c.a(void 0);i.properties.push(new d.a(e,"*")),s.addUpdateRequest(t.OBID,i)}),t.addChangeset(s)}}createColumnItemAndRelatetoColumnSet(e,t,i,s){const a=this.createMatrixColumnItem(e);t.addCreateRequest(a),t.addRelateRequest(0,this.columnSetOBID,"SPFColumnSetColumnItem",!1,void 0,String(i.columnItemDetails.OrderValue+1),void 0,new Map([["SPFColumnDisplayAs",s]]))}createMatrixColumnItem(e){const t=new c.a("SPFColumnItem");return t.properties.push(new d.a("Name",e),new d.a("SPFCIPropertyDefUID",e)),t}createMatrixPropertyDef(e,t,i){const s=new c.a("PropertyDef");return s.properties.push(new d.a("Name",e),new d.a("UID",e),new d.a("DisplayName",i)),s.relationships.push(new l.a("ScopedBy",!0,[t.columnItemDetails.ScopedByOBID]),new l.a("Exposes",!1,[t.columnItemDetails.ExposingInterfaceDefOBID])),s}}return e.\u0275fac=function(t){return new(t||e)(R.dc(h.a),R.dc(I.a),R.dc(u.a),R.dc(m.a),R.dc(D.a))},e.\u0275prov=R.Ob({token:e,factory:e.\u0275fac}),e})()}}]);