(window.webpackJsonp=window.webpackJsonp||[]).push([[90],{"4rwV":function(e,t,i){"use strict";i.r(t),i.d(t,"ReviseObjRoutingModule",(function(){return re}));var s=i("ofXK"),a=i("vZO+"),n=i("uD/B"),o=i("noLC"),r=i("RNI4"),c=i("z+VC"),l=i("inpI"),d=i("F+hv"),h=i("83Gb"),f=i("0Ndu"),p=i("tyNb"),u=i("5iMO"),b=i("quZr"),v=i("itXk"),E=i("LRne"),S=i("IzEk"),g=i("eIep"),O=i("lJxs"),m=i("JIr8"),R=i("YwUS"),T=i("8RLy"),w=i("11V9"),_=i("UVhF"),F=i("S2CU"),I=i("Z9D8"),y=i("LUpO"),A=i("C4gn"),C=i("xc+7"),M=i("349d"),j=i("Z2of"),P=i("zHoD"),x=i("osZK"),N=i("c+03"),D=i("jNCI"),L=i("Qi+w"),U=i("wpY2"),V=i("Ejbi"),X=i("+eYH"),k=i("NEWU"),B=i("41Lq"),K=i("biIz"),W=i("Qhnh"),z=i("sL0b"),G=i("fXoL"),H=i("TLn4"),Y=i("pEK1"),Q=i("ouxa"),J=i("qx4N"),Z=i("niUd"),q=i("ME6W"),$=i("6sHd"),ee=i("tqjF");function te(e,t){if(1&e&&G.Tb(0,"sda-loading-indicator",2),2&e){const e=G.lc();G.sc("centered",!0)("message",e.LOADING_FORM_PLEASE_WAIT)}}function ie(e,t){if(1&e){const e=G.Zb();G.Yb(0,"uxt-checkbox",14),G.hc("isActiveChange",(function(t){return G.Kc(e),G.lc(2).copyMarkUps=t})),G.Xb()}if(2&e){const e=G.lc(2);G.sc("isActive",e.copyMarkUps)("isDisabled",0===e.filesToCopy.length)("text",e.REVISE_COPY_MARKUPS)}}function se(e,t){if(1&e){const e=G.Zb();G.Yb(0,"sda-attached-files",15),G.hc("selectedFiles",(function(t){return G.Kc(e),G.lc(2).selectedAttachedFiles(t)}))("filesExists",(function(t){return G.Kc(e),G.lc(2).filesExists(t)})),G.Xb()}if(2&e){const e=G.lc(2);G.sc("objects",e.selectedObjects)("restrictedExtensionUIDs",e.restrictedFileTypeExtensions)("columnSet",e.existingFilesColumnSet)("allowToSelect",e.allowToSelectAttachedFiles)("showHiddenFiles",!e.showHiddenFiles)("getAllAttachedFiles","true")}}function ae(e,t){if(1&e){const e=G.Zb();G.Yb(0,"div",3),G.Yb(1,"uxt-wizard",4,5),G.hc("finish",(function(){return G.Kc(e),G.lc().reviseAndValidate()}))("cancel",(function(){return G.Kc(e),G.lc().cancelWizard()}))("stepChange",(function(t){return G.Kc(e),G.lc().stepChange(t)})),G.Yb(3,"uxt-wizard-step",6),G.Tb(4,"sda-form-controls",7),G.Xb(),G.Yb(5,"uxt-wizard-step",8),G.Yb(6,"sda-card-view"),G.Yb(7,"div",9),G.Yb(8,"sda-file-upload",10),G.hc("filesSelected",(function(t){return G.Kc(e),G.lc().notifyFilesUploaded(t)}))("filesPendingForUpload",(function(t){return G.Kc(e),G.lc().notifyFilesPendingForUpload(t)})),G.Xb(),G.Xb(),G.Yb(9,"div",11),G.Sc(10,ie,1,3,"uxt-checkbox",12),G.Sc(11,se,1,6,"sda-attached-files",13),G.Xb(),G.Xb(),G.Xb(),G.Xb(),G.Xb()}if(2&e){const e=G.lc();G.Eb(1),G.sc("finishText",e.REVISE)("applyText",e.APPLY_TEXT)("cancelText",e.CANCEL_TEXT)("stepTranslation",e.STEP_TEXT)("ofTranslation",e.OF_TEXT)("isApplyVisible",!1)("isApplyEnabled",!1)("isFinishEnabled",e.isEnableRevise)("step",e.stepName),G.Eb(2),G.sc("stepId",e.formStep)("isMandatory",!0),G.Eb(1),G.sc("form",e.form),G.Eb(1),G.sc("stepId",e.reviseObjStep),G.Eb(3),G.sc("objects",e.selectedObjects)("uploadMode",e.uploadMode)("displayCloseButton",!1)("displayRemoveButton",!0),G.Eb(2),G.sc("ngIf",e.copyFilesArg&&e.filesAvailable),G.Eb(1),G.sc("ngIf",e.copyFilesArg)}}const ne=[{path:"",component:(()=>{class e extends F.a{constructor(e,t,i,s,a,n,o,r,c,l,d,h,f,p,u,b,E){super(p,E,u,b),this.route=e,this.formService=t,this.exceptionService=i,this.applicationSettingsService=s,this.formValidationService=a,this.modalService=n,this.loadingOverlayService=o,this.notificationService=r,this.pinsMenuService=c,this.todoListService=l,this.reviseObjService=d,this.fileUploaderService=h,this.referenceFileHandlingService=f,this.featureSetService=p,this.sdaTranslateService=u,this.saveChangesDialogService=b,this.featureSetNavigationService=E,this.formStep="formStep",this.reviseObjStep="reviseObjStep",this.stepName=this.formStep,this.initialized=!1,this.allowToSelectAttachedFiles=!0,this.isEnableRevise=!0,this.filesAvailable=!0,this.existingFilesColumnSet="CS_CopyToLocalColumnSet",this.workFlowUID="",this.copyMarkUps=!0,this.uploadMode=P.a.None,this.filesToCopy=[],this.restrictedFileTypeExtensions=[],this.REVISE_COPY_MARKUPS=this.sdaTranslateService.get("REVISE_COPY_MARKUPS","Copy Markups"),this.REVISE=this.sdaTranslateService.get("REVISE","Revise"),this.REVISE_OBJ_SUCCESS=this.sdaTranslateService.get("REVISE_OBJ_SUCCESS","Object successfully revised"),this.REVISE_OBJ_ERROR=this.sdaTranslateService.get("REVISE_OBJ_ERROR","Unable to revise the object"),this.ERROR_UPLOADING_FILE=this.sdaTranslateService.get("ERROR_UPLOADING_FILE","Error occurred while uploading file"),this.ACTION_NOT_SUPPORTED=this.sdaTranslateService.get("ACTION_NOT_SUPPORTED","This action is not supported"),this.WORKFLOW_ATTACHED_MESSAGE=this.sdaTranslateService.get("WORKFLOW_ATTACHED_MESSAGE","Object automatically attached to the workflow"),this.REVISE_FORM_ERROR=this.sdaTranslateService.get("REVISE_FORM_ERROR","An error occurred getting revise form"),this.REVISE_GET_NEXT_MAJOR=this.sdaTranslateService.get("REVISE_GET_NEXT_MAJOR","Next Major"),this.REVISE_GET_NEXT_MINOR=this.sdaTranslateService.get("REVISE_GET_NEXT_MINOR","Next Minor"),this.LOADING_FORM_PLEASE_WAIT=this.sdaTranslateService.get("LOADING_FORM_PLEASE_WAIT","Loading form, please wait..."),this.UPDATE_REFERENCES_EXCEPTION=this.sdaTranslateService.get("UPDATE_REFERENCES_EXCEPTION","Error occurred during update references relationships: {0}"),this.REVISE_SAME_FILE_NAME=this.sdaTranslateService.get("REVISE_SAME_FILE_NAME","Files with same name cannot be attached to the same revision"),this.filesToUpload=[],this.allFiles=[],Object(v.a)(this.route.paramMap,this.route.data).subscribe(([e,t])=>{if(this.selectedObjects=t[k.z],this.selectedObjects&&1===this.selectedObjects.length){if(this.objectOBID=this.selectedObjects[0].obid,this.objectConfig=this.selectedObjects[0].config,this.methodOBID=e.get(k.y),this.copyFilesArg=e.get(k.k)&&"true"===e.get(k.k).toLowerCase(),this.showHiddenFiles=e.get(k.l)&&"true"===e.get(k.l).toLowerCase(),this.workFlowUID=e.get(k.q),this.getNextMajor=e.get(k.d)&&"true"===e.get(k.d).toLowerCase(),this.refNotFoundAction=e.get(k.m),this.updateReferences=e.get(k.r)&&"true"===e.get(k.r).toLowerCase(),e.has(k.g)&&(this.restrictedFileTypeExtensions=e.get(k.g).split(",").map(e=>e.trim())),e.has(k.m)&&e.get(k.m)){const t=e.get(k.m).split("~");this.fileUploaderService.fileClass=t[0]}this.selectedObjects[0].name?this.applicationSettingsService.setPageTitle(this.sdaTranslateService.getFormatted("REVISE_ITEM_NAME","Revise {0}",[this.selectedObjects[0].name])):(this.exceptionService.handleException(new I.a(this.ACTION_NOT_SUPPORTED,void 0,"revise-obj.component")),this.cancelWizard(!0))}})}ngOnInit(){1===this.selectedObjects.length&&this.formService.getReviseForm(this.objectOBID,this.methodOBID).subscribe(e=>{this.form=e,this.form.FormPurpose=T.a.Revise,this.form=this.reviseObjService.getMajorMinorDisplayItems(this.form,this.getNextMajor),this.initialized=!0},e=>{this.loadingOverlayService.hideLoadingOverlay(),this.cancelWizard(!0),this.exceptionService.handleException(new I.a(e,this.REVISE_FORM_ERROR,"revise-obj.component","ngOnInit"))})}notifyFilesUploaded(e){this.filesToUpload=e}notifyFilesPendingForUpload(e){this.isEnableRevise=!e}selectedAttachedFiles(e){0===e.length&&(this.copyMarkUps=!1),this.filesToCopy=e}stepChange(e){const t=this.formValidationService.isFormValid(this.form);t.length>0?this.modalService.multiMessageAlert(t):this.stepName=e}filesExists(e){this.filesAvailable=e}reviseAndValidate(){const e=this.formValidationService.isFormValid(this.form);e.length?this.modalService.multiMessageAlert(e):(this.loadingOverlayService.showLoadingOverlay(),!0===this.validateForDuplicateFiles()?(this.loadingOverlayService.hideLoadingOverlay(),this.exceptionService.handleException(new I.a(this.REVISE_SAME_FILE_NAME))):this.filesToUpload.length>0||this.filesToCopy.length>0?this.resolveReferencesAndRevise().pipe(Object(S.a)(1)).subscribe():this.reviseDocument().subscribe())}resolveReferencesAndRevise(){this.allFiles=[],this.allFiles.push(...this.filesToUpload);const e=[];return this.filesToCopy.forEach(t=>{const i=new j.a("","",{name:t.name},void 0,P.a.None,{inLineVirusScanIsAvailable:!0,inlineCSVFileValidationAvailable:!1});this.allFiles.push(i),e.push(t.obid)}),this.loadingOverlayService.showLoadingOverlay(),this.referenceFileHandlingService.resolveReferencesAndShowDuplicates(this.filesToUpload,this.refNotFoundAction,void 0,!1,e,this.allFiles).pipe(Object(g.a)(e=>e?(this.loadingOverlayService.hideLoadingOverlay(),this.reviseDocument()):(this.loadingOverlayService.hideLoadingOverlay(),Object(E.a)(!1))))}reviseDocument(){this.loadingOverlayService.showLoadingOverlay();const e=new W.a;return e.copyFiles=this.filesToCopy.map(e=>e.obid),e.copyMarkUps=this.copyMarkUps,e.formContent=this.formService.getReviseObjectFromForm(this.form,void 0,void 0),e.methodOBID=this.methodOBID,e.objectOBID=this.objectOBID,e.newFiles=[],this.filesToUpload.forEach(t=>{const i=new M.a;i.ClientFilePath=t.file.path+t.file.name,i.UploadID=t.uploadID,e.newFiles.push(i)}),e.resolvedRefFileDetails=this.getResolvedRefFileDetails(),this.reviseObjService.reviseDocument(e,this.objectConfig).pipe(Object(S.a)(1),Object(O.a)(e=>(this.loadingOverlayService.hideLoadingOverlay(),this.pinsMenuService.addToNewItems(new X.a(e.OBID,e.Name,e.Config)),this.notificationService.success(this.REVISE_OBJ_SUCCESS),this.cancelWizard(!0),this.workFlowUID&&this.attachWorkflow(e.OBID,this.workFlowUID),e)),Object(g.a)(e=>this.updateReferences?this.referenceFileHandlingService.navigateToActionMethod([e.NewDocVersionOBID],"MTH_UpdateReferences",e.Config,this.UPDATE_REFERENCES_EXCEPTION):Object(E.a)(void 0)),Object(m.a)(e=>{const t=this.REVISE_OBJ_ERROR+": "+e.message;return this.loadingOverlayService.hideLoadingOverlay(),this.exceptionService.handleException(new I.a(t,void 0,"revise-obj.component","reviseAndValidate")),Object(E.a)(!1)}))}getResolvedRefFileDetails(){return this.allFiles.map(e=>({Name:e.file.name,NewReferenceRelations:e.referenceFilesInfo.newReferenceFiles,ResolvedDuplicateReferenceOBIDs:e.referenceFilesInfo.resolvedDuplicateReferenceOBIDs}))}validateForDuplicateFiles(){let e=-1;if(this.filesToUpload.length>0&&this.filesToCopy.length>0){const t=this.filesToCopy.map(e=>e.name);e=this.filesToUpload.findIndex(e=>t.indexOf(e.file.name)>-1)}return e>-1}attachWorkflow(e,t){this.todoListService.attachWorkflow(e,t).subscribe(()=>{this.notificationService.success(this.WORKFLOW_ATTACHED_MESSAGE)},e=>{e.message=this.sdaTranslateService.getFormatted("REVISE_OBJ_WORKFLOW_ATTACH_ERROR","Object successfully revised, but failed to be attached to the workflow. Error thrown during attach: {0}",[e.message]),this.exceptionService.handleException(new I.a(e,this.REVISE_OBJ_ERROR,"revise-obj.component","attachWorkflow"))})}}return e.\u0275fac=function(t){return new(t||e)(G.Sb(p.a),G.Sb(_.a),G.Sb(y.a),G.Sb(R.a),G.Sb(w.a),G.Sb(D.a),G.Sb(N.a),G.Sb(B.a),G.Sb(L.a),G.Sb(K.a),G.Sb(z.a),G.Sb(x.a),G.Sb(c.a),G.Sb(C.a),G.Sb(V.a),G.Sb(U.a),G.Sb(A.a))},e.\u0275cmp=G.Mb({type:e,selectors:[["sda-revise-obj-view"]],features:[G.Bb],decls:2,vars:2,consts:[["class","wc-background",3,"centered","message",4,"ngIf"],["class","form-wrapper",4,"ngIf"],[1,"wc-background",3,"centered","message"],[1,"form-wrapper"],[1,"sd-wizard-basics-wizard",3,"finishText","applyText","cancelText","stepTranslation","ofTranslation","isApplyVisible","isApplyEnabled","isFinishEnabled","step","finish","cancel","stepChange"],["uxtWizard",""],[3,"stepId","isMandatory"],[3,"form"],[3,"stepId"],[1,"sda-card-header"],[3,"objects","uploadMode","displayCloseButton","displayRemoveButton","filesSelected","filesPendingForUpload"],[1,"sda-card-body"],[3,"isActive","isDisabled","text","isActiveChange",4,"ngIf"],[3,"objects","restrictedExtensionUIDs","columnSet","allowToSelect","showHiddenFiles","getAllAttachedFiles","selectedFiles","filesExists",4,"ngIf"],[3,"isActive","isDisabled","text","isActiveChange"],[3,"objects","restrictedExtensionUIDs","columnSet","allowToSelect","showHiddenFiles","getAllAttachedFiles","selectedFiles","filesExists"]],template:function(e,t){1&e&&(G.Sc(0,te,1,2,"sda-loading-indicator",0),G.Sc(1,ae,12,19,"div",1)),2&e&&(G.sc("ngIf",!t.initialized),G.Eb(1),G.sc("ngIf",t.initialized))},directives:[s.t,H.a,Y.a,Q.a,J.a,Z.a,q.a,$.a,ee.a],styles:["[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%], [_nghost-%COMP%]   .form-wrapper[_ngcontent-%COMP%]{display:flex;width:100%;height:100%}[_nghost-%COMP%]   .form-wrapper[_ngcontent-%COMP%]{flex-direction:column;align-items:center;background-color:#cad0d7}[_nghost-%COMP%]   sda-loading-indicator[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]     sda-tabbed-grid{position:relative;padding:7px}","[_nghost-%COMP%]   sda-card-view[_ngcontent-%COMP%]{overflow-x:hidden;overflow-y:auto}[_nghost-%COMP%]   sda-card-view[_ngcontent-%COMP%]   uxt-checkbox[_ngcontent-%COMP%]{max-width:1300px;height:auto;margin:10px auto 0}[_nghost-%COMP%]   sda-card-view[_ngcontent-%COMP%]     .card{margin:0;padding:0;border:none}"]}),e})(),resolve:{objects:u.a},canDeactivate:[b.a]}];let oe=(()=>{class e{}return e.\u0275mod=G.Qb({type:e}),e.\u0275inj=G.Pb({factory:function(t){return new(t||e)},imports:[[p.k.forChild(ne)],p.k]}),e})(),re=(()=>{class e{}return e.\u0275mod=G.Qb({type:e}),e.\u0275inj=G.Pb({factory:function(t){return new(t||e)},providers:[c.a,z.a],imports:[[oe,s.c,d.a,f.a,n.a,a.a,l.a,h.a,o.a,r.a]]}),e})()},"7CaW":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var s=i("fXoL"),a=i("ofXK"),n=i("7zfz");i("R0Ic");let o=(()=>{let e=class{};return e.\u0275mod=s.Qb({type:e}),e.\u0275inj=s.Pb({factory:function(t){return new(t||e)},imports:[[a.c],n.e]}),e})()},"9X43":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var s=i("WG3B"),a=i("fXoL");let n=(()=>{class e{}return e.\u0275mod=a.Qb({type:e}),e.\u0275inj=a.Pb({factory:function(t){return new(t||e)},imports:[[s.o]]}),e})()},"HPu/":function(e,t,i){"use strict";i.d(t,"a",(function(){return g}));var s=i("ofXK"),a=i("3Pt+"),n=i("bTqV"),o=i("bSwM"),r=i("NFeN"),c=i("STbY"),l=i("Qu3c"),d=i("8yBR"),h=i("BMkO"),f=i("l3mi"),p=i("mQCr"),u=i("wA8e"),b=i("2wiT"),v=i("mZKE"),E=i("VL22"),S=i("fXoL");let g=(()=>{class e{}return e.\u0275mod=S.Qb({type:e}),e.\u0275inj=S.Pb({factory:function(t){return new(t||e)},providers:[E.a,v.a],imports:[[o.b,d.e,o.b,s.c,a.j,b.a,n.b,u.a,p.a,f.a,r.b,h.a,c.c,l.b]]}),e})()},VoKn:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var s=i("l3mi"),a=i("fXoL");let n=(()=>{class e{}return e.\u0275mod=a.Qb({type:e}),e.\u0275inj=a.Pb({factory:function(t){return new(t||e)},imports:[[s.a]]}),e})()},dNA2:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var s=i("Qu3c"),a=i("l3mi"),n=i("fXoL");let o=(()=>{class e{}return e.\u0275mod=n.Qb({type:e}),e.\u0275inj=n.Pb({factory:function(t){return new(t||e)},imports:[[a.a,s.b]]}),e})()},mZKE:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var s=i("fXoL");let a=(()=>{class e{convertFlatListToTree(e){const t={},i=[];let s,a;for(s=0;s<e.length;s+=1)t[e[s].OBID]=s,e[s].Children=[];for(s=0;s<e.length;s+=1)a=e[s],a.parentNodeObid&&void 0!==t[a.parentNodeObid]&&e[t[a.parentNodeObid]]?e[t[a.parentNodeObid]].Children.push(a):i.push(a);return i}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=s.Ob({token:e,factory:e.\u0275fac}),e})()},uJvP:function(e,t,i){"use strict";i.d(t,"a",(function(){return j}));var s=i("rDax"),a=i("+rOU"),n=i("ofXK"),o=i("3Pt+"),r=i("bSwM"),c=i("NFeN"),l=i("qFsG"),d=i("wZkO"),h=i("Qu3c"),f=i("WG3B"),p=i("7CaW"),u=i("BMkO"),b=i("9Abt"),v=i("l3mi"),E=i("ILbM"),S=i("0GHy"),g=i("VtiV"),O=i("F+hv"),m=i("wA8e"),R=i("MX5F"),T=i("GDd0"),w=i("2wiT"),_=i("HPu/"),F=i("dNA2"),I=i("fXoL");let y=(()=>{class e{}return e.\u0275mod=I.Qb({type:e}),e.\u0275inj=I.Pb({factory:function(t){return new(t||e)},imports:[[n.c,f.o]]}),e})();var A=i("9X43"),C=i("VoKn");let M=(()=>{class e{}return e.\u0275mod=I.Qb({type:e}),e.\u0275inj=I.Pb({factory:function(t){return new(t||e)},imports:[[v.a,c.b,l.b,h.b,r.b,n.c,o.j,f.o,O.a,S.a,m.a,R.a,g.a,A.a,u.a,C.a,F.a,y]]}),e})(),j=(()=>{class e{}return e.\u0275mod=I.Qb({type:e}),e.\u0275inj=I.Pb({factory:function(t){return new(t||e)},imports:[[b.a,v.a,d.e,c.b,l.b,h.b,r.b,n.c,o.j,O.a,f.o,p.a,S.a,T.a,a.g,s.f,m.a,w.a,R.a,_.a,E.a,g.a,A.a,u.a,C.a,F.a,M,y]]}),e})()},wA8e:function(e,t,i){"use strict";i.d(t,"a",(function(){return f}));var s=i("ofXK"),a=i("NFeN"),n=i("qFsG"),o=i("STbY"),r=i("d3UM"),c=i("Qu3c"),l=i("l3mi"),d=i("2wiT"),h=i("fXoL");let f=(()=>{class e{}return e.\u0275mod=h.Qb({type:e}),e.\u0275inj=h.Pb({factory:function(t){return new(t||e)},imports:[[s.c,d.a,r.b,o.c,a.b,l.a,n.b,c.b]]}),e})()}}]);