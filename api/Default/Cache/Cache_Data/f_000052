(window.webpackJsonp=window.webpackJsonp||[]).push([[34,122],{"+ZXO":function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i("JxDP"),a=i("Khlq");t.SnapshotBase=class extends n.MCDViewCommand{constructor(){super(!1,!0),this.createSnapshot=this.createSnapshot.bind(this),this.snapshotCallback=this.snapshotCallback.bind(this),this.addEvent(a.MCD_ENUM.CallbackEventNames.SNAPSHOT_EVENT,this.snapshotCallback)}createSnapshot(e,t,i){this._modularCoreDisplay=e,this._eventManager=t,this._snapshotAvailable=i.bind(this)}snapshotCallback(e){return s(this,void 0,void 0,(function*(){let t;t="string"==typeof e?JSON.parse(e):e;const i=yield this._modularCoreDisplay.get("CameraState",""),s=JSON.parse(i);t.camera=s,this._snapshotAvailable(t)}))}start(){const e=super.start();return this._modularCoreDisplay.snapshotCore('{"target":"foreground"}'),e}}},"+bLt":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var s=i("Xfrm");class n{constructor(e,t){this.router=e,this.featureSetNavigationService=t,this.onExecuteMethod=(e,t)=>{this.args=t,this.onExecute(e)}}navigateToActionRoute(e,t,i){if(this.args&&this.args.openInNewTab){const n=this.router.createUrlTree(t,i),a=this.router.serializeUrl(n),o=new s.a(e.name,a);this.featureSetNavigationService.navigateViaRoute(e,o,!0,!1)}else e.showInRelativeRoute&&(t[0]=t[0].replace("/",""),i=Object.assign(Object.assign({},i),this.args.extras)),this.router.navigate(t,i)}}},"+kco":function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i("Khlq"),a=i("hvII");t.FlyToMotion=class{constructor(e,t,i){this._cameraSpeed=.5,this._mcd=e,this.motionStartedEvent=t,this.motionEndedEvent=i,this._cameraJig=new a.CameraJig(this._mcd),this._type=n.MCD_ENUM.MotionTypes.FLYTO_MOTION,this.flyToStarting=this.flyToStarting.bind(this),this.flyToCompleted=this.flyToCompleted.bind(this),this._cameraJig.addFlyToEventListener(n.MCD_ENUM.FlyToEventNames.FLYTO_START_EVENT,this.flyToStarting),this._cameraJig.addFlyToEventListener(n.MCD_ENUM.FlyToEventNames.FLYTO_END_EVENT,this.flyToCompleted)}get cameraJig(){return this._cameraJig}set cameraMotionStartedEvent(e){this.motionStartedEvent=e}set cameraMotionEndedEvent(e){this.motionEndedEvent=e}set undoRedoEvent(e){this.undoRedoEventCallback=e}moveTo(e="",t=!0){return s(this,void 0,void 0,(function*(){""===e&&(e=yield this._mcd.get("CameraState",""),this._mcd.commitCameraChanges(n.MCD_ENUM.CommitAction.CT_Abandon)),this._saveState=t;const i=yield this._mcd.get("CameraState","");return this._cameraJig.flyTo(i,e,this._cameraSpeed),""}))}flyToStarting(){void 0!==this.motionStartedEvent&&this.motionStartedEvent()}flyToCompleted(){return s(this,void 0,void 0,(function*(){this.undoRedoEventCallback&&this._saveState&&(yield this.undoRedoEventCallback(n.MCD_ENUM.GestureEventNames.GESTURE_NONE)),void 0!==this.motionEndedEvent&&(yield this.motionEndedEvent())}))}canSaveState(){return this._saveState}onCameraChange(){this._cameraJig&&this._cameraJig.flyToPending&&this._cameraJig.doFlyToAnimation()}onGesture(e){this._cameraJig&&this._cameraJig.flyToPending&&e!==n.MCD_ENUM.GestureEventNames.GESTURE_MOUSE_MOVE&&(this._cameraJig.flyToPending=!1)}setCameraSpeed(e){this._cameraSpeed=e}getCameraSpeed(){return this._cameraSpeed}}},"2T81":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Point=class{constructor(){}},t.Line=class{constructor(){}},t.Vec2=class{constructor(e,t){this.x=e,this.y=t}};class s{constructor(e,t,i){this.x=e,this.y=t,this.z=i}}t.Vec3=s;class n{constructor(e,t,i,s){this.x=e,this.y=t,this.z=i,this.a=s}}t.Vec4=n;class a{constructor(e,t,i,s){this.x=e,this.y=t,this.z=i,this.w=s}}t.Quat=a;class o{constructor(e,t,i,s,n,a,o,r,l,h,c,_,d,m,u,p){this.m00=e,this.m01=t,this.m02=i,this.m03=s,this.m10=n,this.m11=a,this.m12=o,this.m13=r,this.m20=l,this.m21=h,this.m22=c,this.m23=_,this.m30=d,this.m31=m,this.m32=u,this.m33=p}}t.Mat4=o;class r{constructor(e,t,i,s,n,a,o,r,l){this.m00=e,this.m01=t,this.m02=i,this.m10=s,this.m11=n,this.m12=a,this.m20=o,this.m21=r,this.m22=l}}t.Mat3=r,t.GlMath=class{constructor(){}sub(e,t){return new s(e.x-t.x,e.y-t.y,e.z-t.z)}add(e,t){return new s(e.x+t.x,e.y+t.y,e.z+t.z)}mul(e,t){return new s(e.x*t,e.y*t,e.z*t)}distance(e,t){const i=t.x-e.x,s=t.y-e.y,n=t.z-e.z;return Math.sqrt(i*i+s*s+n*n)}dot(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}cross(e,t){return new s(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x)}magnitude(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)}normalize(e){const t=this.magnitude(e);return 0!==t?new s(e.x/t,e.y/t,e.z/t):new s(0,0,0)}clamp(e,t,i){return e<t?t:e>i?i:e}pitch(e){return Math.atan2(2*(e.y*e.z+e.w*e.x),e.w*e.w-e.x*e.x-e.y*e.y+e.z*e.z)}yaw(e){return Math.asin(this.clamp(-2*(e.x*e.z-e.w*e.y),-1,1))}roll(e){return Math.atan2(2*(e.x*e.y+e.w*e.z),e.w*e.w+e.x*e.x-e.y*e.y-e.z*e.z)}eulerAngles(e){return new s(this.pitch(e),this.yaw(e),this.roll(e))}QuatFromAngles(e,t,i){const s=Math.cos(.5*t),n=Math.sin(.5*t),o=Math.cos(.5*i),r=Math.sin(.5*i),l=Math.cos(.5*e),h=Math.sin(.5*e);return new a(o*h*s-r*l*n,o*l*n+r*h*s,r*l*s-o*h*n,o*l*s+r*h*n)}multMat4(e,t){return new o(e.m00*t.m00+e.m10*t.m01+e.m20*t.m02+e.m30*t.m03,e.m01*t.m00+e.m11*t.m01+e.m21*t.m02+e.m31*t.m03,e.m02*t.m00+e.m12*t.m01+e.m22*t.m02+e.m32*t.m03,e.m03*t.m00+e.m13*t.m01+e.m23*t.m02+e.m33*t.m03,e.m00*t.m10+e.m10*t.m11+e.m20*t.m12+e.m30*t.m13,e.m01*t.m10+e.m11*t.m11+e.m21*t.m12+e.m31*t.m13,e.m02*t.m10+e.m12*t.m11+e.m22*t.m12+e.m32*t.m13,e.m03*t.m10+e.m13*t.m11+e.m23*t.m12+e.m33*t.m13,e.m00*t.m20+e.m10*t.m21+e.m20*t.m22+e.m30*t.m23,e.m01*t.m20+e.m11*t.m21+e.m21*t.m22+e.m31*t.m23,e.m02*t.m20+e.m12*t.m21+e.m22*t.m22+e.m32*t.m23,e.m03*t.m20+e.m13*t.m21+e.m23*t.m22+e.m33*t.m23,e.m00*t.m30+e.m10*t.m31+e.m20*t.m32+e.m30*t.m33,e.m01*t.m30+e.m11*t.m31+e.m21*t.m32+e.m31*t.m33,e.m02*t.m30+e.m12*t.m31+e.m22*t.m32+e.m32*t.m33,e.m03*t.m30+e.m13*t.m31+e.m23*t.m32+e.m33*t.m33)}multMat4Quat(e,t){return new a(e.m00*t.x+e.m10*t.y+e.m20*t.z+e.m30*t.w,e.m01*t.x+e.m11*t.y+e.m21*t.z+e.m31*t.w,e.m02*t.x+e.m12*t.y+e.m22*t.z+e.m32*t.w,e.m03*t.x+e.m13*t.y+e.m23*t.z+e.m33*t.w)}multMat3Vec3(e,t){return new s(e.m00*t.x+e.m10*t.y+e.m20*t.z,e.m01*t.x+e.m11*t.y+e.m21*t.z,e.m02*t.x+e.m12*t.y+e.m22*t.z)}multMat4Vec4(e,t){return new n(e.m00*t.x+e.m10*t.y+e.m20*t.z+e.m30*t.a,e.m01*t.x+e.m11*t.y+e.m21*t.z+e.m31*t.a,e.m02*t.x+e.m12*t.y+e.m22*t.z+e.m32*t.a,e.m03*t.x+e.m13*t.y+e.m23*t.z+e.m33*t.a)}transposeMat3(e){const t=new r(0,0,0,0,0,0,0,0,0);return t.m00=e.m00,t.m01=e.m10,t.m02=e.m20,t.m10=e.m01,t.m11=e.m11,t.m12=e.m21,t.m20=e.m02,t.m21=e.m12,t.m22=e.m22,t}inverseMat4(e){const t=new o(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);t.m00=e.m11*e.m22*e.m33-e.m11*e.m23*e.m32-e.m21*e.m12*e.m33+e.m21*e.m13*e.m32+e.m31*e.m12*e.m23-e.m31*e.m13*e.m22,t.m10=-e.m10*e.m22*e.m33+e.m10*e.m23*e.m32+e.m20*e.m12*e.m33-e.m20*e.m13*e.m32-e.m30*e.m12*e.m23+e.m30*e.m13*e.m22,t.m20=e.m10*e.m21*e.m33-e.m10*e.m23*e.m31-e.m20*e.m11*e.m33+e.m20*e.m13*e.m31+e.m30*e.m11*e.m23-e.m30*e.m13*e.m21,t.m30=-e.m10*e.m21*e.m32+e.m10*e.m22*e.m31+e.m20*e.m11*e.m32-e.m20*e.m12*e.m31-e.m30*e.m11*e.m22+e.m30*e.m12*e.m21,t.m01=-e.m01*e.m22*e.m33+e.m01*e.m23*e.m32+e.m21*e.m02*e.m33-e.m21*e.m03*e.m32-e.m31*e.m02*e.m23+e.m31*e.m03*e.m22,t.m11=e.m00*e.m22*e.m33-e.m00*e.m23*e.m32-e.m20*e.m02*e.m33+e.m20*e.m03*e.m32+e.m30*e.m02*e.m23-e.m30*e.m03*e.m22,t.m21=-e.m00*e.m21*e.m33+e.m00*e.m23*e.m31+e.m20*e.m01*e.m33-e.m20*e.m03*e.m31-e.m30*e.m01*e.m23+e.m30*e.m03*e.m21,t.m31=e.m00*e.m21*e.m32-e.m00*e.m22*e.m31-e.m20*e.m01*e.m32+e.m20*e.m02*e.m31+e.m30*e.m01*e.m22-e.m30*e.m02*e.m21,t.m02=e.m01*e.m12*e.m33-e.m01*e.m13*e.m32-e.m11*e.m02*e.m33+e.m11*e.m03*e.m32+e.m31*e.m02*e.m13-e.m31*e.m03*e.m12,t.m12=-e.m00*e.m12*e.m33+e.m00*e.m13*e.m32+e.m10*e.m02*e.m33-e.m10*e.m03*e.m32-e.m30*e.m02*e.m13+e.m30*e.m03*e.m12,t.m22=e.m00*e.m11*e.m33-e.m00*e.m13*e.m31-e.m10*e.m01*e.m33+e.m10*e.m03*e.m31+e.m30*e.m01*e.m13-e.m30*e.m03*e.m11,t.m32=-e.m00*e.m11*e.m32+e.m00*e.m12*e.m31+e.m10*e.m01*e.m32-e.m10*e.m02*e.m31-e.m30*e.m01*e.m12+e.m30*e.m02*e.m11,t.m03=-e.m01*e.m12*e.m23+e.m01*e.m13*e.m22+e.m11*e.m02*e.m23-e.m11*e.m03*e.m22-e.m21*e.m02*e.m13+e.m21*e.m03*e.m12,t.m13=e.m00*e.m12*e.m23-e.m00*e.m13*e.m22-e.m10*e.m02*e.m23+e.m10*e.m03*e.m22+e.m20*e.m02*e.m13-e.m20*e.m03*e.m12,t.m23=-e.m00*e.m11*e.m23+e.m00*e.m13*e.m21+e.m10*e.m01*e.m23-e.m10*e.m03*e.m21-e.m20*e.m01*e.m13+e.m20*e.m03*e.m11,t.m33=e.m00*e.m11*e.m22-e.m00*e.m12*e.m21-e.m10*e.m01*e.m22+e.m10*e.m02*e.m21+e.m20*e.m01*e.m12-e.m20*e.m02*e.m11;let i=e.m00*t.m00+e.m01*t.m10+e.m02*t.m20+e.m03*t.m30;return 0===i?new o(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0):(i=1/i,t.m00*=i,t.m01*=i,t.m02*=i,t.m03*=i,t.m10*=i,t.m11*=i,t.m12*=i,t.m13*=i,t.m20*=i,t.m21*=i,t.m22*=i,t.m23*=i,t.m30*=i,t.m31*=i,t.m32*=i,t.m33*=i,-0===t.m00&&(t.m00=0),-0===t.m01&&(t.m01=0),-0===t.m02&&(t.m02=0),-0===t.m03&&(t.m03=0),-0===t.m10&&(t.m10=0),-0===t.m11&&(t.m11=0),-0===t.m12&&(t.m12=0),-0===t.m13&&(t.m13=0),-0===t.m20&&(t.m20=0),-0===t.m21&&(t.m21=0),-0===t.m22&&(t.m22=0),-0===t.m23&&(t.m23=0),-0===t.m30&&(t.m30=0),-0===t.m31&&(t.m31=0),-0===t.m32&&(t.m32=0),-0===t.m33&&(t.m33=0),t)}}},"2hPL":function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i("JxDP"),a=i("Khlq"),o=i("XHCD"),r=i("fx83"),l=i("ngv1");t.IsolateBase=class extends n.MCDViewCommand{constructor(){super(!0),this._mcd=null,this._cameraMotion=null,this._cameraMotionEnded=!1,this._isStarting=!1,this._isStopping=!1,this._previousMotion=!1,this._backgroundData=void 0,this._cameraMotionEndEventRaised=!1,this._cameraState="",this._homePosition=""}set cameraState(e){this._cameraState=e}get cameraState(){return this._cameraState}set homePosition(e){this._homePosition=e}get homePosition(){return this._homePosition}get enabled(){return this._enabled}createIsolateBase(e,t,i,s,n,o){if(this._eventManager=i,!this._eventManager)throw new Error("The eventManager provided was NULL.");if(this._mcd=e,!this._mcd)throw new Error("The MCD provided was NULL.");if(this._cameraMotion=t,!this._cameraMotion)throw new Error("The CameraMotion was NULL.");if(this._width=n,this._height=o,this._onIsolateAvailable=s,!this._onIsolateAvailable)throw new Error("The IsolateAvailableEvent provided was NULL");this._onIsolateAvailable=s,this._mcd.addSelectObjectEvent(this.raiseIsolateAvailableEvt.bind(this)),this.onCameraMotionEnd=this.onCameraMotionEnd.bind(this),this.onBackgroundLoaded=this.onBackgroundLoaded.bind(this),this.snapShotEventHandler=this.snapShotEventHandler.bind(this),this.onPauseHandler=this.onPauseHandler.bind(this),this.onEscape=this.onEscape.bind(this),this.addEvent(a.MCD_ENUM.EventNames.CAMERA_MOTION_END,this.onCameraMotionEnd,!0,!1),this.addEvent(a.MCD_ENUM.CallbackEventNames.BACKGROUND_LOAD_EVENT,this.onBackgroundLoaded),this.addEvent(a.MCD_ENUM.CallbackEventNames.SNAPSHOT_EVENT,this.snapShotEventHandler),this._keyMappings=this.createKeyMappings(),this.addOnPauseCallback(this.onPauseHandler)}createKeyMappings(){return[new r.MCDKey(27,a.MCD_ENUM.KeyEventType.KEY_UP,this.onEscape)]}onEscape(){this.stop(!1)}start(){return!!this._enabled&&(this._isStopping=!1,this._isStarting=!0,this._cameraMotionEndEventRaised=!1,super.start(),this._cameraMotion.isFlyToPending&&(this._previousMotion=!0,this._cameraMotion.stopFlyToMotion()),void 0===this._backgroundData?this.activateCmd():this.deactivateCmd(),this._eventManager.onTelemetry(o.Telemetry.getTelemetryJson(a.MCD_ENUM.TelemetryEventName.IsolateCommand,a.MCD_ENUM.TelemetryEventType.Feature,a.MCD_ENUM.TelemetryMessageType.Start)),!0)}stop(e=!0){let t=!1;return this._enabled&&(e?(this._cameraMotion.homePositionLocked=!1,this._cameraMotion.isFlyToPending&&(this._previousMotion=!0,this._cameraMotion.stopFlyToMotion()),this._isStarting=!1,this._isStopping=!0,this._mcd.reset("Selection",""),this.showAndHideObjects(),this.setBackground(),super.stop(),this._onIsolateAvailable(!1),this._isolatedInfo=void 0,t=!0,this.homePosition="",this.cameraState=""):this._isStopping?this.start():(this._isStarting=!1,this._isStopping=!0,this.isPaused&&super.start(),this._cameraMotion.isFlyToPending&&(this._previousMotion=!0,this._cameraMotion.isFlyToPending=!1),this.performCameraOperation(),!1===this._cameraMotionEndEventRaised&&""===this._cameraState&&this.updateIsolateWithoutCameraEvt(),t=!0),this._cameraMotionEndEventRaised=!1),t}updateIsolateOnEscape(){return s(this,void 0,void 0,(function*(){this.isPaused?this.stop(!1):yield this.raiseIsolateAvailableEvt()}))}canToggle(){return!0!==this.isPaused&&!0!==this.isActive}setViewSize(e,t){this.isPaused&&this._mcd.backgroundManager.setBackgroundDimension(e,t),this._width=e,this._height=t}updateIsolateWithoutCameraEvt(){const e=Object.create(null,{stop:{get:()=>super.stop}});return s(this,void 0,void 0,(function*(){yield this.updateHomePosition(),yield this.setObjectState(),yield this.showAndHideObjects(),this.setBackground(),this.cameraState="",this._isolatedInfo=void 0,e.stop.call(this)}))}raiseIsolateAvailableEvt(){return s(this,void 0,void 0,(function*(){this.isPaused||this._cameraMotionEnded||(yield this.canEnableCmd(),this._onIsolateAvailable(this.enabled))}))}onCameraMotionEnd(){const e=Object.create(null,{pause:{get:()=>super.pause},stop:{get:()=>super.stop}});return s(this,void 0,void 0,(function*(){this._cameraMotionEndEventRaised=!0,this._previousMotion?this._previousMotion=!1:(yield this.updateHomePosition(),this._isStarting?(this._isStarting=!1,e.pause.call(this)):this._isStopping&&(yield this.setObjectState(),yield this.showAndHideObjects(),yield this.setBackground(),this.cameraState="",this._isolatedInfo=void 0,e.stop.call(this)))}))}activateCmd(){return s(this,void 0,void 0,(function*(){""===this._homePosition&&(this._homePosition=yield this._mcd.get("CameraHomePosition","")),yield this.setObjectState(),yield this.setBackground()}))}deactivateCmd(){return s(this,void 0,void 0,(function*(){yield this.performCameraOperation()}))}canEnableCmd(){return s(this,void 0,void 0,(function*(){const e=yield this._mcd.getSelectedObjectsAndRange();this._enabled=!(!e&&!this.isPaused)}))}showAndHideObjects(){return s(this,void 0,void 0,(function*(){if(this._isStarting){if(!this._isolatedInfo)return!1;for(let e=0;e<this._isolatedInfo[0].length;e++)this._mcd.showObjects(this._isolatedInfo[0][e].ids,!0,this._isolatedInfo[0][e].targetName)}else this._mcd.showObjects([],!0);return!0}))}performCameraOperation(){return s(this,void 0,void 0,(function*(){if(this._isStarting){if(""===this.cameraState&&(this.cameraState=yield this._cameraMotion.getCameraState()),this._isolatedInfo){const e=this._isolatedInfo[1];e&&this._cameraMotion.fitToRange(e)}}else this.cameraState.hasOwnProperty("isOrthographic")&&(this.cameraState.isOrthographic=this._cameraMotion.projection===a.MCD_ENUM.CameraProjection.ORTHOGRAPHIC),yield this._cameraMotion.moveToCameraStateAsync(this.cameraState,!0)}))}updateHomePosition(){return s(this,void 0,void 0,(function*(){this._isStarting?(yield this._cameraMotion.setHome(),this._cameraMotion.homePositionLocked=!0):(this._mcd.set("CameraHomePosition",this.homePosition),this.homePosition="",this._cameraMotion.homePositionLocked=!1)}))}setObjectState(){return s(this,void 0,void 0,(function*(){if(this._isStarting){const e=yield this._mcd.getSelectedObjectsAndRange();if(!e)return;this._isolatedInfo=e,!0===this._isStarting&&this._mcd.reset("Selection","")}else if(this._isolatedInfo){const e=!0,t=[];this._mcd.reset("Selection","");for(let i=0;i<this._isolatedInfo[0].length;i++)for(let e=0;e<this._isolatedInfo[0][i].ids.length;e++)t.push(new l.MCDSelection(this._isolatedInfo[0][i].ids[e],this._isolatedInfo[1]));yield this._mcd.batchSelect(t,this._isolatedInfo[0][0].targetName,e)}}))}onBackgroundLoaded(e){return s(this,void 0,void 0,(function*(){e.event&&"resource-cached"===e.event&&(yield this.showAndHideObjects(),yield this.performCameraOperation())}))}setBackground(){this._isStarting?this.updateBackground():this.resetBackground()}updateBackground(){this._mcd.backgroundManager&&(this._backgroundData={type:a.MCD_ENUM.BackgroundInputType.Color,data:""},this._backgroundData.type=this._mcd.backgroundManager.activeBackgroundType,this._backgroundData.data=this._mcd.backgroundManager.getBackground()),this._mcd.snapshot(0,0,0,0,'{"target":"primary"}')}resetBackground(){this._mcd.backgroundManager&&(this._mcd.backgroundManager.lockBackground=!1,void 0!==this._backgroundData&&this._mcd.backgroundManager.setBackground(this._backgroundData.type,this._backgroundData.data),this._backgroundData=void 0)}snapShotEventHandler(e){e&&e.hasOwnProperty("options")&&e.options.hasOwnProperty("data")&&(e.darken=!0,this._mcd.backgroundManager.setBackground(a.MCD_ENUM.BackgroundInputType.SnapshotData,JSON.stringify(e),this._width,this._height),this._mcd.backgroundManager.lockBackground=!0)}onPauseHandler(){return s(this,void 0,void 0,(function*(){!1===this._cameraMotionEndEventRaised&&this._cameraMotion.isFlyToPending&&(this._cameraMotion.stopFlyToMotion(),yield this.onCameraMotionEnd())}))}}},"3xuU":function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i("b7LP"),a=i("AZO4");class o extends a.ObjectIdentity{}t.ObjectIdentity2D=o,t.GDS2DIdMap=class extends a.GVCIdMap{constructor(){super(...arguments),this._identityMetadata=[]}InitializeData(e){this._identityMetadata=e}get identityMetadata(){return this._identityMetadata}Initialize(e,t,i){return this._modelId=e,this._url=t,this._appContext=i,!0}LookupById(e,t){return s(this,void 0,void 0,(function*(){return this.LookupByIds([e],[]).then(e=>e.length>0?e[0]:void 0)}))}LookupByIds(e,t){return s(this,void 0,void 0,(function*(){let t;return this._appContext.getDrawingRenderIdData(this._modelId,e).then(e=>s(this,void 0,void 0,(function*(){return t=yield this.structToObjectIdentity(e),t})))}))}LookupByName(e){return s(this,void 0,void 0,(function*(){const t=[e];return yield this.LookupByNames(t)}))}LookupByNames(e){return s(this,void 0,void 0,(function*(){let t;return this._appContext.getDrawingMonikerIdData(this._modelId,e).then(e=>s(this,void 0,void 0,(function*(){return t=yield this.structToObjectIdentity(e),t})))}))}LookupByOidPath(e){return s(this,void 0,void 0,(function*(){const t=[e];return yield this.LookupByOidPaths(t)}))}LookupByOidPaths(e){return s(this,void 0,void 0,(function*(){let t;return this._appContext.getDrawingOidPathIdData(this._modelId,e).then(e=>s(this,void 0,void 0,(function*(){return t=yield this.structToObjectIdentity(e),t})))}))}structToObjectIdentity(e){return s(this,void 0,void 0,(function*(){const t=[],i=JSON.parse(e);for(let e=0;e<i.length;e++)for(let a=0;a<i[e]["render-ids"].length;a++){const r=new o;if(r.Name=i[e].moniker,r.oidPath=i[e].oidPath,r.RenderId=i[e]["render-ids"][a],r.Range=void 0!==i[e].range[a]?new n.MCDRange(i[e].range[a].min.x,i[e].range[a].min.y,i[e].range[a].min.z,i[e].range[a].max.x,i[e].range[a].max.y,i[e].range[a].max.z):new n.MCDRange,0===r.Name.length&&"function"==typeof Headers){const e=new Headers;let t;e.set("cache-control","no-cache"),e.set("Connection","keep-alive"),e.set("Content-Type","application/json"),e.set("Accept","application/json"),e.set("Accept-Encoding","gzip, deflate"),e.set("Authorization","Bearer "+this._token);try{t=yield fetch(this._url+"2DWebAPI.GetAttributes",{body:'{"oidPath": "'+r.oidPath+'" }',headers:e,method:"POST"}).then(e=>e.json()).then(e=>{let t="";const i=r.oidPath.split("|");let s=e[i[0]];for(let n=1;n<i.length;n++){if(s.hasOwnProperty("attributeSets")){s=s.attributeSets[this.identityMetadata[0]];for(const e of s)if(e.name===this.identityMetadata[1]){t=e.value;break}break}s=s[i[n]]}return t})}catch(s){console.warn(s),t=""}finally{r.Name=t}}t.push(r)}return t}))}}},"4jpW":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.displayEnabled=!0,this.buffer=new Set}}t.AccentBuffer=s,t.MaterialAccent=class{constructor(e,t="ALL",i="Parametrics"){this._mcd=e,this._target=t,this._targetType=i,this._buckets={},this.handleMaterialChanged=this.handleMaterialChanged.bind(this),this._mcd.materials&&(this._mcd.materials.materialUpdatedCallback=this.handleMaterialChanged),this.getObjectIds=this.getObjectIds.bind(this)}get bucketList(){const e=[];for(const t in this._buckets)e.push(t);return e}getObjectIds(e){return this._buckets[e]?this._buckets[e].buffer:new Set}handleMaterialChanged(e){this._buckets[e]&&(this._mcd.loadMaterial(this._target,e),0!==Array.from(this._buckets[e].buffer.values()).length&&this.updateRendererList(e))}initialize(e){let t=!1;if(null==e||0===e.length||null===this._mcd.materials)return t;for(let i=0;i<e.length;i++)this._mcd.loadMaterial(this._target,e[i])&&(this._buckets[e[i]]=new s,t=!0);return t}addBucket(e){const t=this._mcd.materials.tryFindMaterialByName(e,void 0);return!(this._buckets[e]||!t.value||(this._buckets[e]=new s,this._mcd.loadMaterial(this._target,e),0))}removeBucket(e){return!!this._buckets[e]&&(this.reset(e)&&delete this._buckets[e],!0)}setBucketVisable(e,t){if(!this._buckets[e])return!1;const i=this._buckets[e];return i.displayEnabled!==t&&(i.displayEnabled=t,0!==Array.from(i.buffer.values()).length&&(t?this.updateRendererList(e):(this._mcd.removeMaterialFromObjects(Array.from(i.buffer.values()),this._target),this.updateRendererList())),!0)}getBucketVisable(e,t){return this._buckets[e]?{value:!0,enable:this._buckets[e].displayEnabled}:{value:!1,enable:!1}}add(e,t=null){if(!e||0===e.length)return!1;let i,s=!1;if(!t&&Object.keys(this._buckets).length>0)i=this._buckets[Object.keys(this._buckets)[0]];else{if(!this._buckets.hasOwnProperty(t))return!1;i=this._buckets[t]}for(let n=0;n<e.length;n++)i.buffer.add(e[n]),s=!0;return s&&this.updateRendererList(t),s}remove(e,t=null){if(!e||0===e.length)return!1;const i=[];let s;if(!t&&Object.keys(this._buckets).length>0)s=this._buckets[Object.keys(this._buckets)[0]];else{if(!this._buckets.hasOwnProperty(t))return!1;s=this._buckets[t]}for(let n=0;n<e.length;n++)s.buffer.delete(e[n]),i.push(e[n]);return i.length>0&&(this._mcd.removeMaterialFromObjects(i,this._target),this.updateRendererList(t),!0)}reset(e=null){const t=new Set;if(null==e||0===e.length)for(const i in this._buckets){const e=this._buckets[i];for(const i of e.buffer.values())t.add(i);e.buffer.clear()}else{if(!this._buckets.hasOwnProperty(e))return!1;for(const i of this._buckets[e].buffer.values())t.add(i);this._buckets[e].buffer.clear()}return this._mcd.removeMaterialFromObjects(Array.from(t.values()),this._target),e&&this.updateRendererList(),!0}updateRendererList(e=""){let t=""===e;for(const i in this._buckets)e===i&&(t=!0),this._buckets[i].displayEnabled&&Array.from(this._buckets[i].buffer.values()).length>0&&t&&this._mcd.applyMaterialToSelectedObjects(Array.from(this._buckets[i].buffer.values()),i,this._target)}cleanup(){this._mcd.materials.materialUpdatedCallback=void 0}}},"4qvN":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("B45s"),n=i("2T81"),a=i("He3+"),o=i("DCEI"),r=i("Khlq");t.ZoomArea=class extends a.ZoomAreaBase{constructor(e,t,i,s){if(super(),this._mcd=null,this._startPoint=new n.Point,this._crossLinesVisible=!1,this._startedRectangle=!1,this._updatedRectangle=!1,this._dynamicMeshLayerForZoomArea=null,this._dynamicMeshLayerNameForZoomArea="ZoomAreaEdgesInDynamicMeshLayer",this._windowLineWidth=2,this._overlayDisplayZoomArea=!0,this._boundingBoxCrossHairColor="rgba(255,255,255,.75)",this._overlayColorIndex=0,this._edgeColorIndex=.1,this._overlayTransparency=.47,this._edgeTransparency=.98,this._colorTable=[],this._vertices=[],this._colorIndices=[],this._triangleIndices=[],this._edgeIndices=[],this._pointIndices=[],this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this._focusScreenPoints=[],this._focusPointCount=0,this._maxScreenDistToBoxCenter=20,this._foundFocusPt=!1,this._minDepth=1e5,this._centerFocusPoint=new n.Quat(0,0,0,0),this._hasUpdateRectangle=!1,this._mcd=e,!this._mcd)throw new Error("The MCD provided was NULL.");this._canvasWidth=t,this._canvasHeight=i,s&&(this._canvas=s,this.initLine()),this.resetColors()}destroyDynamicMeshLayer(){this._dynamicMeshLayerForZoomArea&&(this._dynamicMeshLayerForZoomArea.destroyDynamicMeshLayer(),this._dynamicMeshLayerForZoomArea=null)}get dynamicMeshLayerForZoomArea(){return this._dynamicMeshLayerForZoomArea}get colorTable(){return this._colorTable}get vertices(){return this._vertices}get colorIndices(){return this._colorIndices}get triangleIndices(){return this._triangleIndices}get edgeIndices(){return this._edgeIndices}get pointIndices(){return this._pointIndices}get verticalLine(){return this._verticalLineElement}get horizontalLine(){return this._horizontalLineElement}get updatedRectangle(){return this._updatedRectangle}get boundingBoxCrossHairColor(){return this._boundingBoxCrossHairColor}set boundingBoxCrossHairColor(e){this._boundingBoxCrossHairColor=e}set finishedCallback(e){this.onFinishedCallback=e}set canvas(e){this._canvas=e}hasCanvas(){return!!this._canvas}setViewSize(e,t){this._canvasWidth=e,this._canvasHeight=t,this._canvas&&this.updateCrossLinesDimensions()}getViewWidth(){return this._canvasWidth}getViewHeight(){return this._canvasHeight}getStartPointX(){return this._startPoint.x}getStartPointY(){return this._startPoint.y}startRectangle(e,t){this._updatedRectangle=!1,this._startPoint.x=e,this._startPoint.y=t,this._startedRectangle=!0}updateCrossLines(e,t){this._canvas&&(this._startedRectangle||(this._crossLinesVisible||this.displayCrossLines(!0),this.drawCrossLines(e,t)))}updateCrossLinesDimensions(){this._verticalLineElement&&this._horizontalLineElement&&(this._verticalLineElement.style.height=this._canvas.height+"px",this._horizontalLineElement.style.width=this._canvas.width+"px")}drawCustomCrossOverlay(e,t,i,s,n=1,a=!0,o="rgba(255,255,255,.75)"){if(void 0!==this._horizontalLineElement&&void 0!==this._verticalLineElement){const r=Math.abs(t-s),l=Math.abs(e-i),h=l/2,c=r/2,_=a?e+h-n*h:e+h-.5*n,d=a?t+c-n*c:t+c+.5*n;this._verticalLineElement.style.height=(a?r*n:n)+"px",this._horizontalLineElement.style.width=(a?l*n:n)+"px",this._verticalLineElement.style.left=e+h+"px",this._verticalLineElement.style.top=(a?this._canvasHeight-d-n*r:this._canvasHeight-d)+"px",this._horizontalLineElement.style.left=_+"px",this._horizontalLineElement.style.top=this._canvasHeight-t-c+"px",this._horizontalLineElement.style.border="1px solid "+o,this._verticalLineElement.style.border="1px solid "+o}}updateRectangle(e,t){this._startedRectangle&&(this._updatedRectangle=!0,this._hasUpdateRectangle=!0,this.drawRectangleInDynamicMeshLayer(Math.round(this._startPoint.x),Math.round(this._startPoint.y),e,t),this.drawCustomCrossOverlay(Math.round(this._minX),Math.round(this._minY),Math.round(this._maxX),Math.round(this._maxY),20,!1,this._boundingBoxCrossHairColor))}endRectangle(e,t,i){this.clearRectangleInDynamicMeshLayer(),this._startedRectangle=!1,this.updateCrossLines(e,t),this.initCrossLineStyle(),this._hasUpdateRectangle&&i&&(this._mcd.fitToScreenBox(this._minX,this._minY,this._maxX,this._maxY,0,0,0,0,0,!0),this._hasUpdateRectangle=!1),this._minX=0,this._minY=0,this._maxX=0,this._maxY=0}fitToScreenBox(e){if(""!==e&&this._focusScreenPoints.length>0){let i=0,s=0,n=0,a=0,o=0,l=0,h=0;const c=(this._minX+this._maxX)/2,_=(this._minY+this._maxY)/2;let d=0,m=e;for(;"string"==typeof m;)m=JSON.parse(m);const u=m.hits;try{o=u[0].distance,o>0&&(i=u[0].x,s=u[0].y,n=u[0].z,l=m.x,h=m.y,a=u[0].distance,d=Math.sqrt((l-c)*(l-c)+(h-_)*(h-_)),d<this._maxScreenDistToBoxCenter&&(this._centerFocusPoint.x=i,this._centerFocusPoint.y=s,this._centerFocusPoint.z=n,this._centerFocusPoint.w=o,this._maxScreenDistToBoxCenter=d),o<this._minDepth&&(this._foundFocusPt=!0,this._minDepth=o))}catch(t){console.warn("Something went wrong with the locate for fit to screen box.")}this._focusPointCount<this._focusScreenPoints.length-1?(this._focusPointCount++,l=this._focusScreenPoints[this._focusPointCount].x,h=this._focusScreenPoints[this._focusPointCount].y,this._mcd.locateAsync(JSON.stringify({LocateType:r.MCD_ENUM.LocateType.SurfacePoint,ScreenPosition:{x:l,y:h},Target:"Parametric"}))):(this._minDepth=this._foundFocusPt?this._minDepth:0,this._mcd.fitToScreenBox(this._minX,this._minY,this._maxX,this._maxY,this._minDepth,this._centerFocusPoint.w,this._centerFocusPoint.x,this._centerFocusPoint.y,this._centerFocusPoint.z,!0),this._focusPointCount=0,this._focusScreenPoints=[],this._foundFocusPt=!1,this._maxScreenDistToBoxCenter=20,this._minDepth=1e5,this._centerFocusPoint.x=0,this._centerFocusPoint.y=0,this._centerFocusPoint.z=0,this._centerFocusPoint.w=0,this.onFinishedCallback&&this.onFinishedCallback())}}clearCrossLines(){if(this._canvas){const e=document.getElementById("verticalLine"),t=document.getElementById("horizontalLine");e&&t&&(e.remove(),t.remove()),this._crossLinesVisible=!1}}displayCrossLines(e){if(this._canvas){const t=document.getElementById("verticalLine"),i=document.getElementById("horizontalLine");t&&i&&(e?(t.style.display="block",i.style.display="block",this._crossLinesVisible=!0):(t.style.display="none",i.style.display="none",this._crossLinesVisible=!1))}}setRectangleStartPosition(e,t){this._startPoint.x=e,this._startPoint.y=t,this.startRectangle(this._startPoint.x,this._startPoint.y)}drawRectangleInDynamicMeshLayer(e,t,i,n){Math.abs(i-e)<2||Math.abs(n-t)<2||(this._dynamicMeshLayerForZoomArea||(this._dynamicMeshLayerForZoomArea=new s.DynamicMeshLayer(this._dynamicMeshLayerNameForZoomArea,this._mcd,this._windowLineWidth,this._overlayDisplayZoomArea)),this._dynamicMeshLayerForZoomArea&&(this.constructRectangleOverlay(e,t,i,n),this._dynamicMeshLayerForZoomArea.reset(),this._dynamicMeshLayerForZoomArea.addData(this.colorTable,this.vertices,this.colorIndices,this.triangleIndices,this.pointIndices,this.edgeIndices),this._dynamicMeshLayerForZoomArea.display()))}clearRectangleInDynamicMeshLayer(){if(this._dynamicMeshLayerForZoomArea||(this._dynamicMeshLayerForZoomArea=new s.DynamicMeshLayer(this._dynamicMeshLayerNameForZoomArea,this._mcd,2,!0)),this._dynamicMeshLayerForZoomArea){const e=[];this.clearDisplayData();const t=new n.Vec3(0,0,0);this._vertices.push(t),this._colorIndices.push(0),this._dynamicMeshLayerForZoomArea.reset(),this._dynamicMeshLayerForZoomArea.addData(this.colorTable,this.vertices,this.colorIndices,e,this.pointIndices,this.edgeIndices),this._dynamicMeshLayerForZoomArea.display()}}initLine(){const e=document.getElementsByClassName(".line");e&&e.length>0&&document.removeChild(e[0]);const t=document.createElement("style");t.type="text/css",t.innerHTML=".line { border: 1px solid #0000FF; position: absolute; pointer-events: none;}",document.getElementsByTagName("head")[0].appendChild(t)}constructRectangleOverlay(e,t,i,s){let a=0,r=0;const l=this._canvasHeight/this._canvasWidth;let h=0,c=0;if(this._canvas){const e=this._canvas.getBoundingClientRect();i-=e.left,s-=e.top}t=this._canvasHeight-t,s=this._canvasHeight-s,Math.abs(i-e)>Math.abs(s-t)?e<i?(this._minX=e,this._maxX=i,h=this._maxX-this._minX,t<s?(this._minY=t,this._maxY=this._minY+l*h):(this._maxY=t,this._minY=this._maxY-l*h)):(this._minX=i,this._maxX=e,h=this._maxX-this._minX,t<s?(this._minY=t,this._maxY=this._minY+l*h):(this._maxY=t,this._minY=this._maxY-l*h)):t<s?(this._minY=t,this._maxY=s,c=this._maxY-this._minY,e<i?(this._minX=e,this._maxX=this._minX+c/l):(this._maxX=e,this._minX=this._maxX-c/l)):(this._minY=s,this._maxY=t,c=this._maxY-this._minY,e<i?(this._minX=e,this._maxX=this._minX+c/l):(this._maxX=e,this._minX=this._maxX-c/l));const _=[],d=new n.Point;d.x=this._minX,d.y=this._minY,_.push(d);const m=new n.Point;m.x=this._maxX,m.y=this._minY,_.push(m);const u=new n.Point;u.x=this._maxX,u.y=this._maxY,_.push(u);const p=new n.Point;p.x=this._minX,p.y=this._maxY,_.push(p);const g=new n.Point;g.x=this._minX-1,g.y=this._minY-1,_.push(g);const C=new n.Point;C.x=this._maxX+1,C.y=this._minY-1,_.push(C);const M=new n.Point;M.x=this._maxX+1,M.y=this._maxY+1,_.push(M);const E=new n.Point;E.x=this._minX-1,E.y=this._maxY+1,_.push(E);const P=new n.Point;P.x=1,P.y=1,_.push(P);const y=new n.Point;y.x=this._canvasWidth-1,y.y=1,_.push(y);const D=new n.Point;D.x=this._canvasWidth-1,D.y=this._canvasHeight-1,_.push(D);const v=new n.Point;v.x=1,v.y=this._canvasHeight-1,_.push(v);const f=[];for(a=0;a<12;a++)f.push(o.MathGeometry.getNormalizedScreenPoint(_[a].x,_[a].y,0,this._canvasWidth,this._canvasHeight));for(f[1].z=f[0].z,f[2].z=f[3].z,this.clearDisplayData(),a=0;a<4;a++)this._vertices.push(f[a]),this._colorIndices.push(this._edgeColorIndex);for(this._edgeIndices.push(r),this._edgeIndices.push(r+1),this._edgeIndices.push(r+1),this._edgeIndices.push(r+2),this._edgeIndices.push(r+2),this._edgeIndices.push(r+3),this._edgeIndices.push(r+3),this._edgeIndices.push(r+0),r+=4,this._vertices.push(f[4]),this._vertices.push(f[8]),this._vertices.push(f[9]),this._vertices.push(f[4]),this._vertices.push(f[9]),this._vertices.push(f[5]),a=0;a<6;a++)this._triangleIndices.push(r+a),this._colorIndices.push(this._overlayColorIndex);for(r+=6,this._vertices.push(f[5]),this._vertices.push(f[9]),this._vertices.push(f[10]),this._vertices.push(f[5]),this._vertices.push(f[10]),this._vertices.push(f[6]),a=0;a<6;a++)this._triangleIndices.push(r+a),this._colorIndices.push(this._overlayColorIndex);for(r+=6,this._vertices.push(f[6]),this._vertices.push(f[10]),this._vertices.push(f[11]),this._vertices.push(f[6]),this._vertices.push(f[11]),this._vertices.push(f[7]),a=0;a<6;a++)this._triangleIndices.push(r+a),this._colorIndices.push(this._overlayColorIndex);for(r+=6,this._vertices.push(f[7]),this._vertices.push(f[11]),this._vertices.push(f[8]),this._vertices.push(f[7]),this._vertices.push(f[8]),this._vertices.push(f[4]),a=0;a<6;a++)this._triangleIndices.push(r+a),this._colorIndices.push(this._overlayColorIndex);r+=6}setupCrossLines(){this._canvas&&(this._verticalLineElement=document.createElement("div"),this._verticalLineElement.style.display="none",this._horizontalLineElement=document.createElement("div"),this._horizontalLineElement.style.display="none",this.initCrossLineStyle(),document.getElementById("mcdViewContainer").appendChild(this._verticalLineElement),document.getElementById("mcdViewContainer").appendChild(this._horizontalLineElement))}initCrossLineStyle(){void 0!==this._horizontalLineElement&&void 0!==this._verticalLineElement&&(this._verticalLineElement.id="verticalLine",this._verticalLineElement.className="line",this._verticalLineElement.style.top=this._canvas.offsetTop+"px",this._verticalLineElement.style.height=this._canvas.height+"px",this._horizontalLineElement.id="horizontalLine",this._horizontalLineElement.className="line",this._horizontalLineElement.style.left=this._canvas.offsetLeft+"px",this._horizontalLineElement.style.width=this._canvas.width+"px",this._horizontalLineElement.style.border="1px solid #0000FF",this._verticalLineElement.style.border="1px solid #0000FF")}drawCrossLines(e,t){let i=0,s=0;if(this._canvas){const e=this._canvas.getBoundingClientRect();i=e.left,s=e.top}this._verticalLineElement.style.left=e-i+"px",this._horizontalLineElement.style.top=t-s+"px"}clearDisplayData(){this._vertices=[],this._colorIndices=[],this._triangleIndices=[],this._edgeIndices=[],this._pointIndices=[]}resetColors(){const e=new n.Quat(0,0,0,this._overlayTransparency),t=new n.Quat(1,0,0,this._edgeTransparency);this._colorTable=[],this._colorTable.push(e),this._colorTable.push(t),this._overlayColorIndex=0,this._edgeColorIndex=1}computeAutoFocusScreenPoints(e,t,i,s){const a=(e+i)/2,o=(t+s)/2;let r=0,l=0,h=0,c=0,_=0,d=0,m=2;const u=i-e<50?.4:.2;let p=u*(i-e)/4,g=u*(s-t)/4;this._focusScreenPoints=[];const C=new n.Vec2(a,o);for(this._focusScreenPoints.push(C),_=0;_<2.5;_++){r=a-(_+1)*p,l=o-(_+1)*g;const e=new n.Vec2(r,l);for(this._focusScreenPoints.push(e),h=r,c=l,d=0;d<m;d++){h+=p;const e=new n.Vec2(h,c);this._focusScreenPoints.push(e)}for(d=0;d<m;d++){c+=g;const e=new n.Vec2(h,c);this._focusScreenPoints.push(e)}for(d=0;d<m;d++){h-=p;const e=new n.Vec2(h,c);this._focusScreenPoints.push(e)}for(d=0;d<m-1;d++){c-=g;const e=new n.Vec2(h,c);this._focusScreenPoints.push(e)}m+=2}let M=7,E=7;for(i-e<M&&(M=i-e),s-t<E&&(E=s-t),p=(i-e)/(M-1),g=(s-t)/(E-1),_=0;_<E;_++)for(c=t+_*g,d=0;d<M;d++){h=e+d*p;const t=new n.Vec2(h,c);this._focusScreenPoints.push(t)}}}},"87hY":function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i("Khlq");t.DefaultMotion=class{constructor(e,t,i){this._type=n.MCD_ENUM.MotionTypes.DEFAULT_MOTION,this._mcd=e,this.motionStartedEvent=t,this.motionEndedEvent=i}set cameraMotionStartedEvent(e){this.motionStartedEvent=e}set cameraMotionEndedEvent(e){this.motionEndedEvent=e}set undoRedoEvent(e){this.undoRedoEventCallback=e}moveTo(e="",t=!0){return s(this,void 0,void 0,(function*(){let i="";return void 0!==this.motionStartedEvent&&(yield this.motionStartedEvent()),""!==e&&(i=this._mcd.set("CameraState",e)),this._mcd.commitCameraChanges(n.MCD_ENUM.CommitAction.CT_Immediate),this._saveState=t,this.undoRedoEventCallback&&this._saveState&&(yield this.undoRedoEventCallback(n.MCD_ENUM.GestureEventNames.GESTURE_NONE)),void 0!==this.motionEndedEvent&&(yield this.motionEndedEvent()),i}))}onCameraChange(){}onGesture(e){}canSaveState(){return this._saveState}}},"A8b+":function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Sheets=class{constructor(){this.activeSheetChangedEvent=[],this._mcd=null,this._cameraMotion=null,this._eventManager=null}init(e,t,i){if(this._eventManager=i,!this._eventManager)throw new Error("The eventManager provided was NULL.");if(this._mcd=e,!this._mcd)throw new Error("The MCD provided was NULL.");if(this._cameraMotion=t,!this._cameraMotion)throw new Error("The CameraMotion was NULL.")}addActiveSheetChangedEventHandler(e){-1===this.activeSheetChangedEvent.indexOf(e)&&this.activeSheetChangedEvent.push(e)}removeActiveSheetChangedEventHandler(e){const t=this.activeSheetChangedEvent.indexOf(e);-1!==t&&this.activeSheetChangedEvent.splice(t,1)}setActiveSheet(e){return s(this,void 0,void 0,(function*(){if(void 0!==e&&""!==e){const t={};t["sheet-name"]=e,t["target-name"]=this._mcd.modelName,yield this._mcd.selectObjectCore(-1),this._cameraMotion.clearUndoRedo(),this._eventManager.closeAllCommands(),yield this._mcd.set("ActiveSheet",JSON.stringify(t))}}))}getSheets(){return s(this,void 0,void 0,(function*(){let e;const t={};t["target-name"]=this._mcd.modelName;const i=yield this._mcd.get("Sheets",JSON.stringify(t));if(void 0!==i&&""!==i){const t=JSON.parse(i);null!==t&&(e=t["sheet-names"])}return e}))}getActiveSheet(){return s(this,void 0,void 0,(function*(){let e="";const t={};t["target-name"]=this._mcd.modelName;const i=yield this._mcd.get("ActiveSheet",JSON.stringify(t));return void 0!==i&&""!==i&&(e=JSON.parse(i)["sheet-name"]),e}))}OnActiveSheetChange(e){return s(this,void 0,void 0,(function*(){let t=!1,i=!1;try{null!=e&&(this._cameraMotion.isFlyToEnabled&&(t=!0,this._cameraMotion.disableFlyTo()),this._cameraMotion.homePositionLocked&&(i=!0,this._cameraMotion.homePositionLocked=!1),this._cameraMotion.fit(),yield this._cameraMotion.setHome(),e.hasOwnProperty("sheetName")&&this.activeSheetChangedEvent.forEach(t=>{t(e.sheetName)}))}finally{i&&(this._cameraMotion.homePositionLocked=!0),t&&this._cameraMotion.enableFlyTo()}}))}}},AQPt:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i("bwSC"),a=i("Khlq"),o=i("uZBq"),r=i("sinj"),l=i("hh6j"),h=i("bipn"),c=i("XHCD"),_={SetupDefaultFont:()=>"",InitRenderingContext:()=>"",ExitRenderingContext:()=>"",GetCachePath:()=>"",GetFontPath:()=>"OpenSans-Regular.ttf",GetAppTypeAndGPUInfo:()=>"Browser",GetPerformanceLoggerHostName:()=>"",GetPerformanceLoggerPort:()=>"",GetMinLogLevel:()=>"Trace",GetLazyRenderEnabled:()=>!1};t.ModularCoreDisplay=class extends n.ModularCoreDisplayBase{constructor(e,t,i){super(),this._canvasDestroyed=!0,this._currentCanvasElement="",this._eventCallbackMap=new Map,this._isModelLoaded=!1,this._renderingEffects=null,this._modelName="",this._lastSelectedGraphicId=-1,this._animationFrameRequestId=0,this._isPitchAngleLocked=!1,this._isYawAngleLocked=!1,this._materials=null,this._backgroundManager=null,this.MCD_BAD_PARAM_J=JSON.stringify({error:{code:"MCD_BAD_PARAM",message:""}}),this.MCD_OK_J=JSON.stringify({success:{code:"MCD_OK",message:""}}),this.initializeCanvasWASM=this.initializeCanvasWASM.bind(this),void 0!==e&&""!==e&&(this._canvasId=e,this._perfLoggerHostname=t,this._perfLoggerPort=i,Module.CreateMCD?(this._isWASMEnabled=!1,this.initializeCanvas(this._canvasId,this._perfLoggerHostname,this._perfLoggerPort)):(this._isWASMEnabled=!0,Module.onRuntimeInitialized=this.initializeCanvasWASM))}initializeCanvasWASM(){this.initializeCanvas(this._canvasId,this._perfLoggerHostname,this._perfLoggerPort)}set isPitchAngleLocked(e){this._isPitchAngleLocked=e}get isPitchAngleLocked(){return this._isPitchAngleLocked}set isYawAngleLocked(e){this._isYawAngleLocked=e}get isYawAngleLocked(){return this._isYawAngleLocked}set materials(e){this._materials=e}get materials(){return this._materials}set backgroundManager(e){this._backgroundManager=e}get backgroundManager(){return this._backgroundManager}get isWASMEnabled(){return this._isWASMEnabled}jsonToBool(e){const t=JSON.parse(e);if(!t||!t.hasOwnProperty("success")||!t.success.hasOwnProperty("code"))return!1;const i=t.success.code;return 0===i.localeCompare("MCD_OK")||0===i.localeCompare("MCD_NONE")||0===i.localeCompare("MCD_OBJ_SELECTED")}optimizeNavigation(e){return e?this._renderingEffects||(this._renderingEffects=new r.RenderingEffects(this)):this._renderingEffects=null,this.MCD_OK_J}get renderingEffects(){return this._renderingEffects}initializeCanvas(e,t,i){Module&&(this._mcd=Module.CreateMCD());let s=!1;if(!e)return s;if(0===e.length)return s;this._currentCanvasElement=e;try{const e={stencil:!0,depth:!0,antialias:!0,majorVersion:2,minorVersion:0};if(this._theDisplayWindow=document.getElementById(this._currentCanvasElement),null===Browser||"undefined"===Browser||null===this._theDisplayWindow)return s;if(this._graphicsContext=this._theDisplayWindow.getContext("webgl2",e),null===this._graphicsContext&&(e.majorVersion=1,this._graphicsContext=this._theDisplayWindow.getContext("webgl",e)),null===this._graphicsContext&&(e.majorVersion=1,this._graphicsContext=this._theDisplayWindow.getContext("experimental-webgl",e)),!this._graphicsContext)return console.warn("The graphic context was not created."),s;let n;for(n in Browser.createContext(this._theDisplayWindow,!0,!0,e),Browser.workers){const e=Browser.workers[n];if(null!=e)return e.worker.addEventListener("error",(function(e){console.warn("A worker ran out of memory")}),!1),!1}this._canvasDestroyed=!1,void 0!==t&&""!==t&&void 0!==i&&""!==i&&(_.GetPerformanceLoggerHostName=function(){return t},_.GetPerformanceLoggerPort=function(){return i});const a=Module.CDInitializer.implement(_);return this._mcd.InitDisplayAdapter(a),this.enableTransparency(!0),this.render(),s=!0,this._eventManager&&this._isWASMEnabled&&this._eventManager.onMCDInitialized(),!0}catch(n){return console.warn(n),!1}}render(){if(this._animationFrameRequestId=requestAnimationFrame(()=>this.render()),void 0!==this._mcd)return this._mcd.Set("Viewport",'{"Viewport": { "width":'+this._theDisplayWindow.offsetWidth+' , "height":'+this._theDisplayWindow.offsetHeight+"}}"),this._mcd.Update(),this.MCD_OK_J}closeModel(e){return void 0===e||e.length<=0||!this._mcd?this.MCD_BAD_PARAM_J:(this._mcd.CloseModel(e),this._isModelLoaded=!1,this.MCD_OK_J)}openModel(e){this._isModelLoaded=!0,this._isPitchAngleLocked=!1,this._isYawAngleLocked=!1;const t=JSON.parse(e);if(t["camera-locks"])for(let i=0;i<t["camera-locks"].length;i++)t["camera-locks"][i].isPitchAngleLocked?this._isPitchAngleLocked=t["camera-locks"][i].isPitchAngleLocked:t["camera-locks"][i].isYawAngleLocked&&(this._isYawAngleLocked=t["camera-locks"][i].isYawAngleLocked);return this._mcd.OpenModel(e),this.MCD_OK_J}enableTransparency(e){if(!0!==this._isModelLoaded)return this.MCD_BAD_PARAM_J;let t=0;return e&&(t=1),this._mcd.Set("Preferences",'{"TransparencyAllowed": '+t.toString()+" }"),this.MCD_OK_J}fit(e=!0){return void 0===this._mcd||!0!==this._isModelLoaded?this.MCD_BAD_PARAM_J:(this._mcd.Fit(e),this.MCD_OK_J)}fitToScreenBox(e,t,i,s,n,a,o,r,l,h){return void 0===this._mcd||!0!==this._isModelLoaded?this.MCD_BAD_PARAM_J:(this._mcd.FitToScreenBox(e,t,i,s,n,a,o,r,l,h),this.MCD_OK_J)}goHome(e=!0){return void 0===this._mcd||!0!==this._isModelLoaded?this.MCD_BAD_PARAM_J:(this._mcd.GoHome(e),this.MCD_OK_J)}locateCore(e,t){return void 0===this._mcd||!0!==this._isModelLoaded?this.MCD_BAD_PARAM_J:this.locateAsync(JSON.stringify({LocateType:a.MCD_ENUM.LocateType.Object,ScreenPosition:{x:e,y:t}}))}locateAsync(e){return void 0===this._mcd||!0!==this._isModelLoaded||null==e?this.MCD_BAD_PARAM_J:""!==e&&this._eventCallbackMap?void 0===JSON.parse(e).LocateType?this.MCD_BAD_PARAM_J:(this._eventManager&&this._eventManager.onTelemetry(c.Telemetry.getTelemetryJson(a.MCD_ENUM.TelemetryEventName.ObjectLocatedCommand,a.MCD_ENUM.TelemetryEventType.Feature,a.MCD_ENUM.TelemetryMessageType.Discrete)),this._mcd.Locate(e,null)):this.MCD_BAD_PARAM_J}destroy(e,t){return void 0===this._mcd||!0!==this._isModelLoaded?this.MCD_BAD_PARAM_J:(this._mcd.Destroy(e,t),this.MCD_OK_J)}create(e,t){return void 0===this._mcd?this.MCD_BAD_PARAM_J:(this._mcd.Create(e,t),this.MCD_OK_J)}reset(e,t=""){return this._mcd&&!0===this._isModelLoaded?(this._mcd.Reset(e,t),this.MCD_OK_J):this.MCD_BAD_PARAM_J}selectObjectCore(e,t=!1,i="",n,a){return s(this,void 0,void 0,(function*(){if(void 0===this._mcd||!0!==this._isModelLoaded)return-1;let s="",o=!1,r=!1,l=!1;if(e>Number.MAX_SAFE_INTEGER&&(e=-1),-1===e){let e=yield this.get("Selection","");for(;"string"==typeof e;)e=JSON.parse(e);null==e&&(o=!0),r=!0,this.reset("Selection","")}if(-1!==e&&(n?Number.isNaN(e)||t?!Number.isNaN(e)&&t&&(s='{"ToggleSelection":'+e+',"target-name":"'+n+'",'+i+"}"):s='{"SingleSelection":'+e+',"target-name":"'+n+'",'+i+"}":Number.isNaN(e)||t?!Number.isNaN(e)&&t&&(s='{"ToggleSelection":'+e+',"target-name":"'+this.modelName+'",'+i+"}"):s='{"SingleSelection":'+e+',"target-name":"'+this.modelName+'",'+i+"}",""!==s)){const e=this.set("Selection",s);this.jsonToBool(e)&&(l=!0)}return(!r||o)&&r||-1===this._lastSelectedGraphicId&&-1===e||this.selectObjectCallbackEvents.length>0&&this.selectObjectCallbackEvents.forEach(i=>{i(new h.MCDSelectionChanged(e,n,l,t,a))}),this._lastSelectedGraphicId=e,e}))}addBatchToSelection(e,t,i,n=!1){return s(this,void 0,void 0,(function*(){if(void 0===this._mcd||!0!==this._isModelLoaded)return[];void 0===i&&(i=this.modelName);const s={RemoveFromSelection:[],AddToSelection:[],Ranges:[],"target-name":i};let a=!1,o=!1;e.length>1&&(o=!0);for(let i=0;i<e.length;i++){const n=e[i];if(-1===n)return[];-1!==n&&(Number.isNaN(n)||(s.AddToSelection.push(n),s.Ranges.push(JSON.parse(t[i].toJsonString()))))}const r=this.set("Selection",JSON.stringify(s));return this.jsonToBool(r)&&(a=!0),n&&this.selectObjectCallbackEvents.length>0&&this.selectObjectCallbackEvents.forEach(t=>{t(new h.MCDSelectionChanged(e[e.length-1],i,a,o))}),this._lastSelectedGraphicId=e[e.length-1],e}))}removeBatchFromSelection(e,t){return s(this,void 0,void 0,(function*(){if(void 0===this._mcd||!0!==this._isModelLoaded)return[];void 0===t&&(t=this.modelName);const i={RemoveFromSelection:[],AddToSelection:[],Ranges:[],"target-name":t};for(let t=0;t<e.length;t++){const s=e[t];if(-1===s)return[];-1!==s&&(Number.isNaN(s)||i.RemoveFromSelection.push(s))}return this.set("Selection",JSON.stringify(i)),this._lastSelectedGraphicId=e[e.length-1],e}))}set(e,t){return e&&this._mcd?this._mcd.Set(e,t):this.MCD_BAD_PARAM_J}get(e,t){return s(this,void 0,void 0,(function*(){return e&&this._mcd?new Promise((i,s)=>{void 0===this._mcd&&i(this.MCD_BAD_PARAM_J),i(this._mcd.Get(e,t))}):this.MCD_BAD_PARAM_J}))}motionRotateByAngle(e,t,i){return void 0===this._mcd||!0!==this._isModelLoaded?this.MCD_BAD_PARAM_J:null!==e&&null!==t&&null!==i&&this._mcd?(this._mcd.MotionRotateByAngle(e,t,i),this.MCD_OK_J):this.MCD_BAD_PARAM_J}motionRotateAroundPoint(e,t,i,s,n){return void 0===this._mcd||!0!==this._isModelLoaded?this.MCD_BAD_PARAM_J:(this._mcd.MotionRotateAroundPoint(e,t,i,s,n),this.MCD_OK_J)}motionRotate(e,t,i){return void 0===this._mcd||!0!==this._isModelLoaded?this.MCD_BAD_PARAM_J:null!==e&&null!==t&&null!==i&&this._mcd?(this._mcd.MotionRotate(e,t,i),this.MCD_OK_J):this.MCD_BAD_PARAM_J}motionMove(e,t,i,s,n){return void 0===this._mcd||!0!==this._isModelLoaded?this.MCD_BAD_PARAM_J:null!==e&&null!==t&&null!==i&&null!==s&&null!==n&&this._mcd?(this._mcd.MotionMove(e,t,i,s,n),this.MCD_OK_J):this.MCD_BAD_PARAM_J}motionMoveTo(e,t,i,s,n,a,o=!0){return void 0===this._mcd||!0!==this._isModelLoaded?this.MCD_BAD_PARAM_J:null!==e&&null!==t&&null!==i&&null!==s&&null!==n&&null!==a&&this._mcd?(this._mcd.MotionMoveTo(e,t,i,s,n,a,o),this.MCD_OK_J):this.MCD_BAD_PARAM_J}commitCameraChanges(e){return null!==e&&this._mcd?(this._mcd.CommitCameraChanges(0===e?Module.CameraTransition.CT_Abandon:Module.CameraTransition.CT_Immediate),this.MCD_OK_J):this.MCD_BAD_PARAM_J}addEventCallback(e,t){if(void 0===this._mcd)return this.MCD_BAD_PARAM_J;if(!e||null==t)return this.MCD_BAD_PARAM_J;const i=new(o.CallbackHandler(t));if(this._eventCallbackMap.get(e))this._eventCallbackMap.get(e).push(i);else{const t=new Array;t.push(i),this._eventCallbackMap.set(e,t)}return this._mcd?this._mcd.AddEventCallback(e,i):this.MCD_OK_J}removeEventCallback(e,t){if(void 0===this._mcd)return this.MCD_BAD_PARAM_J;if(!e||null==t)return this.MCD_BAD_PARAM_J;const i=this._eventCallbackMap.get(e);return void 0!==i&&i.forEach((i,s)=>{if(i._callbackFunction===t&&(this._eventCallbackMap.get(e).splice(s,1),this._mcd))return this._mcd.RemoveEventCallback(e,i)}),this.MCD_OK_J}setViewPort(e,t){if(void 0===this._mcd||!0!==this._isModelLoaded)return this.MCD_BAD_PARAM_J;this.set("Viewport",'{"Viewport":{"height":'+t+',"width":'+e+"}}"),this.commitCameraChanges(1)}setCachePathCore(e){if(void 0===this._mcd||!0!==this._isModelLoaded)return this.MCD_BAD_PARAM_J;this._mcd.SetCachePath(e)}getScreenshotPixels(e,t,i,s){const n=this._graphicsContext,a=n.getParameter(n.FRAMEBUFFER_BINDING),o=n.getParameter(n.RENDERBUFFER_BINDING),r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r);const l=this._theDisplayWindow.width,h=this._theDisplayWindow.height,c=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,c),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,l,h),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,c),this.commitCameraChanges(1),this._mcd.Update();const _=new Uint8Array(i*s*4);return n.readPixels(e,t,i,s,n.RGBA,n.UNSIGNED_BYTE,_),n.bindFramebuffer(n.FRAMEBUFFER,a),n.bindRenderbuffer(n.RENDERBUFFER,o),n.deleteFramebuffer(r),n.deleteRenderbuffer(c),_}snapshotAsync(e){return s(this,void 0,void 0,(function*(){const t=this._theDisplayWindow.width,i=this._theDisplayWindow.height,s=JSON.parse(e),n=s.x>0?s.x:0,a=s.y>0?s.y:0;let o=s.width>0?s.width:t,r=s.height>0?s.height:i;n+o>t&&(o-=o-(t-n)),a+r>i&&(r-=r-(i-a));const l=this.getScreenshotPixels(n,a,o,r),h=document.createElement("canvas");h.width=o,h.height=r;const c=h.getContext("2d"),_=c.createImageData(h.width,h.height);_.data.set(l),c.putImageData(_,0,0),c.scale(1,-1),c.translate(0,-_.height),c.drawImage(h,0,0);const d=h.toDataURL().replace(/data\:image\/png\;base64\,/,""),m=JSON.stringify({action:"screenShotAvailable",options:{data:d,encoding:"base64",format:"png",width:o,height:r}}),u=this._eventCallbackMap.get("screenShotAvailable");void 0!==u&&u.forEach((e,t)=>{e.executeCallback(m)})}))}snapshotCore(e){if(void 0===this._mcd||!0!==this._isModelLoaded)return this.MCD_BAD_PARAM_J;if(null==e)return this.MCD_BAD_PARAM_J;const t=JSON.parse(e);return t.targetComposite?this._mcd.Snapshot(JSON.stringify(t),null):this.snapshotAsync(e),this.MCD_OK_J}addSnapshotEvent(e){this.snapshotEvent=e}getSnapshotEvent(){if(this.snapshotEvent)return this.snapshotEvent}set modelName(e){null!==e&&(this._modelName=e)}get modelName(){return this._modelName}getUserPreferences(){return s(this,void 0,void 0,(function*(){const e={RenderEffects:["AntiAlias","AmbientOcclusion","Outline"],CameraPosition:null,Background:null};return Promise.all(Object.keys(e).map(t=>s(this,void 0,void 0,(function*(){const i=yield this.get(t,"");if(e[t]){const s=JSON.parse(i),n=e[t].filter(e=>s.hasOwnProperty(e)).reduce((e,t)=>(e[t]=s[t],e),{});return JSON.stringify(n)}return i}))))}))}setUserPreferences(e){return s(this,void 0,void 0,(function*(){const t=yield["RenderEffects","CameraPosition","Background"].map(t=>Boolean(this.set(t,e))).reduce((e,t)=>e&&t);return this.commitCameraChanges(1),t}))}destroyMCD(){this._animationFrameRequestId&&(cancelAnimationFrame(this._animationFrameRequestId),this._animationFrameRequestId=0),this._mcd&&(Module.DestroyMCD(this._mcd),this._mcd=null)}startMonitoring(){this._mcd&&!this._performance&&(this._performance=Module.GetPerfMon(this._mcd)),this._performance&&this._performance.StartMonitoring()}stopMonitoring(){this._performance&&this._performance.StopMonitoring()}getPerformanceData(e){return this._performance?this._performance.GetPerfData(e):"{}"}getSystemAndOpenGLInformation(){return s(this,void 0,void 0,(function*(){return new Promise((e,t)=>{e(new l.BrowserAndWebGLInfo(this._graphicsContext).getBrowserAndWebGLInformation())})}))}fitToRange(e,t=!0){if(void 0===this._mcd||!0!==this._isModelLoaded||null===e)return this.MCD_BAD_PARAM_J;const i='{"range":'+e.toJsonString()+"}";return this._mcd.FitToRange(i,t),this.MCD_OK_J}}},AZO4:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i("b7LP"),a=i("Pyzi");class o{get RenderId(){return this._renderId}set RenderId(e){this._renderId=e}get Range(){return this._range}set Range(e){this._range=e}get Name(){return this._name}set Name(e){this._name=e}}t.ObjectIdentity=o;class r extends o{get BatchId(){return this._batchId}set BatchId(e){this._batchId=e}constructor(e){super(),this._batchId=e}}t.ObIdHolder=r;class l{get EntryId(){return this._entryid}set EntryId(e){this._entryid=e}constructor(e){this._entryid=e}}t.CacheEntry=l;class h{constructor(){this._modelId="",this._url="",this._token="",this._entryCount=0,this._maxCacheEntries=1e3}get modelId(){return this._modelId}get url(){return this._url}Initialize(e,t,i){return this._modelId=e,this._url=t,this._appContext=i,!0}SetAuth(e){this._token=e}LookupById(e,t){}LookupByIds(e,t){return s(this,void 0,void 0,(function*(){const i=e.length,s=[];for(let n=0;n<i;n++){const i=yield this.LookupById(e[n],t[n]);s.push(i)}return s}))}LookupByName(e){}LookupByNames(e){return s(this,void 0,void 0,(function*(){}))}RefreshMap(e){return!1}}t.GVCIdMap=h,t.GDS3DIdMap=class extends h{constructor(){super(...arguments),this._cacheList=new a.LinkedList,this._lookupBatches=new Map,this._lookupMonikers=new Map,this._lookupIds=new Map,this._nonBatchLookups=new a.LinkedList,this._queryUrl="",this._abortController=new AbortController}Initialize(e,t,i){this._modelId=e,this._url=t,this._appContext=i;const s=t.indexOf("Queries(");return!(s<0||(this._queryUrl=t.substring(0,s),this._abortSignal=this._abortController.signal,0))}LookupById(e,t){return s(this,void 0,void 0,(function*(){let i=this.LookupId(e);if(void 0===i&&null!=t){let s;s=Array.isArray(t)?t[0]:t,this._lookupBatches.has(s)||null==s||(yield this.GetBatch(s)),i=this.LookupId(e)}return void 0===i&&(i=yield this.GetObId(e)),i}))}GetObidFromJson(e,t){return void 0!==t.Id&&void 0!==t.Moniker&&void 0!==t.Range&&(e.Name=t.Moniker,e.RenderId=t.Id,e.Range=t.Range.Low instanceof Array?new n.MCDRange(t.Range.Low[0],t.Range.Low[1],t.Range.Low[2],t.Range.High[0],t.Range.High[1],t.Range.High[2]):new n.MCDRange(t.Range.Low.coordinates[0],t.Range.Low.coordinates[1],t.Range.Low.coordinates[2],t.Range.High.coordinates[0],t.Range.High.coordinates[1],t.Range.High.coordinates[2]),!0)}GetObId(e){return s(this,void 0,void 0,(function*(){const t=yield this.Fetch(this._queryUrl+"RenderIds("+e.toString()+")","",this._token);let i;return i=new o,this.GetObidFromJson(i,t.RenderAttributes)?(this._nonBatchLookups.push(i),this._lookupMonikers.set(i.Name,i),this._lookupIds.set(i.RenderId,i)):i=void 0,i}))}GetBatch(e){return s(this,void 0,void 0,(function*(){const t=yield this.Fetch(this._url+"/Batches("+e+")?$expand=RenderIds","",this._token);this.BuildCacheEntry(e,t.RenderAttributes.RenderIds)}))}BuildCacheEntry(e,t){if(t.length<1)return;const i=new l(e);i.batchData=[];for(let s=0;s<t.length;s++){const n=new r(e);if(this.GetObidFromJson(n,t[s])){if(i.batchData.push(n),this._lookupMonikers.has(n.Name)){const e=this._lookupMonikers[n.Name];e instanceof r==0&&-1!==this._nonBatchLookups.findIndex(e)&&this._nonBatchLookups.removeByData(e),this._lookupMonikers.delete(n.Name)}if(this._lookupMonikers.set(n.Name,n),this._lookupIds.has(n.RenderId)){const e=this._lookupIds[n.RenderId];e instanceof r==0&&-1!==this._nonBatchLookups.findIndex(e)&&this._nonBatchLookups.removeByData(e),this._lookupIds.delete(n.RenderId)}this._lookupIds.set(n.RenderId,n)}}if(this._lookupBatches.set(e,i),this._entryCount>=this._maxCacheEntries){const e=this._cacheList.tail.data;this._cacheList.removeByIndex(0),this._lookupBatches.delete(e.EntryId),e.batchData.forEach(e=>{this._lookupMonikers.delete(e.Name),this._lookupIds.delete(e.RenderId)}),this._entryCount--}this._cacheList.push(i),this._entryCount++}DesolveCacheEntry(e){const t=this._lookupBatches.get(e);if(null!=t){this._cacheList.removeByData(t),this._lookupBatches.delete(t.EntryId);for(let e=0;e<t.batchData.length;e++){const i=t.batchData[e];this._lookupMonikers.delete(i.Name),this._lookupIds.delete(i.RenderId)}this._entryCount--}}ResetNonBatchCache(){for(let e=0;e<this._nonBatchLookups.length;e++){const t=this._nonBatchLookups.getData(e);this._lookupMonikers.delete(t.Name),this._lookupIds.delete(t.RenderId),this._nonBatchLookups.removeByData(t)}}LookupId(e){if(this._lookupIds.has(e)){const t=this._lookupIds.get(e);if(void 0!==t&&this._lookupBatches.has(t.BatchId)){const e=this._lookupBatches.get(t.BatchId);return this._cacheList.removeByData(e),this._cacheList.push(e),t}}}Fetch(e,t,i){return s(this,void 0,void 0,(function*(){let s,n={StatusCode:200,RenderAttributes:void 0};s=void 0===t||0===t.length?{headers:{Authorization:"Bearer "+i,"Content-Type":"application/json"},method:"GET"}:{headers:{Authorization:"Bearer "+i,"Content-Type":"application/json"},method:"POST",body:t};const a=yield fetch(e,s),o=a.status;return 200===a.status&&(n=yield a.json().then(e=>({StatusCode:o,RenderAttributes:e}))),n}))}LookupMoniker(e){let t,i;if(this._lookupMonikers.has(e)){i=this._lookupMonikers.get(e);const s=i;return void 0!==s&&this._lookupBatches.has(s.BatchId)&&(t=this._lookupBatches.get(s.BatchId),this._cacheList.removeByData(t),this._cacheList.push(t)),s}}LookupByName(e){return s(this,void 0,void 0,(function*(){const t=[e];return yield this.LookupByNames(t)}))}LookupByNames(e){return s(this,void 0,void 0,(function*(){if(""===this._url||e.length<=0)return;const t=[],i=[];return e.forEach(e=>{const s=this.LookupMoniker(e);void 0!==s?t.push(s):i.push(e)}),0!==i.length&&(yield this.GetObidsFromMonikers(i)).forEach(e=>{t.push(e)}),t}))}RefreshMap(e){let t=!1;if(e instanceof Array){const i=new Set,s=e;for(let e=0;e<s.length;e++)i.add(s[e]);if(i.size>0){const e=Array.from(this._lookupBatches.keys());for(const s of e)i.has(s)||(this.DesolveCacheEntry(s),t=!0)}this.ResetNonBatchCache()}return t}GetObidsFromMonikers(e){return s(this,void 0,void 0,(function*(){const t={Lookup:{Monikers:e}},i=yield this.Fetch(this._queryUrl+"Com.Ingr.GDS.V1.LookupMonikers",JSON.stringify(t),this._token),s=[];return i.RenderAttributes.value.forEach(e=>{const t=new o;this.GetObidFromJson(t,e)&&(s.push(t),this._nonBatchLookups.push(t),this._lookupMonikers.set(t.Name,t),this._lookupIds.set(t.RenderId,t))}),s}))}}},B45s:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DynamicMeshLayer=class{constructor(e,t,i,s,n,a){if(this._compositeName="",this._dynamicMeshLayerName="",this._overlay=!1,this._edgeWidth=2,this._colorTable=[],this._vertices=[],this._colorIndices=[],this._triangleIndices=[],this._edgeIndices=[],this._pointIndices=[],this._dynamicMeshLayerName=e,this._modularCoreDisplay=t,void 0===i&&(i=2),void 0===s&&(s=!1),this._edgeWidth=i,n&&(this._compositeName=n),void 0===a&&(a=0),!this._modularCoreDisplay)throw new Error("Recieved null for Modular Core Display object");this.createDynamicMeshLayer(s,a),this.reset()}get edgeWidth(){return this._edgeWidth}set edgeWidth(e){this._edgeWidth=e}get colorTable(){return this._colorTable}get colorIndicies(){return this._colorIndices}get vertices(){return this._vertices}get triangleIndices(){return this._triangleIndices}get pointIndicies(){return this._pointIndices}get edgeIndicies(){return this._edgeIndices}createDynamicMeshLayer(e,t){void 0===e&&(e=!1),void 0===t&&(t=0);const i={};i["overlay-rendering"]=e,i["continuous-rendering"]=!1;const s={};return""!==this._compositeName&&(s["target-composite"]=this._compositeName),s["target-name"]=this._dynamicMeshLayerName,s["target-type"]="DynamicMesh",s.hidden=!1,s.config=i,s.priority=t,this._modularCoreDisplay.create("RenderTarget",JSON.stringify(s)),!1}destroyDynamicMeshLayer(){const e={};return e["target-name"]=this._dynamicMeshLayerName,this._modularCoreDisplay.destroy("RenderTarget",JSON.stringify(e)),!1}reset(){this._colorTable=[],this._colorIndices=[],this._vertices=[],this._triangleIndices=[],this._pointIndices=[],this._edgeIndices=[]}addData(e,t,i,s,n,a){const o=this._colorIndices.length,r=this._vertices.length;for(const l of e)this._colorTable.push(l);for(const l of t)this._vertices.push(l);for(const l of i)this._colorIndices.push(l+o);for(const l of s)this._triangleIndices.push(l+r);for(const l of n)this._pointIndices.push(l+r);for(const l of a)this._edgeIndices.push(l+r)}display(){let e="",t=0;const i=[],s=[];for(t=0;t<this._colorTable.length;t++)s[t]=JSON.parse("["+this._colorTable[t].x.toString()+","+this._colorTable[t].y.toString()+","+this._colorTable[t].z.toString()+","+this._colorTable[t].w.toString()+"]"),i.push(s[t]);let n="[";for(t=0;t<this._colorIndices.length;t++)n+=this._colorIndices[t].toString(),t<this._colorIndices.length-1&&(n+=",");n+="]";const a=JSON.parse(n);let o="[";for(t=0;t<this._vertices.length;t++)o+=this._vertices[t].x.toString()+","+this._vertices[t].y.toString()+","+this._vertices[t].z.toString(),t<this._vertices.length-1&&(o+=",");o+="]";const r=JSON.parse(o);let l="[";for(t=0;t<this._triangleIndices.length;t++)l+=this._triangleIndices[t].toString(),t<this._triangleIndices.length-1&&(l+=",");l+="]";const h=JSON.parse(l);let c="[";for(t=0;t<this._pointIndices.length;t++)c+=this._pointIndices[t].toString(),t<this._pointIndices.length-1&&(c+=",");c+="]";const _=JSON.parse(c);let d="[";for(t=0;t<this._edgeIndices.length;t++)d+=this._edgeIndices[t].toString(),t<this._edgeIndices.length-1&&(d+=",");d+="]";const m=JSON.parse(d),u=JSON.parse('{"colorindices":'+JSON.stringify(a)+', "colortable":'+JSON.stringify(i)+', "triangleindices":'+JSON.stringify(h)+', "vertices":'+JSON.stringify(r)+', "pointindices":'+JSON.stringify(_)+', "edgeindices":'+JSON.stringify(m)+', "linewidth": '+this._edgeWidth+"}");e='{"setMesh":'+JSON.stringify(u)+',"target-name": "'+this._dynamicMeshLayerName+'"}',this._modularCoreDisplay.set("RenderTarget",e)}setVisibility(e){const t={};t["target-name"]=this._dynamicMeshLayerName,t.visibility=e,this._modularCoreDisplay.set("RenderTarget",JSON.stringify(t))}}},BLW0:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("ZV0p"),n=i("Khlq");t.FlyNavigation=class extends s.FlyNavigationBase{constructor(){super(),this._intervalId=null,this._moveInSet=!1,this._moveOutSet=!1}get moveInSet(){return this._moveInSet}get moveOutSet(){return this._moveOutSet}moveIn(){this._moveInSet||(clearInterval(this._intervalId),this._intervalId=setInterval(()=>{this._zoomDelta=2,this._modularCoreDisplay.locateAsync(JSON.stringify({LocateType:n.MCD_ENUM.LocateType.SurfacePoint,ScreenPosition:{x:this.width/2,y:this.height/2}}))},n.MCD_ENUM.TouchContinuousFlyConstants.INTERVAL_DELAY),this._moveInSet=!0,this._moveOutSet=!1)}moveOut(){this._moveOutSet||(clearInterval(this._intervalId),this._intervalId=setInterval(()=>{this._zoomDelta=-2,this._modularCoreDisplay.locateAsync(JSON.stringify({LocateType:n.MCD_ENUM.LocateType.SurfacePoint,ScreenPosition:{x:this.width/2,y:this.height/2}}))},n.MCD_ENUM.TouchContinuousFlyConstants.INTERVAL_DELAY),this._moveOutSet=!0,this._moveInSet=!1)}look(e,t){if(Math.abs(e)>n.MCD_ENUM.EventConstants.MIN_TRANSLATION_DELTA||Math.abs(t)>n.MCD_ENUM.EventConstants.MIN_TRANSLATION_DELTA){let i=1;i=this._width/360,this._modularCoreDisplay.motionRotate(e/i,t/i,!1),this._modularCoreDisplay.commitCameraChanges(n.MCD_ENUM.CommitAction.CT_Immediate)}}stopMoveMode(){clearInterval(this._intervalId),this._moveInSet=!1,this._moveOutSet=!1}doContinuousFly(e){e===n.MCD_ENUM.TouchContinuousFlyConstants.FORWARD?this.moveIn():e===n.MCD_ENUM.TouchContinuousFlyConstants.BACKWARD&&this.moveOut(),e<1&&this.stopMoveMode()}}},DCEI:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("2T81");class n{static ifPtIsBetweenTwoPtsOnLine(e,t,i){const n=new s.GlMath,a=n.normalize(n.sub(e,t)),o=n.normalize(n.sub(i,e));return n.dot(a,o)>0}static getDistancePtToPt(e,t){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)+(t.z-e.z)*(t.z-e.z))}static shortestDistancePtToLine(e,t,i){const n=new s.GlMath,a=n.sub(e,t);let o=n.sub(i,t);o=n.normalize(o);const r=n.cross(o,a);return Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z)}static checkRotationAlignWithAxis(e){const t=new s.GlMath;let i=new s.Vec3(0,0,0);for(let n=0;n<3;n++){let a=new s.Vec3(0,0,0);switch(n){case 0:a=new s.Vec3(1,0,0);break;case 1:a=new s.Vec3(0,1,0);break;case 2:a=new s.Vec3(0,0,1)}if(i=t.cross(e,a),Math.abs(i.x)<Number.EPSILON&&Math.abs(i.y)<Number.EPSILON&&Math.abs(i.z)<Number.EPSILON)break}return-1}static computeRotateAlongLineMatrix(e,t,i){const a=new s.GlMath;let o=new s.Mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);const r=new s.Mat4(1,0,0,0,0,1,0,0,0,0,1,0,-t.x,-t.y,-t.z,1),l=new s.Mat4(1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,t.z,1),h=a.sub(i,t),c=n.checkRotationAlignWithAxis(h);if(-1!==c){const t=Math.cos(e*Math.PI/180),i=Math.sin(e*Math.PI/180),n=new s.Mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);switch(c){case 0:n.m11=t,n.m12=-i,n.m21=i,n.m22=t;break;case 1:n.m00=t,n.m02=-i,n.m20=i,n.m22=t;break;case 2:n.m00=t,n.m01=-i,n.m10=i,n.m11=t}o=a.multMat4(l,n),o=a.multMat4(o,r)}else{const t=h.x,i=h.y,n=h.z,c=Math.sqrt(t*t+i*i+n*n),_=Math.sqrt(i*i+n*n);let d=0,m=0;const u=_/c,p=-t/c,g=Math.cos(e*Math.PI/180),C=Math.sin(e*Math.PI/180),M=new s.Mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),E=new s.Mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),P=new s.Mat4(u,0,-p,0,0,1,0,0,p,0,u,0,0,0,0,1),y=new s.Mat4(u,0,p,0,0,1,0,0,-p,0,u,0,0,0,0,1),D=new s.Mat4(g,C,0,0,-C,g,0,0,0,0,1,0,0,0,0,1);Math.abs(_)>Number.EPSILON&&(d=n/_,m=i/_,M.m11=d,M.m12=m,M.m21=-m,M.m22=d,E.m11=d,E.m12=-m,E.m21=m,E.m22=d),o=a.multMat4(l,E),o=a.multMat4(o,y),o=a.multMat4(o,D),o=a.multMat4(o,P),o=a.multMat4(o,M),o=a.multMat4(o,r)}return o}static buildViewMatrix(e,t,i){const n=new s.GlMath,a=n.normalize(n.sub(e,t));let o=new s.Vec3(0,0,0);o=n.normalize(n.cross(i,a));let r=new s.Mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);const l=new s.Mat4(o.x,i.x,a.x,0,o.y,i.y,a.y,0,o.z,i.z,a.z,0,0,0,0,1),h=new s.Mat4(1,0,0,0,0,1,0,0,0,0,1,0,-e.x,-e.y,-e.z,1);return r=n.multMat4(l,h),r}static buildProjectionMatrix(e,t,i,n,a){e<1&&(e=1);const o=1/Math.tan(i/2*Math.PI/180);return new s.Mat4(o*(a/n),0,0,0,0,o,0,0,0,0,-(t+e)/(t-e),-1,0,0,-2*t*e/(t-e),0)}static buildDit2UorMatrix(e,t,i){const n=new s.GlMath,a=n.normalize(n.sub(e,t));i=n.normalize(i);let o=new s.Vec3(0,0,0);o=n.normalize(n.cross(i,a));let r=new s.Mat3(1,0,0,0,1,0,0,0,1);const l=new s.Mat3(o.x,i.x,a.x,o.y,i.y,a.y,o.z,i.z,a.z);return r=n.transposeMat3(l),r}static buildInverseProjViewMatrix(e,t,i){const a=new s.GlMath;let o=new s.Mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),r=new s.Mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),l=new s.Mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),h=new s.Mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);const c=JSON.parse(e);if(""!==e&&c.CameraPosition&&c.CameraPosition.center.x&&c.CameraPosition.center.y&&c.CameraPosition.center.z&&c.CameraPosition.eye.x&&c.CameraPosition.eye.y&&c.CameraPosition.eye.z&&c.CameraPosition.up.x&&c.CameraPosition.up.y&&c.CameraPosition.up.z&&c.CameraPosition["clip-far"]&&c.CameraPosition["clip-near"]&&c.CameraPosition.perspective){const e=new s.Vec3(0,0,0),_=new s.Vec3(0,0,0),d=new s.Vec3(0,1,0);e.x=c.CameraPosition.center.x,e.y=c.CameraPosition.center.y,e.z=c.CameraPosition.center.z,_.x=c.CameraPosition.eye.x,_.y=c.CameraPosition.eye.y,_.z=c.CameraPosition.eye.z,d.x=c.CameraPosition.up.x,d.y=c.CameraPosition.up.y,d.z=c.CameraPosition.up.z;const m=c.CameraPosition["clip-far"],u=c.CameraPosition["clip-near"],p=c.CameraPosition.perspective;r=n.buildViewMatrix(_,e,d),l=n.buildProjectionMatrix(u,m,p,t,i),h=a.multMat4(l,r),o=a.inverseMat4(h)}return o}static getModelPointForScreenPoint(e,t,i,n,a,o){const r=new s.GlMath,l=(e+.5)/(n-1),h=(t+.5)/(a-1),c=new s.Quat(0,0,0,0);c.x=2*l-1,c.y=2*h-1,c.z=2*i-1,c.w=1;const _=r.multMat4Quat(o,c),d=new s.Vec3(0,0,0);return d.x=_.x/_.w,d.y=_.y/_.w,d.z=_.z/_.w,d}static getNormalizedScreenPoint(e,t,i,n,a){const o=(e+.5)/(n-1),r=(t+.5)/(a-1),l=new s.Vec3(0,0,0);return l.x=2*o-1,l.y=2*r-1,l.z=2*i-1,l}static getScreenPointFromModelPoint(e,t,i,a){const o=new s.GlMath;let r=new s.Mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),l=new s.Mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);const h=JSON.parse(e);if(""!==e&&h.CameraPosition&&h.CameraPosition.center.x&&h.CameraPosition.center.y&&h.CameraPosition.center.z&&h.CameraPosition.eye.x&&h.CameraPosition.eye.y&&h.CameraPosition.eye.z&&h.CameraPosition.up.x&&h.CameraPosition.up.y&&h.CameraPosition.up.z&&h.CameraPosition["clip-far"]&&h.CameraPosition["clip-near"]&&h.CameraPosition.perspective){const e=new s.Vec3(0,0,0),c=new s.Vec3(0,0,0),_=new s.Vec3(0,1,0);e.x=h.CameraPosition.center.x,e.y=h.CameraPosition.center.y,e.z=h.CameraPosition.center.z,c.x=h.CameraPosition.eye.x,c.y=h.CameraPosition.eye.y,c.z=h.CameraPosition.eye.z,_.x=h.CameraPosition.up.x,_.y=h.CameraPosition.up.y,_.z=h.CameraPosition.up.z;const d=h.CameraPosition["clip-far"],m=h.CameraPosition["clip-near"],u=h.CameraPosition.perspective;r=n.buildViewMatrix(c,e,_),l=n.buildProjectionMatrix(m,d,u,t,i);const p=new s.Vec4(a.x,a.y,a.z,1),g=o.multMat4Vec4(r,p),C=o.multMat4Vec4(l,g);return C.x=C.x/C.a,C.y=C.y/C.a,C.z=C.z/C.a,C.x=.5*C.x+.5,C.y=.5*C.y+.5,C.z=.5*C.z+.5,C.x=Math.round(C.x*t),C.y=Math.round(C.y*i),new s.Vec2(C.x,C.y)}return null}static getScreenPointFromModelPointAndMatrices(e,t,i,n,a){const o=new s.GlMath;let r=new s.Mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),l=new s.Mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);if(null===e||null===t)return null;l=new s.Mat4(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]),r=new s.Mat4(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]);const h=new s.Vec4(a.x,a.y,a.z,1),c=o.multMat4Vec4(r,h),_=o.multMat4Vec4(l,c);return _.x=_.x/_.a,_.y=_.y/_.a,_.z=_.z/_.a,_.x=.5*_.x+.5,_.y=.5*_.y+.5,_.z=.5*_.z+.5,_.x=Math.round(_.x*i),_.y=Math.round(_.y*n),new s.Vec2(_.x,_.y)}}t.MathGeometry=n,t.RTTriangle=class{constructor(e,t,i,n=!1){this._glmath=new s.GlMath,this.init(e,t,i,n)}init(e,t,i,s=!1){this._v0=e,this._v1=t,this._v2=i,this._u=this._glmath.sub(t,e),this._v=this._glmath.sub(i,e);let n=this._glmath.cross(this._u,this._v);n=this._glmath.normalize(n),this._normal=this._glmath.mul(n,s?1:-1),this._uPerp=this._glmath.cross(this._normal,this._u),this._vPerp=this._glmath.cross(this._normal,this._v),this._denominatorST=this._glmath.dot(this._u,this._vPerp),Math.abs(this._denominatorST)}intersect(e,t,i){let n=new s.Vec3(0,0,0),a=new s.Vec3(0,0,0),o=new s.Vec3(0,0,0);n=this._glmath.sub(t,e),a=this._glmath.sub(e,this._v0);const r=-this._glmath.dot(this._normal,a),l=this._glmath.dot(this._normal,n);if(Math.abs(l)<Number.EPSILON)return!1;const h=r/l;if(h<0)return!1;i=this._glmath.add(e,this._glmath.mul(n,h)),this._pt=i;const c=this._glmath.dot(this._u,this._u),_=this._glmath.dot(this._u,this._v),d=this._glmath.dot(this._v,this._v);o=this._glmath.sub(i,this._v0);const m=this._glmath.dot(o,this._u),u=this._glmath.dot(o,this._v),p=_*_-c*d,g=(_*u-d*m)/p;if(g<0||g>1)return!1;const C=(_*m-c*u)/p;return!(C<0||g+C>1)}getInterceptPoint(){return this._pt}}},Dfju:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i("Khlq");t.EventManagerEvent=class{constructor(e,t,i){this.callBackFunction=e,this._recursive=t,this._useDefault=i}get recursive(){return this._recursive}set recursive(e){this._recursive=e}get useDefault(){return this._useDefault}set useDefault(e){this._useDefault=e}get callback(){return this.callBackFunction}set callback(e){this.callBackFunction=e}},t.EventManager=class{constructor(e,t,i,s,a,o,r,l,h){this._activeCommands=[],this._pausedCommands=[],this._permanentCommands=[],this._keyMappings={},this._defaultKeyMappings={},this._pressedKeys={},this._addedNativeCallbacks=!1,this._activeCommands.push(e),this._activeCommands.push(t),this._backgroundManagerCommand=i,this._modularCoreDisplay=a,this._inputManipulationProcess=o,this._eventRecorder=h,this.defaultKeyMappings=s,this.keyMappings=s,this.onManipulationStart=this.onManipulationStart.bind(this),this.onManipulationUpdate=this.onManipulationUpdate.bind(this),this.onManipulationEnd=this.onManipulationEnd.bind(this),this.onGesture=this.onGesture.bind(this),this.onLocate=this.onLocate.bind(this),this.onHold=this.onHold.bind(this),this.onTap=this.onTap.bind(this),this.onDoubleTap=this.onDoubleTap.bind(this),this.onCameraChange=this.onCameraChange.bind(this),this.onCameraMotionStart=this.onCameraMotionStart.bind(this),this.onCameraMotionEnd=this.onCameraMotionEnd.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.onModelUnloaded=this.onModelUnloaded.bind(this),this.onMouseClick=this.onMouseClick.bind(this),this.onMouseDoubleClick=this.onMouseDoubleClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseWheel=this.onMouseWheel.bind(this),this.onMouseRightClick=this.onMouseRightClick.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onKeyPress=this.onKeyPress.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onSnapshot=this.onSnapshot.bind(this),this.onSurfaceLocate=this.onSurfaceLocate.bind(this),this.onResourceLoad=this.onResourceLoad.bind(this),this.onLayout=this.onLayout.bind(this),this.onTouchCountUpdate=this.onTouchCountUpdate.bind(this),this.onTelemetry=this.onTelemetry.bind(this),this.onBackgroundLoaded=this.onBackgroundLoaded.bind(this),this.onError=this.onError.bind(this),this.onActiveSheetChange=this.onActiveSheetChange.bind(this),this.onClipPlanesInitialized=this.onClipPlanesInitialized.bind(this),this.onMCDInitialized=this.onMCDInitialized.bind(this),this._inputManipulationProcess.addEventlistener(n.MCD_ENUM.EventNames.MANIPULATION_START_EVENT,this.onManipulationStart),this._inputManipulationProcess.addEventlistener(n.MCD_ENUM.EventNames.MANIPULATION_UPDATE_EVENT,this.onManipulationUpdate),this._inputManipulationProcess.addEventlistener(n.MCD_ENUM.EventNames.MANIPULATION_END_EVENT,this.onManipulationEnd),this._inputManipulationProcess.addEventlistener(n.MCD_ENUM.EventNames.HOLD_EVENT,this.onHold),this._inputManipulationProcess.addEventlistener(n.MCD_ENUM.EventNames.TAP_EVENT,this.onTap),this._inputManipulationProcess.addEventlistener(n.MCD_ENUM.EventNames.DOUBLE_TAP_EVENT,this.onDoubleTap),this._inputManipulationProcess.addEventlistener(n.MCD_ENUM.EventNames.MOUSE_RIGHT_CLICK_EVENT,this.onMouseRightClick),this._inputManipulationProcess.addEventlistener(n.MCD_ENUM.EventNames.TOUCH_COUNT_UPDATE_EVENT,this.onTouchCountUpdate),r&&(r.ondblclick=this.onMouseDoubleClick,r.onclick=this.onMouseClick,r.onmousedown=this.onMouseDown,document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp),r.addEventListener("wheel",this.onMouseWheel),r.onkeypress=this.onKeyPress,r.onkeyup=this.onKeyUp,r.onkeydown=this.onKeyDown,r.focus()),this.fireCallback=this.fireCallback.bind(this),this.pop=this.pop.bind(this),this.push=this.push.bind(this),this.pushPermanentListener=this.pushPermanentListener.bind(this),this.popPermanentListener=this.popPermanentListener.bind(this),this.pushPausedCommand=this.pushPausedCommand.bind(this),this.popPausedCommand=this.popPausedCommand.bind(this),this.closeAllCommands=this.closeAllCommands.bind(this)}get hasAddedNativeCallbacks(){return this._addedNativeCallbacks}get activeCommands(){return this._activeCommands}get pausedCommands(){return this._pausedCommands}get eventRecorder(){return this._eventRecorder}set eventRecorder(e){this._eventRecorder=e}get backgroundManagerCommand(){return this._backgroundManagerCommand}set backgroundManagerCommand(e){this._backgroundManagerCommand=e}set keyMappings(e){for(let t=0;t<e.length;t++)this._keyMappings[e[t].getMappingKey()]=e[t]}set defaultKeyMappings(e){this._defaultKeyMappings={};for(let t=0;t<e.length;t++)this._defaultKeyMappings[e[t].getMappingKey()]=e[t];this.resetKeyMappings(),this._activeCommands.length>2&&(this.keyMappings=this._activeCommands[this._activeCommands.length-1].keyMappings)}get transientCommand(){return this._transientCommand}set transientCommand(e){this._transientCommand&&this._transientCommand.stop(),this._transientCommand=e}resetKeyMappings(){this._keyMappings={};for(const e in this._defaultKeyMappings)this._keyMappings[e]=this._defaultKeyMappings[e]}addNativeCallbacks(){this._modularCoreDisplay.addEventCallback(n.MCD_ENUM.CallbackEventNames.LOCATE_ELEMENT_EVENT,this.onLocate),this._modularCoreDisplay.addEventCallback(n.MCD_ENUM.CallbackEventNames.CAMERA_CHANGE_EVENT,this.onCameraChange),this._modularCoreDisplay.addEventCallback(n.MCD_ENUM.CallbackEventNames.MODEL_LOADED_EVENT,this.onModelLoaded),this._modularCoreDisplay.addEventCallback(n.MCD_ENUM.CallbackEventNames.MODEL_UNLOADED_EVENT,this.onModelUnloaded),this._modularCoreDisplay.addEventCallback(n.MCD_ENUM.CallbackEventNames.SNAPSHOT_EVENT,this.onSnapshot),this._modularCoreDisplay.addEventCallback(n.MCD_ENUM.CallbackEventNames.LOCATE_EVENT,this.onSurfaceLocate),this._modularCoreDisplay.addEventCallback(n.MCD_ENUM.CallbackEventNames.RESOURCE_LOAD_EVENT,this.onResourceLoad),this._modularCoreDisplay.addEventCallback(n.MCD_ENUM.CallbackEventNames.BACKGROUND_LOAD_EVENT,this.onBackgroundLoaded),this._modularCoreDisplay.addEventCallback(n.MCD_ENUM.CallbackEventNames.ERROR_EVENT,this.onError),this._modularCoreDisplay.addEventCallback(n.MCD_ENUM.CallbackEventNames.SHEET_CHANGE_EVENT,this.onActiveSheetChange),this._addedNativeCallbacks=!0}onTouchCountUpdate(e){this.fireCallback(n.MCD_ENUM.EventNames.TOUCH_COUNT_UPDATE_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onManipulationStart(e){this.fireCallback(n.MCD_ENUM.EventNames.MANIPULATION_START_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onManipulationUpdate(e){this.fireCallback(n.MCD_ENUM.EventNames.MANIPULATION_UPDATE_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onManipulationEnd(e){this.fireCallback(n.MCD_ENUM.EventNames.MANIPULATION_END_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onGesture(e){this.fireCallback(n.MCD_ENUM.EventNames.GESTURE_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onLocate(e){this.fireCallback(n.MCD_ENUM.CallbackEventNames.LOCATE_ELEMENT_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onHold(e){this.fireCallback(n.MCD_ENUM.EventNames.HOLD_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onTap(e){this.fireCallback(n.MCD_ENUM.EventNames.TAP_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onDoubleTap(e){this.fireCallback(n.MCD_ENUM.EventNames.DOUBLE_TAP_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onCameraChange(e){this.fireCallback(n.MCD_ENUM.CallbackEventNames.CAMERA_CHANGE_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onCameraMotionStart(){this.fireCallback(n.MCD_ENUM.EventNames.CAMERA_MOTION_START,this._activeCommands[this._activeCommands.length-1])}onCameraMotionEnd(){this.fireCallback(n.MCD_ENUM.EventNames.CAMERA_MOTION_END,this._activeCommands[this._activeCommands.length-1])}onModelLoaded(e){this.fireCallback(n.MCD_ENUM.CallbackEventNames.MODEL_LOADED_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onModelUnloaded(e){this.fireCallback(n.MCD_ENUM.CallbackEventNames.MODEL_UNLOADED_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onMouseClick(e){this.fireCallback(n.MCD_ENUM.EventNames.MOUSE_CLICK_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onMouseDoubleClick(e){this.fireCallback(n.MCD_ENUM.EventNames.MOUSE_DOUBLE_CLICK_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onMouseMove(e){this.fireCallback(n.MCD_ENUM.EventNames.MOUSE_MOVE_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onMouseUp(e){this.fireCallback(n.MCD_ENUM.EventNames.MOUSE_UP_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onMouseDown(e){this.fireCallback(n.MCD_ENUM.EventNames.MOUSE_DOWN_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onMouseWheel(e){this.fireCallback(n.MCD_ENUM.EventNames.MOUSE_WHEEL_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onMouseRightClick(e){this.fireCallback(n.MCD_ENUM.EventNames.MOUSE_RIGHT_CLICK_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onMouseOut(e){this.fireCallback(n.MCD_ENUM.EventNames.MOUSE_OUT_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onKeyPress(e){}onKeyUp(e){this._pressedKeys[e.keyCode.toString()]&&delete this._pressedKeys[e.keyCode.toString()];const t=this.getMCDKeyFromEvent(e,!1);t&&t.callback&&t.callback(),0!==Object.keys(this._pressedKeys).length||e.ctrlKey||"ControlLeft"===e.code||"ControlRight"===e.code||e.shiftKey||"ShiftLeft"===e.code||"ShiftRight"===e.code||e.altKey||"AltLeft"===e.code||"AltRight"===e.code||e.metaKey||"MetaLeft"===e.code||"MetaRight"===e.code||this.fireCallback(n.MCD_ENUM.EventNames.GESTURE_EVENT,this._activeCommands[1],n.MCD_ENUM.GestureEventNames.GESTURE_KEY_UP)}onKeyDown(e){this._pressedKeys[e.keyCode.toString()]=e.keyCode;const t=this.getMCDKeyFromEvent(e,!0);t&&t.callback&&t.callback()}onSnapshot(e){this.fireCallback(n.MCD_ENUM.CallbackEventNames.SNAPSHOT_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onSurfaceLocate(e){return s(this,void 0,void 0,(function*(){this.fireCallback(n.MCD_ENUM.CallbackEventNames.LOCATE_EVENT,this._activeCommands[this._activeCommands.length-1],e)}))}onResourceLoad(e){this.fireCallback(n.MCD_ENUM.CallbackEventNames.RESOURCE_LOAD_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onLayout(e){this.fireCallback(n.MCD_ENUM.EventNames.LAYOUT_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onTelemetry(e){this.fireCallback(n.MCD_ENUM.EventNames.TELEMETRY_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onBackgroundLoaded(e){this.fireCallback(n.MCD_ENUM.CallbackEventNames.BACKGROUND_LOAD_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onError(e){this.fireCallback(n.MCD_ENUM.CallbackEventNames.ERROR_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onActiveSheetChange(e){this.fireCallback(n.MCD_ENUM.CallbackEventNames.SHEET_CHANGE_EVENT,this._activeCommands[this._activeCommands.length-1],e)}onClipPlanesInitialized(){this.fireCallback(n.MCD_ENUM.EventNames.CLIP_PLANES_INITIALIZED,this._activeCommands[this._activeCommands.length-1])}onMCDInitialized(){this.fireCallback(n.MCD_ENUM.EventNames.MCD_INITIALIZED,this.activeCommands[this.activeCommands.length-1])}push(e){return this._activeCommands.length>2&&this.pop(),this._activeCommands.push(e),this.keyMappings=e.keyMappings,!0}pop(){if(2===this._activeCommands.length)return!1;const e=this._activeCommands[this._activeCommands.length-1];return e.isPausable&&!e.isPaused?e.pause():e.isActive&&e.stop(),this._activeCommands.length>2&&this._activeCommands.pop(),this.resetKeyMappings(),!0}pushPermanentListener(e){this._permanentCommands.push(e)}popPermanentListener(e){for(const t of this._permanentCommands)if(t===e){this._permanentCommands.splice(this._permanentCommands.indexOf(t),1);break}}pushPausedCommand(e){let t=!1;for(const i of this._pausedCommands)if(i===e){t=!0;break}t||this._pausedCommands.push(e)}popPausedCommand(e){for(const t of this._pausedCommands)if(t===e){this._pausedCommands.splice(this._pausedCommands.indexOf(t),1);break}}closeAllCommands(){this._activeCommands[this._activeCommands.length-1].stop();for(const e of this._pausedCommands)e.stop();this._transientCommand&&this._transientCommand.stop(),this._pausedCommands=[],this._activeCommands=[this._activeCommands[0],this._activeCommands[1]]}getActiveCommand(){if(2!==this._activeCommands.length)return this._activeCommands[this._activeCommands.length-1]}fireCallback(e,t,i){const s=[];if(e===n.MCD_ENUM.CallbackEventNames.CAMERA_CHANGE_EVENT||e===n.MCD_ENUM.EventNames.GESTURE_EVENT||e===n.MCD_ENUM.CallbackEventNames.MODEL_LOADED_EVENT){for(const t of this._activeCommands){const n=t.getEvent(e);if(n)if(void 0!==i){const e=n.callback(i);void 0!==e&&s.push({value:e,command:t})}else{const e=n.callback();void 0!==e&&s.push({value:e,command:t})}}for(const t of this._permanentCommands){const n=t.getEvent(e);if(n)if(void 0!==i){const e=n.callback(i);void 0!==e&&s.push({value:e,command:t})}else{const e=n.callback();void 0!==e&&s.push({value:e,command:t})}}return this.eventRecorder&&this.eventRecorder.record({event:e,param:i,ret:s.length>0?s:void 0}),!0}if(e===n.MCD_ENUM.CallbackEventNames.BACKGROUND_LOAD_EVENT){const t=this._backgroundManagerCommand.getEvent(e);if(t){const e=t.callback(i);void 0!==e&&s.push({value:e,command:this._backgroundManagerCommand})}}if(this._transientCommand){const t=this._transientCommand.getEvent(e);if(t){if(void 0!==i){const e=t.callback(i);void 0!==e&&s.push({value:e,command:this._transientCommand})}else{const e=t.callback();void 0!==e&&s.push({value:e,command:this._transientCommand})}return this._transientCommand.stop(),this.eventRecorder&&this.eventRecorder.record({event:e,param:i,ret:s.length>0?s:void 0}),!0}}let a=t.getEvent(e),o=t;if(a&&e!==n.MCD_ENUM.EventNames.TELEMETRY_EVENT&&e!==n.MCD_ENUM.CallbackEventNames.ERROR_EVENT?a.useDefault&&(o=this._activeCommands[0],a=o.getEvent(e)):(o=this._activeCommands[0],a=o.getEvent(e)),a&&a.callback){if(i){let t=a.callback(i);void 0!==t&&s.push({value:t,command:o}),a.recursive&&this._activeCommands[0].getEvent(e)&&(t=this._activeCommands[0].getEvent(e).callback(i),void 0!==t&&s.push({value:t,command:this._activeCommands[0]}))}else{let t=a.callback();void 0!==t&&s.push({value:t,command:o}),a.recursive&&this._activeCommands[0].getEvent(e)&&(t=this._activeCommands[0].getEvent(e).callback(),void 0!==t&&s.push({value:t,command:this._activeCommands[0]}))}return this.eventRecorder&&this.eventRecorder.record({event:e,param:i,ret:s.length>0?s:void 0}),!0}return this.eventRecorder&&this.eventRecorder.record({event:e,param:i,ret:s.length>0?s:void 0}),!1}getMCDKeyFromEvent(e,t){let i="";return(e.ctrlKey||"ControlLeft"===e.code||"ControlRight"===e.code)&&(i+="ctrl_"),(e.shiftKey||"ShiftLeft"===e.code||"ShiftRight"===e.code)&&(i+="shift_"),(e.altKey||"AltLeft"===e.code||"AltRight"===e.code)&&(i+="alt_"),(e.metaKey||"MetaLeft"===e.code||"MetaRight"===e.code)&&(i+="meta_"),i+=t?n.MCD_ENUM.KeyEventType.KEY_DOWN:n.MCD_ENUM.KeyEventType.KEY_UP,i+=e.keyCode.toString(),this._keyMappings[i]}removeListeners(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)}}},E9dD:function(e,t,i){"use strict";function s(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),s(i("L6aT")),s(i("o+o0")),s(i("OiKg")),s(i("MB4v")),s(i("Khlq")),s(i("Oc5x")),s(i("AQPt")),s(i("bwSC")),s(i("uZBq")),s(i("Tb5U")),s(i("sinj")),s(i("Xlwq")),s(i("hlJD")),s(i("hvII")),s(i("87hY")),s(i("+kco")),s(i("paaN")),s(i("hh6j")),s(i("B45s")),s(i("aZWK")),s(i("v99T")),s(i("DCEI")),s(i("2T81")),s(i("FYTm")),s(i("vXm2")),s(i("b7LP")),s(i("Dfju")),s(i("JxDP")),s(i("RU2X")),s(i("4jpW")),s(i("4qvN")),s(i("He3+")),s(i("ngv1")),s(i("fx83")),s(i("LbbN")),s(i("cb4p")),s(i("HtSf")),s(i("jNbR")),s(i("ZV0p")),s(i("BLW0")),s(i("JB48")),s(i("NP6r")),s(i("Uwny")),s(i("2hPL")),s(i("uKvH")),s(i("mN5u")),s(i("Y0B9")),s(i("qx5m")),s(i("bM4Y")),s(i("P/D+")),s(i("Vw1h")),s(i("bipn")),s(i("XHCD")),s(i("+ZXO")),s(i("AZO4")),s(i("A8b+")),s(i("rFol")),s(i("lhyZ")),s(i("3xuU"))},FYTm:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureLayer=class{constructor(e,t,i=[],s=0,n=!1,a=""){if(this._modularCoreDisplay=null,!e)throw new Error("Value recived was null or empty for strLayerName");if(this._layerName=e,this._modularCoreDisplay=t,null==this._modularCoreDisplay)throw new Error("Value recived was undefined/null for oMCD");if(null==i)throw new Error("Value recived was null for styles");if(null==s)throw new Error("Value recived was null for priority");if(null==n)throw new Error("Value recived was null for clearDepth");if(null==a)throw new Error("Value recived was null for strTargetComposite");this._targetComposite=a,this.createFeatureLayer(i,s,n)}set visible(e){const t={};t["target-name"]=this._layerName,t.visibility=e,this._modularCoreDisplay.set("RenderTarget",JSON.stringify(t)),this._visibility=e}get visible(){return this._visibility}setDefaultStyleToLayer(e){const t={};t.style=e,t["target-name"]=this._layerName,e.styleID="Default",this._modularCoreDisplay.set("RenderTarget",JSON.stringify(t))}createOrUpdateStyle(e){const t={};t.style=e,t["target-name"]=this._layerName,this._modularCoreDisplay.set("RenderTarget",JSON.stringify(t))}setStyleToFeature(e,t){const i={type:"style"};i.id=e,i.styleID=t;const s={};s["target-name"]=this._layerName,s.modify=i,this._modularCoreDisplay.set("RenderTarget",JSON.stringify(s))}addText(e,t,i,s,n=""){const a={type:"text"};a.id=e,a.position=[i.x,i.y,i.z],a.text=t,a.alignment=s,""!==n&&(a.styleID=n);const o={};o["target-name"]=this._layerName,o.create=a,this._modularCoreDisplay.set("RenderTarget",JSON.stringify(o))}addPoint(e,t,i="",s=null){const n={type:"point"};n.id=e,n.position=[t.x,t.y,t.z],""!==i&&(n.styleID=i),null!==s&&(n.normal=[s.x,s.y,s.z]);const a={};a["target-name"]=this._layerName,a.create=n,this._modularCoreDisplay.set("RenderTarget",JSON.stringify(a))}addLine(e,t,i,s=""){const n={type:"line"};n.id=e,n.start=[t.x,t.y,t.z],n.end=[i.x,i.y,i.z],""!==s&&(n.styleID=s);const a={};a["target-name"]=this._layerName,a.create=n,this._modularCoreDisplay.set("RenderTarget",JSON.stringify(a))}removeFeature(e){const t={},i={};i.id=e,t["target-name"]=this._layerName,t.remove=i,this._modularCoreDisplay.set("RenderTarget",JSON.stringify(t))}createFeatureLayer(e,t,i){const s={};s.styles=e,s["clear-depth"]=i;const n={};""!==this._targetComposite&&(n["target-composite"]=this._targetComposite),n["target-name"]=this._layerName,n["target-type"]="Features",n.hidden=!1,n.priority=t,n.config=s,this._modularCoreDisplay.create("RenderTarget",JSON.stringify(n))}}},"He3+":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("4qvN"),n=i("Khlq"),a=i("JxDP"),o=i("fx83"),r=i("XHCD");t.ZoomAreaBase=class extends a.MCDViewCommand{constructor(){super(!1)}createZoomArea(e,t,i,a,o){this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._modularCoreDisplay=e,this._width=i,this._height=a,o?(this._zoomArea=new s.ZoomArea(this._modularCoreDisplay,i,a,o),this._zoomArea.finishedCallback=this.stop):(this._zoomArea=new s.ZoomArea(this._modularCoreDisplay,i,a),this._zoomArea.finishedCallback=this.stop),this._eventManager=t,this.manipulationStartCallback=this.onManipulationStartEvent.bind(this),this.manipulationUpdateCallback=this.onManipulationUpdateEvent.bind(this),this.manipulationEndCallback=this.onManipulationEndEvent.bind(this),this.mouseMoveCallback=this.onMouseMoveEvent.bind(this),this.onLayout=this.onLayout.bind(this),this.surfaceLocateCallback=this.onSurfaceLocate.bind(this),this.mouseClickCallback=this.onMouseClick.bind(this),this.mouseRightClickCallback=this.onMouseRightClick.bind(this),this.doubleTapCallback=this.onDoubleTap.bind(this),this.tapCallback=this.onTap.bind(this),this.mouseWheelCallback=this.onMouseWheel.bind(this),this.addEvent(n.MCD_ENUM.EventNames.MANIPULATION_START_EVENT,this.manipulationStartCallback,!1,!1),this.addEvent(n.MCD_ENUM.EventNames.MANIPULATION_UPDATE_EVENT,this.manipulationUpdateCallback,!1,!1),this.addEvent(n.MCD_ENUM.EventNames.MANIPULATION_END_EVENT,this.manipulationEndCallback,!1,!1),this.addEvent(n.MCD_ENUM.EventNames.MOUSE_MOVE_EVENT,this.mouseMoveCallback,!1,!1),this.addEvent(n.MCD_ENUM.EventNames.MOUSE_CLICK_EVENT,this.mouseClickCallback,!1,!1),this.addEvent(n.MCD_ENUM.EventNames.MOUSE_RIGHT_CLICK_EVENT,this.mouseRightClickCallback,!1,!1),this.addEvent(n.MCD_ENUM.EventNames.DOUBLE_TAP_EVENT,this.doubleTapCallback,!1,!1),this.addEvent(n.MCD_ENUM.EventNames.TAP_EVENT,this.tapCallback,!1,!1),this.addEvent(n.MCD_ENUM.EventNames.MOUSE_WHEEL_EVENT,this.mouseWheelCallback,!1,!1),this.addEvent(n.MCD_ENUM.CallbackEventNames.LOCATE_EVENT,this.surfaceLocateCallback,!1,!1),this._defaultEventMap=this._eventMap,this._keyMappings=this.createKeyMappings()}createKeyMappings(){return[new o.MCDKey(27,n.MCD_ENUM.KeyEventType.KEY_UP,this.stop)]}set width(e){this._width=e,this._zoomArea.hasCanvas()&&this._zoomArea.setViewSize(this._width,this._height)}get width(){return this._width}set height(e){this._height=e,this._zoomArea.hasCanvas()&&this._zoomArea.setViewSize(this._width,this._height)}get height(){return this._height}updateViewSize(e,t){this._width=e,this._height=t,this._zoomArea.hasCanvas()&&this._zoomArea.setViewSize(this._width,this._height)}start(){const e=super.start();return e&&(this._zoomArea.setupCrossLines(),this._eventManager.onTelemetry(r.Telemetry.getTelemetryJson(n.MCD_ENUM.TelemetryEventName.ZoomAreaCommand,n.MCD_ENUM.TelemetryEventType.Feature,n.MCD_ENUM.TelemetryMessageType.Start))),e}stop(){const e=super.stop();return e&&(this._zoomArea.endRectangle(0,0,!1),this._zoomArea.clearCrossLines(),this._zoomArea.destroyDynamicMeshLayer(),this._eventManager.onTelemetry(r.Telemetry.getTelemetryJson(n.MCD_ENUM.TelemetryEventName.ZoomAreaCommand,n.MCD_ENUM.TelemetryEventType.Feature,n.MCD_ENUM.TelemetryMessageType.End))),e}destroyDynamicMeshLayer(){this._zoomArea.destroyDynamicMeshLayer()}onManipulationStartEvent(e){return!!this._zoomArea&&(this._zoomArea.startRectangle(e.x,e.y),!0)}onManipulationUpdateEvent(e){return!!this._zoomArea&&(this._zoomArea.updateRectangle(e.x,e.y),!0)}onManipulationEndEvent(e){return!!this._zoomArea&&(this._zoomArea.endRectangle(e.x,e.y,!0),!0)}onMouseMoveEvent(e){return!!this._zoomArea&&(this._zoomArea.updateRectangle(e.x,e.y),this._zoomArea.updateCrossLines(e.x,e.y),!0)}onMouseWheel(e){return!0}onLayout(e,t){this._zoomArea.setViewSize(e,t)}onSurfaceLocate(e){this._zoomArea.fitToScreenBox(e)}onMouseRightClick(e){this.stop()}onDoubleTap(e){this.stop()}onTap(e){}onMouseClick(e){}}},HtSf:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i("JxDP"),a=i("Khlq"),o=i("cb4p"),r=i("2T81");t.WalkingViewBase=class extends n.MCDViewCommand{constructor(){super(!1),this._isDragMode=!1,this._isTeleportReady=!1,this.handleGoHome=this.handleGoHome.bind(this)}createWalkingView(e,t,i){this.addEvent=this.addEvent.bind(this),this.resetEvent=this.resetEvent.bind(this),this.resetAllEvents=this.resetAllEvents.bind(this),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.getEvent=this.getEvent.bind(this),this.dropCameraEvents=this.dropCameraEvents.bind(this),this._modularCoreDisplay=e,this._camera=t,this._walkingView=new o.WalkingView(this._modularCoreDisplay,this._camera),this._currentGraphicId=-1,this._eventManager=i,this.manipulationUpdateCallback=this.onManipulationUpdateEvent.bind(this),this.manipulationEndCallback=this.onManipulationEndEvent.bind(this),this.mouseMoveCallback=this.onMouseMoveEvent.bind(this),this.mouseUpCallback=this.onMouseUp.bind(this),this.addEvent(a.MCD_ENUM.EventNames.MANIPULATION_UPDATE_EVENT,this.manipulationUpdateCallback),this.addEvent(a.MCD_ENUM.EventNames.MANIPULATION_END_EVENT,this.manipulationEndCallback),this.addEvent(a.MCD_ENUM.EventNames.MOUSE_MOVE_EVENT,this.mouseMoveCallback),this.addEvent(a.MCD_ENUM.EventNames.MOUSE_UP_EVENT,this.mouseUpCallback,!1,!1),this.addEvent(a.MCD_ENUM.CallbackEventNames.LOCATE_EVENT,this.onObjectLocate.bind(this),!1,!1),this.addEvent(a.MCD_ENUM.CallbackEventNames.LOCATE_ELEMENT_EVENT,this.highlightOnDrag.bind(this),!1,!1),this._defaultEventMap=this.eventMap}handleGoHome(){const e=Object.create(null,{stop:{get:()=>super.stop}});return s(this,void 0,void 0,(function*(){this._camera.onGoHome=void 0,yield this._camera.lockCamera(!1,a.MCD_ENUM.CameraLock.LOCK_ELEVATION,!0),e.stop.call(this)&&(this._camera.firstPersonMode=!1)}))}start(){const e=super.start();return e&&(this._camera.onGoHome=this.handleGoHome,this.eventMap[a.MCD_ENUM.EventNames.MANIPULATION_END_EVENT].useDefault=!1,this.eventMap[a.MCD_ENUM.EventNames.MANIPULATION_UPDATE_EVENT].useDefault=!1,this.eventMap[a.MCD_ENUM.EventNames.MOUSE_MOVE_EVENT].useDefault=!1,this.eventMap[a.MCD_ENUM.EventNames.MOUSE_UP_EVENT].useDefault=!1,this.eventMap[a.MCD_ENUM.CallbackEventNames.LOCATE_EVENT].useDefault=!1,this.eventMap[a.MCD_ENUM.CallbackEventNames.LOCATE_ELEMENT_EVENT].useDefault=!1),e}stop(){const e=super.stop();return e&&(this._camera.firstPersonMode=!1,this._camera.lockCamera(!1,a.MCD_ENUM.CameraLock.LOCK_ELEVATION,!0)),e}onManipulationUpdateEvent(e){if(!this._modularCoreDisplay)return!1;const t={LocateType:a.MCD_ENUM.LocateType.Object,ScreenPosition:{x:e.x,y:e.y}};return this._isDragMode=!0,this._modularCoreDisplay.locateAsync(JSON.stringify(t)),!0}onManipulationEndEvent(e){if(!this._modularCoreDisplay)return!1;const t={LocateType:a.MCD_ENUM.LocateType.SurfacePoint,ScreenPosition:{x:e.x,y:e.y}};return this._isDragMode=!1,this._isTeleportReady=!0,this._modularCoreDisplay.locateAsync(JSON.stringify(t)),!0}onMouseMoveEvent(e){if(!this._modularCoreDisplay)return!1;const t={LocateType:a.MCD_ENUM.LocateType.Object,ScreenPosition:{x:e.x,y:e.y}};return this._isDragMode=!0,this._modularCoreDisplay.locateAsync(JSON.stringify(t)),!0}onMouseUp(e){if(!this._modularCoreDisplay)return!1;const t={LocateType:a.MCD_ENUM.LocateType.SurfacePoint,ScreenPosition:{x:e.x,y:e.y}};return this._isDragMode=!1,this._isTeleportReady=!0,this._modularCoreDisplay.locateAsync(JSON.stringify(t)),!0}highlightOnDrag(e){if(""===e)return!1;"string"==typeof e&&(e=JSON.parse(e));const t={hits:[]};for(let i=0;i<e["hit-records"].length;i++)if(e["hit-records"][i]["target-name"]===this._modularCoreDisplay.modelName){t.hits=e["hit-records"][i].hits;break}return!!this._isDragMode&&(0!==t.hits.length&&t.hits[0].hasOwnProperty("id")?(this._currentGraphicId!==t.hits[0].id&&(this._currentGraphicId=t.hits[0].id,this._modularCoreDisplay.selectObject(this._currentGraphicId)),!0):(this._currentGraphicId=-1,this._modularCoreDisplay.selectObject(this._currentGraphicId),!0))}moveOnDrop(e){return s(this,void 0,void 0,(function*(){let t=!1;if(""!==e&&this._isTeleportReady){let s=e;for(;"string"==typeof s;)s=JSON.parse(s);const n=s.hits;this._currentGraphicId=-1,this._modularCoreDisplay.selectObject(this._currentGraphicId);try{const e=n[0].x,i=n[0].y,s=n[0].z,a=yield this._modularCoreDisplay.get("CameraState",""),o=JSON.parse(a),l=1.524;o.eye[0]=e,o.eye[1]=i,o.eye[2]=s+l;let h=new r.Quat(o.orientation[0],o.orientation[1],o.orientation[2],o.orientation[3]);const c=new r.GlMath,_=c.eulerAngles(h);_.x=Math.PI/2,h=c.QuatFromAngles(_.x,_.y,_.z),o.orientation[0]=h.x,o.orientation[1]=h.y,o.orientation[2]=h.z,o.orientation[3]=h.w,o.isElevationLocked=!0,this._camera.moveToCameraState(o,!0),this._camera.firstPersonMode=!0,t=!0}catch(i){}this._isTeleportReady=!1}return this.isActive&&(this.eventMap[a.MCD_ENUM.EventNames.MANIPULATION_END_EVENT].useDefault=!0,this.eventMap[a.MCD_ENUM.EventNames.MANIPULATION_UPDATE_EVENT].useDefault=!0,this.eventMap[a.MCD_ENUM.EventNames.MOUSE_MOVE_EVENT].useDefault=!0,this.eventMap[a.MCD_ENUM.EventNames.MOUSE_UP_EVENT].useDefault=!0,this.eventMap[a.MCD_ENUM.CallbackEventNames.LOCATE_EVENT].useDefault=!0,this.eventMap[a.MCD_ENUM.CallbackEventNames.LOCATE_ELEMENT_EVENT].useDefault=!0),t}))}dropCameraEvents(){this.eventMap[a.MCD_ENUM.EventNames.MANIPULATION_END_EVENT].useDefault=!0,this.eventMap[a.MCD_ENUM.EventNames.MANIPULATION_UPDATE_EVENT].useDefault=!0,this.eventMap[a.MCD_ENUM.EventNames.MOUSE_MOVE_EVENT].useDefault=!0,this.eventMap[a.MCD_ENUM.EventNames.MOUSE_UP_EVENT].useDefault=!0,this.eventMap[a.MCD_ENUM.CallbackEventNames.LOCATE_EVENT].useDefault=!0,this.eventMap[a.MCD_ENUM.CallbackEventNames.LOCATE_ELEMENT_EVENT].useDefault=!0}onObjectLocate(e){this.moveOnDrop(e)}}},IQbp:function(e){e.exports=JSON.parse('{"AXIS_X":"X","AXIS_Y":"Y","AXIS_Z":"Z","AXIS_N":"N","AXIS_E":"E","AXIS_El":"El","DISTANCE":"D","TOTAL_DISTANCE":"T","DISTANCE_UNITS":"m"}')},JB48:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.EnvInformation=class{constructor(e,t){this._modularCoreDisplay=e,this._mcdViewVersion=t}getProductInformation(){return s(this,void 0,void 0,(function*(){const e=JSON.parse("{}");if(this._modularCoreDisplay){e["GVC version"]=this._mcdViewVersion;const t=yield this._modularCoreDisplay.get("ProductInformation","");if(t){const i=JSON.parse(t);i.hasOwnProperty("mMap SDK version")&&(e["mMap SDK version"]=i["mMap SDK version"])}}return e}))}getDocumentInformation(){return s(this,void 0,void 0,(function*(){let e=JSON.parse("{}");if(null!==this._modularCoreDisplay&&null!==this._modularCoreDisplay.documentData){const t=JSON.parse(this._modularCoreDisplay.documentData);if(t.hasOwnProperty("model-list")){const i=t["model-list"];for(let t=0;t<i.length;t++){if(i[t].hasOwnProperty("model-access-protocol"))if("web-api"===i[t]["model-access-protocol"])i[t].hasOwnProperty("model-name")&&i[t].hasOwnProperty("model-url")&&(e["File Name"]=i[t]["model-name"],e["File URL"]=i[t]["model-url"],e["Author Type"]="S3D");else{const t=yield this._modularCoreDisplay.get("DocumentInformation","");null!==t&&(e=JSON.parse(t))}break}}}return e}))}getSystemInformation(){return s(this,void 0,void 0,(function*(){let e=JSON.parse("{}");if(null!==this._modularCoreDisplay){const t=yield this._modularCoreDisplay.getSystemAndOpenGLInformation();null!==t&&(e=JSON.parse(t))}return e}))}}},JxDP:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("Dfju");t.MCDViewCommand=class{constructor(e,t){this._isActive=!1,this._isPausable=!1,this._isPaused=!1,this._isTransient=!1,this._defaultEventMap={},this._eventMap={},this._keyMappings=[],this.onStartCallback=[],this.onStopCallback=[],this.onPauseCallback=[],this.onResumeCallback=[],this._isPausable=e,t&&(this._isTransient=t),this.removeOnStartCallback=this.removeOnStartCallback.bind(this),this.removeOnStopCallback=this.removeOnStopCallback.bind(this),this.removeOnPauseCallback=this.removeOnPauseCallback.bind(this),this.removeOnResumeCallback=this.removeOnResumeCallback.bind(this)}set onStart(e){this.onStartCallback=[],this.onStartCallback.push(e)}set onStop(e){this.onStopCallback=[],this.onStopCallback.push(e)}set onPause(e){this.onPauseCallback=[],this.onPauseCallback.push(e)}set onResume(e){this.onResumeCallback=[],this.onResumeCallback.push(e)}addOnStartCallback(e){this.onStartCallback.push(e)}addOnStopCallback(e){this.onStopCallback.push(e)}addOnPauseCallback(e){this.onPauseCallback.push(e)}addOnResumeCallback(e){this.onResumeCallback.push(e)}removeOnStartCallback(e){for(const t of this.onStartCallback)t===e&&this.onStartCallback.splice(this.onStartCallback.indexOf(t),1)}removeOnStopCallback(e){for(const t of this.onStopCallback)t===e&&this.onStopCallback.splice(this.onStopCallback.indexOf(t),1)}removeOnPauseCallback(e){for(const t of this.onPauseCallback)t===e&&this.onPauseCallback.splice(this.onPauseCallback.indexOf(t),1)}removeOnResumeCallback(e){for(const t of this.onResumeCallback)t===e&&this.onResumeCallback.splice(this.onResumeCallback.indexOf(t),1)}get isActive(){return this._isActive}get isPaused(){return this._isPaused}get isPausable(){return this._isPausable}get isTransient(){return this._isPausable}get keyMappings(){return this._keyMappings}get eventMap(){return this._eventMap}get defaultEventMap(){return this._defaultEventMap}addEvent(e,t,i,n){if(!this._eventMap)return!1;void 0===i&&(i=!1),void 0===n&&(n=!1);const a=new s.EventManagerEvent(t,i,n);return this._eventMap[e]=a,!0}addDefaultEvent(e,t,i,n){if(!this._eventMap)return!1;void 0===i&&(i=!1),void 0===n&&(n=!1);const a=new s.EventManagerEvent(t,i,n);return this._eventMap[e]=a,this.addEvent(e,t,i,n),!0}resetEvent(e){return!(!this._eventManager||!this._eventMap[e]||(this._eventMap[e]=this._eventMap[e]&&this._defaultEventMap[e]?this._defaultEventMap[e]:void 0,0))}resetAllEvents(){return!!this._eventManager&&(this._eventMap=this._defaultEventMap,!0)}getEvent(e){return this._eventMap[e]}start(){if(!this._eventManager)return!1;if(this._isActive||(this._isActive=!0,this._isPaused=!1,this._isTransient?this._eventManager.transientCommand=this:this._eventManager.push(this)),0!==this.onStartCallback.length)for(let e=0;e<this.onStartCallback.length;e++)this.onStartCallback[e]();return!0}stop(){if(!this._eventManager)return!1;if(this._isActive||this._isPaused){if(this._isActive)if(this._isActive=!1,this._isTransient)this._eventManager.transientCommand===this&&(this._eventManager.transientCommand=void 0);else{const e=this._isPausable;this._isPausable=!1,this._eventManager.pop(),e&&this._eventManager.popPausedCommand(this),this._isPausable=e}if(this._isPaused=!1,0!==this.onStopCallback.length)for(let e=0;e<this.onStopCallback.length;e++)this.onStopCallback[e]();return!0}return!1}pause(){if(!this._eventManager)return!1;if(this._isPausable&&!this._isPaused&&this._isActive&&!this._isTransient){if(this._isActive){this._isActive=!1;const e=this._isPausable;this._isPausable=!1,this._eventManager.pop(),this._eventManager.pushPausedCommand(this),this._isPausable=e}if(this._isPaused=!0,0!==this.onPauseCallback.length)for(let e=0;e<this.onPauseCallback.length;e++)this.onPauseCallback[e]();return!0}return!1}resume(){if(!this._eventManager)return!1;if(this._isPausable&&this._isPaused&&!this._isActive&&!this._isTransient&&(this._isActive=!0,this._isPaused=!1,this._eventManager.popPausedCommand(this),this._eventManager.push(this),0!==this.onResumeCallback.length)){for(let e=0;e<this.onResumeCallback.length;e++)this.onResumeCallback[e]();return!0}return!1}}},Khlq:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){let t,i,s,n,a,o,r,l,h,c,_,d,m,u,p,g,C,M,E,P,y,D,v,f,N,T,S,b,U,I,O,L,x,A,k;!function(e){e.ANTI_ALIAS="AntiAlias",e.AMBIENT_OCCLUSION="AmbientOcclusion",e.OUTLINE="Outline"}(t=e.RenderingEffects||(e.RenderingEffects={})),function(e){e.TRANSPARENCY="TransparencyAllowed",e.USE_MODEL_MONIKERS="UseModelMonikers"}(i=e.Preferences||(e.Preferences={})),function(e){e.NONE="none",e.ORTHOGRAPHIC="orthographic",e.PERSPECTIVE="perspective"}(s=e.CameraProjection||(e.CameraProjection={})),function(e){e.ISOMETRIC="isometric",e.TOP="top",e.BOTTOM="bottom",e.FRONT="front",e.BACK="back",e.LEFT="left",e.RIGHT="right"}(n=e.CameraHeading||(e.CameraHeading={})),function(e){e[e.GESTURE_NONE=0]="GESTURE_NONE",e[e.GESTURE_MOUSE_DOWN=1]="GESTURE_MOUSE_DOWN",e[e.GESTURE_MOUSE_MOVE=2]="GESTURE_MOUSE_MOVE",e[e.GESTURE_MOUSE_UP=3]="GESTURE_MOUSE_UP",e[e.GESTURE_MOUSE_WHEEL=4]="GESTURE_MOUSE_WHEEL",e[e.GESTURE_TOUCH_START=5]="GESTURE_TOUCH_START",e[e.GESTURE_TOUCH_MOVE=6]="GESTURE_TOUCH_MOVE",e[e.GESTURE_TOUCH_END=7]="GESTURE_TOUCH_END",e[e.GESTURE_KEY_DOWN=8]="GESTURE_KEY_DOWN",e[e.GESTURE_KEY_UP=9]="GESTURE_KEY_UP"}(a=e.GestureEventNames||(e.GestureEventNames={})),function(e){e[e.Radius=0]="Radius",e[e.Yaw=1]="Yaw",e[e.Pitch=2]="Pitch",e[e.Roll=3]="Roll",e[e.Distance=4]="Distance"}(o=e.FlyToParameter||(e.FlyToParameter={})),function(e){e[e.FLYTO_START_EVENT=1]="FLYTO_START_EVENT",e[e.FLYTO_END_EVENT=2]="FLYTO_END_EVENT"}(r=e.FlyToEventNames||(e.FlyToEventNames={})),function(e){e[e.MOTION_START_EVENT=1]="MOTION_START_EVENT",e[e.MOTION_END_EVENT=2]="MOTION_END_EVENT"}(l=e.MotionEventNames||(e.MotionEventNames={})),function(e){e[e.DEFAULT_MOTION=1]="DEFAULT_MOTION",e[e.FLYTO_MOTION=2]="FLYTO_MOTION"}(h=e.MotionTypes||(e.MotionTypes={})),function(e){e.Color="Color",e.SkyBox="SkyBox",e.StaticImage="StaticImage",e.SnapshotData="SnapshotData"}(c=e.BackgroundInputType||(e.BackgroundInputType={})),function(e){e.LOCATE_EVENT="depthClicked",e.LOCATE_ELEMENT_EVENT="elementClicked",e.CAMERA_CHANGE_EVENT="CameraChangeEvent",e.RENDER_TARGET_EVENT="RenderTargetEvent",e.MODEL_LOADED_EVENT="ModelLoadedEvent",e.MODEL_UNLOADED_EVENT="ModelUnloadedEvent",e.SNAPSHOT_EVENT="screenShotAvailable",e.RESOURCE_LOAD_EVENT="ResourceLoadEvent",e.BACKGROUND_LOAD_EVENT="BackgroundLoadEvent",e.ERROR_EVENT="ErrorEvent",e.SHEET_CHANGE_EVENT="ActiveSheetChangeEvent"}(_=e.CallbackEventNames||(e.CallbackEventNames={})),function(e){e[e.CT_Abandon=0]="CT_Abandon",e[e.CT_Immediate=1]="CT_Immediate",e[e.CT_Transition=2]="CT_Transition"}(d=e.CommitAction||(e.CommitAction={})),function(e){e.EDGES="Edges",e.PARAMETRICS="Parametrics",e.HSPC="HSPC",e.TILES="3DTiles",e.SKYBOX="Skybox",e.FEATURES="Features",e.DYNAMIC_MESH="DynamicMesh"}(m=e.Target||(e.Target={})),function(e){e[e.SIMPLE_PHYSICAL=0]="SIMPLE_PHYSICAL",e[e.DETAILED_PHYSICAL=4]="DETAILED_PHYSICAL",e[e.INSULATION=5]="INSULATION",e[e.OPERATION=6]="OPERATION",e[e.MAINTENANCE=7]="MAINTENANCE",e[e.REFERENCE_GEOMETRY=8]="REFERENCE_GEOMETRY",e[e.CENTERLINE=9]="CENTERLINE",e[e.MOLDED_FORMS=17]="MOLDED_FORMS",e[e.EQUIPMENT_HOLE=19]="EQUIPMENT_HOLE"}(u=e.Aspect||(e.Aspect={})),function(e){e.Object="ObjectID",e.SurfacePoint="SurfacePoint"}(p=e.LocateType||(e.LocateType={})),function(e){e.File="file",e.WebApi="web-api"}(g=e.AccessProtocol||(e.AccessProtocol={})),function(e){e[e.StartLocate=1]="StartLocate",e[e.LookingSurfacePoint=2]="LookingSurfacePoint",e[e.FoundSurfacePoint=3]="FoundSurfacePoint",e[e.NoSurfacePoint=4]="NoSurfacePoint"}(C=e.SurfacePointLocateStage||(e.SurfacePointLocateStage={})),function(e){e[e.StartLocate=1]="StartLocate",e[e.Done=2]="Done"}(M=e.DepthLocateStage||(e.DepthLocateStage={})),function(e){e[e.None=1]="None",e[e.Rotate=2]="Rotate",e[e.General=3]="General"}(E=e.NavigationMode||(e.NavigationMode={})),function(e){e[e.M_PI=3.141592653589793]="M_PI",e[e.SMOOTHING_WINDOW_SIZE=10]="SMOOTHING_WINDOW_SIZE",e[e.MIN_SCALE_DELTA=.001]="MIN_SCALE_DELTA",e[e.MIN_ROTATE_DELTA=.01]="MIN_ROTATE_DELTA",e[e.MIN_TRANSLATION_DELTA=.9]="MIN_TRANSLATION_DELTA",e[e.INERTIA_ELAPSE_TIME=5]="INERTIA_ELAPSE_TIME",e[e.MANIPULATION_LAG_TIME=70]="MANIPULATION_LAG_TIME",e[e.MAX_TAP_TIME=300]="MAX_TAP_TIME",e[e.MAX_DOUBLE_TAP_TIME=300]="MAX_DOUBLE_TAP_TIME",e[e.MAX_TAP_DIST=20]="MAX_TAP_DIST",e[e.MIN_PRESS_AND_HOLD_TIME=800]="MIN_PRESS_AND_HOLD_TIME",e[e.MIN_TOGGLE_MULTISELECT_TIME=600]="MIN_TOGGLE_MULTISELECT_TIME",e[e.MOUSE_NOBUTTON=0]="MOUSE_NOBUTTON",e[e.MOUSE_LBUTTON=1]="MOUSE_LBUTTON",e[e.MOUSE_RBUTTON=2]="MOUSE_RBUTTON",e[e.MOUSE_MBUTTON=4]="MOUSE_MBUTTON",e[e.MAX_CLIP_PLANES=6]="MAX_CLIP_PLANES",e[e.MAX_VERTICES_BOX=8]="MAX_VERTICES_BOX"}(P=e.EventConstants||(e.EventConstants={})),function(e){e[e.MANIPULATION_START_EVENT=1]="MANIPULATION_START_EVENT",e[e.MANIPULATION_END_EVENT=2]="MANIPULATION_END_EVENT",e[e.MANIPULATION_UPDATE_EVENT=3]="MANIPULATION_UPDATE_EVENT",e[e.TAP_EVENT=4]="TAP_EVENT",e[e.HOLD_EVENT=5]="HOLD_EVENT",e[e.DOUBLE_TAP_EVENT=6]="DOUBLE_TAP_EVENT",e[e.GESTURE_EVENT=7]="GESTURE_EVENT",e[e.CAMERA_MOTION_START=8]="CAMERA_MOTION_START",e[e.CAMERA_MOTION_END=9]="CAMERA_MOTION_END",e[e.MOUSE_CLICK_EVENT=10]="MOUSE_CLICK_EVENT",e[e.MOUSE_RIGHT_CLICK_EVENT=11]="MOUSE_RIGHT_CLICK_EVENT",e[e.MOUSE_DOUBLE_CLICK_EVENT=12]="MOUSE_DOUBLE_CLICK_EVENT",e[e.MOUSE_MOVE_EVENT=13]="MOUSE_MOVE_EVENT",e[e.MOUSE_UP_EVENT=14]="MOUSE_UP_EVENT",e[e.MOUSE_DOWN_EVENT=15]="MOUSE_DOWN_EVENT",e[e.MOUSE_WHEEL_EVENT=16]="MOUSE_WHEEL_EVENT",e[e.MOUSE_OUT_EVENT=17]="MOUSE_OUT_EVENT",e[e.LAYOUT_EVENT=18]="LAYOUT_EVENT",e[e.TOUCH_COUNT_UPDATE_EVENT=19]="TOUCH_COUNT_UPDATE_EVENT",e[e.TELEMETRY_EVENT=20]="TELEMETRY_EVENT",e[e.CLIP_PLANES_INITIALIZED=21]="CLIP_PLANES_INITIALIZED",e[e.MCD_INITIALIZED=22]="MCD_INITIALIZED"}(y=e.EventNames||(e.EventNames={})),function(e){e.LOCK_CENTER="isCenterLocked",e.LOCK_ELEVATION="isElevationLocked",e.LOCK_PITCH="isPitchAngleLocked",e.LOCK_YAW="isYawAngleLocked"}(D=e.CameraLock||(e.CameraLock={})),function(e){e[e.None=-1]="None",e[e.Plane0=0]="Plane0",e[e.Plane1=1]="Plane1",e[e.Plane2=2]="Plane2",e[e.Plane3=3]="Plane3",e[e.Plane4=4]="Plane4",e[e.Plane5=5]="Plane5",e[e.Edge0=6]="Edge0",e[e.Edge1=7]="Edge1",e[e.Edge2=8]="Edge2",e[e.Edge3=9]="Edge3",e[e.Edge4=10]="Edge4",e[e.Edge5=11]="Edge5",e[e.Edge6=12]="Edge6",e[e.Edge7=13]="Edge7",e[e.Edge8=14]="Edge8",e[e.Edge9=15]="Edge9",e[e.Edge10=16]="Edge10",e[e.Edge11=17]="Edge11",e[e.Corner0=18]="Corner0",e[e.Corner1=19]="Corner1",e[e.Corner2=20]="Corner2",e[e.Corner3=21]="Corner3",e[e.Corner4=22]="Corner4",e[e.Corner5=23]="Corner5",e[e.Corner6=24]="Corner6",e[e.Corner7=25]="Corner7",e[e.RotationAxisX=26]="RotationAxisX",e[e.RotationAxisY=27]="RotationAxisY",e[e.RotationAxisZ=28]="RotationAxisZ"}(v=e.ClippingPlaneSelection||(e.ClippingPlaneSelection={})),function(e){e[e.MODEL=0]="MODEL",e[e.OBJECT=1]="OBJECT"}(f=e.ClippingType||(e.ClippingType={})),function(e){e[e.MOVEMENT=0]="MOVEMENT",e[e.ROTATE=1]="ROTATE"}(N=e.ClippingManipulationType||(e.ClippingManipulationType={})),function(e){e[e.CREATE=1]="CREATE",e[e.REMOVE=2]="REMOVE",e[e.SHOW=3]="SHOW",e[e.HIDE=4]="HIDE"}(T=e.MeasurementEvents||(e.MeasurementEvents={})),function(e){e.KEY_DOWN="keydown_",e.KEY_UP="keyup_"}(S=e.KeyEventType||(e.KeyEventType={})),function(e){e[e.INTERVAL_DELAY=50]="INTERVAL_DELAY",e[e.FORWARD=2]="FORWARD",e[e.BACKWARD=1]="BACKWARD"}(b=e.TouchContinuousFlyConstants||(e.TouchContinuousFlyConstants={})),function(e){e.AXIS_X="AXIS_X",e.AXIS_Y="AXIS_Y",e.AXIS_Z="AXIS_Z",e.AXIS_E="AXIS_E",e.AXIS_N="AXIS_N",e.AXIS_El="AXIS_El"}(U=e.ViewAxisLocaleText||(e.ViewAxisLocaleText={})),function(e){e.Discrete="Discrete",e.Start="Start",e.End="End",e.Pause="Pause",e.Resume="Resume"}(I=e.TelemetryMessageType||(e.TelemetryMessageType={})),function(e){e.Diagnostic="Diagnostic",e.Verbose="Verbose",e.Information="Information",e.Feature="Feature",e.Warning="Warning",e.Error="Error",e.Critical="Critical"}(O=e.TelemetryEventType||(e.TelemetryEventType={})),function(e){e.HomeCommand="Home Command",e.SetHomeCommand="Set Home Command",e.ResetHomeCommand="Reset Home Command",e.ZoomAreaCommand="Zoom Area Command",e.FitCommand="Fit Command",e.FlyCommand="Fly Command",e.UndoCommand="Undo Command",e.RedoCommand="Redo Command",e.ClipCommand="Clip Command",e.IsolateCommand="Isolate Command",e.KeyboardNavigationCommand="Keyboard Navigation Command",e.MouseNavigationCommand="Mouse Navigation Command",e.TouchNavigationCommand="Touch Navigation Command",e.SnapshotCommand="Snapshot Command",e.MeasurementCommand="Measurement Command",e.RefreshCommand="Refresh Command",e.NavigatorHomeCommand="Navigation Home Command",e.NavigatorNorthCommand="Navigator North Command",e.NavigatorCompassMoveCommand="Navigator Compass Move Command",e.NavigatorFitCommand="Navigator Fit Command",e.Navigator2DCommand="Navigator 2D Command",e.NavigatorWalkingCommand="Navigator Walking Command",e.NavigatorWalkingStartCommand="Navigator Walking Start Command",e.NavigatorZoomCommand="Navigator Zoom Command",e.ObjectLocatedCommand="Object Located Command",e.SettingsCommand="Settings Command",e.Open3DModel="Open 3D Model",e.Open2DDrawing="Open 2D Model",e.OpenHSPC="Open HSPC",e.Open3DTile="Open 3D Tile",e.Close3DModel="Close 3D Model",e.Close2DDrawing="Close 2D Model",e.CloseHSPC="Close HSPC",e.Close3DTile="Close 3D Tile",e.Help="Help",e.Error="Error"}(L=e.TelemetryEventName||(e.TelemetryEventName={})),function(e){e[e.Undefined=-1]="Undefined",e[e.Top=0]="Top",e[e.Bottom=1]="Bottom",e[e.Front=2]="Front",e[e.Back=3]="Back",e[e.Left=4]="Left",e[e.Right=5]="Right",e[e.TopFront=6]="TopFront",e[e.TopBack=7]="TopBack",e[e.TopLeft=8]="TopLeft",e[e.TopRight=9]="TopRight",e[e.BottomFront=10]="BottomFront",e[e.BottomBack=11]="BottomBack",e[e.BottomLeft=12]="BottomLeft",e[e.BottomRight=13]="BottomRight",e[e.FrontLeft=14]="FrontLeft",e[e.FrontRight=15]="FrontRight",e[e.BackLeft=16]="BackLeft",e[e.BackRight=17]="BackRight",e[e.TopFrontLeft=18]="TopFrontLeft",e[e.TopFrontRight=19]="TopFrontRight",e[e.TopBackLeft=20]="TopBackLeft",e[e.TopBackRight=21]="TopBackRight",e[e.BottomFrontLeft=22]="BottomFrontLeft",e[e.BottomFrontRight=23]="BottomFrontRight",e[e.BottomBackLeft=24]="BottomBackLeft",e[e.BottomBackRight=25]="BottomBackRight",e[e.CommonViewCount=26]="CommonViewCount"}(x=e.CommonViewOrientation||(e.CommonViewOrientation={})),function(e){e[e.Trace=0]="Trace",e[e.Debug=1]="Debug",e[e.Info=2]="Info",e[e.Warn=3]="Warn",e[e.Error=4]="Error",e[e.Fatal=5]="Fatal"}(A=e.ErrorLevel||(e.ErrorLevel={})),function(e){e[e.NoneError=0]="NoneError",e[e.UnExpectedError=1e3]="UnExpectedError",e[e.GraphicsNotSupportError=2e3]="GraphicsNotSupportError",e[e.DisplayContextError=2001]="DisplayContextError",e[e.DisplayFunctionError=2002]="DisplayFunctionError",e[e.DisplayError=2003]="DisplayError",e[e.LoadModelUnAuthorizationError=3e3]="LoadModelUnAuthorizationError",e[e.LoadModelSeverError=3001]="LoadModelSeverError",e[e.LoadModelError=3002]="LoadModelError"}(k=e.ErrorCode||(e.ErrorCode={}))}(t.MCD_ENUM||(t.MCD_ENUM={}))},L6aT:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("Khlq");let n=s.MCD_ENUM.EventConstants.MIN_SCALE_DELTA,a=s.MCD_ENUM.EventConstants.MIN_ROTATE_DELTA,o=s.MCD_ENUM.EventConstants.MIN_TRANSLATION_DELTA;const r=s.MCD_ENUM.EventConstants.MAX_TAP_TIME;let l=s.MCD_ENUM.EventConstants.MAX_TAP_DIST;const h=s.MCD_ENUM.EventConstants.MIN_PRESS_AND_HOLD_TIME,c=s.MCD_ENUM.EventConstants.MAX_DOUBLE_TAP_TIME,_=s.MCD_ENUM.EventConstants.MOUSE_NOBUTTON,d=s.MCD_ENUM.EventConstants.MOUSE_RBUTTON;class m{}t.Delta=m;class u{constructor(e,t,i,s,n,a,o,r,l,h){this._x=e,this._y=t,this._deltaX=i,this._deltaY=s,this._deltaZ=n,this._angle=a,this._deltaRotation=o,this._tapCount=r,this._touchCount=l,this._mouseButtonType=h}set x(e){this._x=e}get x(){return this._x}set y(e){this._y=e}get y(){return this._y}set deltaX(e){this._deltaX=e}get deltaX(){return this._deltaX}set deltaY(e){this._deltaY=e}get deltaY(){return this._deltaY}set deltaZ(e){this._deltaZ=e}get deltaZ(){return this._deltaZ}set angle(e){this._angle=e}get angle(){return this._angle}set deltaRotation(e){this._deltaRotation=e}get deltaRotation(){return this._deltaRotation}set tapCount(e){this._tapCount=e}get tapCount(){return this._tapCount}set touchCount(e){this._touchCount=e}get touchCount(){return this._touchCount}set mouseButtonType(e){this._mouseButtonType=e}get mouseButtonType(){return this._mouseButtonType}}t.Event=u;class p{set x(e){this._x=e}get x(){return this._x}set y(e){this._y=e}get y(){return this._y}getDistance(e){return Math.sqrt((e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y))}}t.VisPoint=p,t.InputManipulationProcess=class{constructor(e,t=h){this._tapCount=0,this._lastTapTime=0,this._distance=0,this._angle=0,this._cumulativeTranslationX=0,this._cumulativeTranslationY=0,this._gestureStartTime=0,this._gestureEndTime=0,this._mouseButtonState=_,this._windowIndex=0,this._points=[],this._maxTapPoints=[],this._prevMaxTapPoints=[],this._confirmedNavigaiton=!1,this._minToggleTimeMultiSelect=h,this.eventListeners=new Map,n*=e,a*=e,o*=e,l*=e,this._minToggleTimeMultiSelect=t}addEventlistener(e,t){t=t.bind(this),this.eventListeners.set(e,t)}deleteEventListener(e){this.eventListeners.delete(e)}get multiSelectToggleTime(){return this._minToggleTimeMultiSelect}set multiSelectToggleTime(e){void 0!==e&&(e<h||(this._minToggleTimeMultiSelect=e))}getDistanceBetweenPoints(e){let t=0;return e.length>1&&(t=e[0].getDistance(e[1])),t}getAngleOfPoints(e){let t=0;return e.length>1&&(t=Math.atan2(e[1].y-e[0].y,e[1].x-e[0].x)),t}getMeanPoint(e){const t=new p;return 1===e.length?(t.x=e[0].x,t.y=e[0].y):e.length>1?(t.x=(e[0].x+e[1].x)/2,t.y=(e[0].y+e[1].y)/2):(t.x=0,t.y=0),t}comparePoints(e,t){if(e.length!==t.length||0===e.length||0===t.length)return!1;for(let i=0;i<e.length;i++){let s=!1;for(let n=0;n<t.length;n++)if(e[i].getDistance(t[n])<l){s=!0;break}if(!1===s)return!1}return!0}trackMaxTapPoints(e){e.length>this._points.length&&(this._maxTapPoints=e)}onMousePressEvent(e,t,i,n){this._gestureStartTime=n,this._points=[];const a=new p;if(a.x=e,a.y=t,this._points.push(a),this._mouseButtonState|=i,i===d){const n=this.eventListeners.get(s.MCD_ENUM.EventNames.MOUSE_RIGHT_CLICK_EVENT);n&&n(new u(e,t,0,0,0,0,0,0,0,i))}else{const n=this.eventListeners.get(s.MCD_ENUM.EventNames.MANIPULATION_START_EVENT);n&&n(new u(e,t,0,0,0,0,0,0,0,i))}}onMouseMoveEvent(e,t,i){if(this._mouseButtonState!==_&&0!==this._points.length&&(this._distance=0,this._angle=0,Math.abs(this._gestureStartTime-i)>r)){const i=this.eventListeners.get(s.MCD_ENUM.EventNames.MANIPULATION_UPDATE_EVENT);if(i){const s=-e,n=-t;this._points[0].x=this._points[0].x+e,this._points[0].y=this._points[0].y+t;const a=new u(this._points[0].x,this._points[0].y,s,n,0,0,0,0,0,this._mouseButtonState);a.mouseButtonType=this._mouseButtonState,i(a)}}}onMouseReleaseEvent(e,t,i,n){this._gestureEndTime=n,this._mouseButtonState&=~i;const a=this.eventListeners.get(s.MCD_ENUM.EventNames.TAP_EVENT);if(a){if(this._gestureEndTime-this._gestureStartTime<r){const s=new p;if(s.x=e,s.y=t,this._points[0].getDistance(s)<l){const s=new u(e,t,0,0,0,0,0,0,0,0);s.tapCount=1,s.touchCount=0,s.mouseButtonType=i,a(s)}}const n=this.eventListeners.get(s.MCD_ENUM.EventNames.MANIPULATION_END_EVENT);n&&n(new u(e,t,0,0,0,0,0,0,0,i))}}onMouseDoubleClickEvent(e,t,i){const n=this.eventListeners.get(s.MCD_ENUM.EventNames.TAP_EVENT);if(n){const s=new u(e,t,0,0,0,0,0,0,0,0);s.tapCount=2,s.touchCount=0,s.mouseButtonType=i,n(s)}}onTouchPressEvent(e,t,i){if(this.eventListeners.get(s.MCD_ENUM.EventNames.TOUCH_COUNT_UPDATE_EVENT)(new u(0,0,0,0,0,0,0,0,e,0)),0===this._points.length&&1===t.length){this._gestureStartTime=i,this._distance=0,this._angle=0,this._cumulativeTranslationX=0,this._cumulativeTranslationY=0,this._gestureStartTime-this._gestureEndTime>r&&(this._prevMaxTapPoints=[],this._tapCount=0);const e=this.eventListeners.get(s.MCD_ENUM.EventNames.MANIPULATION_START_EVENT);e&&t.length>0&&(this._confirmedNavigaiton=!1,e(new u(t[0].x,t[0].y,0,0,0,0,0,0,0,0)))}this._points=t,this._maxTapPoints=t}onTouchUpdateEvent(e,t,i){this.eventListeners.get(s.MCD_ENUM.EventNames.TOUCH_COUNT_UPDATE_EVENT)(new u(0,0,0,0,0,0,0,0,e,0));let n=0,h=0,c=0,d=0,g=new p,C=new p;const M=this.getDistanceBetweenPoints(t),E=this.getAngleOfPoints(t);C=this.getMeanPoint(t),this.trackMaxTapPoints(t),this._points.length!==t.length?(this._distance=M,this._angle=E,g=this.getMeanPoint(t)):g=this.getMeanPoint(this._points),d=this._distance-M,this._distance=M,c=this._angle-E,this._angle=E,n=g.x-C.x,h=g.y-C.y,this._cumulativeTranslationX+=n,this._cumulativeTranslationY+=h;const P=this.eventListeners.get(s.MCD_ENUM.EventNames.MANIPULATION_UPDATE_EVENT);if(P){const e=new m;e.translationDeltaX=n,e.translationDeltaY=h,e.translationDeltaZ=d,e.rotationDelta=c,(Math.abs(this._gestureStartTime-i)>r||Math.abs(this._cumulativeTranslationX)>l||Math.abs(this._cumulativeTranslationY)>l)&&(Math.abs(e.translationDeltaX)>o||Math.abs(e.translationDeltaY)>o||Math.abs(e.translationDeltaZ)>o||Math.abs(e.rotationDelta)>a)&&(this._confirmedNavigaiton=!0,P(new u(C.x,C.y,e.translationDeltaX,e.translationDeltaY,e.translationDeltaZ,E,e.rotationDelta,0,t.length,_)))}this._points=t}onTouchReleaseEvent(e,t,i){if(this._gestureEndTime=i,Math.abs(this._cumulativeTranslationX)<l&&Math.abs(this._cumulativeTranslationY)<l){if(this._gestureEndTime-this._gestureStartTime<r)this.comparePoints(this._prevMaxTapPoints,this._maxTapPoints)?this._tapCount++:this._tapCount=1;else if(this._gestureEndTime-this._gestureStartTime>this._minToggleTimeMultiSelect&&!this._confirmedNavigaiton){const i=this.eventListeners.get(s.MCD_ENUM.EventNames.HOLD_EVENT);i&&t.length>0&&(this._tapCount=0,i(new u(t[0].x,t[0].y,0,0,0,0,0,0,e,0)))}}else this._tapCount=0;if(this._tapCount&&this._tapCount>0){let e=new p;if(e=this.getMeanPoint(this._maxTapPoints),i-this._lastTapTime<c){const t=this.eventListeners.get(s.MCD_ENUM.EventNames.DOUBLE_TAP_EVENT);if(t){const i=new u(e.x,e.y,0,0,0,0,0,0,0,0);i.tapCount=this._tapCount,i.touchCount=this._maxTapPoints.length,i.mouseButtonType=_,t(i)}}else{this._lastTapTime=i;const t=this.eventListeners.get(s.MCD_ENUM.EventNames.TAP_EVENT);if(t){const i=new u(e.x,e.y,0,0,0,0,0,0,0,0);i.tapCount=this._tapCount,i.touchCount=this._maxTapPoints.length,i.mouseButtonType=_,t(i)}}this._prevMaxTapPoints=this._maxTapPoints}else this._prevMaxTapPoints=[];const n=this.eventListeners.get(s.MCD_ENUM.EventNames.MANIPULATION_END_EVENT);n&&t.length>0&&n(new u(t[0].x,t[0].y,0,0,0,0,0,0,e,0)),this._points=[],this._maxTapPoints=[]}}},LbbN:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.UserPreferences=class{constructor(){this._registeredPreferencesProviders=[]}register(e){this._registeredPreferencesProviders.push(e)}get(){return s(this,void 0,void 0,(function*(){const e={};return(yield Promise.all(this._registeredPreferencesProviders.map(e=>s(this,void 0,void 0,(function*(){return yield e.getUserPreferences()}))))).forEach(t=>t.forEach(t=>{const i=JSON.parse(t);Object.keys(i).forEach(t=>e[t]=i[t])})),JSON.stringify(e)}))}set(e){return s(this,void 0,void 0,(function*(){return(yield Promise.all(this._registeredPreferencesProviders.map(t=>s(this,void 0,void 0,(function*(){return yield t.setUserPreferences(e)}))))).reduce((e,t)=>e&&t)}))}}},MB4v:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i("o+o0");t.WebAPIProperties=class{constructor(){this._propertiesURL="",this._authorizationToken=""}setAuthorizationToken(e){return!!e&&(this._authorizationToken=e,!0)}setPropertiesURL(e){return!!e&&(this._propertiesURL=e,!0)}fetchProperties(e){return s(this,void 0,void 0,(function*(){if(e&&""!==this._propertiesURL){const t=this._propertiesURL+"S3dItems('"+e+"')";return yield n.McdNetworkIO.fetchResponseWithGet(t,this._authorizationToken)}return null}))}fetchUrl(e){return s(this,void 0,void 0,(function*(){return yield n.McdNetworkIO.fetchResponseWithGet(e,this._authorizationToken)}))}}},NP6r:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("2T81");t.MCDTransform=class{constructor(e,t,i,n,a,o,r,l,h,c,_,d,m,u,p,g){this._useMatrix=!1,this._userTransform=new s.Mat4(e,t,i,n,a,o,r,l,h,c,_,d,m,u,p,g)}get useMatrix(){return this._useMatrix}set useMatrix(e){this._useMatrix=e}get transform(){return this._userTransform}set transform(e){this._userTransform=e}get rotation(){return this._userRotation}set rotation(e){this._userRotation=e}get scale(){return this._userScale}set scale(e){this._userScale=e}get translation(){return this._userTranslation}set translation(e){this._userTranslation=e}toJsonString(){const e={};return this._useMatrix&&void 0!==this._userTransform?(e["user-matrix"]={},e["user-matrix"]=[this._userTransform.m00,this._userTransform.m01,this._userTransform.m02,this._userTransform.m03,this._userTransform.m10,this._userTransform.m11,this._userTransform.m12,this._userTransform.m13,this._userTransform.m20,this._userTransform.m21,this._userTransform.m22,this._userTransform.m23,this._userTransform.m30,this._userTransform.m31,this._userTransform.m32,this._userTransform.m33]):void 0!==this._userRotation&&(e["user-transform"]={},e["user-transform"].rotation={},e["user-transform"].rotation.x=this._userRotation.x,e["user-transform"].rotation.y=this._userRotation.y,e["user-transform"].rotation.z=this._userRotation.z,void 0!==this._userScale&&(e["user-transform"].scale={},e["user-transform"].scale.x=this._userScale.x,e["user-transform"].scale.y=this._userScale.y,e["user-transform"].scale.z=this._userScale.z),void 0!==this._userTranslation&&(e["user-transform"].translation={},e["user-transform"].translation.x=this._userTranslation.x,e["user-transform"].translation.y=this._userTranslation.y,e["user-transform"].translation.z=this._userTranslation.z)),e}}},Oc5x:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("2T81");t.MCDColor=class{constructor(e,t,i,n){e>1&&(e/=255),i>1&&(i/=255),t>1&&(t/=255),this._glmath=new s.GlMath,this.red=e,this.green=t,this.blue=i,this.alpha=n}set red(e){this._red=this._glmath.clamp(e,0,1)}get red(){return this._red}set green(e){this._green=this._glmath.clamp(e,0,1)}get green(){return this._green}set blue(e){this._blue=this._glmath.clamp(e,0,1)}get blue(){return this._blue}set alpha(e){this._alpha=this._glmath.clamp(e,0,1)}get alpha(){return this._alpha}rgba(){return[this._red,this._green,this._blue,this._alpha]}}},OiKg:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i("Khlq");t.RenderManipulationCallback=(()=>{class e{constructor(e,t,i,s){this._locatedPtX=0,this._locatedPtY=0,this._locatedPtZ=0,this._eventFirstUpdate=!0,this._navigationMode=n.MCD_ENUM.NavigationMode.None,this._surfacePointLocateStage=n.MCD_ENUM.SurfacePointLocateStage.NoSurfacePoint,this._depthLocateStage=n.MCD_ENUM.DepthLocateStage.StartLocate,this._modularCoreDisplay=e,this._dpr=t,this._width=i,this._height=s,this.Module="undefined"==typeof Module?this._modularCoreDisplay:Module,this.manipulationStartedEvent=this.manipulationStartedEvent.bind(this),this.manipulationCompletedEvent=this.manipulationCompletedEvent.bind(this),this.manipulationUpdateEvent=this.manipulationUpdateEvent.bind(this),this.manipulationUpdateEvent=this.manipulationUpdateEvent.bind(this),this.onTouchCountUpdate=this.onTouchCountUpdate.bind(this)}set eventManager(e){this._eventManager=e}set module(e){this.Module=e}get module(){return this.Module}get depthLocateStage(){return this._depthLocateStage}set depthLocateStage(e){this._depthLocateStage=e}get navigationMode(){return this._navigationMode}set navigationMode(e){this._navigationMode=e}set surfacePointLocateStage(e){this._surfacePointLocateStage=e}get surfacePointLocateStage(){return this._surfacePointLocateStage}set width(e){this._width=e}get width(){return this._width}set height(e){this._height=e}get height(){return this._height}updateViewSize(e,t){this._width=e,this._height=t}onLayout(e,t){this._width=e,this._height=t}updateCameraDistanceAt(e,t){this._modularCoreDisplay.locateAsync(JSON.stringify({LocateType:n.MCD_ENUM.LocateType.SurfacePoint,ScreenPosition:{x:e,y:t}}))}surfacePointLocatedCallback(e,t=!0){return s(this,void 0,void 0,(function*(){if(!this._modularCoreDisplay)return;const i=this.Module;if(""!==e){let o=JSON.parse(e);"string"==typeof o&&(o=JSON.parse(o));const r=o.hits;if(this._navigationMode===n.MCD_ENUM.NavigationMode.Rotate&&this._surfacePointLocateStage===n.MCD_ENUM.SurfacePointLocateStage.LookingSurfacePoint)try{r[0].distance>0&&(this._locatedPtX=r[0].x,this._locatedPtY=r[0].y,this._locatedPtZ=r[0].z,this._surfacePointLocateStage=n.MCD_ENUM.SurfacePointLocateStage.FoundSurfacePoint)}catch(s){this._surfacePointLocateStage=n.MCD_ENUM.SurfacePointLocateStage.NoSurfacePoint}else if(t){try{r[0].distance>0&&this._modularCoreDisplay.get("CameraState","").then(e=>{if(""!==e){const t=JSON.parse(e);t.distance=r[0].distance,!1===t.isOrthographic&&(this._modularCoreDisplay.set("CameraState",JSON.stringify(t)),this._modularCoreDisplay.commitCameraChanges(i.CameraTransition.CT_Immediate))}})}catch(a){this._surfacePointLocateStage=n.MCD_ENUM.SurfacePointLocateStage.NoSurfacePoint}this._depthLocateStage=n.MCD_ENUM.DepthLocateStage.Done}}}))}centerLineLocateByJsonAsync(e){return s(this,void 0,void 0,(function*(){this._modularCoreDisplay&&(yield this._modularCoreDisplay.locateAsync(e))}))}manipulationStartedEvent(e){this._depthLocateStage=n.MCD_ENUM.DepthLocateStage.StartLocate,this._eventFirstUpdate=!0,this._modularCoreDisplay&&(this.updateCameraDistanceAt(e.x,e.y),this._surfacePointLocateStage=n.MCD_ENUM.SurfacePointLocateStage.StartLocate,this._navigationMode=n.MCD_ENUM.NavigationMode.None,this._eventFirstUpdate=!0)}manipulationCompletedEvent(e){this._navigationMode=n.MCD_ENUM.NavigationMode.None}manipulationUpdateEvent(e){if(!this._modularCoreDisplay)return;const t=this.Module;if(1===e.touchCount)(Math.abs(e.deltaX)>1||Math.abs(e.deltaY)>1)&&this._depthLocateStage===n.MCD_ENUM.DepthLocateStage.Done&&(this._modularCoreDisplay.motionMove(e.deltaX,-e.deltaY,0,e.x,e.y),this._modularCoreDisplay.commitCameraChanges(t.CameraTransition.CT_Immediate),this._navigationMode=n.MCD_ENUM.NavigationMode.General);else if(e.touchCount>=2){if(this._eventFirstUpdate)return this._eventFirstUpdate=!1,void(this._navigationMode=n.MCD_ENUM.NavigationMode.None);if(this._navigationMode===n.MCD_ENUM.NavigationMode.None){let t=Math.abs(e.angle);t>Math.PI/2&&(t=Math.PI-t),t<Math.PI/4&&Math.abs(e.deltaY)>Math.abs(e.deltaX)?(this._navigationMode=n.MCD_ENUM.NavigationMode.Rotate,this._surfacePointLocateStage=n.MCD_ENUM.SurfacePointLocateStage.LookingSurfacePoint,this.updateCameraDistanceAt(e.x,e.y)):this._navigationMode=n.MCD_ENUM.NavigationMode.General}this._navigationMode===n.MCD_ENUM.NavigationMode.Rotate?this._surfacePointLocateStage===n.MCD_ENUM.SurfacePointLocateStage.FoundSurfacePoint?this._modularCoreDisplay.motionRotateAroundPoint(e.deltaX/2,e.deltaY/2,this._locatedPtX,this._locatedPtY,this._locatedPtZ):this._surfacePointLocateStage===n.MCD_ENUM.SurfacePointLocateStage.NoSurfacePoint&&this._modularCoreDisplay.motionRotate(e.deltaX/2,e.deltaY/2,!0):(this._modularCoreDisplay.motionMove(e.deltaX,-e.deltaY,-e.deltaZ/2,e.x,e.y),this._modularCoreDisplay.motionRotateByAngle(e.x,e.y,-e.deltaRotation)),this._modularCoreDisplay.commitCameraChanges(t.CameraTransition.CT_Immediate)}else(e.mouseButtonType&n.MCD_ENUM.EventConstants.MOUSE_LBUTTON)!==n.MCD_ENUM.EventConstants.MOUSE_LBUTTON||this._modularCoreDisplay.isPitchAngleLocked&&this._modularCoreDisplay.isYawAngleLocked?((e.mouseButtonType&n.MCD_ENUM.EventConstants.MOUSE_MBUTTON)===n.MCD_ENUM.EventConstants.MOUSE_MBUTTON||(e.mouseButtonType&n.MCD_ENUM.EventConstants.MOUSE_LBUTTON)===n.MCD_ENUM.EventConstants.MOUSE_LBUTTON&&this._modularCoreDisplay.isPitchAngleLocked&&this._modularCoreDisplay.isYawAngleLocked)&&(this._modularCoreDisplay.motionMove(e.deltaX,-e.deltaY,0,e.x,e.y),this._modularCoreDisplay.commitCameraChanges(t.CameraTransition.CT_Immediate)):(this._navigationMode===n.MCD_ENUM.NavigationMode.None&&(this._navigationMode=n.MCD_ENUM.NavigationMode.Rotate,this._surfacePointLocateStage=n.MCD_ENUM.SurfacePointLocateStage.LookingSurfacePoint,this.updateCameraDistanceAt(e.x,e.y)),(Math.abs(e.deltaX)>1||Math.abs(e.deltaY)>1)&&(this._surfacePointLocateStage===n.MCD_ENUM.SurfacePointLocateStage.FoundSurfacePoint?this._modularCoreDisplay.motionRotateAroundPoint(e.deltaX/2,e.deltaY/2,this._locatedPtX,this._locatedPtY,this._locatedPtZ):this._surfacePointLocateStage===n.MCD_ENUM.SurfacePointLocateStage.NoSurfacePoint&&this._modularCoreDisplay.motionRotate(e.deltaX/2,e.deltaY/2,!0),this._modularCoreDisplay.commitCameraChanges(t.CameraTransition.CT_Immediate)))}onTouchCountUpdate(e){}}return e.EVENT_LOCATE=1,e})()},"P/D+":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Guid=class{constructor(){this._value="",this._value=this.generate()}generate(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}set value(e){this._value=e}get value(){return this._value}}},Pyzi:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e){this.data=e,this.next=this.next,this.prev=this.prev}hasPrev(){return null!==this.prev}hasNext(){return null!==this.next}}t.Node=s,t.LinkedList=class{constructor(){this.length=0,this.head=new s(null),this.tail=new s(null)}isEmpty(){return 0===this.length}toArray(){const e=[];for(let t=0,i=this.length;t<i;t++)e.push(this.getData(t));return e}push(e){const t=new s(e);this.isEmpty()?(this.head=this.tail=t,this.length++):(this.tail.next=t,t.prev=this.tail,this.tail=t,this.length++)}findIndex(e){if(null!==e){let t=0,i=this.head;for(;t<this.length;){if(i.data===e)return t;i=i.next,t++}}return-1}removeByIndex(e){this.removeByData(this.getData(e))}getData(e){if("number"==typeof e&&e<this.length){let t,i;if(e>this.length/2){for(i=this.length,t=this.tail;i-- >e;)t=t.prev;return t.data}for(i=0,t=this.head;i++<e;)t=t.next;return t.data}}removeByData(e){let t;if(e){if(e===this.head.data)this.head=this.head.next;else if(e===this.tail.data)t=this.tail.prev,this.tail=t;else{for(t=this.head;void 0!==t&&t.data!==e;)t=t.next;if(void 0===t)return;t.hasPrev()&&(t.prev.next=t.next),t.hasNext()&&(t.next.prev=t.prev)}this.length--}}}},RU2X:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i("Oc5x"),a=i("2T81");let o=(()=>{class e{}return e.colors=[4278216319,4278294458,4283473455,4287023292,4290232080,4292635439,4294034432,4286194478,4278228922,4286959067,4289058919,4278218390,4278763742,4283206443,4288009728,4292304640,4294943744,4293591081,4278228062,4287813036,4278212024,4287938793,4283566710,4288116947,4278214760,4280732371,4289408041,4294925109,4293032960,4294567961],e})();t.Defaults=o;class r{constructor(){this._roughness=1,this._metalness=0,this._glmath=new a.GlMath}get roughness(){return this._roughness}set roughness(e){this._roughness=this._glmath.clamp(e,0,1)}get metalness(){return this._metalness}set metalness(e){this._metalness=this._glmath.clamp(e,0,1)}}t.PBRMaterial=r;class l{constructor(){this._reflection=0,this._finish=1}get reflection(){return this._reflection}set reflection(e){this._reflection=e}get finish(){return this._finish}set finish(e){this._finish=e}}t.BaseMaterial=l;class h{constructor(e,t,i){if(this._id=0,this._name="",this._id=0,this._name=e,this._glmath=new a.GlMath,t){const e=t.toString(16);e?(this._diffuse=new n.MCDColor(parseInt(e.slice(2,4),16)/255,parseInt(e.slice(4,6),16)/255,parseInt(e.slice(6,8),16)/255,parseInt(e.slice(0,2),16)/255),this._specular=new n.MCDColor(1,1,1,1)):(this._diffuse=new n.MCDColor(1,0,1,1),this._specular=new n.MCDColor(0,0,0,1))}else this._diffuse=new n.MCDColor(1,0,1,1),this._specular=new n.MCDColor(0,0,0,1);this._baseSpecular=new n.MCDColor(0,0,0,1),this._ambient=new n.MCDColor(0,0,0,1),this._wireframe=new n.MCDColor(0,0,0,1),this._transparency=0,i&&(this._guid=i),this._pbrMaterial=new r,this._baseMaterial=new l}set id(e){this._id=e}get id(){return this._id}set transparency(e){this._transparency=this._glmath.clamp(e,0,1)}get transparency(){return this._transparency}set diffuse(e){null!==e&&(this._diffuse=e)}get diffuse(){return this._diffuse}set specular(e){null!==e&&(this._specular=e)}get specular(){return this._specular}set ambient(e){null!==e&&(this._ambient=e)}get ambient(){return this._ambient}set baseSpecular(e){null!==e&&(this._baseSpecular=e)}get baseSpecular(){return this._baseSpecular}set wireframe(e){null!==e&&(this._wireframe=e)}get wireframe(){return this._wireframe}get guid(){return this._guid}get name(){return this._name}get pbrMaterial(){return this._pbrMaterial}set pbrMaterial(e){this._pbrMaterial=e}get baseMaterial(){return this._baseMaterial}set baseMaterial(e){this._baseMaterial=e}toMaterialDef(){const e={};return e["material-id"]=this._id,e.diffuse=this._diffuse.rgba(),e.ambient=this._ambient.rgba(),e.specular=this._specular.rgba(),e.basespecular=this._baseSpecular.rgba(),e.wireframe=this._wireframe.rgba(),e.transmit=this._transparency,e}}t.Material=h,t.MaterialManager=class{constructor(e){this._nextMaterialID=1,this._mcd=e,this._initialized=!1,this._materials={},this._materialNames={},this._materialGuids={},this._mcd.materials=this}get materials(){return this._materials}set materialUpdatedCallback(e){this._materialUpdatedCallback=e}initialize(e=null){if(this._initialized)return!1;if(!e){const e=o.colors.length;for(let t=0;t<e;t++){const e="HC"+t.toString(),i=new h(e,o.colors[t]);this.add(e,i)}return this._initialized=!0,!0}if(0===e.length)return!1;for(let t=0;t<e.length;t++)this.add(e[t].name,e[t]);return this._initialized=!0,!0}loadFromStream(){return!1}saveToStream(){return!1}add(e,t){return!this._materialNames.hasOwnProperty(e)&&(t.id=this._nextMaterialID,this._materials[this._nextMaterialID]=t,this._materialNames[e]=this._nextMaterialID,t.guid&&(this._materialGuids[t.guid.value]=this._nextMaterialID),this._nextMaterialID++,this._initialized=!0,!0)}remove(e){let t=0;return!!this._initialized&&!!this._materialNames.hasOwnProperty(e)&&(t=this._materialNames[e],this._materials[t].guid&&delete this._materialGuids[this._materials[t].guid.value],delete this._materialNames[e],delete this._materials[t],!0)}tryFindMaterialByName(e,t){if(this._materialNames.hasOwnProperty(e)){const t=this._materialNames[e];if(this._materials.hasOwnProperty(t))return{value:!0,material:this._materials[t]}}return{value:!1,material:new h("",null)}}tryFindMaterialByGuid(e,t){if(this._materialGuids.hasOwnProperty(e.value)){const t=this._materialGuids[e.value];if(this._materials.hasOwnProperty(t))return{value:!0,material:this._materials[t]}}return{value:!1,material:new h("",null)}}updateMaterial(e,t){return!(!this._materialNames.hasOwnProperty(e)||!this._materials.hasOwnProperty(this._materialNames[e])||(this.remove(e),this.add(e,t),this._materialUpdatedCallback&&this._materialUpdatedCallback(e),0))}getLastAssignedMaterial(e){return s(this,void 0,void 0,(function*(){const t={};t["target-name"]=this._mcd.modelName,t.GetMaterials={"get-type":"material-assignments"};const i=yield this._mcd.get("Material",JSON.stringify(t));if(""!==i){const t=JSON.parse(i);if(t.hasOwnProperty("assigned-objects")&&t["assigned-objects"].length>0)for(let i=0;i<t["assigned-objects"].length;i++)if(t["assigned-objects"][i]["object-id"]===e)return t["assigned-objects"][i]["material-id"]}return-1}))}}},Tb5U:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("Khlq");t.DisplayNavigation=class{constructor(e){this._modularCoreDisplay=e,this.movePositiveX=this.movePositiveX.bind(this),this.movePositiveY=this.movePositiveY.bind(this),this.movePositiveZ=this.movePositiveZ.bind(this),this.moveNegativeX=this.moveNegativeX.bind(this),this.moveNegativeY=this.moveNegativeY.bind(this),this.moveNegativeZ=this.moveNegativeZ.bind(this),this.lookPositiveX=this.lookPositiveX.bind(this),this.lookPositiveY=this.lookPositiveY.bind(this),this.lookNegativeX=this.lookNegativeX.bind(this),this.lookNegativeY=this.lookNegativeY.bind(this),this.movePositiveZNegativeX=this.movePositiveZNegativeX.bind(this),this.movePositiveZPositiveX=this.movePositiveZPositiveX.bind(this),this.moveNegativeZNegativeX=this.moveNegativeZNegativeX.bind(this),this.moveNegativeZPositiveX=this.moveNegativeZPositiveX.bind(this)}onMouseWheel(e){this._modularCoreDisplay.motionMove(0,0,e.wheelDelta/120,e.x,e.y),this._modularCoreDisplay.commitCameraChanges(s.MCD_ENUM.CommitAction.CT_Immediate),e.preventDefault()}movePositiveX(){this._modularCoreDisplay.motionMove(1,0,0,-1,-1),this._modularCoreDisplay.commitCameraChanges(s.MCD_ENUM.CommitAction.CT_Immediate)}movePositiveY(){this._modularCoreDisplay.motionMove(0,1,0,-1,-1),this._modularCoreDisplay.commitCameraChanges(s.MCD_ENUM.CommitAction.CT_Immediate)}movePositiveZ(){this._modularCoreDisplay.motionMove(0,0,1,-1,-1),this._modularCoreDisplay.commitCameraChanges(s.MCD_ENUM.CommitAction.CT_Immediate)}moveNegativeX(){this._modularCoreDisplay.motionMove(-1,0,0,-1,-1),this._modularCoreDisplay.commitCameraChanges(s.MCD_ENUM.CommitAction.CT_Immediate)}moveNegativeY(){this._modularCoreDisplay.motionMove(0,-1,0,-1,-1),this._modularCoreDisplay.commitCameraChanges(s.MCD_ENUM.CommitAction.CT_Immediate)}moveNegativeZ(){this._modularCoreDisplay.motionMove(0,0,-1,-1,-1),this._modularCoreDisplay.commitCameraChanges(s.MCD_ENUM.CommitAction.CT_Immediate)}lookPositiveX(){this._modularCoreDisplay.motionRotate(1,0,!1),this._modularCoreDisplay.commitCameraChanges(s.MCD_ENUM.CommitAction.CT_Immediate)}lookPositiveY(){this._modularCoreDisplay.motionRotate(0,1,!1),this._modularCoreDisplay.commitCameraChanges(s.MCD_ENUM.CommitAction.CT_Immediate)}lookNegativeX(){this._modularCoreDisplay.motionRotate(-1,0,!1),this._modularCoreDisplay.commitCameraChanges(s.MCD_ENUM.CommitAction.CT_Immediate)}lookNegativeY(){this._modularCoreDisplay.motionRotate(0,-1,!1),this._modularCoreDisplay.commitCameraChanges(s.MCD_ENUM.CommitAction.CT_Immediate)}movePositiveZNegativeX(){this._modularCoreDisplay.motionMove(-1,0,1,-1,-1),this._modularCoreDisplay.commitCameraChanges(s.MCD_ENUM.CommitAction.CT_Immediate)}movePositiveZPositiveX(){this._modularCoreDisplay.motionMove(1,0,1,-1,-1),this._modularCoreDisplay.commitCameraChanges(s.MCD_ENUM.CommitAction.CT_Immediate)}moveNegativeZNegativeX(){this._modularCoreDisplay.motionMove(-1,0,-1,-1,-1),this._modularCoreDisplay.commitCameraChanges(s.MCD_ENUM.CommitAction.CT_Immediate)}moveNegativeZPositiveX(){this._modularCoreDisplay.motionMove(1,0,-1,-1,-1),this._modularCoreDisplay.commitCameraChanges(s.MCD_ENUM.CommitAction.CT_Immediate)}}},Uwny:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("Oc5x"),n=i("Khlq"),a=i("B45s"),o=i("JxDP");t.BackgroundManager=class extends o.MCDViewCommand{constructor(e){super(!1),this._isLocked=!1,this._activeBackgroundType=n.MCD_ENUM.BackgroundInputType.Color,this._backgroundData=JSON.parse("{}"),this._dynamicMeshLayerForBackground=null,this._dynamicMeshLayerForBase64Background=null,this._darkMeshBackground=null,this._dynamicMeshLayerNameForBackground="BackgroundInDynamicMeshLayer",this._dynamicMeshLayerNameForBase64Background="Base64BackgroundInDynamicMeshLayer",this._targetCompositeName="background",this._blank_image="iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4wcDCQIGKBVMSgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAC0lEQVQI12NgAAIAAAUAAeImBZsAAAAASUVORK5CYII=",this._defaultColor=new s.MCDColor(.7,.73,.8,1),this._hidePreviousBackgroundOnLoad=!1,this._width=0,this._height=0,this._modularCoreDisplay=e||function(){throw new Error("MCD recieved was null for ModularCoreDisplay")}(),this.onBackgroundLoaded=this.onBackgroundLoaded.bind(this),this.addEvent(n.MCD_ENUM.CallbackEventNames.BACKGROUND_LOAD_EVENT,this.onBackgroundLoaded)}setupInitialBackground(){const e=JSON.parse("{}");if(e["target-name"]="BackgroundSkyBox",e["target-composite"]=this._targetCompositeName,e["target-type"]="SkyBox",e.hidden=!0,this._modularCoreDisplay.create("RenderTarget",JSON.stringify(e)),this.setBackgroundColor(this._defaultColor),this._dynamicMeshLayerForBackground||(this._dynamicMeshLayerForBackground=new a.DynamicMeshLayer(this._dynamicMeshLayerNameForBackground,this._modularCoreDisplay,0,!1,this._targetCompositeName)),this._dynamicMeshLayerForBase64Background||(this._dynamicMeshLayerForBase64Background=new a.DynamicMeshLayer(this._dynamicMeshLayerNameForBase64Background,this._modularCoreDisplay,0,!1,this._targetCompositeName),this.setMeshData("base64_resources://background_texture",this._dynamicMeshLayerNameForBase64Background)),!this._darkMeshBackground){const e="DarkMesh";this._darkMeshBackground=new a.DynamicMeshLayer(e,this._modularCoreDisplay,0,!1,this._targetCompositeName,1),this.setMeshDataForDarkBackground(e),this._darkMeshBackground.setVisibility(!1)}}set eventManager(e){this._eventManager=e}start(){return this._eventManager.pushPermanentListener(this),!0}stop(){return this._eventManager.popPermanentListener(this),!0}setBackground(e,t,i,a){let o=!1;if(this._width=i,this._height=a,!1===this._isLocked)if(t&&(t instanceof s.MCDColor||"string"==typeof t)){if(e===n.MCD_ENUM.BackgroundInputType.Color||this._activeBackgroundType===n.MCD_ENUM.BackgroundInputType.Color?this.hidePreviousBackground(this._activeBackgroundType):this._activeBackgroundType!==e?(this._hidePreviousBackgroundOnLoad=!0,this._previousBackgroundType=this._activeBackgroundType):this._activeBackgroundType===e&&(this._hidePreviousBackgroundOnLoad=!1),e===n.MCD_ENUM.BackgroundInputType.Color&&t instanceof s.MCDColor)this.setBackgroundColor(t),o=!0;else if(e===n.MCD_ENUM.BackgroundInputType.SkyBox&&"string"==typeof t){const i=JSON.parse("{}");i.url=t;const s=JSON.parse("{}");s["target-name"]="BackgroundSkyBox",s.visibility=!0,s.config=i,this._modularCoreDisplay.set("RenderTarget",JSON.stringify(s)),this._backgroundData[e.toString()]=t,this._activeBackgroundType=e,o=!0}else if(e===n.MCD_ENUM.BackgroundInputType.StaticImage&&"string"==typeof t)null!==this._dynamicMeshLayerForBackground&&(this.setMeshData(t,this._dynamicMeshLayerNameForBackground),this._dynamicMeshLayerForBackground.setVisibility(!0)),this._backgroundData[e.toString()]=t,this._activeBackgroundType=e,o=!0;else if(e===n.MCD_ENUM.BackgroundInputType.SnapshotData&&"string"==typeof t){const i={},s={},n=this.isJsonString(t)?JSON.parse(t):t;i.type="base64",i.name="background_texture",i.url="base64_resources://background_texture",i.data=n.hasOwnProperty("options")&&n.options.hasOwnProperty("data")?n.options.data:n,s["target-name"]=this._dynamicMeshLayerNameForBase64Background,s.updateTexture=i,this._modularCoreDisplay.set("RenderTarget",JSON.stringify(s)),this.resetBackgroundDimension(),n.hasOwnProperty("darken")&&this._darkMeshBackground.setVisibility(n.darken),this._backgroundData[e.toString()]=i.data,this._activeBackgroundType=e,o=!0}}else e===n.MCD_ENUM.BackgroundInputType.Color&&(this._activeBackgroundType!==n.MCD_ENUM.BackgroundInputType.Color&&this.hidePreviousBackground(this._activeBackgroundType),this.setBackgroundColor(this._defaultColor),o=!0);return o}getBackground(){let e=null;if(this._backgroundData.hasOwnProperty(this._activeBackgroundType.toString()))if(this._activeBackgroundType===n.MCD_ENUM.BackgroundInputType.Color){const t=this._backgroundData[this._activeBackgroundType.toString()];null!==t&&(e=new s.MCDColor(t.Red,t.Green,t.Blue,t.Alpha))}else e=this._backgroundData[this._activeBackgroundType.toString()];return e}setMeshData(e,t){const i={},s={vertices:[1,-1,0,1,1,0,-1,1,0,-1,-1,0],triangleindices:[0,1,2,0,2,3]},n={};n.name="base64_resources://background_texture"===e?"background_texture":"texture0",n.url=e,s.textures=[n],s.triangletextureids=[0,0],s.texcoords=[1,1,1,0,0,0,0,1],i.setMesh=s,i["target-name"]=t,this._modularCoreDisplay.set("RenderTarget",JSON.stringify(i))}get lockBackground(){return this._isLocked}set lockBackground(e){this._isLocked=e}get activeBackgroundType(){return this._activeBackgroundType}set activeBackgroundType(e){this._activeBackgroundType=e}hidePreviousBackground(e){this._backgroundData.hasOwnProperty(e.toString())&&(e===n.MCD_ENUM.BackgroundInputType.SkyBox&&this._modularCoreDisplay.set("RenderTarget",JSON.stringify({"target-name":"BackgroundSkyBox",visibility:!1})),e===n.MCD_ENUM.BackgroundInputType.StaticImage&&null!==this._dynamicMeshLayerForBackground&&this._dynamicMeshLayerForBackground.setVisibility(!1),e===n.MCD_ENUM.BackgroundInputType.SnapshotData&&(null!==this._dynamicMeshLayerForBackground&&this.resetDynamicMeshLayerForbase64(),null!==this._darkMeshBackground&&this._darkMeshBackground.setVisibility(!1))),this._hidePreviousBackgroundOnLoad=!1}setBackgroundColor(e){if(null!==e){const t=JSON.parse("{}");t.Red=e.red,t.Green=e.green,t.Blue=e.blue,t.Alpha=e.alpha;const i=JSON.parse("{}");i.colorData=t;const s=JSON.parse("{}");s.BackgroundColor=i,this._modularCoreDisplay.set("Background",JSON.stringify(s)),this._backgroundData[n.MCD_ENUM.BackgroundInputType.Color]=t,this._activeBackgroundType=n.MCD_ENUM.BackgroundInputType.Color}}resetDynamicMeshLayerForbase64(){const e={type:"base64",name:"background_texture",url:"base64_resources://background_texture"};e.data=this._blank_image;const t={};t["target-name"]=this._dynamicMeshLayerNameForBase64Background,t.updateTexture=e,this._modularCoreDisplay.set("RenderTarget",JSON.stringify(t))}onBackgroundLoaded(e){e.event&&"resource-cached"===e.event&&(this._activeBackgroundType===n.MCD_ENUM.BackgroundInputType.SkyBox&&this._modularCoreDisplay.commitCameraChanges(n.MCD_ENUM.CommitAction.CT_Immediate),this._hidePreviousBackgroundOnLoad&&this.hidePreviousBackground(this._previousBackgroundType))}isJsonString(e){if("string"!=typeof e)return!1;try{return JSON.parse(e),!0}catch(t){return!1}}setMeshDataForDarkBackground(e){const t={},i={vertices:[1,-1,0,1,1,0,-1,1,0,-1,-1,0],triangleindices:[0,1,2,0,2,3],colorindices:[0,0,0,0]},s=[0,0,0,.6];i.colortable=[s,s,s,s],t.setMesh=i,t["target-name"]=e,this._modularCoreDisplay.set("RenderTarget",JSON.stringify(t))}setBackgroundDimension(e,t){let i=[1,1,1,0,0,0,0,1];if(void 0===this._width||void 0===this._height)return;if(this._width/this._height>e/t){const s=t*this._width/this._height,n=(s-e)/2/s;i=[1-n,1,1-n,0,n,0,n,1]}else if(this._width/this._height<e/t){const s=e*this._height/this._width,n=(s-t)/2/s;i=[1,1-n,1,n,0,n,0,1-n]}const s={},n={offset:0,vertices:[1,-1,0,1,1,0,-1,1,0,-1,-1,0]};n.texcoords=i,s.modifyVertexRange=n,s["target-name"]=this._dynamicMeshLayerNameForBase64Background,this._modularCoreDisplay.set("RenderTarget",JSON.stringify(s))}resetBackgroundDimension(){const e={modifyVertexRange:{offset:0,vertices:[1,-1,0,1,1,0,-1,1,0,-1,-1,0],texcoords:[1,1,1,0,0,0,0,1]}};e["target-name"]=this._dynamicMeshLayerNameForBase64Background,this._modularCoreDisplay.set("RenderTarget",JSON.stringify(e))}}},Vw1h:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=t.UndoManagerEvents=function(e){return e[e.CAN_UNDO=1]="CAN_UNDO",e[e.CAN_REDO=2]="CAN_REDO",e}(t.UndoManagerEvents||{});t.UndoRedoManager=class{constructor(){this.eventListeners=new Map,this._undoViewsLimit=50,this.initializeUndoRedoStates()}set undoLimit(e){if(e<=0)throw new Error("Arguments Out of Range Exception");if(this._undoViewsLimit!==e){this._undoViewsLimit=e;const t=this._undoStates.pop();this.initializeUndoRedoStates(),null!==t&&this.saveState(t)}}get undoLimit(){return this._undoViewsLimit}set canUndo(e){if(this._canUndo!==e){this._canUndo=e;const t=this.eventListeners.get(s.CAN_UNDO);t&&t(e)}}get canUndo(){return this._canUndo}set canRedo(e){if(this._canRedo!==e){this._canRedo=e;const t=this.eventListeners.get(s.CAN_REDO);t&&t(e)}}get canRedo(){return this._canRedo}setCurrentState(e){if(this._currentState){if(this.areStatesEqual(this._currentState,e))return!1;this.saveState(this._currentState)}return this._currentState=e,!0}get currentState(){return this._currentState}set currentCameraProjectionIsOrthographic(e){this._currentCameraProjection=e}get currentCameraProjectionIsOrthographic(){return this._currentCameraProjection}initializeUndoRedoStates(){this.canUndo=!1,this.canRedo=!1,this._undoStates=new Array,this._redoStates=new Array,this._currentState="",this._currentCameraProjection=!1}addEventlistener(e,t){t=t.bind(this),this.eventListeners.set(e,t)}deleteEventListener(e){this.eventListeners.delete(e)}undo(){if(this.canUndo&&(this._redoStates.push(this._currentState),this._currentState=this._undoStates.pop(),this.canRedo=!0,this._undoStates.length<=0&&(this.canUndo=!1)),this._currentState){const e=JSON.parse(this._currentState);return e.isOrthographic=this.currentCameraProjectionIsOrthographic,JSON.stringify(e)}return this._currentState}redo(){if(this.canRedo&&(this._undoStates.push(this._currentState),this._currentState=this._redoStates.pop(),this.canUndo=!0,this._redoStates.length<=0&&(this.canRedo=!1)),this._currentState){const e=JSON.parse(this._currentState);return e.isOrthographic=this.currentCameraProjectionIsOrthographic,JSON.stringify(e)}return this._currentState}saveState(e){e&&(this._redoStates.length>0&&(this._redoStates=[],this.canRedo=!1),this._undoStates.push(e),this.canUndo=!0,this._undoStates.length>this._undoViewsLimit&&this._undoStates.shift())}areStatesEqual(e,t){let i=!1;if(null!==t&&null!==e){const s=JSON.parse(t),n=JSON.parse(e);if(!s.hasOwnProperty("error")&&!n.hasOwnProperty("error")){const e=Object.keys(s),t=Object.keys(n);if(e.length!==t.length)return!1;for(const a of e){const e=s[a],t=n[a];if(i="eye"===a?this.compareEyeStates(e,t,i):"orientation"===a?this.compareOrientationState(e,t,i):"distance"===a||"farClipDistance"===a||"fieldOfView"===a||"minDistanceBetweenEyeAndCenter"===a?this.compareStateParameters(e,t,i):e===t,!1===i)break}}}return i}compareStateParameters(e,t,i){return 0===Math.abs(e-t)}compareOrientationState(e,t,i){return 0===Math.abs(e[0]-t[0])&&0===Math.abs(e[1]-t[1])&&0===Math.abs(e[2]-t[2])&&0===Math.abs(e[3]-t[3])}compareEyeStates(e,t,i){return 0===Math.abs(e[0]-t[0])&&0===Math.abs(e[1]-t[1])&&0===Math.abs(e[2]-t[2])}resetUndoRedoManager(){this._undoViewsLimit=50,this.initializeUndoRedoStates()}stash(e){return!(!this._canUndo||0!==this._stashUndoStates.length||(this._currentState=e,this._stashUndoStates=this._undoStates.slice(),this._undoStates=new Array,this._redoStates=new Array,this._canUndo=!1,this._canRedo=!1,0))}withdraw(e){return this._stashUndoStates.length>0&&(this._currentState=e,this._undoStates=this._stashUndoStates.slice(),this._stashUndoStates=new Array,this._redoStates=new Array,this._canUndo=this._stashUndoStates.length>0,this._canRedo=!1,!0)}}},XHCD:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("Khlq");t.Telemetry=class{static getTelemetryJson(e,t=s.MCD_ENUM.TelemetryEventType.Feature,i=s.MCD_ENUM.TelemetryMessageType.Discrete,n=""){const a={};return a.eventName=e,a.eventType=t,a.messageType=i,a.eventData=n,JSON.parse(JSON.stringify(a))}static getModelTypeTelemetry(e,t){return t?e===s.MCD_ENUM.Target.EDGES?s.MCD_ENUM.TelemetryEventName.Open2DDrawing:e===s.MCD_ENUM.Target.HSPC?s.MCD_ENUM.TelemetryEventName.OpenHSPC:e===s.MCD_ENUM.Target.TILES?s.MCD_ENUM.TelemetryEventName.Open3DTile:s.MCD_ENUM.TelemetryEventName.Open3DModel:e===s.MCD_ENUM.Target.EDGES?s.MCD_ENUM.TelemetryEventName.Close2DDrawing:e===s.MCD_ENUM.Target.HSPC?s.MCD_ENUM.TelemetryEventName.CloseHSPC:e===s.MCD_ENUM.Target.TILES?s.MCD_ENUM.TelemetryEventName.Close3DTile:s.MCD_ENUM.TelemetryEventName.Close3DModel}}},Xlwq:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),i("oHXl"),t.MyVrMonikerLookup=class{constructor(){this._stringTree=new StringTreeJS}get isLoaded(){return!(null==this._stringTree||!this._stringTree.isLoaded())}openBinFile(e,t="tree0000.idx.bin"){return s(this,void 0,void 0,(function*(){try{!0===(yield fetch(e+t).then(e=>e).catch(e=>{throw e})).ok&&this._stringTree.open(e+t)}catch(i){return console.error("ERROR: "+i),!1}}))}closeBinFile(){return this._stringTree.close(),!0}findMoniker(e){return this._stringTree.ReverseFind(e)||""}findGraphic(e){const t=this._stringTree.Find(e);return t?Array.prototype.slice.call(t):""}}},Y0B9:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("2T81"),n=i("mN5u");var a=t.stylesID=function(e){return e.NONE="",e.DEFAULT_BIGGER_CIRCLE="DefaultBigerCircle",e.DESELECTED_BIGGER_CIRCLE="DeselectedBiggerCircle",e.POINT_WHITE_BORDER="PointWithWhiteBorder",e.POINT_NO_BORDER="PointWithNoBorder",e.LINE="Line",e.SELECTED_BIGGER_CIRCLE="SelectedBiggerCircle",e.MOVING_BIGGER_CIRCLE="movingBiggerCircle",e}(t.stylesID||{}),o=t.Point_Type=function(e){return e[e.START=0]="START",e[e.END=1]="END",e[e.BOTH=2]="BOTH",e[e.NONE=3]="NONE",e}(t.Point_Type||{}),r=t.MeasurementFeatureIDs=function(e){return e[e.START_SMALL_POINT=0]="START_SMALL_POINT",e[e.START_BIGGER_DISC=1]="START_BIGGER_DISC",e[e.END_SMALL_POINT=2]="END_SMALL_POINT",e[e.END_BIGGER_DISC=3]="END_BIGGER_DISC",e[e.LINE=4]="LINE",e[e.TEXT=5]="TEXT",e}(t.MeasurementFeatureIDs||{});t.MeasurementPoint=class{constructor(e,t){this._position=e,this._orientation=t}set position(e){this._position=e}get position(){return this._position}set orientation(e){this._orientation=e}get orientation(){return this._orientation}isEqual(e){return this._position.x===e._position.x&&this._position.y===e._position.y&&this._position.z===e._position.z&&this._orientation.x===e._orientation.x&&this._orientation.y===e._orientation.y&&this._orientation.z===e._orientation.z}};class l{constructor(e,t){this._featureID=e,this._styleID=t}set featureID(e){this._featureID=e}get featureID(){return this._featureID}set styleID(e){this._styleID=e}get styleID(){return this._styleID}}t.MeasurementFeature=l;class h extends l{constructor(e,t,i){super(e,t),this._point=i}set point(e){this._point=e}get point(){return this._point}}t.MeasurementFeaturePoint=h;class c extends l{constructor(e,t,i,s){super(e,t),this._start=i,this._end=s}set start(e){this._start=e}get start(){return this._start}set end(e){this._end=e}get end(){return this._end}}t.MeasurementFeatureLine=c;class _ extends l{constructor(e,t,i,s){super(e,t),this._alignment="CENTRE",this._point=i,this._text=s}set point(e){this._point=e}get point(){return this._point}set text(e){this._text=e}get text(){return this._text}set alignment(e){this._alignment=e}get alignment(){return this._alignment}}t.MeasurementLine=(()=>{class e{constructor(e){this._activePoint=o.NONE,this._startFeatureID=e}get startPoint(){return this._startPoint}get endPoint(){return this._endPoint}get startFeatureID(){return this._startFeatureID}get activePoint(){return this._activePoint}set activePoint(e){this._activePoint=e}addPoint(e,t){e===o.START?(this._startPoint=t,this._startSmallCircle=new h(this._startFeatureID+r.START_SMALL_POINT,a.POINT_WHITE_BORDER,this._startPoint),this._startBiggerCircle=new h(this._startFeatureID+r.START_BIGGER_DISC,a.DEFAULT_BIGGER_CIRCLE,this._startPoint),this.createOrUpdateFeature(this._startSmallCircle),this.createOrUpdateFeature(this._startBiggerCircle),this._endPoint?(this.createOrUpdateLineAndText(),this.createOrUpdateFeature(this._line),this.createOrUpdateFeature(this._text),this._activePoint=o.BOTH):this._activePoint=o.START):e===o.END&&(this._endPoint=t,this._endSmallCircle=new h(this._startFeatureID+r.END_SMALL_POINT,a.POINT_WHITE_BORDER,this._endPoint),this._endBiggerCircle=new h(this._startFeatureID+r.END_BIGGER_DISC,a.DEFAULT_BIGGER_CIRCLE,this._endPoint),this.createOrUpdateFeature(this._endSmallCircle),this.createOrUpdateFeature(this._endBiggerCircle),this._startPoint?(this.createOrUpdateLineAndText(),this.createOrUpdateFeature(this._line),this.createOrUpdateFeature(this._text),this._activePoint=o.BOTH):this._activePoint=o.END)}updatePoint(e,t){e===o.START?(this._startPoint=t,this._startSmallCircle.point=this._startPoint,this._startBiggerCircle.point=this._startPoint,this.createOrUpdateFeature(this._startSmallCircle),this.createOrUpdateFeature(this._startBiggerCircle),this._endPoint&&(this.createOrUpdateLineAndText(),this.createOrUpdateFeature(this._line),this.createOrUpdateFeature(this._text))):e===o.END&&(this._endPoint=t,this._endBiggerCircle.point=this._endPoint,this._endSmallCircle.point=this._endPoint,this.createOrUpdateFeature(this._endBiggerCircle),this.createOrUpdateFeature(this._endSmallCircle),this._startPoint&&(this.createOrUpdateLineAndText(),this.createOrUpdateFeature(this._line),this.createOrUpdateFeature(this._text)))}createOrUpdateLineAndText(){const e=(new s.GlMath).distance(this._startPoint.position,this._endPoint.position),t=new s.Vec3(0,0,0);t.x=Math.abs(this._startPoint.position.x-this._endPoint.position.x),t.y=Math.abs(this._startPoint.position.y-this._endPoint.position.y),t.z=Math.abs(this._startPoint.position.z-this._endPoint.position.z);const i=this.getText(e,t),n=new s.Vec3(0,0,0);n.x=(this._startPoint.position.x+this._endPoint.position.x)/2,n.y=(this._startPoint.position.y+this._endPoint.position.y)/2,n.z=(this._startPoint.position.z+this._endPoint.position.z)/2,this._line?(this._line.start=this._startPoint,this._line.end=this._endPoint,this._text.point=n,this._text.text=i):(this._line=new c(this._startFeatureID+r.LINE,a.LINE,this._startPoint,this._endPoint),this._text=new _(this._startFeatureID+r.TEXT,a.NONE,n,i))}getText(t,i){let s="",a="";const o=e.precision;return e.units===n.Units.METERS?a="m":e.units===n.Units.CENTIMETERS?(a="cm",t*=100,i.x=100*i.x,i.y=100*i.y,i.z=100*i.z):e.units===n.Units.MILLIMETERS&&(a="mm",t*=1e3,i.x=1e3*i.x,i.y=1e3*i.y,i.z=1e3*i.z),s=s+" D: "+t.toFixed(o)+" "+a,!0===e.showDimesionsAlongXYZ&&(s+="\n",s=s+" X: "+i.x.toFixed(o)+" "+a,s+="\n",s=s+" Y: "+i.y.toFixed(o)+" "+a,s+="\n",s=s+" Z: "+i.z.toFixed(o)+" "+a),s}updateText(){this.startPoint&&this.endPoint&&this._line&&(this.createOrUpdateLineAndText(),this.createOrUpdateFeature(this._text))}activatePoint(e){e===o.START?(this._activePoint=o.START,this._startPoint&&(this._startBiggerCircle.styleID=a.SELECTED_BIGGER_CIRCLE,this._startSmallCircle.styleID=a.POINT_WHITE_BORDER,this.updateStyle(this._startBiggerCircle),this.updateStyle(this._startSmallCircle)),this._endPoint&&(this._endBiggerCircle.styleID=a.DESELECTED_BIGGER_CIRCLE,this._endSmallCircle.styleID=a.POINT_WHITE_BORDER,this.updateStyle(this._endBiggerCircle),this.updateStyle(this._endSmallCircle))):e===o.END?(this._activePoint=o.END,this._endPoint&&(this._endBiggerCircle.styleID=a.SELECTED_BIGGER_CIRCLE,this._endSmallCircle.styleID=a.POINT_WHITE_BORDER,this.updateStyle(this._endBiggerCircle),this.updateStyle(this._endSmallCircle)),this._startPoint&&(this._startBiggerCircle.styleID=a.DESELECTED_BIGGER_CIRCLE,this._startSmallCircle.styleID=a.POINT_WHITE_BORDER,this.updateStyle(this._startBiggerCircle),this.updateStyle(this._startSmallCircle))):e===o.BOTH&&(this._activePoint=o.BOTH,this._startPoint&&(this._startBiggerCircle.styleID=a.DEFAULT_BIGGER_CIRCLE,this._startSmallCircle.styleID=a.POINT_WHITE_BORDER,this.updateStyle(this._startBiggerCircle),this.updateStyle(this._startSmallCircle)),this._endPoint&&(this._endBiggerCircle.styleID=a.DEFAULT_BIGGER_CIRCLE,this._endSmallCircle.styleID=a.POINT_WHITE_BORDER,this.updateStyle(this._endBiggerCircle),this.updateStyle(this._endSmallCircle)))}delete(e){e===o.START?this._startPoint&&(this._startPoint=null,this.removeFeature(this._startBiggerCircle),this.removeFeature(this._startSmallCircle),this._endPoint?(this.removeFeature(this._line),this.removeFeature(this._text),this._activePoint=o.END):this._activePoint=o.NONE):e===o.END?this._endPoint&&(this._endPoint=null,this.removeFeature(this._endBiggerCircle),this.removeFeature(this._endSmallCircle),this._startPoint?(this.removeFeature(this._line),this.removeFeature(this._text),this._activePoint=o.START):this._activePoint=o.NONE):e===o.BOTH&&(this._startPoint&&(this.removeFeature(this._startBiggerCircle),this.removeFeature(this._startSmallCircle)),this._endPoint&&(this.removeFeature(this._endBiggerCircle),this.removeFeature(this._endSmallCircle)),this._line&&(this.removeFeature(this._line),this.removeFeature(this._text)),this._startPoint=null,this._endPoint=null,this._activePoint=o.NONE)}deactivate(){this._startPoint&&this._endPoint?(this._startSmallCircle.styleID=a.POINT_NO_BORDER,this._endSmallCircle.styleID=a.POINT_NO_BORDER,this.updateStyle(this._startSmallCircle),this.updateStyle(this._endSmallCircle),this.removeFeature(this._startBiggerCircle),this.removeFeature(this._endBiggerCircle)):this._startPoint&&!this._endPoint?(this.removeFeature(this._startBiggerCircle),this.removeFeature(this._startSmallCircle)):!this._startPoint&&this._endPoint&&(this.removeFeature(this._endSmallCircle),this.removeFeature(this._endBiggerCircle)),this._activePoint=o.NONE}activate(){this._startPoint&&this._endPoint&&(this.createOrUpdateFeature(this._startBiggerCircle),this.createOrUpdateFeature(this._endBiggerCircle),this._startSmallCircle.styleID=a.POINT_WHITE_BORDER,this._endSmallCircle.styleID=a.POINT_WHITE_BORDER,this.updateStyle(this._startSmallCircle),this.updateStyle(this._endSmallCircle),this._activePoint=o.BOTH)}changePointStyleForMoving(e){e===o.START?(this._startBiggerCircle.styleID=a.MOVING_BIGGER_CIRCLE,this.updateStyle(this._startBiggerCircle)):e===o.END&&(this._endBiggerCircle.styleID=a.MOVING_BIGGER_CIRCLE,this.updateStyle(this._endBiggerCircle))}resetPointStyleAfterMoving(e){e===o.START?(this._startBiggerCircle.styleID=a.DEFAULT_BIGGER_CIRCLE,this.activePoint===o.START?this._startBiggerCircle.styleID=a.SELECTED_BIGGER_CIRCLE:this.activePoint===o.END&&(this._startBiggerCircle.styleID=a.DESELECTED_BIGGER_CIRCLE),this.updateStyle(this._startBiggerCircle)):e===o.END&&(this._endBiggerCircle.styleID=a.DEFAULT_BIGGER_CIRCLE,this.activePoint===o.END?this._endBiggerCircle.styleID=a.SELECTED_BIGGER_CIRCLE:this.activePoint===o.START&&(this._endBiggerCircle.styleID=a.DESELECTED_BIGGER_CIRCLE),this.updateStyle(this._endBiggerCircle))}createOrUpdateFeature(t){e.createdIDs[t.featureID]&&e.featureLayer.removeFeature(t.featureID),t instanceof h?e.featureLayer.addPoint(t.featureID,t.point.position,t.styleID,t.point.orientation):t instanceof c?e.featureLayer.addLine(t.featureID,t.start.position,t.end.position,t.styleID):t instanceof _&&e.featureLayer.addText(t.featureID,t.text,t.point,t.alignment,t.styleID),e.createdIDs[t.featureID]=!0}updateStyle(t){e.createdIDs[t.featureID]&&e.featureLayer.setStyleToFeature(t.featureID,t.styleID)}removeFeature(t){e.createdIDs[t.featureID]&&(e.featureLayer.removeFeature(t.featureID),e.createdIDs[t.featureID]=!1)}}return e.createdIDs=[],e.units=n.Units.METERS,e.precision=3,e.showDimesionsAlongXYZ=!0,e})()},ZV0p:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i("JxDP"),a=i("Khlq"),o=i("B45s"),r=i("2T81"),l=i("DCEI"),h=i("fx83"),c=i("Tb5U"),_=i("XHCD");t.FlyNavigationBase=class extends n.MCDViewCommand{constructor(){super(!1),this._modularCoreDisplay=null,this._canvas=null,this._nativeBrowser=!1,this._width=null,this._height=null,this._isMovingBackwards=!1,this._mouseRUp=!1,this._mouseButtonState=a.MCD_ENUM.EventConstants.MOUSE_NOBUTTON,this._mouseSensitivity=4,this._isShiftPressed=!1,this._dynamicMeshLayerForCrossHair=null,this._dynamicMeshLayerNameForCrossHair="CrossHairInDynamicMeshLayer",this._targetCompositeName="foreground",this._crossHairPath="",this._matrixProjectViewInv=new r.Mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this._zoomDelta=0,this._minCameraDistanceOnCamera=0}set width(e){this._width=e}get width(){return this._width}set height(e){this._height=e}get height(){return this._height}isNativeBrowser(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))}init(e,t,i,s,n,r,l){if(!i)throw new Error("The ModularCoreDisplay provided was NULL.");this._flyNavigation=e,this._eventManager=t,this._modularCoreDisplay=i,this._canvas=l,this._canvas&&(this._nativeBrowser=this.isNativeBrowser()),this._width=s,this._height=n,this._crossHairPath=r,this._isMovingBackwards=!1,this._displayNavigation=new c.DisplayNavigation(i),this.mouseMoveCallback=this.onMouseMove.bind(this),this.mouseDownCallback=this.onMouseDown.bind(this),this.mouseUpCallback=this.onMouseUp.bind(this),this.mouseRightClickCallback=this.onMouseRightClick.bind(this),this.mouseWheelCallback=this.onMouseWheel.bind(this),this.shiftPressed=this.shiftPressed.bind(this),this.shiftReleased=this.shiftReleased.bind(this),this.onContinuousFlyIn=this.onContinuousFlyIn.bind(this),this.onContinuousFlyOut=this.onContinuousFlyOut.bind(this),this.stopMoving=this.stopMoving.bind(this),this.onLockChange=this.onLockChange.bind(this),this.contextMenuHandler=this.contextMenuHandler.bind(this),this.onTouchCountUpdateCallback=this.onTouchCountUpdate.bind(this),this.manipulationUpdateCallback=this.onManipulationUpdateEvent.bind(this),this.manipulationEndCallback=this.onManipulationEndEvent.bind(this),this.onLayout=this.onLayout.bind(this),this.surfaceLocateCallback=this.onSurfaceLocate.bind(this),this.addEvent(a.MCD_ENUM.EventNames.MOUSE_MOVE_EVENT,this.mouseMoveCallback),this.addEvent(a.MCD_ENUM.EventNames.MOUSE_DOWN_EVENT,this.mouseDownCallback),this.addEvent(a.MCD_ENUM.EventNames.MOUSE_UP_EVENT,this.mouseUpCallback),this.addEvent(a.MCD_ENUM.EventNames.MOUSE_RIGHT_CLICK_EVENT,this.mouseRightClickCallback),this.addEvent(a.MCD_ENUM.EventNames.MOUSE_WHEEL_EVENT,this.mouseWheelCallback),this.addEvent(a.MCD_ENUM.EventNames.MOUSE_CLICK_EVENT,()=>{}),this.addEvent(a.MCD_ENUM.EventNames.TAP_EVENT,()=>{}),this.addEvent(a.MCD_ENUM.EventNames.MANIPULATION_UPDATE_EVENT,this.manipulationUpdateCallback),this.addEvent(a.MCD_ENUM.EventNames.MANIPULATION_END_EVENT,this.manipulationEndCallback),this.addEvent(a.MCD_ENUM.EventNames.TOUCH_COUNT_UPDATE_EVENT,this.onTouchCountUpdateCallback),this.addEvent(a.MCD_ENUM.EventNames.HOLD_EVENT,()=>{}),this.addEvent(a.MCD_ENUM.CallbackEventNames.LOCATE_EVENT,this.surfaceLocateCallback,!1,!1),this._dynamicMeshLayerForCrossHair||(this._dynamicMeshLayerForCrossHair=new o.DynamicMeshLayer(this._dynamicMeshLayerNameForCrossHair,this._modularCoreDisplay,0,!1,this._targetCompositeName),this.setMeshDataForCrossHair(),this._dynamicMeshLayerForCrossHair.setVisibility(!1)),this._keyMappings=this.createKeyMappings()}createKeyMappings(){const e=new h.MCDKey(27,a.MCD_ENUM.KeyEventType.KEY_UP,this.stop),t=new h.MCDKey(16,a.MCD_ENUM.KeyEventType.KEY_DOWN,this.shiftPressed),i=new h.MCDKey(16,a.MCD_ENUM.KeyEventType.KEY_UP,this.shiftReleased),s=new h.MCDKey(87,a.MCD_ENUM.KeyEventType.KEY_DOWN,this.onContinuousFlyIn),n=new h.MCDKey(83,a.MCD_ENUM.KeyEventType.KEY_DOWN,this.onContinuousFlyOut),o=new h.MCDKey(87,a.MCD_ENUM.KeyEventType.KEY_UP,this.stopMoving),r=new h.MCDKey(83,a.MCD_ENUM.KeyEventType.KEY_UP,this.stopMoving),l=new h.MCDKey(40,a.MCD_ENUM.KeyEventType.KEY_DOWN,this.onContinuousFlyOut),c=new h.MCDKey(40,a.MCD_ENUM.KeyEventType.KEY_UP,this.stopMoving),_=new h.MCDKey(38,a.MCD_ENUM.KeyEventType.KEY_DOWN,this.onContinuousFlyIn),d=new h.MCDKey(38,a.MCD_ENUM.KeyEventType.KEY_UP,this.stopMoving);return[e,t,i,s,o,n,r,new h.MCDKey(73,a.MCD_ENUM.KeyEventType.KEY_DOWN,this._displayNavigation.lookPositiveY),new h.MCDKey(74,a.MCD_ENUM.KeyEventType.KEY_DOWN,this._displayNavigation.lookPositiveX),new h.MCDKey(75,a.MCD_ENUM.KeyEventType.KEY_DOWN,this._displayNavigation.lookNegativeY),new h.MCDKey(76,a.MCD_ENUM.KeyEventType.KEY_DOWN,this._displayNavigation.lookNegativeX),l,c,_,d]}shiftPressed(){this._isShiftPressed=!0,!this._flyNavigation.moveInSet&&!this._flyNavigation.moveOutSet||this._isMovingBackwards||(this._isMovingBackwards=!0,this._flyNavigation.stopMoveMode(),this.onContinuousFlyInOut())}shiftReleased(){this._isShiftPressed=!1,this._isMovingBackwards=!1,(this._flyNavigation.moveInSet||this._flyNavigation.moveOutSet)&&(this._flyNavigation.stopMoveMode(),this.onContinuousFlyInOut())}start(){const e=super.start();return e&&(this._modularCoreDisplay.get("CameraState","").then(e=>{if(""!==e){const t=JSON.parse(e);this._minCameraDistanceOnCamera=t.minDistanceBetweenEyeAndCenter,t.minDistanceBetweenEyeAndCenter=5,!1===t.isOrthographic&&(this._modularCoreDisplay.set("CameraState",JSON.stringify(t)),this._modularCoreDisplay.commitCameraChanges(a.MCD_ENUM.CommitAction.CT_Immediate))}}),this._canvas&&!this._nativeBrowser&&(this._mouseRUp=!1,this._canvas.style.cursor="none",this._canvas.requestPointerLock=this._canvas.requestPointerLock||this._canvas.mozRequestPointerLock||this._canvas.webkitRequestPointerLock,"function"==typeof this._canvas.requestPointerLock&&this._canvas.requestPointerLock(),document.addEventListener("contextmenu",this.contextMenuHandler),"onpointerlockchange"in document?document.addEventListener("pointerlockchange",this.onLockChange):"onmozpointerlockchange"in document?document.addEventListener("mozpointerlockchange",this.onLockChange):"onwebkitpointerlockchange"in document&&document.addEventListener("webkitpointerlockchange",this.onLockChange)),null!==this._dynamicMeshLayerForCrossHair&&this._dynamicMeshLayerForCrossHair.setVisibility(!0),this._eventManager.onTelemetry(_.Telemetry.getTelemetryJson(a.MCD_ENUM.TelemetryEventName.FlyCommand,a.MCD_ENUM.TelemetryEventType.Feature,a.MCD_ENUM.TelemetryMessageType.Start))),e}stop(){const e=super.stop();return e&&(this.stopMoving(),this._isShiftPressed=!1,this._modularCoreDisplay.get("CameraState","").then(e=>{if(""!==e){const t=JSON.parse(e);t.minDistanceBetweenEyeAndCenter=this._minCameraDistanceOnCamera,!1===t.isOrthographic&&(this._modularCoreDisplay.set("CameraState",JSON.stringify(t)),this._modularCoreDisplay.commitCameraChanges(a.MCD_ENUM.CommitAction.CT_Immediate))}}),this._canvas&&!this._nativeBrowser&&(this._canvas.style.cursor="default",document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,"function"==typeof document.exitPointerLock&&document.exitPointerLock(),document.removeEventListener("pointerlockchange",this.onLockChange),document.removeEventListener("mozpointerlockchange",this.onLockChange),document.removeEventListener("webkitpointerlockchange",this.onLockChange),this._mouseRUp||document.removeEventListener("contextmenu",this.contextMenuHandler)),null!==this._dynamicMeshLayerForCrossHair&&this._dynamicMeshLayerForCrossHair.setVisibility(!1),this._eventManager.onTelemetry(_.Telemetry.getTelemetryJson(a.MCD_ENUM.TelemetryEventName.FlyCommand,a.MCD_ENUM.TelemetryEventType.Feature,a.MCD_ENUM.TelemetryMessageType.End))),e}set crossHairPath(e){this._crossHairPath=e;const t={};t["target-name"]=this._dynamicMeshLayerNameForCrossHair,this._modularCoreDisplay.destroy("RenderTarget",JSON.stringify(t)),this.setMeshDataForCrossHair()}setMeshDataForCrossHair(){const e=this._width/2,t=this._height/2,i=l.MathGeometry.getModelPointForScreenPoint(e-15,t+15,.5,this._width,this._height,this._matrixProjectViewInv),s=l.MathGeometry.getModelPointForScreenPoint(e+15,t+15,.5,this._width,this._height,this._matrixProjectViewInv),n=l.MathGeometry.getModelPointForScreenPoint(e+15,t-15,.5,this._width,this._height,this._matrixProjectViewInv),a=l.MathGeometry.getModelPointForScreenPoint(e-15,t-15,.5,this._width,this._height,this._matrixProjectViewInv),o={},r={};r.vertices=[n.x,n.y,0,s.x,s.y,0,i.x,i.y,0,n.x,n.y,0,i.x,i.y,0,a.x,a.y,0],r.triangleindices=[0,1,2,3,4,5];const h={name:"texture0"};h.url=this._crossHairPath,r.textures=[h],r.triangletextureids=[0,0],r.texcoords=[1,1,1,0,0,0,1,1,0,0,0,1],o.setMesh=r,o["target-composite"]=this._targetCompositeName,o["target-name"]=this._dynamicMeshLayerNameForCrossHair,this._modularCoreDisplay.set("RenderTarget",JSON.stringify(o))}onLayout(e,t){this.updateViewSize(e,t)}updateViewSize(e,t){if(this._width=e,this._height=t,null!==this._dynamicMeshLayerForCrossHair){this._dynamicMeshLayerForCrossHair.setVisibility(!0);const e=this._width/2,t=this._height/2,i=l.MathGeometry.getModelPointForScreenPoint(e-15,t+15,.5,this._width,this._height,this._matrixProjectViewInv),s=l.MathGeometry.getModelPointForScreenPoint(e+15,t+15,.5,this._width,this._height,this._matrixProjectViewInv),n=l.MathGeometry.getModelPointForScreenPoint(e+15,t-15,.5,this._width,this._height,this._matrixProjectViewInv),a=l.MathGeometry.getModelPointForScreenPoint(e-15,t-15,.5,this._width,this._height,this._matrixProjectViewInv),o={},r={offset:0};r.vertices=[n.x,n.y,0,s.x,s.y,0,i.x,i.y,0,n.x,n.y,0,i.x,i.y,0,a.x,a.y,0],r.texcoords=[1,1,1,0,0,0,1,1,0,0,0,1],o.modifyVertexRange=r,o["target-name"]=this._dynamicMeshLayerNameForCrossHair,this._modularCoreDisplay.set("RenderTarget",JSON.stringify(o)),this._dynamicMeshLayerForCrossHair.setVisibility(!!this.isActive)}}onTouchCountUpdate(e){this._eventManager.onGesture(a.MCD_ENUM.GestureEventNames.GESTURE_MOUSE_DOWN),this._flyNavigation.doContinuousFly(e.touchCount)}onManipulationUpdateEvent(e){this._eventManager.onGesture(a.MCD_ENUM.GestureEventNames.GESTURE_MOUSE_DOWN),this._flyNavigation.look(e.deltaX,e.deltaY)}onManipulationEndEvent(e){this._eventManager.onGesture(0===e.touchCount?a.MCD_ENUM.GestureEventNames.GESTURE_TOUCH_END:a.MCD_ENUM.GestureEventNames.GESTURE_MOUSE_DOWN),this._flyNavigation.doContinuousFly(e.touchCount)}onLockChange(){this._canvas&&(null!==document.pointerLockElement&&null!==document.mozPointerLockElement&&null!==document.webkitPointerLockElement||this.stop())}contextMenuHandler(){event.preventDefault(),document.removeEventListener("contextmenu",this.contextMenuHandler)}onMouseMove(e){if(void 0===e)return;if(void 0===e.movementX||void 0===e.movementY)return;this._eventManager.onGesture(a.MCD_ENUM.GestureEventNames.GESTURE_MOUSE_DOWN);let t=1;t=this._width/360,t*=this._mouseSensitivity,this._modularCoreDisplay.motionRotate(-e.movementX/t,-e.movementY/t,!1),this._modularCoreDisplay.commitCameraChanges(a.MCD_ENUM.CommitAction.CT_Immediate)}onMouseDown(e){void 0!==e&&(this._eventManager.onGesture(a.MCD_ENUM.GestureEventNames.GESTURE_MOUSE_DOWN),this._mouseButtonState|=this.getButtonValue(e.button),this._mouseButtonState===a.MCD_ENUM.EventConstants.MOUSE_LBUTTON?(this.onContinuousFlyInOut(),this._modularCoreDisplay.renderingEffects&&(this._modularCoreDisplay.renderingEffects.enableRenderingEffects=!1)):this._mouseButtonState===a.MCD_ENUM.EventConstants.MOUSE_RBUTTON&&this.onMouseRightClick())}onContinuousFlyIn(){this._flyNavigation.doContinuousFly(a.MCD_ENUM.TouchContinuousFlyConstants.FORWARD)}onContinuousFlyOut(){this._flyNavigation.doContinuousFly(a.MCD_ENUM.TouchContinuousFlyConstants.BACKWARD)}onContinuousFlyInOut(){this._isShiftPressed?this.onContinuousFlyOut():this.onContinuousFlyIn()}onMouseUp(e){void 0!==e&&(this._eventManager.onGesture(a.MCD_ENUM.GestureEventNames.GESTURE_MOUSE_UP),this._mouseButtonState=a.MCD_ENUM.EventConstants.MOUSE_NOBUTTON,this.stopMoving())}stopMoving(){this._flyNavigation.stopMoveMode(),this._modularCoreDisplay.renderingEffects&&(this._modularCoreDisplay.renderingEffects.enableRenderingEffects=!0)}onMouseRightClick(){this._eventManager.onGesture(a.MCD_ENUM.GestureEventNames.GESTURE_MOUSE_DOWN),this._mouseRUp=!0,this._mouseButtonState=a.MCD_ENUM.EventConstants.MOUSE_NOBUTTON,this.stopMoving(),this.stop()}getButtonValue(e){let t=0;switch(e){case 0:t=a.MCD_ENUM.EventConstants.MOUSE_LBUTTON;break;case 1:t=a.MCD_ENUM.EventConstants.MOUSE_MBUTTON;break;case 2:t=a.MCD_ENUM.EventConstants.MOUSE_RBUTTON;break;default:t=a.MCD_ENUM.EventConstants.MOUSE_NOBUTTON}return t}onMouseWheel(e){this._eventManager.onGesture(a.MCD_ENUM.GestureEventNames.GESTURE_MOUSE_DOWN),this._modularCoreDisplay.motionMove(0,0,e.wheelDelta/120,this._width/2,this._height/2),this._modularCoreDisplay.commitCameraChanges(a.MCD_ENUM.CommitAction.CT_Immediate)}onSurfaceLocate(e,t=!0){return s(this,void 0,void 0,(function*(){if(this._modularCoreDisplay&&""!==e){let i=e;"string"==typeof i&&(i=JSON.parse(i));const s=i.hits;try{s[0].distance>0&&this._modularCoreDisplay.get("CameraState","").then(e=>{if(""!==e){const t=JSON.parse(e);t.distance=s[0].distance,t.minDistanceBetweenEyeAndCenter=5,!1===t.isOrthographic&&(this._modularCoreDisplay.set("CameraState",JSON.stringify(t)),this._modularCoreDisplay.commitCameraChanges(a.MCD_ENUM.CommitAction.CT_Immediate)),this._modularCoreDisplay.motionMove(0,0,this._zoomDelta,-1,-1),this._modularCoreDisplay.commitCameraChanges(a.MCD_ENUM.CommitAction.CT_Immediate)}})}catch(t){this._modularCoreDisplay.motionMove(0,0,this._zoomDelta,-1,-1),this._modularCoreDisplay.commitCameraChanges(a.MCD_ENUM.CommitAction.CT_Immediate)}}}))}}},aZWK:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i("v99T"),a=i("2T81"),o=i("Khlq"),r=i("B45s"),l=i("DCEI"),h=i("L6aT");t.ClipPlanes=class extends n.ClipPlanesBase{constructor(e,t){if(super(),this._mcd=null,this._glmath=null,this._dynamicMeshLayerForPlanes=null,this._dynamicMeshLayerForEdges=null,this._dynamicMeshLayerNameForPlanes="ClipPlanesInDynamicMeshLayer",this._dynamicMeshLayerNameForEdges="ClipEdgesInDynamicMeshLayer",this._overlayDisplayClippingPlane=!1,this._selectionIndex=o.MCD_ENUM.ClippingPlaneSelection.None,this._planeColorIndex=0,this._edgeColorIndex=0,this._whiteEdgeColorIndex=0,this._edgeHighliteColorIndex=0,this._enableDisplayModelClippingPlanes=!1,this._startOn3PlanesClipping=!0,this._enableModelClipPlanes=[],this._modelClipPlanesPos=[],this._modelClipPlanesDir=[],this._modelClipPlanesDefaultPos=[],this._modelClipPlanesDefaultDir=[],this._clipPlanesVertices=[],this._clipPlanesDefaultVertices=[],this._enableModelClipPlanesDefault=[],this._rotationCenter=new a.Vec3(0,0,0),this._rotationXAxis=new a.Vec3(0,0,0),this._rotationYAxis=new a.Vec3(0,0,0),this._rotationZAxis=new a.Vec3(0,0,0),this._objectLength=0,this._objectWidth=0,this._objectHeight=0,this._inverseClipping=!1,this._clipPlanesCount=3,this._movementScale=.2,this._distanceTolerance=.2,this._oldPosWorld=new a.Vec3(0,0,0),this._newPosWorld=new a.Vec3(0,0,0),this._eyePos=new a.Vec3(0,0,0),this._centerPos=new a.Vec3(0,0,0),this._up=new a.Vec3(0,0,0),this._isManipulationReady=!1,this._maxModelRange=new a.Vec3(0,0,0),this._minModelRange=new a.Vec3(0,0,0),this._currentVertexIndex=0,this._viewFromBottom=!1,this._clippingType=o.MCD_ENUM.ClippingType.MODEL,this._clippingTypeDefault=o.MCD_ENUM.ClippingType.MODEL,this._manipulationType=o.MCD_ENUM.ClippingManipulationType.MOVEMENT,this._matrixDit2Uor=new a.Mat3(1,0,0,0,1,0,0,0,1),this._oldPos=new h.VisPoint,this._planeTransparency=.1,this._edgeTransparency=.98,this._highliteEdgeTransparency=.98,this._aspectRatio=1,this._colorTable=[],this._vertices=[],this._colorIndices=[],this._triangleIndices=[],this._edgeIndices=[],this._pointIndices=[],this._edgeWidth=4,this._mcd=e,this._glmath=new a.GlMath,!this._mcd)throw new Error("The MCD provided was NULL.");this._aspectRatio=Math.abs(t)!==Number.EPSILON?t:1}initializeClipPlanes(e){return s(this,void 0,void 0,(function*(){if(this._clipPlanesVertices=[],this._modelClipPlanesDir=[],this._modelClipPlanesPos=[],this._clipPlanesDefaultVertices=[],this._modelClipPlanesDefaultDir=[],this._modelClipPlanesDefaultPos=[],e){this._startOn3PlanesClipping=!1;const t=new a.Vec3(e.minx,e.miny,e.minz),i=new a.Vec3(e.maxx,e.maxy,e.maxz);this.initObjectClippingPlanes(t,i)}else{this._startOn3PlanesClipping=!0;const e=new a.Vec3(0,0,0),t=30,i=30,s=30,n=yield this.getCenterAndSizeOfView(e,t,i,s);this.initClippingPlanes(n.pt,n.length,n.width,n.height)}}))}set modelRangeMin(e){this._minModelRange.x=e.x,this._minModelRange.y=e.y,this._minModelRange.z=e.z}get modelRangeMin(){return this._minModelRange}set modelRangeMax(e){this._maxModelRange.x=e.x,this._maxModelRange.y=e.y,this._maxModelRange.z=e.z}get modelRangeMax(){return this._maxModelRange}get selectionPlaneDir(){let e=new a.Vec3(0,0,0);return this.selection>=o.MCD_ENUM.ClippingPlaneSelection.Plane0&&this.selection<=o.MCD_ENUM.ClippingPlaneSelection.Plane5&&(e=this._modelClipPlanesDir[this.selection]),e}get aspectRatio(){return this._aspectRatio}set aspectRatio(e){this._aspectRatio=e}get inverseClipping(){return this._inverseClipping}set inverseClipping(e){this._inverseClipping=e}get clipPlanesNameInDynamicMeshLayer(){return this._dynamicMeshLayerNameForPlanes}get clipEdgesNameInDynamicMeshLayer(){return this._dynamicMeshLayerNameForEdges}get planeTransparency(){return this._planeTransparency}set planeTransparency(e){this._planeTransparency=e}get edgeTransparency(){return this._edgeTransparency}set edgeTransparency(e){this._edgeTransparency=e}get highliteEdgeTransparency(){return this._highliteEdgeTransparency}set highliteEdgeTransparency(e){this._highliteEdgeTransparency=e}get manipulationType(){return this._manipulationType}set manipulationType(e){this._manipulationType=e}get enableDisplayModelClippingPlanes(){return this._enableDisplayModelClippingPlanes}set enableDisplayModelClippingPlanes(e){this._enableDisplayModelClippingPlanes=e}get colorTable(){return this._colorTable}get vertices(){return this._vertices}get selection(){return this._selectionIndex}set selection(e){this._selectionIndex=e}get colorIndices(){return this._colorIndices}get triangleIndices(){return this._triangleIndices}get edgeIndices(){return this._edgeIndices}get pointIndices(){return this._pointIndices}get startOn3PlanesClipping(){return this._startOn3PlanesClipping}set startOn3PlanesClipping(e){this._startOn3PlanesClipping=e}get clipVolumeRangeMax(){return this.startOn3PlanesClipping?this._clipPlanesVertices[6]:this.getClipVolumeRange()[1]}set clipVolumeRangeMax(e){this._clipPlanesVertices[2].x=e.x,this._clipPlanesVertices[3].x=e.x,this._clipPlanesVertices[6].x=e.x,this._clipPlanesVertices[7].x=e.x,this._clipPlanesVertices[4].y=e.y,this._clipPlanesVertices[5].y=e.y,this._clipPlanesVertices[6].y=e.y,this._clipPlanesVertices[7].y=e.y,this._clipPlanesVertices[1].z=e.z,this._clipPlanesVertices[2].z=e.z,this._clipPlanesVertices[5].z=e.z,this._clipPlanesVertices[6].z=e.z,this._modelClipPlanesPos[3]=this._clipPlanesVertices[6],this._modelClipPlanesPos[4]=this._clipPlanesVertices[6],this._modelClipPlanesPos[5]=this._clipPlanesVertices[6]}get clipVolumeRangeMin(){return this._startOn3PlanesClipping?this._clipPlanesVertices[0]:this.getClipVolumeRange()[0]}set clipVolumeRangeMin(e){this._clipPlanesVertices[0].x=e.x,this._clipPlanesVertices[1].x=e.x,this._clipPlanesVertices[4].x=e.x,this._clipPlanesVertices[5].x=e.x,this._clipPlanesVertices[0].y=e.y,this._clipPlanesVertices[1].y=e.y,this._clipPlanesVertices[2].y=e.y,this._clipPlanesVertices[3].y=e.y,this._clipPlanesVertices[0].z=e.z,this._clipPlanesVertices[3].z=e.z,this._clipPlanesVertices[4].z=e.z,this._clipPlanesVertices[7].z=e.z,this._modelClipPlanesPos[0]=this._clipPlanesVertices[0],this._modelClipPlanesPos[1]=this._clipPlanesVertices[0],this._modelClipPlanesPos[2]=this._clipPlanesVertices[0]}get clipPlanesVertices(){return this._clipPlanesVertices}get modelClipPlanesDir(){return this._modelClipPlanesDir}get modelClipPlanesPos(){return this._modelClipPlanesPos}isAnyPlaneEnabled(){let e=!1;for(let t=0;t<o.MCD_ENUM.EventConstants.MAX_CLIP_PLANES;t++)if(this._enableModelClipPlanes[t]){e=!0;break}return e}getCenterAndSizeOfView(e,t,i,n){return s(this,void 0,void 0,(function*(){const s=yield this._mcd.get("CameraPosition",""),a=JSON.parse(s);if(""!==s&&null!==a.CameraPosition&&null!==a.CameraPosition.eye.x&&null!==a.CameraPosition.eye.y&&null!==a.CameraPosition.eye.z&&null!==a.CameraPosition.up.x&&null!==a.CameraPosition.up.y&&null!==a.CameraPosition.up.z&&null!==a.CameraPosition.center.x&&null!==a.CameraPosition.center.y&&null!==a.CameraPosition.center.z&&null!==a.CameraPosition["clip-far"]&&null!==a.CameraPosition["clip-near"]&&null!==a.CameraPosition.perspective){e.x=a.CameraPosition.center.x,e.y=a.CameraPosition.center.y,e.z=a.CameraPosition.center.z,this._centerPos=e,this._eyePos.x=a.CameraPosition.eye.x,this._eyePos.y=a.CameraPosition.eye.y,this._eyePos.z=a.CameraPosition.eye.z,this._viewFromBottom=this._eyePos.z<this._centerPos.z,this._up.x=a.CameraPosition.up.x,this._up.y=a.CameraPosition.up.y,this._up.z=a.CameraPosition.up.z;const s=Math.tan(a.CameraPosition.perspective/2*Math.PI/180),o=this._windowHeight/(2*s),r=l.MathGeometry.getDistancePtToPt(this._eyePos,this._centerPos)/o;i=(n=this._windowHeight/3*r)*this._aspectRatio;let h=(this._maxModelRange.x-this._minModelRange.x)/2;const c=(this._maxModelRange.y-this._minModelRange.y)/2,_=this._maxModelRange.z-this._minModelRange.z;h=h<c?c:h,n=n>_?_:n,t=i=i>h?h:i}return{pt:e,length:t,width:i,height:n}}))}setModelRange(e,t){super.setModelRange(e,t),this._minModelRange=e,this._maxModelRange=t}resetThreePlaneClipPlanes(){this._startOn3PlanesClipping=!0,this.enableAllPlanes(),this._clipPlanesVertices=[],this._modelClipPlanesDir=[],this._modelClipPlanesPos=[];for(let e=0;e<this._clipPlanesDefaultVertices.length;e++)this._clipPlanesVertices.push(this._clipPlanesDefaultVertices[e]);for(let e=0;e<this._modelClipPlanesDefaultDir.length;e++)this._modelClipPlanesDir.push(this._modelClipPlanesDefaultDir[e]);for(let e=0;e<this._modelClipPlanesDefaultPos.length;e++)this._modelClipPlanesPos.push(this._modelClipPlanesDefaultPos[e])}initClippingPlanes(e,t,i,s){const n=this._glmath.normalize(this._glmath.sub(this._eyePos,this._centerPos));let r=new a.Vec3(0,0,0);r=this._glmath.normalize(this._glmath.cross(this._up,n));const l=new a.Vec3(1,0,0),h=new a.Vec3(0,1,0),c=new a.Vec3(0,0,1),_=180*Math.acos(this._glmath.dot(r,l))/Math.PI,d=180*Math.acos(this._glmath.dot(r,h))/Math.PI,m=180*Math.acos(this._glmath.dot(n,c))/Math.PI;t=_<90||Math.abs(_-90)<Number.EPSILON?-t:t,i=d<90||Math.abs(d-90)<Number.EPSILON?i:-i,s=m<90||Math.abs(m-90)<Number.EPSILON?s:-s,this._clipPlanesVertices[0]=new a.Vec3(e.x,e.y,e.z),this._clipPlanesVertices[1]=new a.Vec3(e.x,e.y,e.z+s),this._clipPlanesVertices[2]=new a.Vec3(e.x+i,e.y,e.z+s),this._clipPlanesVertices[3]=new a.Vec3(e.x+i,e.y,e.z),this._clipPlanesVertices[4]=new a.Vec3(e.x,e.y+t,e.z),this._clipPlanesVertices[5]=new a.Vec3(e.x,e.y+t,e.z+s),this._clipPlanesVertices[6]=new a.Vec3(e.x+i,e.y+t,e.z+s),this._clipPlanesVertices[7]=new a.Vec3(e.x+i,e.y+t,e.z);let u=this._glmath.sub(this._clipPlanesVertices[4],this._clipPlanesVertices[0]);u=this._glmath.normalize(u),u=this._glmath.mul(u,-1),this.initClipPlane(0,e,u),this._enableModelClipPlanes[0]=!0;let p=this._glmath.sub(this._clipPlanesVertices[3],this._clipPlanesVertices[0]);p=this._glmath.normalize(p),p=this._glmath.mul(p,-1),this.initClipPlane(1,e,p),this._enableModelClipPlanes[1]=!0;let g=this._glmath.sub(this._clipPlanesVertices[1],this._clipPlanesVertices[0]);g=this._glmath.normalize(g),g=this._glmath.mul(g,-1),this.initClipPlane(2,e,g),this._enableModelClipPlanes[2]=!0,this._enableModelClipPlanes[3]=!1,this._enableModelClipPlanes[4]=!1,this._enableModelClipPlanes[5]=!1,this._clippingType=o.MCD_ENUM.ClippingType.MODEL,this.resetColors(),this._selectionIndex=o.MCD_ENUM.ClippingPlaneSelection.None,this._enableDisplayModelClippingPlanes=!1,this.deleteDynamicMeshLayer(),this._clipPlanesCount=3;for(let a=0;a<this._clipPlanesVertices.length;a++)this._clipPlanesDefaultVertices.push(this._clipPlanesVertices[a])}initObjectClippingPlanes(e,t){const i=new a.Vec3(e.x,e.y,e.z),s=t.x-e.x,n=t.y-e.y,r=t.z-e.z;this._objectWidth=2*s,this._objectLength=2*n,this._objectHeight=2*r,this._clipPlanesVertices[0]=new a.Vec3(i.x,i.y,i.z),this._clipPlanesVertices[1]=new a.Vec3(i.x,i.y,i.z+r),this._clipPlanesVertices[2]=new a.Vec3(i.x+s,i.y,i.z+r),this._clipPlanesVertices[3]=new a.Vec3(i.x+s,i.y,i.z),this._clipPlanesVertices[4]=new a.Vec3(i.x,i.y+n,i.z),this._clipPlanesVertices[5]=new a.Vec3(i.x,i.y+n,i.z+r),this._clipPlanesVertices[6]=new a.Vec3(i.x+s,i.y+n,i.z+r),this._clipPlanesVertices[7]=new a.Vec3(i.x+s,i.y+n,i.z);let l=this._glmath.sub(this._clipPlanesVertices[4],this._clipPlanesVertices[0]);l=this._glmath.normalize(l),l=this._glmath.mul(l,-1),this.initClipPlane(0,i,l),this._enableModelClipPlanes[0]=!0;let h=this._glmath.sub(this._clipPlanesVertices[3],this._clipPlanesVertices[0]);h=this._glmath.normalize(h),h=this._glmath.mul(h,-1),this.initClipPlane(1,i,h),this._enableModelClipPlanes[1]=!0;let c=this._glmath.sub(this._clipPlanesVertices[1],this._clipPlanesVertices[0]);c=this._glmath.normalize(c),c=this._glmath.mul(c,-1),this.initClipPlane(2,i,c),this._enableModelClipPlanes[2]=!0,l=this._glmath.mul(l,-1),this.initClipPlane(3,this._clipPlanesVertices[6],l),this._enableModelClipPlanes[3]=!0,h=this._glmath.mul(h,-1),this.initClipPlane(4,this._clipPlanesVertices[6],h),this._enableModelClipPlanes[4]=!0,c=this._glmath.mul(c,-1),this.initClipPlane(5,this._clipPlanesVertices[6],c),this._enableModelClipPlanes[5]=!0,this._clippingType=o.MCD_ENUM.ClippingType.OBJECT,this.resetColors(),this._selectionIndex=o.MCD_ENUM.ClippingPlaneSelection.None,this._enableDisplayModelClippingPlanes=!1,this.deleteDynamicMeshLayer(),this._clipPlanesCount=6}getClipPlanes(){let e="",t="";const i=[];for(let s=0;s<this._clipPlanesCount;s++){let e="",t="",n="";t='{ "x": '+this._modelClipPlanesPos[s].x+', "y": '+this._modelClipPlanesPos[s].y+', "z": '+this._modelClipPlanesPos[s].z+"}",n=this._enableModelClipPlanes[s]&&this._enableDisplayModelClippingPlanes?'{ "x": '+this._modelClipPlanesDir[s].x+', "y": '+this._modelClipPlanesDir[s].y+', "z": '+this._modelClipPlanesDir[s].z+"}":'{ "x": 0, "y": 0, "z": 0 }',e='{ "position": '+t+',"direction": '+n+"}",i.push(JSON.parse(e))}return t='{"clipplane-array" : '+JSON.stringify(i)+',"inverted" : '+this._inverseClipping+"}",e='{"ClipPlanes" : '+t+"}",e}getClipVolumeRange(){const e=new a.Vec3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t=new a.Vec3(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),i=new a.Vec3(e.x,e.y,e.z),s=new a.Vec3(t.x,t.y,t.z);for(let n=0;n<8;n++)i.x>this._clipPlanesVertices[n].x&&(i.x=this._clipPlanesVertices[n].x),s.x<this._clipPlanesVertices[n].x&&(s.x=this._clipPlanesVertices[n].x),i.y>this._clipPlanesVertices[n].y&&(i.y=this._clipPlanesVertices[n].y),s.y<this._clipPlanesVertices[n].y&&(s.y=this._clipPlanesVertices[n].y),i.z>this._clipPlanesVertices[n].z&&(i.z=this._clipPlanesVertices[n].z),s.z<this._clipPlanesVertices[n].z&&(s.z=this._clipPlanesVertices[n].z);return e.x=Math.min(i.x,this._minModelRange.x),e.y=Math.min(i.y,this._minModelRange.y),e.z=Math.min(i.z,this._minModelRange.z),t.x=Math.max(s.x,this._maxModelRange.x),t.y=Math.max(s.y,this._maxModelRange.y),t.z=Math.max(s.z,this._maxModelRange.z),this._startOn3PlanesClipping?(this.getPlaneEnabled(0)&&Math.abs(this._modelClipPlanesDir[0].x)>0?this._modelClipPlanesDir[0].x>0?t.x=this._modelClipPlanesPos[0].x:e.x=this._modelClipPlanesPos[0].x:this.getPlaneEnabled(1)&&Math.abs(this._modelClipPlanesDir[1].x)>0&&(this._modelClipPlanesDir[1].x>0?t.x=this._modelClipPlanesPos[1].x:e.x=this._modelClipPlanesPos[1].x),this.getPlaneEnabled(0)&&Math.abs(this._modelClipPlanesDir[0].y)>0?this._modelClipPlanesDir[0].y>0?t.y=this._modelClipPlanesPos[0].y:e.y=this._modelClipPlanesPos[0].y:this.getPlaneEnabled(1)&&Math.abs(this._modelClipPlanesDir[1].y)>0&&(this._modelClipPlanesDir[1].y>0?t.y=this._modelClipPlanesPos[1].y:e.y=this._modelClipPlanesPos[1].y),this.getPlaneEnabled(2)&&(this._viewFromBottom?t.z=this._modelClipPlanesPos[2].z:e.z=this._modelClipPlanesPos[2].z)):(this.getPlaneEnabled(1)&&this.getPlaneEnabled(4)?(e.x=Math.min(this._modelClipPlanesPos[1].x,this._modelClipPlanesPos[4].x),t.x=Math.max(this._modelClipPlanesPos[1].x,this._modelClipPlanesPos[4].x)):this.getPlaneEnabled(1)&&!this.getPlaneEnabled(4)?this._modelClipPlanesDir[1].x>0?t.x=this._modelClipPlanesPos[1].x:e.x=this._modelClipPlanesPos[1].x:!this.getPlaneEnabled(1)&&this.getPlaneEnabled(4)?this._modelClipPlanesDir[4].x>0?t.x=this._modelClipPlanesPos[4].x:e.x=this._modelClipPlanesPos[4].x:this.getPlaneEnabled(1)||this.getPlaneEnabled(4)||(e.x=this._minModelRange.x,t.x=this._maxModelRange.x),this.getPlaneEnabled(0)&&this.getPlaneEnabled(3)?(e.y=Math.min(this._modelClipPlanesPos[0].y,this._modelClipPlanesPos[3].y),t.y=Math.max(this._modelClipPlanesPos[0].y,this._modelClipPlanesPos[3].y)):this.getPlaneEnabled(0)&&!this.getPlaneEnabled(3)?this._modelClipPlanesDir[0].y>0?t.y=this._modelClipPlanesPos[0].y:e.y=this._modelClipPlanesPos[0].y:!this.getPlaneEnabled(0)&&this.getPlaneEnabled(3)?this._modelClipPlanesDir[3].y>0?t.y=this._modelClipPlanesPos[3].y:e.y=this._modelClipPlanesPos[3].y:this.getPlaneEnabled(0)||this.getPlaneEnabled(3)||(e.y=this._minModelRange.y,t.y=this._maxModelRange.y),this.getPlaneEnabled(2)&&this.getPlaneEnabled(5)?(e.z=Math.min(this._modelClipPlanesPos[2].z,this._modelClipPlanesPos[5].z),t.z=Math.max(this._modelClipPlanesPos[2].z,this._modelClipPlanesPos[5].z)):this.getPlaneEnabled(2)&&!this.getPlaneEnabled(5)?this._modelClipPlanesDir[2].z>0?t.z=this._modelClipPlanesPos[2].z:e.z=this._modelClipPlanesPos[2].z:!this.getPlaneEnabled(2)&&this.getPlaneEnabled(5)?this._modelClipPlanesDir[5].z>0?t.z=this._modelClipPlanesPos[5].z:e.z=this._modelClipPlanesPos[5].z:this.getPlaneEnabled(2)||this.getPlaneEnabled(5)||(e.z=this._minModelRange.z,t.z=this._maxModelRange.z)),Number.EPSILON<t.x-e.x&&Number.EPSILON<t.y-e.y&&Number.EPSILON<t.z-e.z?[e,t]:[new a.Vec3(0,0,0)]}getClippingVolumeRangeInfo(){let e="";const t={},i={},s={},n={};return s.x=this._clipPlanesVertices[0].x,s.y=this._clipPlanesVertices[0].y,s.z=this._clipPlanesVertices[0].z,n.x=this._clipPlanesVertices[6].x,n.y=this._clipPlanesVertices[6].y,n.z=this._clipPlanesVertices[6].z,i.point0=s,i.point1=n,i.clipping_volume_on=this._enableDisplayModelClippingPlanes,i.start_3planes_clipping=this._startOn3PlanesClipping,t.ClipPlanes=i,e=JSON.stringify(t),e}invert(){this.enableDisplayModelClippingPlanes&&(this._inverseClipping=!this._inverseClipping,this.enableModelPlanesClipping(this.enableDisplayModelClippingPlanes)),this.display(this.enableDisplayModelClippingPlanes)}moveClipPlane(e,t,i,s,n,r){if(t<o.MCD_ENUM.ClippingPlaneSelection.Plane0&&t>o.MCD_ENUM.ClippingPlaneSelection.Plane5)return[];let l=new a.Vec3(0,0,0);const h=[];switch(t){case o.MCD_ENUM.ClippingPlaneSelection.Plane0:if(l=this._glmath.normalize(this._glmath.sub(this._clipPlanesVertices[0],this._clipPlanesVertices[4])),this._enableModelClipPlanes[o.MCD_ENUM.ClippingPlaneSelection.Plane3]){const t=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[4],this._clipPlanesVertices[0],this._modelClipPlanesDir[0],this._modelClipPlanesDir[3]);this._modelClipPlanesDir[0]=t[0],this._modelClipPlanesDir[3]=t[1]}break;case o.MCD_ENUM.ClippingPlaneSelection.Plane1:if(l=this._glmath.normalize(this._glmath.sub(this._clipPlanesVertices[0],this._clipPlanesVertices[3])),this._enableModelClipPlanes[o.MCD_ENUM.ClippingPlaneSelection.Plane4]){const t=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[3],this._clipPlanesVertices[0],this._modelClipPlanesDir[1],this._modelClipPlanesDir[4]);this._modelClipPlanesDir[1]=t[0],this._modelClipPlanesDir[4]=t[1]}break;case o.MCD_ENUM.ClippingPlaneSelection.Plane2:if(l=this._glmath.normalize(this._glmath.sub(this._clipPlanesVertices[0],this._clipPlanesVertices[1])),this._enableModelClipPlanes[o.MCD_ENUM.ClippingPlaneSelection.Plane5]){const t=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[1],this._clipPlanesVertices[0],this._modelClipPlanesDir[2],this._modelClipPlanesDir[5]);this._modelClipPlanesDir[2]=t[0],this._modelClipPlanesDir[5]=t[1]}break;case o.MCD_ENUM.ClippingPlaneSelection.Plane3:if(l=this._glmath.normalize(this._glmath.sub(this._clipPlanesVertices[6],this._clipPlanesVertices[2])),this._enableModelClipPlanes[o.MCD_ENUM.ClippingPlaneSelection.Plane0]){const t=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[2],this._clipPlanesVertices[6],this._modelClipPlanesDir[3],this._modelClipPlanesDir[0]);this._modelClipPlanesDir[3]=t[0],this._modelClipPlanesDir[0]=t[1]}break;case o.MCD_ENUM.ClippingPlaneSelection.Plane4:if(l=this._glmath.normalize(this._glmath.sub(this._clipPlanesVertices[6],this._clipPlanesVertices[5])),this._enableModelClipPlanes[o.MCD_ENUM.ClippingPlaneSelection.Plane1]){const t=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[5],this._clipPlanesVertices[6],this._modelClipPlanesDir[4],this._modelClipPlanesDir[1]);this._modelClipPlanesDir[4]=t[0],this._modelClipPlanesDir[1]=t[1]}break;case o.MCD_ENUM.ClippingPlaneSelection.Plane5:if(l=this._glmath.normalize(this._glmath.sub(this._clipPlanesVertices[6],this._clipPlanesVertices[7])),this._enableModelClipPlanes[o.MCD_ENUM.ClippingPlaneSelection.Plane2]){const t=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[7],this._clipPlanesVertices[6],this._modelClipPlanesDir[5],this._modelClipPlanesDir[2]);this._modelClipPlanesDir[5]=t[0],this._modelClipPlanesDir[2]=t[1]}}const c=this._glmath.dot(e,l),_=this._glmath.mul(l,c);return i=this._glmath.add(i,_),h.push(i),s=this._glmath.add(s,_),h.push(s),n=this._glmath.add(n,_),h.push(n),r=this._glmath.add(r,_),h.push(r),h}moveClipPlanes(e){let t=[];switch(this._selectionIndex){case o.MCD_ENUM.ClippingPlaneSelection.Plane0:t=this.moveClipPlane(e,o.MCD_ENUM.ClippingPlaneSelection.Plane0,this._clipPlanesVertices[0],this._clipPlanesVertices[1],this._clipPlanesVertices[2],this._clipPlanesVertices[3]),this._clipPlanesVertices[0]=t[0],this._clipPlanesVertices[1]=t[1],this._clipPlanesVertices[2]=t[2],this._clipPlanesVertices[3]=t[3];break;case o.MCD_ENUM.ClippingPlaneSelection.Plane1:t=this.moveClipPlane(e,o.MCD_ENUM.ClippingPlaneSelection.Plane1,this._clipPlanesVertices[0],this._clipPlanesVertices[1],this._clipPlanesVertices[5],this._clipPlanesVertices[4]),this._clipPlanesVertices[0]=t[0],this._clipPlanesVertices[1]=t[1],this._clipPlanesVertices[5]=t[2],this._clipPlanesVertices[4]=t[3];break;case o.MCD_ENUM.ClippingPlaneSelection.Plane2:t=this.moveClipPlane(e,o.MCD_ENUM.ClippingPlaneSelection.Plane2,this._clipPlanesVertices[0],this._clipPlanesVertices[3],this._clipPlanesVertices[7],this._clipPlanesVertices[4]),this._clipPlanesVertices[0]=t[0],this._clipPlanesVertices[3]=t[1],this._clipPlanesVertices[7]=t[2],this._clipPlanesVertices[4]=t[3];break;case o.MCD_ENUM.ClippingPlaneSelection.Plane3:t=this.moveClipPlane(e,o.MCD_ENUM.ClippingPlaneSelection.Plane3,this._clipPlanesVertices[4],this._clipPlanesVertices[5],this._clipPlanesVertices[6],this._clipPlanesVertices[7]),this._clipPlanesVertices[4]=t[0],this._clipPlanesVertices[5]=t[1],this._clipPlanesVertices[6]=t[2],this._clipPlanesVertices[7]=t[3];break;case o.MCD_ENUM.ClippingPlaneSelection.Plane4:t=this.moveClipPlane(e,o.MCD_ENUM.ClippingPlaneSelection.Plane4,this._clipPlanesVertices[2],this._clipPlanesVertices[3],this._clipPlanesVertices[7],this._clipPlanesVertices[6]),this._clipPlanesVertices[2]=t[0],this._clipPlanesVertices[3]=t[1],this._clipPlanesVertices[7]=t[2],this._clipPlanesVertices[6]=t[3];break;case o.MCD_ENUM.ClippingPlaneSelection.Plane5:t=this.moveClipPlane(e,o.MCD_ENUM.ClippingPlaneSelection.Plane5,this._clipPlanesVertices[1],this._clipPlanesVertices[2],this._clipPlanesVertices[6],this._clipPlanesVertices[5]),this._clipPlanesVertices[1]=t[0],this._clipPlanesVertices[2]=t[1],this._clipPlanesVertices[6]=t[2],this._clipPlanesVertices[5]=t[3];break;case o.MCD_ENUM.ClippingPlaneSelection.Edge0:case o.MCD_ENUM.ClippingPlaneSelection.Edge1:case o.MCD_ENUM.ClippingPlaneSelection.Edge2:case o.MCD_ENUM.ClippingPlaneSelection.Edge3:case o.MCD_ENUM.ClippingPlaneSelection.Edge4:case o.MCD_ENUM.ClippingPlaneSelection.Edge5:case o.MCD_ENUM.ClippingPlaneSelection.Edge6:case o.MCD_ENUM.ClippingPlaneSelection.Edge7:case o.MCD_ENUM.ClippingPlaneSelection.Edge8:case o.MCD_ENUM.ClippingPlaneSelection.Edge9:case o.MCD_ENUM.ClippingPlaneSelection.Edge10:case o.MCD_ENUM.ClippingPlaneSelection.Edge11:case o.MCD_ENUM.ClippingPlaneSelection.Corner0:case o.MCD_ENUM.ClippingPlaneSelection.Corner1:case o.MCD_ENUM.ClippingPlaneSelection.Corner2:case o.MCD_ENUM.ClippingPlaneSelection.Corner3:case o.MCD_ENUM.ClippingPlaneSelection.Corner4:case o.MCD_ENUM.ClippingPlaneSelection.Corner5:case o.MCD_ENUM.ClippingPlaneSelection.Corner6:case o.MCD_ENUM.ClippingPlaneSelection.Corner7:this.moveCorners(e)}this._modelClipPlanesPos[0]=this._clipPlanesVertices[0],this._modelClipPlanesPos[1]=this._clipPlanesVertices[0],this._modelClipPlanesPos[2]=this._clipPlanesVertices[0],this._modelClipPlanesPos[3]=this._clipPlanesVertices[6],o.MCD_ENUM.EventConstants.MAX_CLIP_PLANES>4&&(this._modelClipPlanesPos[4]=this._clipPlanesVertices[6],this._modelClipPlanesPos[5]=this._clipPlanesVertices[6])}moveCorners(e){const t=this._glmath.normalize(this._glmath.sub(this._clipPlanesVertices[3],this._clipPlanesVertices[0])),i=this._glmath.normalize(this._glmath.sub(this._clipPlanesVertices[4],this._clipPlanesVertices[0])),s=this._glmath.normalize(this._glmath.sub(this._clipPlanesVertices[1],this._clipPlanesVertices[0])),n=this._glmath.dot(e,t),a=this._glmath.dot(e,i),r=this._glmath.dot(e,s),l=this._glmath.mul(t,n),h=this._glmath.mul(i,a),c=this._glmath.mul(s,r),_=this._glmath.add(l,h),d=this._glmath.add(l,c),m=this._glmath.add(h,c),u=this._glmath.add(this._glmath.add(l,h),c);let p=[];switch(this._selectionIndex){case o.MCD_ENUM.ClippingPlaneSelection.Edge0:case o.MCD_ENUM.ClippingPlaneSelection.Edge1:case o.MCD_ENUM.ClippingPlaneSelection.Edge2:case o.MCD_ENUM.ClippingPlaneSelection.Edge3:case o.MCD_ENUM.ClippingPlaneSelection.Edge4:case o.MCD_ENUM.ClippingPlaneSelection.Edge5:case o.MCD_ENUM.ClippingPlaneSelection.Edge6:case o.MCD_ENUM.ClippingPlaneSelection.Edge7:case o.MCD_ENUM.ClippingPlaneSelection.Edge8:case o.MCD_ENUM.ClippingPlaneSelection.Edge9:case o.MCD_ENUM.ClippingPlaneSelection.Edge10:case o.MCD_ENUM.ClippingPlaneSelection.Edge11:this._clipPlanesVertices[0]=this._glmath.add(this._clipPlanesVertices[0],u),this._clipPlanesVertices[1]=this._glmath.add(this._clipPlanesVertices[1],u),this._clipPlanesVertices[2]=this._glmath.add(this._clipPlanesVertices[2],u),this._clipPlanesVertices[3]=this._glmath.add(this._clipPlanesVertices[3],u),this._clipPlanesVertices[4]=this._glmath.add(this._clipPlanesVertices[4],u),this._clipPlanesVertices[5]=this._glmath.add(this._clipPlanesVertices[5],u),this._clipPlanesVertices[6]=this._glmath.add(this._clipPlanesVertices[6],u),this._clipPlanesVertices[7]=this._glmath.add(this._clipPlanesVertices[7],u);break;case o.MCD_ENUM.ClippingPlaneSelection.Corner0:this._enableModelClipPlanes[4]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[6],this._clipPlanesVertices[5],this._modelClipPlanesDir[1],this._modelClipPlanesDir[4]),this._modelClipPlanesDir[1]=p[0],this._modelClipPlanesDir[4]=p[1]),this._clipPlanesVertices[5]=this._glmath.add(this._clipPlanesVertices[5],l),this._enableModelClipPlanes[3]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[6],this._clipPlanesVertices[2],this._modelClipPlanesDir[0],this._modelClipPlanesDir[3]),this._modelClipPlanesDir[0]=p[0],this._modelClipPlanesDir[3]=p[1]),this._clipPlanesVertices[2]=this._glmath.add(this._clipPlanesVertices[2],h),this._enableModelClipPlanes[5]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[6],this._clipPlanesVertices[7],this._modelClipPlanesDir[2],this._modelClipPlanesDir[5]),this._modelClipPlanesDir[2]=p[0],this._modelClipPlanesDir[5]=p[1]),this._clipPlanesVertices[7]=this._glmath.add(this._clipPlanesVertices[7],c),this._clipPlanesVertices[0]=this._glmath.add(this._clipPlanesVertices[0],u),this._clipPlanesVertices[1]=this._glmath.add(this._clipPlanesVertices[1],_),this._clipPlanesVertices[4]=this._glmath.add(this._clipPlanesVertices[4],d),this._clipPlanesVertices[3]=this._glmath.add(this._clipPlanesVertices[3],m);break;case o.MCD_ENUM.ClippingPlaneSelection.Corner1:this._enableModelClipPlanes[4]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[7],this._clipPlanesVertices[4],this._modelClipPlanesDir[1],this._modelClipPlanesDir[4]),this._modelClipPlanesDir[1]=p[0],this._modelClipPlanesDir[4]=p[1]),this._clipPlanesVertices[4]=this._glmath.add(this._clipPlanesVertices[4],l),this._enableModelClipPlanes[3]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[7],this._clipPlanesVertices[3],this._modelClipPlanesDir[0],this._modelClipPlanesDir[3]),this._modelClipPlanesDir[0]=p[0],this._modelClipPlanesDir[3]=p[1]),this._clipPlanesVertices[3]=this._glmath.add(this._clipPlanesVertices[3],h),this._enableModelClipPlanes[5]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[7],this._clipPlanesVertices[6],this._modelClipPlanesDir[2],this._modelClipPlanesDir[5]),this._modelClipPlanesDir[2]=p[0],this._modelClipPlanesDir[5]=p[1]),this._clipPlanesVertices[6]=this._glmath.add(this._clipPlanesVertices[6],c),this._clipPlanesVertices[1]=this._glmath.add(this._clipPlanesVertices[1],u),this._clipPlanesVertices[0]=this._glmath.add(this._clipPlanesVertices[0],_),this._clipPlanesVertices[5]=this._glmath.add(this._clipPlanesVertices[5],d),this._clipPlanesVertices[2]=this._glmath.add(this._clipPlanesVertices[2],m);break;case o.MCD_ENUM.ClippingPlaneSelection.Corner2:this._enableModelClipPlanes[1]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[4],this._clipPlanesVertices[7],this._modelClipPlanesDir[1],this._modelClipPlanesDir[4]),this._modelClipPlanesDir[1]=p[0],this._modelClipPlanesDir[4]=p[1]),this._clipPlanesVertices[7]=this._glmath.add(this._clipPlanesVertices[7],l),this._enableModelClipPlanes[3]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[4],this._clipPlanesVertices[0],this._modelClipPlanesDir[0],this._modelClipPlanesDir[3]),this._modelClipPlanesDir[0]=p[0],this._modelClipPlanesDir[3]=p[1]),this._clipPlanesVertices[0]=this._glmath.add(this._clipPlanesVertices[0],h),this._enableModelClipPlanes[5]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[4],this._clipPlanesVertices[5],this._modelClipPlanesDir[2],this._modelClipPlanesDir[5]),this._modelClipPlanesDir[2]=p[0],this._modelClipPlanesDir[5]=p[1]),this._clipPlanesVertices[5]=this._glmath.add(this._clipPlanesVertices[5],c),this._clipPlanesVertices[2]=this._glmath.add(this._clipPlanesVertices[2],u),this._clipPlanesVertices[3]=this._glmath.add(this._clipPlanesVertices[3],_),this._clipPlanesVertices[6]=this._glmath.add(this._clipPlanesVertices[6],d),this._clipPlanesVertices[1]=this._glmath.add(this._clipPlanesVertices[1],m);break;case o.MCD_ENUM.ClippingPlaneSelection.Corner3:this._enableModelClipPlanes[1]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[5],this._clipPlanesVertices[6],this._modelClipPlanesDir[1],this._modelClipPlanesDir[4]),this._modelClipPlanesDir[1]=p[0],this._modelClipPlanesDir[4]=p[1]),this._clipPlanesVertices[6]=this._glmath.add(this._clipPlanesVertices[6],l),this._enableModelClipPlanes[3]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[5],this._clipPlanesVertices[1],this._modelClipPlanesDir[0],this._modelClipPlanesDir[3]),this._modelClipPlanesDir[0]=p[0],this._modelClipPlanesDir[3]=p[1]),this._clipPlanesVertices[1]=this._glmath.add(this._clipPlanesVertices[1],h),this._enableModelClipPlanes[5]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[5],this._clipPlanesVertices[4],this._modelClipPlanesDir[2],this._modelClipPlanesDir[5]),this._modelClipPlanesDir[2]=p[0],this._modelClipPlanesDir[5]=p[1]),this._clipPlanesVertices[4]=this._glmath.add(this._clipPlanesVertices[4],c),this._clipPlanesVertices[3]=this._glmath.add(this._clipPlanesVertices[3],u),this._clipPlanesVertices[2]=this._glmath.add(this._clipPlanesVertices[2],_),this._clipPlanesVertices[7]=this._glmath.add(this._clipPlanesVertices[7],d),this._clipPlanesVertices[0]=this._glmath.add(this._clipPlanesVertices[0],m);break;case o.MCD_ENUM.ClippingPlaneSelection.Corner4:this._enableModelClipPlanes[4]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[2],this._clipPlanesVertices[1],this._modelClipPlanesDir[1],this._modelClipPlanesDir[4]),this._modelClipPlanesDir[1]=p[0],this._modelClipPlanesDir[4]=p[1]),this._clipPlanesVertices[1]=this._glmath.add(this._clipPlanesVertices[1],l),this._enableModelClipPlanes[0]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[2],this._clipPlanesVertices[6],this._modelClipPlanesDir[0],this._modelClipPlanesDir[3]),this._modelClipPlanesDir[0]=p[0],this._modelClipPlanesDir[3]=p[1]),this._clipPlanesVertices[6]=this._glmath.add(this._clipPlanesVertices[6],h),this._enableModelClipPlanes[5]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[2],this._clipPlanesVertices[3],this._modelClipPlanesDir[2],this._modelClipPlanesDir[5]),this._modelClipPlanesDir[2]=p[0],this._modelClipPlanesDir[5]=p[1]),this._clipPlanesVertices[3]=this._glmath.add(this._clipPlanesVertices[3],c),this._clipPlanesVertices[4]=this._glmath.add(this._clipPlanesVertices[4],u),this._clipPlanesVertices[5]=this._glmath.add(this._clipPlanesVertices[5],_),this._clipPlanesVertices[0]=this._glmath.add(this._clipPlanesVertices[0],d),this._clipPlanesVertices[7]=this._glmath.add(this._clipPlanesVertices[7],m);break;case o.MCD_ENUM.ClippingPlaneSelection.Corner5:this._enableModelClipPlanes[4]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[3],this._clipPlanesVertices[0],this._modelClipPlanesDir[1],this._modelClipPlanesDir[4]),this._modelClipPlanesDir[1]=p[0],this._modelClipPlanesDir[4]=p[1]),this._clipPlanesVertices[0]=this._glmath.add(this._clipPlanesVertices[0],l),this._enableModelClipPlanes[0]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[3],this._clipPlanesVertices[7],this._modelClipPlanesDir[0],this._modelClipPlanesDir[3]),this._modelClipPlanesDir[0]=p[0],this._modelClipPlanesDir[3]=p[1]),this._clipPlanesVertices[7]=this._glmath.add(this._clipPlanesVertices[7],h),this._enableModelClipPlanes[2]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[3],this._clipPlanesVertices[2],this._modelClipPlanesDir[2],this._modelClipPlanesDir[5]),this._modelClipPlanesDir[2]=p[0],this._modelClipPlanesDir[5]=p[1]),this._clipPlanesVertices[2]=this._glmath.add(this._clipPlanesVertices[2],c),this._clipPlanesVertices[5]=this._glmath.add(this._clipPlanesVertices[5],u),this._clipPlanesVertices[4]=this._glmath.add(this._clipPlanesVertices[4],_),this._clipPlanesVertices[1]=this._glmath.add(this._clipPlanesVertices[1],d),this._clipPlanesVertices[6]=this._glmath.add(this._clipPlanesVertices[6],m);break;case o.MCD_ENUM.ClippingPlaneSelection.Corner6:this._enableModelClipPlanes[4]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[3],this._clipPlanesVertices[1],this._modelClipPlanesDir[1],this._modelClipPlanesDir[4]),this._modelClipPlanesDir[1]=p[0],this._modelClipPlanesDir[4]=p[1]),this._clipPlanesVertices[3]=this._glmath.add(this._clipPlanesVertices[3],l),this._enableModelClipPlanes[0]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[0],this._clipPlanesVertices[4],this._modelClipPlanesDir[0],this._modelClipPlanesDir[3]),this._modelClipPlanesDir[0]=p[0],this._modelClipPlanesDir[3]=p[1]),this._clipPlanesVertices[4]=this._glmath.add(this._clipPlanesVertices[4],h),this._enableModelClipPlanes[2]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[0],this._clipPlanesVertices[1],this._modelClipPlanesDir[2],this._modelClipPlanesDir[5]),this._modelClipPlanesDir[2]=p[0],this._modelClipPlanesDir[5]=p[1]),this._clipPlanesVertices[1]=this._glmath.add(this._clipPlanesVertices[1],c),this._clipPlanesVertices[6]=this._glmath.add(this._clipPlanesVertices[6],u),this._clipPlanesVertices[7]=this._glmath.add(this._clipPlanesVertices[7],_),this._clipPlanesVertices[2]=this._glmath.add(this._clipPlanesVertices[2],d),this._clipPlanesVertices[5]=this._glmath.add(this._clipPlanesVertices[5],m);break;case o.MCD_ENUM.ClippingPlaneSelection.Corner7:this._enableModelClipPlanes[1]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[1],this._clipPlanesVertices[2],this._modelClipPlanesDir[1],this._modelClipPlanesDir[4]),this._modelClipPlanesDir[1]=p[0],this._modelClipPlanesDir[4]=p[1]),this._clipPlanesVertices[2]=this._glmath.add(this._clipPlanesVertices[2],l),this._enableModelClipPlanes[0]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[1],this._clipPlanesVertices[5],this._modelClipPlanesDir[0],this._modelClipPlanesDir[3]),this._modelClipPlanesDir[0]=p[0],this._modelClipPlanesDir[3]=p[1]),this._clipPlanesVertices[5]=this._glmath.add(this._clipPlanesVertices[5],h),this._enableModelClipPlanes[5]&&(p=this.flipPlanesDirWhenPlanesCrossOver(e,this._clipPlanesVertices[1],this._clipPlanesVertices[0],this._modelClipPlanesDir[2],this._modelClipPlanesDir[5]),this._modelClipPlanesDir[2]=p[0],this._modelClipPlanesDir[5]=p[1]),this._clipPlanesVertices[0]=this._glmath.add(this._clipPlanesVertices[0],c),this._clipPlanesVertices[7]=this._glmath.add(this._clipPlanesVertices[7],u),this._clipPlanesVertices[6]=this._glmath.add(this._clipPlanesVertices[6],_),this._clipPlanesVertices[3]=this._glmath.add(this._clipPlanesVertices[3],d),this._clipPlanesVertices[4]=this._glmath.add(this._clipPlanesVertices[4],m)}}flipPlanesDirWhenPlanesCrossOver(e,t,i,s,n){const a=this._glmath.normalize(this._glmath.sub(i,t)),o=this._glmath.dot(e,a),r=this._glmath.mul(a,o),h=this._glmath.add(i,r);return l.MathGeometry.ifPtIsBetweenTwoPtsOnLine(t,h,i)&&(s=this._glmath.mul(s,-1),n=this._glmath.mul(n,-1)),[s,n]}rotateClipPlanes(e,t){let i=0,s=new a.Mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);if(t){let n=new a.Vec3(0,0,0);if(Math.abs(t.x-1)<Number.EPSILON?n=this._modelClipPlanesDir[0]:Math.abs(t.y-1)<Number.EPSILON?n=this._modelClipPlanesDir[1]:Math.abs(t.z-1)<Number.EPSILON&&(n=this._modelClipPlanesDir[2]),Math.abs(n.x)<Number.EPSILON&&Math.abs(n.y)<Number.EPSILON&&Math.abs(n.z)<Number.EPSILON)return;const o=this._modelClipPlanesPos[0],r=this._glmath.add(this._modelClipPlanesPos[0],n);for(s=l.MathGeometry.computeRotateAlongLineMatrix(e,o,r),i=0;i<8;i++){let e=new a.Quat(this._clipPlanesVertices[i].x,this._clipPlanesVertices[i].y,this._clipPlanesVertices[i].z,1);e=this._glmath.multMat4Quat(s,e),this._clipPlanesVertices[i].x=e.x,this._clipPlanesVertices[i].y=e.y,this._clipPlanesVertices[i].z=e.z}for(i=0;i<3;i++){const e=new a.Vec3(0,0,0);let t=new a.Vec3(0,0,0);switch(i){case 0:t=this._glmath.sub(this._clipPlanesVertices[4],this._clipPlanesVertices[0]),t=this._glmath.normalize(t),t=this._glmath.mul(t,-1);break;case 1:t=this._glmath.sub(this._clipPlanesVertices[3],this._clipPlanesVertices[0]),t=this._glmath.normalize(t),t=this._glmath.mul(t,-1);break;case 2:t=t=this._glmath.sub(this._clipPlanesVertices[1],this._clipPlanesVertices[0]),t=this._glmath.normalize(t),t=this._glmath.mul(t,-1)}this._modelClipPlanesDir[i]=this._enableModelClipPlanes[i]?t:e,this._modelClipPlanesPos[i]=this._clipPlanesVertices[0]}}else{switch(this._selectionIndex){case o.MCD_ENUM.ClippingPlaneSelection.RotationAxisX:s=l.MathGeometry.computeRotateAlongLineMatrix(e,this._rotationCenter,this._rotationXAxis);break;case o.MCD_ENUM.ClippingPlaneSelection.RotationAxisY:s=l.MathGeometry.computeRotateAlongLineMatrix(e,this._rotationCenter,this._rotationYAxis);break;case o.MCD_ENUM.ClippingPlaneSelection.RotationAxisZ:s=l.MathGeometry.computeRotateAlongLineMatrix(e,this._rotationCenter,this._rotationZAxis)}for(i=0;i<8;i++){let e=new a.Quat(this._clipPlanesVertices[i].x,this._clipPlanesVertices[i].y,this._clipPlanesVertices[i].z,1);e=this._glmath.multMat4Quat(s,e),this._clipPlanesVertices[i].x=e.x,this._clipPlanesVertices[i].y=e.y,this._clipPlanesVertices[i].z=e.z}for(i=0;i<6;i++){const e=new a.Vec3(0,0,0);let t=new a.Vec3(0,0,0);switch(i){case 0:t=this._glmath.sub(this._clipPlanesVertices[4],this._clipPlanesVertices[0]),t=this._glmath.normalize(t),t=this._glmath.mul(t,-1);break;case 1:t=this._glmath.sub(this._clipPlanesVertices[3],this._clipPlanesVertices[0]),t=this._glmath.normalize(t),t=this._glmath.mul(t,-1);break;case 2:t=this._glmath.sub(this._clipPlanesVertices[1],this._clipPlanesVertices[0]),t=this._glmath.normalize(t),t=this._glmath.mul(t,-1);break;case 3:t=this._glmath.sub(this._clipPlanesVertices[4],this._clipPlanesVertices[0]),t=this._glmath.normalize(t);break;case 4:t=this._glmath.sub(this._clipPlanesVertices[3],this._clipPlanesVertices[0]),t=this._glmath.normalize(t);break;case 5:t=this._glmath.sub(this._clipPlanesVertices[1],this._clipPlanesVertices[0]),t=this._glmath.normalize(t)}this._modelClipPlanesDir[i]=this._enableModelClipPlanes[i]?t:e,this._modelClipPlanesPos[i]=i<3?this._clipPlanesVertices[0]:this._clipPlanesVertices[6]}}}constructDisplayData(e){let t=0;if(this._currentVertexIndex=0,this.clearDisplayData(),this._enableDisplayModelClippingPlanes=e,this._enableDisplayModelClippingPlanes){if(this.manipulationType===o.MCD_ENUM.ClippingManipulationType.MOVEMENT){for(this._selectionIndex>=o.MCD_ENUM.ClippingPlaneSelection.Corner0&&this._selectionIndex<=o.MCD_ENUM.ClippingPlaneSelection.Corner7?this.addEdgesBasedOnSelectedCorner(this._selectionIndex):this._selectionIndex>=o.MCD_ENUM.ClippingPlaneSelection.Plane0&&this._selectionIndex<=o.MCD_ENUM.ClippingPlaneSelection.Plane5?this.addEdgesBasedOnSelectedPlane(this._selectionIndex):this.addEdgesBasedOnSelectedEdges(this._selectionIndex,this._selectionIndex>=o.MCD_ENUM.ClippingPlaneSelection.Edge0&&this._selectionIndex<=o.MCD_ENUM.ClippingPlaneSelection.Edge11?this._edgeHighliteColorIndex:this._edgeColorIndex),t=0;t<o.MCD_ENUM.EventConstants.MAX_CLIP_PLANES;t++)if(this._enableModelClipPlanes[t])switch(t){case 0:this.addAPlane(this._clipPlanesVertices[0],this._clipPlanesVertices[1],this._clipPlanesVertices[2],this._clipPlanesVertices[3]);break;case 1:this.addAPlane(this._clipPlanesVertices[0],this._clipPlanesVertices[4],this._clipPlanesVertices[5],this._clipPlanesVertices[1]);break;case 2:this.addAPlane(this._clipPlanesVertices[0],this._clipPlanesVertices[3],this._clipPlanesVertices[7],this._clipPlanesVertices[4]);break;case 3:this.addAPlane(this._clipPlanesVertices[4],this._clipPlanesVertices[5],this._clipPlanesVertices[6],this._clipPlanesVertices[7]);break;case 4:this.addAPlane(this._clipPlanesVertices[2],this._clipPlanesVertices[3],this._clipPlanesVertices[7],this._clipPlanesVertices[6]);break;case 5:this.addAPlane(this._clipPlanesVertices[1],this._clipPlanesVertices[2],this._clipPlanesVertices[6],this._clipPlanesVertices[5])}}else this.manipulationType===o.MCD_ENUM.ClippingManipulationType.ROTATE&&(this.addEdgesBasedOnSelectedEdges(o.MCD_ENUM.ClippingPlaneSelection.None,this._whiteEdgeColorIndex),this.addEdgesOnFeatureLayerBasedOnRotation(this._selectionIndex));let e=!0;for(t=0;t<o.MCD_ENUM.EventConstants.MAX_CLIP_PLANES;t++)if(!0===this._enableModelClipPlanes[t]){e=!1;break}e&&(this._vertices.push(this._clipPlanesVertices[0]),this._colorIndices.push(0))}else this._vertices.push(this._clipPlanesVertices[0]),this._colorIndices.push(0)}locateClipPlane(e){return s(this,void 0,void 0,(function*(){let t=JSON.parse(e);if("string"==typeof t&&(t=JSON.parse(t)),yield this.onManipulationStart(t.x,t.y),null!==t.hits){this._oldPosWorld.x=t.hits[0].x,this._oldPosWorld.y=t.hits[0].y,this._oldPosWorld.z=t.hits[0].z,this.selection=this.selectClipPlane(this._eyePos,this._oldPosWorld);const e=new a.Vec3(0,0,0),{first:i,last:s}=this.convertScreenPtToWorldPt(this._oldPos.x,this._oldPos.y,this._oldPosWorld,e);i&&(this._oldPosWorld=s)}else this.selection=o.MCD_ENUM.ClippingPlaneSelection.None;return this._isManipulationReady=this.selection!==o.MCD_ENUM.ClippingPlaneSelection.None,this.display(this.enableDisplayModelClippingPlanes),this.selection}))}display(e){if(null===this._dynamicMeshLayerForEdges&&(this._dynamicMeshLayerForEdges=new r.DynamicMeshLayer(this._dynamicMeshLayerNameForEdges,this._mcd,this._edgeWidth,this._overlayDisplayClippingPlane,"",3)),null===this._dynamicMeshLayerForPlanes&&(this._dynamicMeshLayerForPlanes=new r.DynamicMeshLayer(this._dynamicMeshLayerNameForPlanes,this._mcd,this._edgeWidth,this._overlayDisplayClippingPlane,"",3)),null!==this._dynamicMeshLayerForPlanes&&null!==this._dynamicMeshLayerForEdges){const t=[],i=[],s=[];this.constructDisplayData(e),this._dynamicMeshLayerForEdges.reset(),this._dynamicMeshLayerForEdges.addData(this.colorTable,this.vertices,this.colorIndices,t,this.pointIndices,this.edgeIndices),this._dynamicMeshLayerForEdges.display(),this._dynamicMeshLayerForPlanes.reset(),this._dynamicMeshLayerForPlanes.addData(this.colorTable,this.vertices,this.colorIndices,this.triangleIndices,s,i),this._dynamicMeshLayerForPlanes.display()}const t=this.getClippingVolumeRangeInfo();this._mcd.set("RenderEffects",t)}enableModelPlanesClipping(e){!1!==this.isAnyPlaneEnabled()&&!1!==e||(this._inverseClipping=!1);const t=this.getClipPlanes();this._mcd.set("RenderEffects",t.toString())}enablePlane(e,t){e>=0&&e<this._clipPlanesCount&&this._enableModelClipPlanes.length>0&&this._enableModelClipPlanes[e]!==t&&(this._enableModelClipPlanes[e]=t)}enableAllPlanes(){for(let e=0;e<this._clipPlanesCount;e++)this.enablePlane(e,!0)}disableAllPlanes(){for(let e=0;e<this._clipPlanesCount;e++)this.enablePlane(e,!1)}getEnablePlaneCount(){let e=0;for(let t=0;t<o.MCD_ENUM.EventConstants.MAX_CLIP_PLANES;t++)!0===this._enableModelClipPlanes[t]&&e++;return e}getPlaneEnabled(e){return e>=0&&e<o.MCD_ENUM.EventConstants.MAX_CLIP_PLANES&&!0===this._enableModelClipPlanes[e]}initClipPlane(e,t,i){this._modelClipPlanesPos[e]=t,this._modelClipPlanesDir[e]=i,this._modelClipPlanesDefaultPos[e]=new a.Vec3(t.x,t.y,t.z),this._modelClipPlanesDefaultDir[e]=new a.Vec3(i.x,i.y,i.z)}resetColors(){const e=new a.Quat(.5,0,0,this._planeTransparency),t=new a.Quat(0,.5,0,this._planeTransparency),i=new a.Quat(0,0,.5,this._planeTransparency),s=new a.Quat(1,1,0,this._edgeTransparency),n=new a.Quat(1,0,0,this._highliteEdgeTransparency),o=new a.Quat(1,1,1,this._edgeTransparency);this._colorTable=[],this._colorTable.push(e),this._colorTable.push(t),this._colorTable.push(i),this._colorTable.push(s),this._colorTable.push(n),this._colorTable.push(o),this._planeColorIndex=0,this._edgeColorIndex=3,this._edgeHighliteColorIndex=4,this._whiteEdgeColorIndex=5}clearDisplayData(){this._vertices=[],this._colorIndices=[],this._triangleIndices=[],this._edgeIndices=[],this._pointIndices=[]}highlightPlane(e){this.selection=e,this.display(this.enableDisplayModelClippingPlanes)}selectClipPlane(e,t){let i,s=0;const n=[],r=[],h=[];let c=new a.Vec3(0,0,0);for(s=0;s<o.MCD_ENUM.EventConstants.MAX_CLIP_PLANES;s++)r[s]=Number.MAX_VALUE;if(this._enableDisplayModelClippingPlanes)if(this._manipulationType===o.MCD_ENUM.ClippingManipulationType.ROTATE)this._selectionIndex=this.selectRotationEdge(t);else if(this._manipulationType===o.MCD_ENUM.ClippingManipulationType.MOVEMENT)for(s=0;s<o.MCD_ENUM.EventConstants.MAX_CLIP_PLANES;s++)if(this._enableModelClipPlanes[s])switch(s){case 0:i=new l.RTTriangle(this._clipPlanesVertices[0],this._clipPlanesVertices[1],this._clipPlanesVertices[2],!0),n[s]=i.intersect(e,t,h[s]),h[s]=i.getInterceptPoint(),n[s]||(i=new l.RTTriangle(this._clipPlanesVertices[0],this._clipPlanesVertices[2],this._clipPlanesVertices[3],!0),n[s]=i.intersect(e,t,h[s]),h[s]=i.getInterceptPoint()),n[s]&&(c=this._glmath.sub(h[s],e),r[s]=this._glmath.magnitude(c));break;case 1:i=new l.RTTriangle(this._clipPlanesVertices[0],this._clipPlanesVertices[4],this._clipPlanesVertices[5],!0),n[s]=i.intersect(e,t,h[s]),h[s]=i.getInterceptPoint(),n[s]||(i=new l.RTTriangle(this._clipPlanesVertices[0],this._clipPlanesVertices[5],this._clipPlanesVertices[1],!0),n[s]=i.intersect(e,t,h[s]),h[s]=i.getInterceptPoint()),n[s]&&(c=this._glmath.sub(h[s],e),r[s]=this._glmath.magnitude(c));break;case 2:i=new l.RTTriangle(this._clipPlanesVertices[0],this._clipPlanesVertices[3],this._clipPlanesVertices[7],!0),n[s]=i.intersect(e,t,h[s]),h[s]=i.getInterceptPoint(),n[s]||(i=new l.RTTriangle(this._clipPlanesVertices[0],this._clipPlanesVertices[7],this._clipPlanesVertices[4],!0),n[s]=i.intersect(e,t,h[s]),h[s]=i.getInterceptPoint()),n[s]&&(c=this._glmath.sub(h[s],e),r[s]=this._glmath.magnitude(c));break;case 3:i=new l.RTTriangle(this._clipPlanesVertices[4],this._clipPlanesVertices[5],this._clipPlanesVertices[6],!0),n[s]=i.intersect(e,t,h[s]),h[s]=i.getInterceptPoint(),n[s]||(i=new l.RTTriangle(this._clipPlanesVertices[4],this._clipPlanesVertices[6],this._clipPlanesVertices[7],!0),n[s]=i.intersect(e,t,h[s]),h[s]=i.getInterceptPoint()),n[s]&&(c=this._glmath.sub(h[s],e),r[s]=this._glmath.magnitude(c));break;case 4:i=new l.RTTriangle(this._clipPlanesVertices[2],this._clipPlanesVertices[3],this._clipPlanesVertices[6],!0),n[s]=i.intersect(e,t,h[s]),h[s]=i.getInterceptPoint(),n[s]||(i=new l.RTTriangle(this._clipPlanesVertices[3],this._clipPlanesVertices[7],this._clipPlanesVertices[6],!0),n[s]=i.intersect(e,t,h[s]),h[s]=i.getInterceptPoint()),n[s]&&(c=this._glmath.sub(h[s],e),r[s]=this._glmath.magnitude(c));break;case 5:i=new l.RTTriangle(this._clipPlanesVertices[1],this._clipPlanesVertices[2],this._clipPlanesVertices[6],!0),n[s]=i.intersect(e,t,h[s]),h[s]=i.getInterceptPoint(),n[s]||(i=new l.RTTriangle(this._clipPlanesVertices[1],this._clipPlanesVertices[6],this._clipPlanesVertices[5],!0),n[s]=i.intersect(e,t,h[s]),h[s]=i.getInterceptPoint()),n[s]&&(c=this._glmath.sub(h[s],e),r[s]=this._glmath.magnitude(c))}let _=-1,d=o.MCD_ENUM.ClippingPlaneSelection.None,m=Number.MAX_VALUE;for(s=0;s<o.MCD_ENUM.EventConstants.MAX_CLIP_PLANES;s++)this._enableModelClipPlanes[s]&&r[s]<m&&(m=r[s],_=s);return this._selectionIndex=_,-1!==_&&this._selectionIndex>=o.MCD_ENUM.ClippingPlaneSelection.Plane0&&this._selectionIndex<=o.MCD_ENUM.ClippingPlaneSelection.Plane5&&(d=this.selectCornerFromPlane(h[_],this._selectionIndex),this._selectionIndex=d>=o.MCD_ENUM.ClippingPlaneSelection.Corner0&&d<=o.MCD_ENUM.ClippingPlaneSelection.Corner7?d:this.selectEdge(h[_],_)),this._selectionIndex}selectEdge(e,t){let i=t;const s=[0,0,0,0];let n=0,a=0,r=0,h=0,c=0,_=0;switch(t){case o.MCD_ENUM.ClippingPlaneSelection.Plane0:for(n=l.MathGeometry.getDistancePtToPt(this._clipPlanesVertices[0],this._clipPlanesVertices[1]),a=l.MathGeometry.getDistancePtToPt(this._clipPlanesVertices[1],this._clipPlanesVertices[2]),h=n<a?n:a,h/=10,s[0]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[0],this._clipPlanesVertices[1]),s[1]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[1],this._clipPlanesVertices[2]),s[2]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[2],this._clipPlanesVertices[3]),s[3]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[3],this._clipPlanesVertices[0]),r=s[0],c=1;c<4;c++)s[c]<r&&(r=s[c],_=c);if(r<this._distanceTolerance&&r<h)switch(_){case 0:i=o.MCD_ENUM.ClippingPlaneSelection.Edge0;break;case 1:i=o.MCD_ENUM.ClippingPlaneSelection.Edge1;break;case 2:i=o.MCD_ENUM.ClippingPlaneSelection.Edge2;break;case 3:i=o.MCD_ENUM.ClippingPlaneSelection.Edge3}break;case o.MCD_ENUM.ClippingPlaneSelection.Plane1:for(n=l.MathGeometry.getDistancePtToPt(this._clipPlanesVertices[0],this._clipPlanesVertices[4]),a=l.MathGeometry.getDistancePtToPt(this._clipPlanesVertices[4],this._clipPlanesVertices[5]),h=n<a?n:a,h/=10,s[0]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[0],this._clipPlanesVertices[4]),s[1]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[4],this._clipPlanesVertices[5]),s[2]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[5],this._clipPlanesVertices[1]),s[3]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[1],this._clipPlanesVertices[0]),r=s[0],c=1;c<4;c++)r=s[c]<r?s[c]:r,_=c;if(r<this._distanceTolerance&&r<h)switch(_){case 0:i=o.MCD_ENUM.ClippingPlaneSelection.Edge8;break;case 1:i=o.MCD_ENUM.ClippingPlaneSelection.Edge4;break;case 2:i=o.MCD_ENUM.ClippingPlaneSelection.Edge9;break;case 3:i=o.MCD_ENUM.ClippingPlaneSelection.Edge0}break;case o.MCD_ENUM.ClippingPlaneSelection.Plane2:for(n=l.MathGeometry.getDistancePtToPt(this._clipPlanesVertices[0],this._clipPlanesVertices[3]),a=l.MathGeometry.getDistancePtToPt(this._clipPlanesVertices[3],this._clipPlanesVertices[7]),h=n<a?n:a,h/=10,s[0]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[0],this._clipPlanesVertices[3]),s[1]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[3],this._clipPlanesVertices[7]),s[2]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[7],this._clipPlanesVertices[4]),s[3]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[4],this._clipPlanesVertices[0]),r=s[0],c=1;c<4;c++)r=s[c]<r?s[c]:r,_=c;if(r<this._distanceTolerance&&r<h)switch(_){case 0:i=o.MCD_ENUM.ClippingPlaneSelection.Edge3;break;case 1:i=o.MCD_ENUM.ClippingPlaneSelection.Edge11;break;case 2:i=o.MCD_ENUM.ClippingPlaneSelection.Edge7;break;case 3:i=o.MCD_ENUM.ClippingPlaneSelection.Edge8}break;case o.MCD_ENUM.ClippingPlaneSelection.Plane3:for(n=l.MathGeometry.getDistancePtToPt(this._clipPlanesVertices[4],this._clipPlanesVertices[5]),a=l.MathGeometry.getDistancePtToPt(this._clipPlanesVertices[5],this._clipPlanesVertices[6]),h=n<a?n:a,h/=10,s[0]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[0],this._clipPlanesVertices[3]),s[1]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[3],this._clipPlanesVertices[7]),s[2]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[7],this._clipPlanesVertices[4]),s[3]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[4],this._clipPlanesVertices[0]),r=s[0],c=1;c<4;c++)r=s[c]<r?s[c]:r,_=c;if(r<this._distanceTolerance&&r<h)switch(_){case 0:i=o.MCD_ENUM.ClippingPlaneSelection.Edge4;break;case 1:i=o.MCD_ENUM.ClippingPlaneSelection.Edge5;break;case 2:i=o.MCD_ENUM.ClippingPlaneSelection.Edge6;break;case 3:i=o.MCD_ENUM.ClippingPlaneSelection.Edge7}break;case o.MCD_ENUM.ClippingPlaneSelection.Plane4:for(n=l.MathGeometry.getDistancePtToPt(this._clipPlanesVertices[2],this._clipPlanesVertices[3]),a=l.MathGeometry.getDistancePtToPt(this._clipPlanesVertices[3],this._clipPlanesVertices[7]),h=n<a?n:a,h/=10,s[0]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[2],this._clipPlanesVertices[3]),s[1]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[3],this._clipPlanesVertices[7]),s[2]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[7],this._clipPlanesVertices[6]),s[3]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[6],this._clipPlanesVertices[2]),r=s[0],c=1;c<4;c++)r=s[c]<r?s[c]:r,_=c;if(r<this._distanceTolerance&&r<h)switch(_){case 0:i=o.MCD_ENUM.ClippingPlaneSelection.Edge2;break;case 1:i=o.MCD_ENUM.ClippingPlaneSelection.Edge11;break;case 2:i=o.MCD_ENUM.ClippingPlaneSelection.Edge6;break;case 3:i=o.MCD_ENUM.ClippingPlaneSelection.Edge10}break;case o.MCD_ENUM.ClippingPlaneSelection.Plane5:for(n=l.MathGeometry.getDistancePtToPt(this._clipPlanesVertices[1],this._clipPlanesVertices[2]),a=l.MathGeometry.getDistancePtToPt(this._clipPlanesVertices[2],this._clipPlanesVertices[6]),h=n<a?n:a,h/=10,s[0]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[1],this._clipPlanesVertices[2]),s[1]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[2],this._clipPlanesVertices[6]),s[2]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[6],this._clipPlanesVertices[5]),s[3]=l.MathGeometry.shortestDistancePtToLine(e,this._clipPlanesVertices[5],this._clipPlanesVertices[1]),r=s[0],c=1;c<4;c++)r=s[c]<r?s[c]:r,_=c;if(r<this._distanceTolerance&&r<h)switch(_){case 0:i=o.MCD_ENUM.ClippingPlaneSelection.Edge1;break;case 1:i=o.MCD_ENUM.ClippingPlaneSelection.Edge10;break;case 2:i=o.MCD_ENUM.ClippingPlaneSelection.Edge5;break;case 3:i=o.MCD_ENUM.ClippingPlaneSelection.Edge9}}return i}selectRotationEdge(e){let t=o.MCD_ENUM.ClippingPlaneSelection.None;const i=l.MathGeometry.shortestDistancePtToLine(e,this._rotationCenter,this._rotationXAxis),s=l.MathGeometry.shortestDistancePtToLine(e,this._rotationCenter,this._rotationYAxis),n=l.MathGeometry.shortestDistancePtToLine(e,this._rotationCenter,this._rotationZAxis);return i<this._distanceTolerance&&i<s&&i<n?t=o.MCD_ENUM.ClippingPlaneSelection.RotationAxisX:s<this._distanceTolerance&&s<i&&s<n?t=o.MCD_ENUM.ClippingPlaneSelection.RotationAxisY:n<this._distanceTolerance&&n<i&&n<s&&(t=o.MCD_ENUM.ClippingPlaneSelection.RotationAxisZ),t}selectCorner(e,t,i,s,n){let a=o.MCD_ENUM.ClippingPlaneSelection.None;const r=[0,0,0,0];let h=0,c=0,_=0,d=0;const m=l.MathGeometry.getDistancePtToPt(this._clipPlanesVertices[1],this._clipPlanesVertices[2]),u=l.MathGeometry.getDistancePtToPt(this._clipPlanesVertices[2],this._clipPlanesVertices[3]);for(c=m<u?m:u,c/=10,r[0]=l.MathGeometry.getDistancePtToPt(e,this._clipPlanesVertices[t]),r[1]=l.MathGeometry.getDistancePtToPt(e,this._clipPlanesVertices[i]),r[2]=l.MathGeometry.getDistancePtToPt(e,this._clipPlanesVertices[s]),r[3]=l.MathGeometry.getDistancePtToPt(e,this._clipPlanesVertices[n]),h=r[0],_=1;_<4;_++)r[_]<h&&(h=r[_],d=_);if(h<this._distanceTolerance&&h<c)switch(d){case 0:a=o.MCD_ENUM.ClippingPlaneSelection.Corner0+t;break;case 1:a=o.MCD_ENUM.ClippingPlaneSelection.Corner0+i;break;case 2:a=o.MCD_ENUM.ClippingPlaneSelection.Corner0+s;break;case 3:a=o.MCD_ENUM.ClippingPlaneSelection.Corner0+n}return a}selectCornerFromPlane(e,t){let i=o.MCD_ENUM.ClippingPlaneSelection.None;switch(t){case o.MCD_ENUM.ClippingPlaneSelection.Plane0:i=this.selectCorner(e,0,1,2,3);break;case o.MCD_ENUM.ClippingPlaneSelection.Plane1:i=this.selectCorner(e,1,2,5,4);break;case o.MCD_ENUM.ClippingPlaneSelection.Plane2:i=this.selectCorner(e,0,3,7,4);break;case o.MCD_ENUM.ClippingPlaneSelection.Plane3:i=this.selectCorner(e,4,5,6,7);break;case o.MCD_ENUM.ClippingPlaneSelection.Plane4:i=this.selectCorner(e,2,3,7,6);break;case o.MCD_ENUM.ClippingPlaneSelection.Plane5:i=this.selectCorner(e,1,2,6,5)}return i}addAPlane(e,t,i,s){this._vertices.push(e),this._vertices.push(t),this._vertices.push(i),this._vertices.push(e),this._vertices.push(i),this._vertices.push(s),this._triangleIndices.push(0+this._currentVertexIndex),this._triangleIndices.push(1+this._currentVertexIndex),this._triangleIndices.push(2+this._currentVertexIndex),this._triangleIndices.push(3+this._currentVertexIndex),this._triangleIndices.push(4+this._currentVertexIndex),this._triangleIndices.push(5+this._currentVertexIndex),this._colorIndices.push(this._planeColorIndex),this._colorIndices.push(this._planeColorIndex),this._colorIndices.push(this._planeColorIndex),this._colorIndices.push(this._planeColorIndex),this._colorIndices.push(this._planeColorIndex),this._colorIndices.push(this._planeColorIndex),this._currentVertexIndex+=6}addEdge(e,t){switch(e){case o.MCD_ENUM.ClippingPlaneSelection.Edge0:(this._enableModelClipPlanes[0]||this._enableModelClipPlanes[1])&&(this._vertices.push(this._clipPlanesVertices[0]),this._vertices.push(this._clipPlanesVertices[1]),this._colorIndices.push(t),this._colorIndices.push(t),this._edgeIndices.push(this._currentVertexIndex),this._edgeIndices.push(this._currentVertexIndex+1),this._currentVertexIndex+=2);break;case o.MCD_ENUM.ClippingPlaneSelection.Edge1:(this._enableModelClipPlanes[0]||this._enableModelClipPlanes[5])&&(this._vertices.push(this._clipPlanesVertices[1]),this._vertices.push(this._clipPlanesVertices[2]),this._colorIndices.push(t),this._colorIndices.push(t),this._edgeIndices.push(this._currentVertexIndex),this._edgeIndices.push(this._currentVertexIndex+1),this._currentVertexIndex+=2);break;case o.MCD_ENUM.ClippingPlaneSelection.Edge2:(this._enableModelClipPlanes[0]||this._enableModelClipPlanes[4])&&(this._vertices.push(this._clipPlanesVertices[2]),this._vertices.push(this._clipPlanesVertices[3]),this._colorIndices.push(t),this._colorIndices.push(t),this._edgeIndices.push(this._currentVertexIndex),this._edgeIndices.push(this._currentVertexIndex+1),this._currentVertexIndex+=2);break;case o.MCD_ENUM.ClippingPlaneSelection.Edge3:(this._enableModelClipPlanes[0]||this._enableModelClipPlanes[2])&&(this._vertices.push(this._clipPlanesVertices[3]),this._vertices.push(this._clipPlanesVertices[0]),this._colorIndices.push(t),this._colorIndices.push(t),this._edgeIndices.push(this._currentVertexIndex),this._edgeIndices.push(this._currentVertexIndex+1),this._currentVertexIndex+=2);break;case o.MCD_ENUM.ClippingPlaneSelection.Edge4:(this._enableModelClipPlanes[1]||this._enableModelClipPlanes[3])&&(this._vertices.push(this._clipPlanesVertices[4]),this._vertices.push(this._clipPlanesVertices[5]),this._colorIndices.push(t),this._colorIndices.push(t),this._edgeIndices.push(this._currentVertexIndex),this._edgeIndices.push(this._currentVertexIndex+1),this._currentVertexIndex+=2);break;case o.MCD_ENUM.ClippingPlaneSelection.Edge5:(this._enableModelClipPlanes[3]||this._enableModelClipPlanes[5])&&(this._vertices.push(this._clipPlanesVertices[5]),this._vertices.push(this._clipPlanesVertices[6]),this._colorIndices.push(t),this._colorIndices.push(t),this._edgeIndices.push(this._currentVertexIndex),this._edgeIndices.push(this._currentVertexIndex+1),this._currentVertexIndex+=2);break;case o.MCD_ENUM.ClippingPlaneSelection.Edge6:(this._enableModelClipPlanes[3]||this._enableModelClipPlanes[4])&&(this._vertices.push(this._clipPlanesVertices[6]),this._vertices.push(this._clipPlanesVertices[7]),this._colorIndices.push(t),this._colorIndices.push(t),this._edgeIndices.push(this._currentVertexIndex),this._edgeIndices.push(this._currentVertexIndex+1),this._currentVertexIndex+=2);break;case o.MCD_ENUM.ClippingPlaneSelection.Edge7:(this._enableModelClipPlanes[3]||this._enableModelClipPlanes[2])&&(this._vertices.push(this._clipPlanesVertices[4]),this._vertices.push(this._clipPlanesVertices[7]),this._colorIndices.push(t),this._colorIndices.push(t),this._edgeIndices.push(this._currentVertexIndex),this._edgeIndices.push(this._currentVertexIndex+1),this._currentVertexIndex+=2);break;case o.MCD_ENUM.ClippingPlaneSelection.Edge8:(this._enableModelClipPlanes[1]||this._enableModelClipPlanes[2])&&(this._vertices.push(this._clipPlanesVertices[0]),this._vertices.push(this._clipPlanesVertices[4]),this._colorIndices.push(t),this._colorIndices.push(t),this._edgeIndices.push(this._currentVertexIndex),this._edgeIndices.push(this._currentVertexIndex+1),this._currentVertexIndex+=2);break;case o.MCD_ENUM.ClippingPlaneSelection.Edge9:(this._enableModelClipPlanes[1]||this._enableModelClipPlanes[5])&&(this._vertices.push(this._clipPlanesVertices[1]),this._vertices.push(this._clipPlanesVertices[5]),this._colorIndices.push(t),this._colorIndices.push(t),this._edgeIndices.push(this._currentVertexIndex),this._edgeIndices.push(this._currentVertexIndex+1),this._currentVertexIndex+=2);break;case o.MCD_ENUM.ClippingPlaneSelection.Edge10:(this._enableModelClipPlanes[4]||this._enableModelClipPlanes[5])&&(this._vertices.push(this._clipPlanesVertices[2]),this._vertices.push(this._clipPlanesVertices[6]),this._colorIndices.push(t),this._colorIndices.push(t),this._edgeIndices.push(this._currentVertexIndex),this._edgeIndices.push(this._currentVertexIndex+1),this._currentVertexIndex+=2);break;case o.MCD_ENUM.ClippingPlaneSelection.Edge11:(this._enableModelClipPlanes[2]||this._enableModelClipPlanes[4])&&(this._vertices.push(this._clipPlanesVertices[3]),this._vertices.push(this._clipPlanesVertices[7]),this._colorIndices.push(t),this._colorIndices.push(t),this._edgeIndices.push(this._currentVertexIndex),this._edgeIndices.push(this._currentVertexIndex+1),this._currentVertexIndex+=2);break;case o.MCD_ENUM.ClippingPlaneSelection.RotationAxisX:this._vertices.push(this._rotationCenter),this._vertices.push(this._rotationXAxis),this._colorIndices.push(t),this._colorIndices.push(t),this._edgeIndices.push(this._currentVertexIndex),this._edgeIndices.push(this._currentVertexIndex+1),this._currentVertexIndex+=2;break;case o.MCD_ENUM.ClippingPlaneSelection.RotationAxisY:this._vertices.push(this._rotationCenter),this._vertices.push(this._rotationYAxis),this._colorIndices.push(t),this._colorIndices.push(t),this._edgeIndices.push(this._currentVertexIndex),this._edgeIndices.push(this._currentVertexIndex+1),this._currentVertexIndex+=2;break;case o.MCD_ENUM.ClippingPlaneSelection.RotationAxisZ:this._vertices.push(this._rotationCenter),this._vertices.push(this._rotationZAxis),this._colorIndices.push(t),this._colorIndices.push(t),this._edgeIndices.push(this._currentVertexIndex),this._edgeIndices.push(this._currentVertexIndex+1),this._currentVertexIndex+=2}}calculateRotationCenterAndAxis(){this._rotationCenter=this._glmath.mul(this._glmath.add(this._clipPlanesVertices[0],this._clipPlanesVertices[6]),.5),this._rotationXAxis=this._glmath.mul(this._glmath.add(this._clipPlanesVertices[3],this._clipPlanesVertices[6]),.5),this._rotationYAxis=this._glmath.mul(this._glmath.add(this._clipPlanesVertices[4],this._clipPlanesVertices[6]),.5),this._rotationZAxis=this._glmath.mul(this._glmath.add(this._clipPlanesVertices[1],this._clipPlanesVertices[6]),.5);const e=this._glmath.normalize(this._glmath.sub(this._rotationXAxis,this._rotationCenter)),t=this._glmath.normalize(this._glmath.sub(this._rotationYAxis,this._rotationCenter)),i=this._glmath.normalize(this._glmath.sub(this._rotationZAxis,this._rotationCenter));this._rotationXAxis=this._glmath.add(this._rotationCenter,this._glmath.mul(e,this._objectWidth)),this._rotationYAxis=this._glmath.add(this._rotationCenter,this._glmath.mul(t,this._objectLength)),this._rotationZAxis=this._glmath.add(this._rotationCenter,this._glmath.mul(i,this._objectHeight))}addEdgesBasedOnSelectedCorner(e){e>=o.MCD_ENUM.ClippingPlaneSelection.Corner0&&e<=o.MCD_ENUM.ClippingPlaneSelection.Corner7&&(e===o.MCD_ENUM.ClippingPlaneSelection.Corner0?(this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge0,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge3,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge8,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge1,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge2,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge4,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge7,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge9,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge11,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge5,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge6,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge10,this._edgeColorIndex)):this._selectionIndex===o.MCD_ENUM.ClippingPlaneSelection.Corner1?(this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge0,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge1,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge9,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge2,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge3,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge4,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge5,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge8,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge10,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge6,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge7,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge11,this._edgeColorIndex)):this._selectionIndex===o.MCD_ENUM.ClippingPlaneSelection.Corner2?(this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge1,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge2,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge10,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge0,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge3,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge5,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge6,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge9,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge11,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge4,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge7,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge8,this._edgeColorIndex)):this._selectionIndex===o.MCD_ENUM.ClippingPlaneSelection.Corner3&&(this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge2,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge3,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge11,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge0,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge1,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge6,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge7,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge8,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge10,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge4,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge5,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge9,this._edgeColorIndex)),this._selectionIndex===o.MCD_ENUM.ClippingPlaneSelection.Corner4&&(this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge4,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge7,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge8,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge0,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge3,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge5,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge6,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge9,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge11,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge1,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge2,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge10,this._edgeColorIndex)),this._selectionIndex===o.MCD_ENUM.ClippingPlaneSelection.Corner5&&(this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge4,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge5,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge9,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge0,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge1,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge6,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge7,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge8,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge10,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge2,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge3,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge11,this._edgeColorIndex)),this._selectionIndex===o.MCD_ENUM.ClippingPlaneSelection.Corner6&&(this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge5,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge6,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge10,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge1,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge2,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge4,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge7,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge9,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge11,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge0,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge3,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge8,this._edgeColorIndex)),this._selectionIndex===o.MCD_ENUM.ClippingPlaneSelection.Corner7&&(this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge6,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge7,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge11,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge2,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge3,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge4,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge5,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge8,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge10,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge0,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge1,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge9,this._edgeColorIndex)))}addEdgesBasedOnSelectedEdges(e,t){this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge0,t),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge1,t),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge2,t),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge3,t),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge4,t),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge5,t),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge6,t),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge7,t),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge8,t),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge9,t),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge10,t),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge11,t)}addEdgesOnFeatureLayerBasedOnRotation(e){this._manipulationType===o.MCD_ENUM.ClippingManipulationType.ROTATE&&this._clippingType===o.MCD_ENUM.ClippingType.OBJECT&&this.calculateRotationCenterAndAxis()}addEdgesBasedOnRotation(e){if(this._manipulationType===o.MCD_ENUM.ClippingManipulationType.ROTATE&&this._clippingType===o.MCD_ENUM.ClippingType.OBJECT)switch(this.calculateRotationCenterAndAxis(),e){case o.MCD_ENUM.ClippingPlaneSelection.RotationAxisX:this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.RotationAxisX,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.RotationAxisY,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.RotationAxisZ,this._edgeColorIndex);break;case o.MCD_ENUM.ClippingPlaneSelection.RotationAxisY:this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.RotationAxisX,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.RotationAxisY,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.RotationAxisZ,this._edgeColorIndex);break;case o.MCD_ENUM.ClippingPlaneSelection.RotationAxisZ:this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.RotationAxisX,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.RotationAxisY,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.RotationAxisZ,this._edgeHighliteColorIndex);break;case o.MCD_ENUM.ClippingPlaneSelection.None:this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.RotationAxisX,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.RotationAxisY,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.RotationAxisZ,this._edgeColorIndex)}}addEdgesBasedOnSelectedPlane(e){e>=o.MCD_ENUM.ClippingPlaneSelection.Plane0&&e<=o.MCD_ENUM.ClippingPlaneSelection.Plane5&&(e===o.MCD_ENUM.ClippingPlaneSelection.Plane0?(this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge0,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge1,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge2,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge3,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge4,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge5,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge6,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge7,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge8,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge9,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge10,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge11,this._edgeColorIndex)):this._selectionIndex===o.MCD_ENUM.ClippingPlaneSelection.Plane1?(this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge0,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge4,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge8,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge9,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge1,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge2,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge3,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge5,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge6,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge7,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge10,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge11,this._edgeColorIndex)):this._selectionIndex===o.MCD_ENUM.ClippingPlaneSelection.Plane2?(this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge3,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge7,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge8,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge11,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge0,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge1,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge2,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge4,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge5,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge6,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge9,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge10,this._edgeColorIndex)):this._selectionIndex===o.MCD_ENUM.ClippingPlaneSelection.Plane3&&(this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge4,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge5,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge6,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge7,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge0,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge1,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge2,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge3,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge8,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge9,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge10,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge11,this._edgeColorIndex)),this._selectionIndex===o.MCD_ENUM.ClippingPlaneSelection.Plane4&&(this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge2,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge6,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge10,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge11,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge0,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge1,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge3,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge4,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge5,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge7,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge8,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge9,this._edgeColorIndex)),this._selectionIndex===o.MCD_ENUM.ClippingPlaneSelection.Plane5&&(this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge1,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge5,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge9,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge10,this._edgeHighliteColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge0,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge2,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge3,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge4,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge6,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge7,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge8,this._edgeColorIndex),this.addEdge(o.MCD_ENUM.ClippingPlaneSelection.Edge11,this._edgeColorIndex)))}onManipulationStart(e,t){return s(this,void 0,void 0,(function*(){this._oldPos.x=e,this._oldPos.y=this._windowHeight-t,this._isManipulationReady=!1,yield this.getCameraAndProjectionMatrices()}))}onManipulationUpdate(e,t){if(!this._isManipulationReady)return;const i=new h.VisPoint;i.x=e,i.y=this._windowHeight-t;const s=i.x-this._oldPos.x,n=i.y-this._oldPos.y;if(Math.abs(s)>=4||Math.abs(n)>=4){let e=1;if(this.selection>=o.MCD_ENUM.ClippingPlaneSelection.RotationAxisX&&this.selection<=o.MCD_ENUM.ClippingPlaneSelection.RotationAxisZ)Math.abs(s)>Math.abs(n)?e=s>0?1:-1:Math.abs(s)<Math.abs(n)&&(e=n>0?1:-1),this.rotateClipPlanes(e);else if(this.selection>=o.MCD_ENUM.ClippingPlaneSelection.Plane0&&this.selection<=o.MCD_ENUM.ClippingPlaneSelection.Corner7){const{first:e,last:t}=this.convertScreenPtToWorldPt(i.x,i.y,this._oldPosWorld,this._newPosWorld);if(e){this._newPosWorld=t;const e=this._glmath.sub(this._oldPosWorld,this._newPosWorld);this.moveClipPlanes(e),this._oldPosWorld=this._newPosWorld}}this.display(!0),this.enableModelPlanesClipping(!0),this._oldPos.x=i.x,this._oldPos.y=i.y}}deleteDynamicMeshLayer(){null!==this._dynamicMeshLayerForEdges&&(this._dynamicMeshLayerForEdges.destroyDynamicMeshLayer(),this._dynamicMeshLayerForEdges=null),null!==this._dynamicMeshLayerForPlanes&&(this._dynamicMeshLayerForPlanes.destroyDynamicMeshLayer(),this._dynamicMeshLayerForPlanes=null)}setViewSize(e,t){this._windowWidth=e,this._windowHeight=t}adjustSelectionDistanceTolerance(e){this._distanceTolerance=e<1?.05:e<2?.1:e<4?.15:e<6?.2:e<8?.25:.3}convertScreenPtToWorldPt(e,t,i,s){const n=l.MathGeometry.getDistancePtToPt(this._eyePos,this._centerPos)/this._movementScale,o=new a.Vec3(this._windowWidth/2,this._windowHeight/2,-n);let r=new a.Vec3(e,t,0);r=this._glmath.sub(r,o),r=this._glmath.multMat3Vec3(this._matrixDit2Uor,r),r=this._glmath.normalize(r);const h=this._glmath.sub(this._eyePos,this._centerPos),c=this._glmath.sub(i,this._eyePos),_=this._glmath.dot(h,c),d=this._glmath.dot(h,r);return Math.abs(d)>Number.EPSILON?(r=this._glmath.mul(r,_/d),{first:!0,last:s=this._glmath.add(this._eyePos,r)}):{first:!1,last:s}}getCameraAndProjectionMatrices(){return s(this,void 0,void 0,(function*(){const e=yield this._mcd.get("CameraPosition","");let t=JSON.parse(e);for(;"string"==typeof t;)t=JSON.parse(t);if(this._enableDisplayModelClippingPlanes){let i=new a.Mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),s=new a.Mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),n=new a.Mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);if(""!==e&&null!==t.CameraPosition&&null!==t.CameraPosition.center.x&&null!==t.CameraPosition.center.y&&null!==t.CameraPosition.center.z&&null!==t.CameraPosition.eye.x&&null!==t.CameraPosition.eye.y&&null!==t.CameraPosition.eye.z&&null!==t.CameraPosition.up.x&&null!==t.CameraPosition.up.y&&null!==t.CameraPosition.up.z&&null!==t.CameraPosition["clip-far"]&&null!==t.CameraPosition["clip-near"]&&null!==t.CameraPosition.perspective){this._centerPos.x=t.CameraPosition.center.x,this._centerPos.y=t.CameraPosition.center.y,this._centerPos.z=t.CameraPosition.center.z,this._eyePos.x=t.CameraPosition.eye.x,this._eyePos.y=t.CameraPosition.eye.y,this._eyePos.z=t.CameraPosition.eye.z,this._up.x=t.CameraPosition.up.x,this._up.y=t.CameraPosition.up.y,this._up.z=t.CameraPosition.up.z;const e=t.CameraPosition["clip-far"],a=t.CameraPosition["clip-near"],o=t.CameraPosition.perspective,r=Math.PI/180*o/2,h=this._glmath.sub(this._eyePos,this._centerPos);this._movementScale=2*Math.tan(r)*this._glmath.magnitude(h)/this._windowHeight,i=l.MathGeometry.buildViewMatrix(this._eyePos,this._centerPos,this._up),s=l.MathGeometry.buildProjectionMatrix(a,e,o,this._windowWidth,this._windowHeight),n=this._glmath.multMat4(s,i),this.adjustSelectionDistanceTolerance(l.MathGeometry.getDistancePtToPt(this._eyePos,this._centerPos)),this._matrixDit2Uor=l.MathGeometry.buildDit2UorMatrix(this._eyePos,this._centerPos,this._up)}}}))}}},b7LP:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MCDRange=class{constructor(e,t,i,s,n,a){const o=Number.MAX_VALUE;this._minx=void 0!==e?e:o,this._miny=void 0!==t?t:o,this._minz=void 0!==i?i:o,this._maxx=void 0!==s?s:-o,this._maxy=void 0!==n?n:-o,this._maxz=void 0!==a?a:-o}accumilate(e,t,i,s,n,a){this._minx>e&&(this._minx=e),this._miny>t&&(this._miny=t),this._minz>i&&(this._minz=i),this._maxx<s&&(this._maxx=s),this._maxy<n&&(this._maxy=n),this._maxz<a&&(this._maxz=a)}get minx(){return this._minx}set minx(e){this._minx=e}get miny(){return this._miny}set miny(e){this._miny=e}get minz(){return this._minz}set minz(e){this._minz=e}get maxx(){return this._maxx}set maxx(e){this._maxx=e}get maxy(){return this._maxy}set maxy(e){this._maxy=e}get maxz(){return this._maxz}set maxz(e){this._maxz=e}toJsonString(){const e={max:{},min:{}};return e.max.x=this._maxx,e.max.y=this._maxy,e.max.z=this._maxz,e.min.x=this._minx,e.min.y=this._miny,e.min.z=this._minz,JSON.stringify(e)}}},bM4Y:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i("Y0B9"),a=i("Khlq"),o=i("JxDP"),r=i("L6aT"),l=i("2T81"),h=i("fx83"),c=i("XHCD");t.MeasurementBase=class extends o.MCDViewCommand{constructor(){super(!0),this._pointPlacementMode=!1,this._tapPoints=[],this._visible=!0,this._toleranceForElementClicked=5,this._clickedPoint=new l.Vec2(0,0),this._useFeatureAsPointFromTap=!1,this._placePointfromTap=!1,this._placeUpdatedPoint=!1,this._placePointFromUpdateScreenPosition=!1,this._selectFeaturefromTap=!1,this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.pause=this.pause.bind(this),this.resume=this.resume.bind(this)}start(){const e=super.start();return e&&(this.pointPlacementMode=!0,this._eventManager.onTelemetry(c.Telemetry.getTelemetryJson(a.MCD_ENUM.TelemetryEventName.MeasurementCommand,a.MCD_ENUM.TelemetryEventType.Feature,a.MCD_ENUM.TelemetryMessageType.Start))),e}stop(){const e=super.stop();return e&&(this.visible=!0,this.pointPlacementMode=!1,this.deleteAllMeasurements(),this._eventManager.onTelemetry(c.Telemetry.getTelemetryJson(a.MCD_ENUM.TelemetryEventName.MeasurementCommand,a.MCD_ENUM.TelemetryEventType.Feature,a.MCD_ENUM.TelemetryMessageType.End))),e}pause(){const e=super.pause();return e&&(this._measurement.deactivateCurrentActiveLine(),this._eventManager.onTelemetry(c.Telemetry.getTelemetryJson(a.MCD_ENUM.TelemetryEventName.MeasurementCommand,a.MCD_ENUM.TelemetryEventType.Feature,a.MCD_ENUM.TelemetryMessageType.Pause))),e}resume(){const e=super.resume();return e&&this._eventManager.onTelemetry(c.Telemetry.getTelemetryJson(a.MCD_ENUM.TelemetryEventName.MeasurementCommand,a.MCD_ENUM.TelemetryEventType.Feature,a.MCD_ENUM.TelemetryMessageType.Resume)),e}set width(e){this._width=e}set height(e){this._height=e}updateViewSize(e,t){this._width=e,this._height=t}init(e,t,i,s,n,o){this._measurement=e,this._modularCoreDisplay=t,this._eventManager=i,this._width=s,this._height=n,this._fontPath=o.fontPath,this._iconPath=o.iconPath,this._units=o.units,this._precision=o.precision,this._selectedPointColor=o.selectedPointColor,this._deSelectedPointColor=o.deSelectedPointColor,this._defaultColor=o.defaultColor,this._lineColor=o.lineColor,this._movingPointColor=o.movingPointColor,this._showDimesionsAlongXYZ=o.showDimesionsAlongXYZ,this._onPlaceMeasurementPointActive=o.onPointPlacementModeActive,this.surfaceLocateCallback=this.onSurfaceLocate.bind(this),this.elementLocateCallback=this.onElementLocate.bind(this),this.tapCallback=this.onTap.bind(this),this.mouseClickCallback=this.onMouseClick.bind(this),this.manipulationStartCallback=this.onManipulationStart.bind(this),this.manipulationUpdateCallback=this.onManipulationUpdate.bind(this),this.manipulationEndCallback=this.onManipulationEnd.bind(this),this.addEvent(a.MCD_ENUM.CallbackEventNames.LOCATE_EVENT,this.surfaceLocateCallback,!1,!0),this.addEvent(a.MCD_ENUM.CallbackEventNames.LOCATE_ELEMENT_EVENT,this.elementLocateCallback),this.addEvent(a.MCD_ENUM.EventNames.TAP_EVENT,this.tapCallback),this.addEvent(a.MCD_ENUM.EventNames.MOUSE_CLICK_EVENT,this.mouseClickCallback),this.addEvent(a.MCD_ENUM.EventNames.MANIPULATION_START_EVENT,this.manipulationStartCallback,!0,!1),this.addEvent(a.MCD_ENUM.EventNames.MANIPULATION_UPDATE_EVENT,this.manipulationUpdateCallback,!0,!1),this.addEvent(a.MCD_ENUM.EventNames.MANIPULATION_END_EVENT,this.manipulationEndCallback,!0,!1),this._measurement.initMeasurement(),this._keyMappings=this.createKeyMappings()}createKeyMappings(){return[new h.MCDKey(27,a.MCD_ENUM.KeyEventType.KEY_UP,this.stop)]}set pointPlacementMode(e){this._pointPlacementMode=e,!1===this._pointPlacementMode&&this._measurement.deactivateCurrentActiveLine()}get pointPlacementMode(){return this._pointPlacementMode}deleteAllMeasurements(){this._measurement.clearAll()}set visible(e){this._measurement.deactivateCurrentActiveLine(),this._measurement.setVisibility(e),this._visible=e}get currentActiveMeasurementPointType(){return this._measurement.currentMeasurementLine.activePoint}get measurementLinesJson(){const e=[];for(const t of this._measurement.measurementLines.values())e.push({startPoint:{orientation:{x:t.startPoint.orientation.x,y:t.startPoint.orientation.y,z:t.startPoint.orientation.z},position:{x:t.startPoint.position.x,y:t.startPoint.position.y,z:t.startPoint.position.z}},endPoint:{orientation:{x:t.endPoint.orientation.x,y:t.endPoint.orientation.y,z:t.endPoint.orientation.z},position:{x:t.endPoint.position.x,y:t.endPoint.position.y,z:t.endPoint.position.z}}});return e}selectFeature(e){this._measurement.selectFeature(e)}addPoint(e){this._measurement.addPoint(e)}deleteCurrentActiveMeasurement(){this._visible&&this._measurement.deleteCurrentActive()&&this._onPlaceMeasurementPointActive()}updateConfig(e){this._fontPath=e.fontPath,this._iconPath=e.iconPath,this._units=e.units,this._precision=e.precision,this._selectedPointColor=e.selectedPointColor,this._deSelectedPointColor=e.deSelectedPointColor,this._defaultColor=e.defaultColor,this._lineColor=e.lineColor,this._movingPointColor=e.movingPointColor,this._showDimesionsAlongXYZ=e.showDimesionsAlongXYZ,this._onPlaceMeasurementPointActive=e.onPointPlacementModeActive,this._measurement.updateStylesAndText()}destroy(){this._measurement.destroyLayers()}onMouseClick(){event.preventDefault()}onTap(e){if(this._visible&&1===e.tapCount&&(1===e.touchCount||e.mouseButtonType===a.MCD_ENUM.EventConstants.MOUSE_LBUTTON)){const t=this._toleranceForElementClicked;this._modularCoreDisplay.locateAsync(JSON.stringify({LocateType:a.MCD_ENUM.LocateType.Object,ScreenRange:{x0:e.x-t,y0:e.y-t,x1:e.x+t,y1:e.y+t}})),this._pointPlacementMode?(this._useFeatureAsPointFromTap=!0,this._currentTapPoint=new r.VisPoint,this._currentTapPoint.x=Math.floor(e.x),this._currentTapPoint.y=Math.floor(e.y)):this._selectFeaturefromTap=!0}}onElementLocate(e){return s(this,void 0,void 0,(function*(){const t=this.getSelectedIDSFromJSON(e);if(this._isCallfromManipulationStart)t.length>0&&(this._featureClickAndHold=this._measurement.createMovingFeature(t),this._featureClickAndHold&&(this.eventMap[a.MCD_ENUM.EventNames.MANIPULATION_UPDATE_EVENT].recursive=!1));else if(this._useFeatureAsPointFromTap){let e=!0;if(t.length>0&&(e=this._measurement.useFeatureForPlacingPoint(t)),e){const e={LocateType:a.MCD_ENUM.LocateType.SurfacePoint,ScreenPosition:{x:this._currentTapPoint.x,y:this._currentTapPoint.y}};this._placePointfromTap=!0,this._modularCoreDisplay.locateAsync(JSON.stringify(e));const t=new r.VisPoint;t.x=this._currentTapPoint.x,t.y=this._currentTapPoint.y,this._tapPoints.push(t),this.eventMap[a.MCD_ENUM.CallbackEventNames.LOCATE_EVENT].useDefault=!1}this._useFeatureAsPointFromTap=!1}else if(this._selectFeaturefromTap)t.length>0&&this._measurement.selectFeature(t[0]),this._selectFeaturefromTap=!1;else if(this._placeUpdatedPoint){let e=!1;if(e=!(t.length>0)||this._measurement.useFeatureForUpdatingPoint(t),e){const e={LocateType:a.MCD_ENUM.LocateType.SurfacePoint,ScreenPosition:{x:this._currentTapPoint.x,y:this._currentTapPoint.y}};this._placePointFromUpdateScreenPosition=!0,this._modularCoreDisplay.locateAsync(JSON.stringify(e));const t=new r.VisPoint;t.x=this._currentTapPoint.x,t.y=this._currentTapPoint.y,this._tapPoints.push(t),this.eventMap[a.MCD_ENUM.CallbackEventNames.LOCATE_EVENT].useDefault=!1}else this._measurement.finalizeMovingFeatureAfterUpdate();this._placeUpdatedPoint=!1}}))}getSelectedIDSFromJSON(e){const t=[];if("string"==typeof e&&(e=JSON.parse(e)),e["hit-records"]&&e["hit-records"].length>0)for(let i=0;i<e["hit-records"].length;i++)if(e["hit-records"][i]){const s=e["hit-records"][i];if(s["target-name"]===this._measurement.featureLayername){if(s.hits&&s.hits.length>0){const e=s.hits;for(let i=0;i<e.length;i++){const s=e[i];s&&t.push(s.id)}}break}}return t}onSurfaceLocate(e){return s(this,void 0,void 0,(function*(){let t=e;"string"==typeof t&&(t=JSON.parse(e));let i=!1;const s=new r.VisPoint;s.x=t.x,s.y=t.y;for(let e=0;e<this._tapPoints.length;e++)0===s.getDistance(this._tapPoints[e])&&(i=!0,this._tapPoints.splice(e,1));if(i&&null!==t.hits&&t.hits[0]["target-name"]!==this._measurement.featureLayername){if(this._visible){let e=t.hits[0].nx,i=t.hits[0].ny,s=t.hits[0].nz;0===e&&(e=.9999999),0===i&&(i=.9999999),0===s&&(s=.9999999);const a=new n.MeasurementPoint(new l.Vec3(t.hits[0].x,t.hits[0].y,t.hits[0].z),new l.Vec3(e,i,s));this._featureClickAndHold?this._measurement.updatePoint(a):this._placePointFromUpdateScreenPosition?(this._measurement.updatePoint(a),this._measurement.finalizeMovingFeatureAfterUpdate()):this._placePointfromTap&&this._measurement.addPoint(a)}}else this._featureClickAndHold?t.x&&t.y&&this._measurement.updateMovingfeatureAtNearClipping(t.x,t.y):this._placePointFromUpdateScreenPosition&&(this._measurement.resetMovingPointPositionToOrginal(),this._measurement.finalizeMovingFeatureAfterUpdate());0===this._tapPoints.length&&(this.eventMap[a.MCD_ENUM.CallbackEventNames.LOCATE_EVENT].useDefault=!0),this._placePointFromUpdateScreenPosition=!1,this._placePointfromTap=!1}))}onManipulationStart(e){this._visible&&!1===this._pointPlacementMode&&(this._tapPoints=[],this._timeOut=setTimeout(()=>{this._isCallfromManipulationStart=!0;const t=this._toleranceForElementClicked;this._modularCoreDisplay.locateAsync(JSON.stringify({LocateType:a.MCD_ENUM.LocateType.Object,ScreenRange:{x0:e.x-t,y0:e.y-t,x1:e.x+t,y1:e.y+t}}))},200),this._clickedPoint.x=e.x,this._clickedPoint.y=e.y)}onManipulationUpdate(e){if(!1===this._pointPlacementMode)if(this._featureClickAndHold){const t={x:Math.floor(e.x),y:Math.floor(e.y)};this._modularCoreDisplay.locateAsync(JSON.stringify({LocateType:a.MCD_ENUM.LocateType.SurfacePoint,ScreenPosition:t}));const i=new r.VisPoint;i.x=Math.floor(e.x),i.y=Math.floor(e.y),this._tapPoints.push(i),this.eventMap[a.MCD_ENUM.CallbackEventNames.LOCATE_EVENT].useDefault=!1}else clearTimeout(this._timeOut)}onManipulationEnd(e){if(!1===this._pointPlacementMode&&(clearTimeout(this._timeOut),e.touchCount<1||e.mouseButtonType===a.MCD_ENUM.EventConstants.MOUSE_LBUTTON)){if(this._isCallfromManipulationStart=!1,this._featureClickAndHold)if(this._featureClickAndHold=!1,this._clickedPoint.x!==e.x&&this._clickedPoint.y!==e.y){const e=this._measurement.finalScreenPositionAfterUpdate();if(e&&e.x>0&&e.y>0&&e.x<this._width&&e.y<this._height){const t=this._toleranceForElementClicked,i={LocateType:a.MCD_ENUM.LocateType.Object,ScreenRange:{x0:e.x-t,y0:e.y-t,x1:e.x+t,y1:e.y+t}};this._placeUpdatedPoint=!0,this._currentTapPoint=new r.VisPoint,this._currentTapPoint.x=Math.floor(e.x),this._currentTapPoint.y=Math.floor(e.y),this._measurement.removeMovingPoint(),this._modularCoreDisplay.locateAsync(JSON.stringify(i))}else this._measurement.resetMovingPointPositionToOrginal(),this._measurement.finalizeMovingFeatureAfterUpdate();this._clickedPoint.x=0,this._clickedPoint.y=0}else this._measurement.resetMovingPointPositionToOrginal(),this._measurement.finalizeMovingFeatureAfterUpdate();this.eventMap[a.MCD_ENUM.EventNames.MANIPULATION_UPDATE_EVENT].recursive=!0}}}},bipn:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MCDSelectionChanged=class{constructor(e,t,i,s,n){this._graphicId=e,this._targetName=t,this._isSelected=i,this._extraData=n,this._isMultiSelect=s}get graphicId(){return this._graphicId}set graphicId(e){this._graphicId=e}get targetName(){return this._targetName}set targetName(e){this._targetName=e}get isSelected(){return this._isSelected}set isSelected(e){this._isSelected=e}get isMultiSelect(){return this._isMultiSelect}set isMultiSelect(e){this._isMultiSelect=e}get extraData(){return this._extraData}set extraData(e){this._extraData=e}}},bwSC:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i("Khlq"),a=i("b7LP"),o=i("uKvH"),r=i("XHCD"),l=i("4jpW");t.ModularCoreDisplayBase=class{constructor(e){this._enabledEffects={},this._materialIds=[],this._jsonModelList=[],this.selectObjectCallbackEvents=[],this._canvasElementId=e,this.snapshot=this.snapshot.bind(this)}get documentData(){return this._documentData}get materialAccent(){return this._materialAccent}set eventManager(e){this._eventManager=e}createMCD(e){this._modularCoreDisplay=e,null!==this._modularCoreDisplay&&(this._materialAccent=this._modularCoreDisplay.materialAccent)}get selectObjectCallbackEventStack(){return this.selectObjectCallbackEvents}addSelectObjectEvent(e){-1===this.selectObjectCallbackEvents.indexOf(e)&&this.selectObjectCallbackEvents.push(e)}removeSelectObjectEvent(e){const t=this.selectObjectCallbackEvents.indexOf(e);-1!==t&&this.selectObjectCallbackEvents.splice(t,1)}enableEffects(e){if(!this._modularCoreDisplay||!e)return!1;if(0===e.length)return!0;let t="{";for(let i=0;i<e.length;i++)this._enabledEffects[e[i]]=e[i],t+='"'+e[i]+'": { "enable": true }',i+1<e.length&&(t+=",");return t+="}",this._modularCoreDisplay.set("RenderEffects",t),!0}disableEffects(e){if(!this._modularCoreDisplay||!e)return!1;if(0===e.length)return this._modularCoreDisplay.reset("RenderEffects",""),this._modularCoreDisplay.commitCameraChanges(1),!0;let t="{";for(let i=0;i<e.length;i++)delete this._enabledEffects[e[i]],t+='"'+e[i]+'": { "enable": false }',i+1<e.length&&(t+=",");return t+="}",this._modularCoreDisplay.set("RenderEffects",t),!0}setLocateRadius(e){return!(!this._modularCoreDisplay||!e||(this._modularCoreDisplay.set("Preferences",'{"DefaultLocateRadius ":'+e+"}"),0))}enablePreferences(e){if(!this._modularCoreDisplay||!e)return!1;if(0===e.length)return this._modularCoreDisplay.reset("Preferences",""),this._modularCoreDisplay.commitCameraChanges(1),!0;const t={};for(let i=0;i<e.length;i++)t[e[i]]=!0;return this._modularCoreDisplay.set("Preferences",JSON.stringify(t)),!0}disablePreferences(e){if(!this._modularCoreDisplay||!e)return!1;if(0===e.length)return this._modularCoreDisplay.reset("Preferences",""),this._modularCoreDisplay.commitCameraChanges(1),!0;const t={};for(let i=0;i<e.length;i++)t[e[i]]=!1;return this._modularCoreDisplay.set("Preferences",JSON.stringify(t)),!0}open(e,t,i,s,a,o,h,c,_,d,m,u,p,g=!1,C){if(!(this._modularCoreDisplay&&t&&i&&s&&a))return!1;void 0===s&&(s="Parametrics"),void 0===a&&(a="web-api"),void 0===o&&(o=n.MCD_ENUM.CameraHeading.ISOMETRIC),void 0===h&&(h=n.MCD_ENUM.CameraProjection.PERSPECTIVE);const M={};if(t&&(M["model-name"]=t),i&&(M["model-url"]=i),s&&(M["model-type"]=s),a&&(M["model-access-protocol"]=a),o&&(M["camera-heading"]=o),h&&(M["camera-projection"]=h),u&&(M["authorization-token"]=u),c&&c.length>0){let e="[";for(let t=0;t<c.length;t++)e+=c[t].toJsonString(),t<c.length-1&&(e+=",");e+="]",M["initial-selection"]=JSON.parse(e)}if(_&&(M["model-range"]=JSON.parse(_.toJsonString())),d&&d.length>0){let e="[";for(let t=0;t<d.length;t++)e+='{ "',e+=d[t],e+='" : true }',t<d.length-1&&(e+=",");e+="]",M["camera-locks"]=JSON.parse(e)}if(m&&"HSPC"===s&&(M["model-transform"]=m.toJsonString()),void 0!==C&&C.length>0&&(M["identity-metadata"]=C),p&&(M.parent=p),this._eventManager&&this._eventManager.onTelemetry(r.Telemetry.getTelemetryJson(r.Telemetry.getModelTypeTelemetry(this.getModelType(s),!0),n.MCD_ENUM.TelemetryEventType.Feature,n.MCD_ENUM.TelemetryMessageType.Discrete)),this._jsonModelList.push(M),e){const e={};if(e["model-list"]=this._jsonModelList,void 0!==C&&C.length>0&&(e["identity-metadata"]=C),!g){const i=this.accumulateModelView(this._jsonModelList);i&&(e["model-range"]=JSON.parse(i.toJsonString()));let s=this.getFirstCameraSettings(this._jsonModelList,"camera-projection");s&&(e["camera-projection"]=s),s=this.getFirstCameraSettings(this._jsonModelList,"camera-heading"),s&&(e["camera-heading"]=s),s=this.getFirstCameraSettings(this._jsonModelList,"camera-locks"),s&&(e["camera-locks"]=s),this._modularCoreDisplay.modelName=t}const i=JSON.stringify(e);this._modularCoreDisplay.openModel(i),this._documentData=i,this._jsonModelList=[],null!==this._modularCoreDisplay.materials&&(this._materialAccent=new l.MaterialAccent(this._modularCoreDisplay))}return!0}close(e){return s(this,void 0,void 0,(function*(){if(!this._modularCoreDisplay||!e)return!1;const t=yield this._modularCoreDisplay.get("Models","");if(t){const i=JSON.parse(t);if(i.hasOwnProperty(e)&&i[e].hasOwnProperty("model-type")){const t=i[e]["model-type"];this._eventManager&&this._eventManager.onTelemetry(r.Telemetry.getTelemetryJson(r.Telemetry.getModelTypeTelemetry(this.getModelType(t),!1),n.MCD_ENUM.TelemetryEventType.Feature,n.MCD_ENUM.TelemetryMessageType.Discrete))}}return this._modularCoreDisplay.closeModel(e),this._documentData="",!0}))}getModelType(e){return"edges"===e.toLowerCase()?n.MCD_ENUM.Target.EDGES:"hspc"===e.toLowerCase()?n.MCD_ENUM.Target.HSPC:"3dtiles"===e.toLowerCase()?n.MCD_ENUM.Target.TILES:n.MCD_ENUM.Target.PARAMETRICS}refresh(e){if(!this._modularCoreDisplay||e.length<1)return!1;const t={};return t.Models=e,this._modularCoreDisplay.reset("Models",JSON.stringify(t)),this._eventManager&&this._eventManager.onTelemetry(r.Telemetry.getTelemetryJson(n.MCD_ENUM.TelemetryEventName.RefreshCommand,n.MCD_ENUM.TelemetryEventType.Feature,n.MCD_ENUM.TelemetryMessageType.Discrete)),!0}selectObject(e,t=!1,i,n,a){return s(this,void 0,void 0,(function*(){if(!this._modularCoreDisplay||void 0===e)return!1;let s="";return s=void 0===i?'"Range":{ "min":{"x":0,"y":0,"z":0 }, "max":{"x":0,"y":0,"z":0 } }':'"Range":'+i.toJsonString(),yield this._modularCoreDisplay.selectObjectCore(e,t,s,n,a),!0}))}batchSelect(e,t,i=!1){return s(this,void 0,void 0,(function*(){if(!this._modularCoreDisplay||void 0===e||0===e.length)return!1;const s=[],n=[];for(let t=0;t<e.length;t++){const i=e[t];s.push(i.id),n.push(i.range)}return yield this._modularCoreDisplay.addBatchToSelection(s,n,t,i),!0}))}batchDeselect(e,t){return s(this,void 0,void 0,(function*(){if(!this._modularCoreDisplay||void 0===e||0===e.length)return!1;const i=[];for(let t=0;t<e.length;t++)i.push(e[t]);return this._modularCoreDisplay.removeBatchFromSelection(i,t),!0}))}setCachePath(e){return!(!this._modularCoreDisplay||!e||(this._modularCoreDisplay.setCachePathCore(e),0))}snapshot(e=0,t=0,i=0,s=0,n=""){if(!this._modularCoreDisplay)return!1;const a=JSON.stringify({x:e,y:t,width:i,height:s,targetComposite:n});return this._modularCoreDisplay.snapshotCore(a),!0}loadMaterial(e,t){if(!e||!t||e.length<=0||t.length<=0||!this._modularCoreDisplay.materials)return!1;const i=this._modularCoreDisplay.materials.tryFindMaterialByName(t,void 0),s=i.material;if(!i.value)return!1;const n={};n["target-name"]=e,n.definition=s.toMaterialDef();const a={};return a.CreateMaterial=n,this._modularCoreDisplay.create("Material",JSON.stringify(a)),!0}defineMaterial(e){return!!(this._modularCoreDisplay&&e&&this._modularCoreDisplay.materials)&&(this._modularCoreDisplay.materials.add(e.name,e),this.loadMaterial(this._modularCoreDisplay.modelName,e.name))}applyMaterialToSelectedObjects(e,t,i){if(!e||!t||!i||e.length<=0||t.length<=0||i.length<=0||!this._modularCoreDisplay.materials)return!1;const s=this._modularCoreDisplay.materials.tryFindMaterialByName(t,void 0);if(!s.value)return!1;const n={};n["material-id"]=s.material.id,n["object-ids"]=e;const a={};a.materialIdAndObjIds=n,a["target-name"]=i;const o={};return o.ApplyMaterialToObjects=a,this._modularCoreDisplay.set("Material",JSON.stringify(o)),!0}applyMaterialToModel(e){if(!e||e.length<=0||!this._modularCoreDisplay.materials)return!1;const t=this._modularCoreDisplay.materials.tryFindMaterialByName(e,void 0);if(!t.value)return!1;const i={};i.materialId=t.material.id,i["target-name"]=this._modularCoreDisplay.modelName;const s={};return s.ApplyMaterialToModel=i,this._modularCoreDisplay.set("Material",JSON.stringify(s)),!0}removeMaterialFromObjects(e,t){if(!e||!t||e.length<=0||t.length<=0)return!1;const i={};i["object-ids"]=e;const s={};s.objectIds=i,s["target-name"]=t;const n={};return n.RemoveMaterialFromObjects=s,this._modularCoreDisplay.set("Material",JSON.stringify(n)),!0}removeMaterialFromModel(e){const t={};t["target-name"]=e;const i={};i.RemoveMaterialFromModel=t,this._modularCoreDisplay.set("Material",JSON.stringify(i))}setSelectionColor(e,t){if(!e||!t)return;const i={};i["selection-colorA"]=[e.red,e.green,e.blue,e.alpha],i["selection-colorB"]=[t.red,t.green,t.blue,t.alpha];const s={};s["target-name"]=this._modularCoreDisplay.modelName,s.Color=i,this._modularCoreDisplay.set("Selection",JSON.stringify(s))}resetSelectionColor(){const e={};e["target-name"]=this._modularCoreDisplay.modelName,e.Color=!0,this._modularCoreDisplay.reset("Selection",JSON.stringify(e))}hideObjects(e,t){if(!this._modularCoreDisplay||!e)return;const i={};i["target-name"]=t||this._modularCoreDisplay.modelName,i.AddToHidden=e,this._modularCoreDisplay.set("Hidden",JSON.stringify(i))}showObjects(e,t=!1,i){if(!this._modularCoreDisplay||!e)return;const s={};s["target-name"]=i||this._modularCoreDisplay.modelName,t?0!==e.length?s.AddToIsolate=e:s.RemoveFromIsolate=e:s.RemoveFromHidden=e,this._modularCoreDisplay.set("Hidden",JSON.stringify(s))}toggleModelVisibility(e,t){if(!this._modularCoreDisplay)return;const i={};i[t]={hidden:!e},this._modularCoreDisplay.set("Models",JSON.stringify(i))}getSelectedObjectsAndRange(){return s(this,void 0,void 0,(function*(){if(!this._modularCoreDisplay)return;const e=yield this._modularCoreDisplay.get("Selection",JSON.stringify({})),t=[[],new a.MCDRange(0,0,0,0,0,0)],i=JSON.parse(e);if(!i)return;if(!i.Selection)return;const s=[];for(let n=0;n<i.Selection.length;n++){const e={targetName:"",ids:[]};e.targetName=i.Selection[n]["target-name"],e.ids=i.Selection[n].IDs,s.push(e)}return t[0]=s,t[1]=new a.MCDRange(i.Range.min.x,i.Range.min.y,i.Range.min.z,i.Range.max.x,i.Range.max.y,i.Range.max.z),t}))}clearSelectionList(){return s(this,void 0,void 0,(function*(){return!!this._modularCoreDisplay&&(yield this._modularCoreDisplay.selectObjectCore(-1),!0)}))}startMonitoring(){this._modularCoreDisplay.startMonitoring()}stopMonitoring(){this._modularCoreDisplay.stopMonitoring()}getPerformanceData(e){return this._modularCoreDisplay.getPerformanceData(e)}getRenderEffects(){return s(this,void 0,void 0,(function*(){return this._modularCoreDisplay.get("RenderEffects","")}))}setRenderEffects(e){this._modularCoreDisplay.set("RenderEffects",e)}getBearing(){return s(this,void 0,void 0,(function*(){const e=yield this._modularCoreDisplay.get("Bearing",""),t=JSON.parse(e);return t.hasOwnProperty("bearing")?t.bearing:-1}))}setBearing(e,t,i=!1){let s=!1;const n={};return n.bearing=e,n.target=t,s=this._modularCoreDisplay.set("Bearing",JSON.stringify(n))===this._modularCoreDisplay.MCD_OK_J,i&&this._modularCoreDisplay.commitCameraChanges(1),s}getPitch(){return s(this,void 0,void 0,(function*(){const e=yield this._modularCoreDisplay.get("Pitch",""),t=JSON.parse(e);return t.hasOwnProperty("pitch")?t.pitch:0}))}setPitch(e,t,i=!1){let s=!1;const n={};return n.pitch=e,n.target=t,s=this._modularCoreDisplay.set("Pitch",JSON.stringify(n))===this._modularCoreDisplay.MCD_OK_J,i&&this._modularCoreDisplay.commitCameraChanges(1),s}accumulateModelView(e){const t=new a.MCDRange;let i=!1;for(let s=0;s<e.length;s++)e[s]["model-range"]&&(t.accumilate(e[s]["model-range"].min.x,e[s]["model-range"].min.y,e[s]["model-range"].min.z,e[s]["model-range"].max.x,e[s]["model-range"].max.y,e[s]["model-range"].max.z),i=!0);if(i)return t}getFirstCameraSettings(e,t){let i,s=!1;for(let n=0;n<e.length;n++)if(e[n][t]){i=e[n][t],s=!0;break}if(s)return i}setLocale(e){this._mcdLocalize=new o.MCDLocalize(e)}getLocaleString(e,t){return this._mcdLocalize?this._mcdLocalize.getLocaleString(e,t):t}getLocaleDateString(e){return this._mcdLocalize?this._mcdLocalize.getLocaleDateString(e):e.toDateString()}getLocaleNumberString(e){return this._mcdLocalize?this._mcdLocalize.getLocaleNumberString(e):e.toString()}logPerformanceEvent(e){this._modularCoreDisplay.set("LogPerfEvent",'{"event" : '+e+"}")}locate(e,t){return null!==this._modularCoreDisplay&&(this._modularCoreDisplay.locateCore(e,t),!0)}getDrawingMonikerIdData(e,t){return s(this,void 0,void 0,(function*(){return this._modularCoreDisplay.get("ObjectIdentity",JSON.stringify({monikers:t,"target-name":e}))}))}getDrawingOidPathIdData(e,t){return s(this,void 0,void 0,(function*(){return this._modularCoreDisplay.get("ObjectIdentity",JSON.stringify({"oid-paths":t,"target-name":e}))}))}getDrawingRenderIdData(e,t){return s(this,void 0,void 0,(function*(){return this._modularCoreDisplay.get("ObjectIdentity",JSON.stringify({"render-ids":t,"target-name":e}))}))}}},cb4p:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("HtSf");t.WalkingView=class extends s.WalkingViewBase{constructor(e,t){if(super(),this._mcd=null,this._cam=null,this._mcd=e,this._cam=t,!this._mcd)throw new Error("The MCD provided was NULL.");if(!this._cam)throw new Error("The CameraMotion provided was NULL")}}},cdXO:function(e,t,i){"use strict";i.d(t,"a",(function(){return v}));var s=i("tk/3"),n=i("C2rS"),a=i("ADS0"),o=i("E9dD"),r=i("LRne"),l=i("Cfvw"),h=i("cp0P"),c=i("eIep"),_=i("lJxs"),d=i("JIr8"),m=i("Z9D8"),u=i("HLw3"),p=i("dEBh"),g=i("tCxB"),C=i("A3La"),M=i("Ejbi"),E=i("BltP"),P=i("ONOH"),y=i("xVJr"),D=i("fXoL");let v=(()=>{class e{constructor(e,t,i,s,n,a,o,r,l){this.odataService=e,this.loggingService=t,this.windowService=i,this.batchRequestFactory=s,this.authClientFactory=n,this.httpClient=a,this.workspaceDefinitionService=o,this.configService=r,this.sdaTranslateService=l,this.DEBUG_COMPLETE_QUERY="_DEBUG_Complete",this.gdsQueryUrls={}}getGDSConnectionUrl(e,t){let i;return i=e.data&&e.data.hasOwnProperty("GDSConnectionUrl")?Object(r.a)(e.data.GDSConnectionUrl):this.odataService.get(`Objects('${e.obid}')?$select=GDSConnectionUrl`,e.config).pipe(Object(c.a)(e=>Object(r.a)(e.value.GDSConnectionUrl))),i.pipe(Object(c.a)(i=>this.resolveGdsPlantAndQuery(e,i,e.config,t)))}uidsToGraphicOidsAndTags(e,t){const i="$top="+e.length,s=this.batchRequestFactory.createBatchRequest();return e.forEach(e=>{const n=`UID eq '${encodeURIComponent(e)}'`;s.addGetRequest(`Objects?$filter=(${n})and contains(Interfaces,'IGraphics3D')&${i}&$select=OBID,Name,Config,Graphics3DGUID`,!0,t)}),s.execute().pipe(Object(c.a)(e=>{const t={};return e.forEach(e=>{var i;(null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.value.length)>0&&e.data.value.forEach(e=>{const i=e.Graphics3DGUID;t.hasOwnProperty(i)||(t[i]=e)})}),Object(r.a)(t)}))}getTagsFromGraphics(e,t){const i=this.getGraphics3DGUIDClause(e);return this.odataService.get(`Objects?$filter=contains(Interfaces,'IGraphics3D')and (${i})`,t).pipe(Object(c.a)(e=>Object(r.a)(e.value)))}onSearch(e,t,i){const s={graphics:[],name:[],totalCount:void 0,displayCount:void 0};return this.odataService.get("Objects?$filter=contains(Interfaces,'IGraphics3D')and "+t+i+"&$select=Graphics3DGUID,Name&$count=true",e).pipe(Object(_.a)(e=>(s.totalCount=e.count,s.displayCount=e.value.length,s.displayCount>0&&this.addGoidsForSearch(s.graphics,e.value,s.name),s)))}filterTagNames(e,t,i){return this.odataService.get(`Objects?$filter=contains(Interfaces,'IGraphics3D')and ${t}&${i}&$select=Name`,e).pipe(Object(_.a)(e=>{const t=[];return e.value.length>0&&e.value.forEach(e=>{t.push(e.Name)}),t}))}identityToMcdObjectSelection(e){const t=new o.MCDObjectSelection(e.Name);return t.Reset(e.RenderId,e.Range),t}monikersToIdentities(e,t){return Object(l.a)(e.LookupByNames(t)).pipe(Object(c.a)(e=>{const t={};return e&&e.forEach(e=>{const i=e.Name.slice(1,-1);t.hasOwnProperty(i)?t[i].push(e):t[i]=[e]}),Object(r.a)(t)}),Object(d.a)(e=>Object(r.a)({})))}renderIdToMoniker(e,t,i){return null===i&&(i=void 0),Object(l.a)(e.LookupById(t,i)).pipe(Object(c.a)(e=>Object(r.a)(e?e.Name:void 0)))}getGdsAuthToken(e){const t=Settings.authorization.usePKCE,i=this.authClientFactory.createAuthenticationClient({client:Settings.authorization.clientId,redirectUri:Settings.authorization.redirectUri,sessionFramePath:"_session.html",postLogoutRedirectUri:Settings.authorization.redirectUri,usePKCE:t||!1,dummyClientSecret:t?Settings.authorization.dummyClientSecret:void 0}),s={mode:a.d.Silent,serviceUri:this.getGdsServiceUri(e),requestOptions:{credentials:"include"},state:this.windowService.Window.btoa(this.windowService.Window.location.hostname),resource:!0};return Object(l.a)(i.authenticate(s)).pipe(Object(d.a)(e=>{if("interaction_required"===e.error||"login_required"===e.error)return s.mode=a.d.Popup,Object(l.a)(i.authenticate(s)).pipe(Object(d.a)(e=>{var t,s;if(i.hasOwnProperty("popup")){const e=i.popup;(null===(t=null==e?void 0:e.overlay)||void 0===t?void 0:t.style)&&(e.overlay.style.display="none")}throw this.loggingService.info("GDS authentication error "+e.message),(null===(s=i.popup)||void 0===s?void 0:s.element)?new m.a(e):new m.a(this.sdaTranslateService.get("VIEW_MARKUP_GDS_POPUPS","Popups must be enabled. Please see Graphic Data Service troubleshooting for help."))}));throw this.loggingService.info("GDS authentication error "+e.message),new m.a(e)}),Object(c.a)(e=>Object(r.a)(e?e.accessToken:void 0)))}postGdsQuery(e,t){const i=this.getGdsUrlQuery(e);if(i&&i!==this.DEBUG_COMPLETE_QUERY){const n=this.getPostUrl(e);if(n){const e={Name:i,Scope:Settings.odata.url+"/RunAdvanced3DFilterForGraphicsGUIDs"};let a=new s.d;a=a.append("Authorization","Bearer "+t),a=a.append("Content-Type","application/json");const o={headers:a,withCredentials:!0};return this.httpClient.post(n,JSON.stringify(e),o).pipe(Object(d.a)(e=>{this.loggingService.info(`Error posting GDS query with URL ${n}: ${e.message}`);const t=new m.a(e,e.message);if(404===e.status||400===e.status){const e=new m.a(this.sdaTranslateService.get("VIEW_MARKUP_INVALID_GDS_CONFIG","Ensure GDS is configured and running. Please see Graphic Data Service troubleshooting for help."));throw e.innerException=t,e}throw t}))}}return Object(r.a)(void 0)}getGdsConnection(e){return this.odataService.get(`Objects?$filter=(UID eq '${e}') and contains(Interfaces,'ISPFConfigurationItem')&$expand=SPFGDSConnectionConfigItem_21`,e,!0,void 0,void 0,!0).pipe(Object(c.a)(t=>{let i;if(t&&t.value&&t.value.length>0){const s=t.value[0].SPFGDSConnectionConfigItem_21;if(s&&(Array.isArray(s)?s.length>0&&(i=s[0]):i=s),!i){const t=this.getParentConfig(e);if(t)return this.getGdsConnection(t)}}return Object(r.a)(i)}))}getTerminatedTags(e){return this.getTerminatedTagCount(e).pipe(Object(c.a)(t=>this.odataService.get("Objects?$filter=contains(Interfaces,'ISPFMergableItem')and SPFMergeStatus eq 'e1TerminatedAtConfig' and contains(Interfaces,'IGraphics3D')&$select=Name,OBID,Graphics3DGUID&$top="+t,e,!1,void 0,new s.d({FilterMarkedForDeleteObjectsForAPICalls:"false"})).pipe(Object(c.a)(e=>Object(r.a)(null==e?void 0:e.value)))))}getFilterUidFromGdsUrl(e){const t=this.getGdsUrlQuery(e);return t?this.workspaceDefinitionService.getWorkspaceDefinitionFilter(t):Object(r.a)(void 0)}getGdsQuery(e){let t;const i=e.match(/.*Queries\('(.*)'\)/i);if(i&&2===i.length){const e=i[1];e&&(t=decodeURIComponent(e))}return t}getWorkspaceDefinitionFilter(e,t){return this.odataService.get(`Objects?$filter=contains(Interfaces,'IGDSWorkspaceDefinition')and Name eq '${e}'&$select=WorkspaceDefinitionName`,t).pipe(Object(c.a)(e=>{var t;let i;return(null===(t=null==e?void 0:e.value)||void 0===t?void 0:t.length)>0&&(i=e.value[0].WorkspaceDefinitionName),Object(r.a)(i)}))}getFilterByUidOrName(e,t){return this.odataService.get(`Objects?$filter=contains(Interfaces,'ISDxiHubAdvanced3DFilter')and (UID eq '${e}' or Name eq '${e}')`,t).pipe(Object(c.a)(e=>{var t;let i;return(null===(t=null==e?void 0:e.value)||void 0===t?void 0:t.length)>0&&(i=e.value[0]),Object(r.a)(i)}))}getTagsInHierarchy(e,t,i){const s=`Objects('${e}')?$expand=PBSHierarchy_12($levels=max;$top=1000;$select=OBID,Name,Config,Graphics3DGUID)`,n=[this.odataService.get(`Objects?$filter=OBID eq '${e}' and contains(Interfaces,'IGraphics3D')&$select=OBID,Name,Config,Graphics3DGUID`,t),this.odataService.get(s,t)];return Object(h.a)(n).pipe(Object(c.a)(e=>{var t;const s=[];return 2===(null==e?void 0:e.length)&&((null===(t=e[0].value)||void 0===t?void 0:t.length)>0&&this.addTagsInHierarchy(s,e[0].value[0],i),e[1].value&&this.addTagsInHierarchy(s,e[1].value,i)),Object(r.a)(s)}))}getHierarchyAncestorNodes(e,t){const i=""+e.map(e=>`OBID eq '${e}'`).join(" or "),s=["IBreakdown","IRun","INetwork"],n=[...s,"IEquipment"],a=""+s.map(e=>`contains(Interfaces,'${e}')`).join("or "),o=""+n.map(e=>`contains(Interfaces,'${e}')`).join("or ");return this.odataService.get(`Objects?$filter=(${o})and(${i})&$expand=PBSHierarchy_21($levels=max;$top=1000;$select=Name,OBID,Class,Config;$filter=${a};$orderby=Name)`,t).pipe(Object(c.a)(e=>{var t;const i={};return(null===(t=null==e?void 0:e.value)||void 0===t?void 0:t.length)>0&&e.value.forEach(e=>{this.addNodeWithChild(i,e)}),Object(r.a)(i)}))}getHierarchyDescendants(e,t,i,s){const n=i||"max",a=s?s.toString():"1000",o=""+["IBreakdown","IRun","INetwork","IEquipment"].map(e=>`contains(Interfaces,'${e}')`).join("or "),l=""+e.map(e=>`OBID eq '${e}'`).join(" or ");return this.odataService.get(`Objects?$filter=(${o})and(${l})&$expand=PBSHierarchy_12($levels=${n};$top=${a};$select=Name,OBID,Class,Config;$filter=${o};$orderby=Name)`,t).pipe(Object(c.a)(e=>{var t;let i;return(null===(t=null==e?void 0:e.value)||void 0===t?void 0:t.length)>0&&(i=this.getDescendantNodes(e.value)),Object(r.a)(i)}))}findTreeNodeById(e,t){var i;if(e.Id===t)return e;{let s;if((null===(i=e.Children)||void 0===i?void 0:i.length)>0){let i;e.Children.some(e=>(i=this.findTreeNodeById(e,t),!!i&&(s=i,!0)))}return s}}getPlantForConfig(e){var t;let i;const s=null===(t=this.configService.getConfigLevel([e])[0])||void 0===t?void 0:t.value;return s===E.a.PLANT?i=e:s===E.a.PROJECT&&(i=this.getParentConfig(e)),i}getGdsConnectionDefaultFilter(e,t){return this.odataService.get(`Objects('${e.obid}')?$expand=SPFGDSConnectionDefaultAdvanced3DFilter_12`,t).pipe(Object(c.a)(e=>{var t;return Object(r.a)(null===(t=null==e?void 0:e.value)||void 0===t?void 0:t.SPFGDSConnectionDefaultAdvanced3DFilter_12)}))}getDescendantNodes(e){return e.map(e=>({Id:e.OBID,Name:e.Name,Class:e.Class,Config:e.Config,Children:this.getDescendantNodes(e.PBSHierarchy_12)}))}addNodeWithChild(e,t,i){var s;const n=t.OBID;let a;e.hasOwnProperty(n)?a=e[n]:(a={Id:t.OBID,Name:t.Name,Class:t.Class,Config:t.Config,Children:[],Parent:void 0},e[n]=a),i&&(i.Parent=a,a.Children.some(e=>e.Id===i.Id)||a.Children.push(i)),(null===(s=t.PBSHierarchy_21)||void 0===s?void 0:s.length)>0&&this.addNodeWithChild(e,t.PBSHierarchy_21[0],a)}getPostUrl(e){let t;const i=e.match(/(.*Queries)/i);return i&&2===i.length&&(t=i[1]),t}getGraphics3DGUIDClause(e){let t;const i=e.map(e=>{let t=e;return 0===t.indexOf("{")&&(t=t.slice(1,-1)),`Graphics3DGUID eq '${t}'`});return i.length>0&&(t=i.join("or ")),t}addGoidsForSearch(e,t,i){const s=[];t.forEach(e=>{s.push(e.Name+"@@SPF@@"+e.Graphics3DGUID)}),s.sort(),s.forEach(t=>{const s=t.split("@@SPF@@");s[0]&&s[1]&&(i.push(s[0]),e.push(s[1]))})}getGdsServiceUri(e){let t=e;const i=e.toLowerCase().indexOf("/plants");return i>0&&(t=e.substr(0,i)),t}resolveGdsPlantAndQuery(e,t,i,s){return this.resolveGdsPlant(t,i).pipe(Object(c.a)(t=>s?this.replaceFilterWithWorkspaceDefinition(t,s,i):this.getGdsUrlWithWorkspaceDefinition(e,t,i)))}getGdsUrlParameter(e,t){let i;const s=e.match(t);if(s&&2===s.length){const e=s[1];if(e)try{i=decodeURIComponent(e)}catch(n){i=e}}return i}replaceGdsUrlParameter(e,t,i){let s;const n=encodeURIComponent(i),a=e.match(t);return s=a&&4===a.length?a[2]===n?e:`${a[1]}${n}${a[3]}`:e,s}getGdsUrlQuery(e){return this.getGdsUrlParameter(e,/.*Queries\('(.*?)'\)/i)}replaceGdsUrlQuery(e,t){return this.replaceGdsUrlParameter(e,/(.*Queries\(')(.*?)('\).*)/i,t)}replaceOrAddGdsUrlQuery(e,t,i){if(this.getGdsUrlQuery(e))return Object(r.a)(this.replaceGdsUrlQuery(e,t));{let s=`${e}/Queries('${encodeURIComponent(t)}')`;return this.getGdsQueryUrls(s,i).pipe(Object(c.a)(e=>((null==e?void 0:e.length)>0?s=e[0]:s+="/myVR(Aspect=0,Device=0)",Object(r.a)(s))))}}getGdsUrlPlant(e){return this.getGdsUrlParameter(e,/.*Plants\('(.*?)'\)/i)}replaceGdsUrlPlant(e,t){return this.replaceGdsUrlParameter(e,/(.*Plants\(')(.*?)('\).*)/i,t)}getParentConfig(e){const t=this.configService.getConfigByUid(e);return null==t?void 0:t.ParentUID}resolveGdsPlant(e,t){const i=this.getPlantForConfig(t);if(!i)throw new Error(this.sdaTranslateService.getFormatted("NO_GDSPLANT_FOR_CONFIG-CONFIG","No valid GDS plant for config {0}",[t]));const s="_"+i,n=this.getGdsUrlPlant(e);let a=e;if(!n)throw new Error(this.sdaTranslateService.get("NO_PLANTS_IN_GDSCONNECTION","No Plants entry in GDS Connection URL"));if(!n.endsWith(s))if(n.indexOf("_PL_")>0){const t=n.indexOf("_PL_");if(t>0){const s=`${n.substr(0,t)}_${i}`;a=this.replaceGdsUrlPlant(e,s)}}else a=this.replaceGdsUrlPlant(e,`${n}_${i}`);return Object(r.a)(a)}replaceFilterWithWorkspaceDefinition(e,t,i){return this.workspaceDefinitionService.ensureWorkspaceDefinitionForFilter(t,i).pipe(Object(c.a)(t=>t?this.replaceOrAddGdsUrlQuery(e,t.Name,!0):Object(r.a)(e)))}getGdsUrlWithWorkspaceDefinition(e,t,i){const s=this.getGdsUrlQuery(t);return s===this.DEBUG_COMPLETE_QUERY?Object(r.a)(t):(s?this.getGdsFilterUid(s,i):this.getGdsConnectionDefaultFilterUid(e,i)).pipe(Object(c.a)(n=>{if(n)return this.replaceFilterWithWorkspaceDefinition(t,n,i);throw new Error(this.sdaTranslateService.getFormatted("NO_FILTER_WITH_NAME-FILTERNAME","No view filter found with name {0}",[s||e.name]))}))}getGdsQueryUrls(e,t){return this.getGdsAuthToken(e).pipe(Object(c.a)(i=>{let n;return n=t?this.postGdsQuery(e,i):Object(r.a)(void 0),n.pipe(Object(c.a)(()=>{const t=e.toLowerCase();if(this.gdsQueryUrls.hasOwnProperty(t))return Object(r.a)(this.gdsQueryUrls[t]);const n=e+"/Urls";let a=new s.d;return a=a.append("Authorization","Bearer "+i),this.httpClient.get(n,{headers:a,withCredentials:!0}).pipe(Object(c.a)(e=>{var i;if((null===(i=null==e?void 0:e.value)||void 0===i?void 0:i.length)>0){const i=e.value.map(e=>e.URL);return this.gdsQueryUrls[t]=i,Object(r.a)(i)}return Object(r.a)([])}))}))}))}getGdsFilterUid(e,t){return this.odataService.get(`Objects?$filter=(Name eq '${e}')and contains(Interfaces,'ISDxiHubAdvanced3DFilter')`,t).pipe(Object(c.a)(e=>{var t;return(null===(t=null==e?void 0:e.value)||void 0===t?void 0:t.length)>0?Object(r.a)(e.value[0].UID):Object(r.a)(void 0)}))}getTerminatedTagCount(e){return this.odataService.get("Objects?$filter=contains(Interfaces,'ISPFMergableItem')and SPFMergeStatus eq 'e1TerminatedAtConfig' and contains(Interfaces,'IGraphics3D')&$count=true&$top=0",e,!1,void 0,new s.d({FilterMarkedForDeleteObjectsForAPICalls:"false"})).pipe(Object(c.a)(e=>Object(r.a)(e.count)))}addTagsInHierarchy(e,t,i,s){if(void 0===s){let e;t&&(e=this.findTreeNodeById(i,t.OBID)),s=e||i}if(t.hasOwnProperty("Graphics3DGUID")){const i=t.Graphics3DGUID;i&&(e.push({OBID:t.OBID,Name:t.Name,Config:t.Config,Graphics3DGUID:i}),s.Graphics?s.Graphics.add(i):s.Graphics=new Set([i]))}if(t.hasOwnProperty("PBSHierarchy_12")){const n=t.PBSHierarchy_12;if((null==n?void 0:n.length)>0){const t=s;n.forEach(n=>{const a=this.findTreeNodeById(s,n.OBID);a&&(s=a),this.addTagsInHierarchy(e,n,i,s),s=t})}}}getGdsConnectionDefaultFilterUid(e,t){return this.odataService.get(`Objects('${e.obid}')?$expand=SPFGDSConnectionDefaultAdvanced3DFilter_12($select=UID)`,t).pipe(Object(c.a)(i=>{var s,n;const a=null===(n=null===(s=null==i?void 0:i.value)||void 0===s?void 0:s.SPFGDSConnectionDefaultAdvanced3DFilter_12)||void 0===n?void 0:n.UID;return a?Object(r.a)(a):this.getGdsFilterUid(e.name,t)}))}}return e.\u0275fac=function(t){return new(t||e)(D.dc(C.a),D.dc(g.a),D.dc(p.a),D.dc(u.a),D.dc(n.b),D.dc(s.a),D.dc(y.a),D.dc(P.a),D.dc(M.a))},e.\u0275prov=D.Ob({token:e,factory:e.\u0275fac}),e})()},fx83:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("Khlq");t.MCDKey=class{constructor(e,t,i,n,a,o,r){this._keyCode=-1,this._keyEventType=s.MCD_ENUM.KeyEventType.KEY_DOWN,this._isCtrl=!1,this._isShift=!1,this._isAlt=!1,this._isMeta=!1,this._keyCode=e,this._keyEventType=t,this._callback=i,void 0!==n&&(this._isCtrl=n),void 0!==a&&(this._isShift=a),void 0!==o&&(this._isAlt=o),void 0!==r&&(this._isMeta=r),17===this._keyCode&&(this._isCtrl=!0),16===this._keyCode&&(this._isShift=!0),18===this._keyCode&&(this._isAlt=!0),91!==this._keyCode&&93!==this._keyCode||(this._isMeta=!0)}get keyCode(){return this._keyCode}get keyEventType(){return this._keyEventType}get callback(){return this._callback}get isCtrl(){return this._isCtrl}get isShift(){return this._isShift}get isAlt(){return this._isAlt}get isMeta(){return this._isMeta}getMappingKey(){let e="";return this._isCtrl&&(e+="ctrl_"),this._isShift&&(e+="shift_"),this._isAlt&&(e+="alt_"),this._isMeta&&(e+="meta_"),e+=this._keyEventType,e+=this._keyCode.toString(),e}}},hh6j:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserAndWebGLInfo=class{constructor(e){this._gl=e}getGLString(e){const t=this._gl.getParameter(e);return t?t.toString():"0"}getBrowserAndWebGLInformation(){const e=this._gl,t=JSON.parse("{}");if(t.Platform=this.getBrowserInformation(),null!==e){const i=this.getUnmaskedInfo(),s={"GL Version":e.getParameter(e.VERSION),"Shading Language Version":e.getParameter(e.SHADING_LANGUAGE_VERSION),"GL Vendor":e.getParameter(e.VENDOR),"GL Renderer":e.getParameter(e.RENDERER),"Unmasked Vendor":i?i.vendor:"Not available","Unmasked Renderer":i?i.renderer:"Not available","Anti Alias":e.getContextAttributes().antialias?"Available":"Not available",Angle:this.getAngle(e)};t["GL Information"]=s;const n={"Red Bits":this.getGLString(e.RED_BITS),"Green Bits":this.getGLString(e.GREEN_BITS),"Blue Bits":this.getGLString(e.BLUE_BITS),"Alpha Bits":this.getGLString(e.ALPHA_BITS),"Depth Bits":this.getGLString(e.DEPTH_BITS),"Stencil Bits":this.getGLString(e.STENCIL_BITS),"Max Render Buffer Size":this.getGLString(e.MAX_RENDERBUFFER_SIZE),"Viewport Dimension":this.describeRange(e.getParameter(e.MAX_VIEWPORT_DIMS))};t["Frame Buffer"]=n;const a={"Max Varying Vectors":this.getGLString(e.MAX_VARYING_VECTORS),"Max Vertex Attributes":this.getGLString(e.MAX_VERTEX_ATTRIBS),"Max Vertex Texture Image Units":this.getGLString(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),"Max Vertex Uniform Vectors":this.getGLString(e.MAX_VERTEX_UNIFORM_VECTORS)};t["Vertex Shader"]=a;const o={"Max Fragment Uniform Vectors":this.getGLString(e.MAX_FRAGMENT_UNIFORM_VECTORS),"Max Texture Image Units":this.getGLString(e.MAX_TEXTURE_IMAGE_UNITS),"Float/Int Precision":this.getFloatIntPrecision(e)};t["Fragment Shader"]=o;const r={"Max Combined Texture Image Units":this.getGLString(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),"Max CubeMap Texture Size":this.getGLString(e.MAX_CUBE_MAP_TEXTURE_SIZE),"Max TextureSize":this.getGLString(e.MAX_TEXTURE_SIZE),"Max Anisotropy":this.getMaxAnisotropy()};t.Textures=r;const l={"Aliased Line Width Range":this.describeRange(e.getParameter(e.ALIASED_LINE_WIDTH_RANGE)),"Aliased Point Size Range":this.describeRange(e.getParameter(e.ALIASED_POINT_SIZE_RANGE))};t.Rasterizer=l}let i=JSON.parse("{}");i=this.sortJsonByKey(t);for(const s in i)"object"==typeof i[s]&&(i[s]=this.sortJsonByKey(i[s]));return JSON.stringify(i)}sortJsonByKey(e){try{return Object.keys(e).sort().reduce((t,i)=>Object.assign({},t,{[i]:e[i]}),{})}catch(t){return console.warn("Json not sorted because of ERROR: "+t),e}}getUnmaskedInfo(){const e=JSON.parse("{}"),t=this._gl.getExtension("WEBGL_debug_renderer_info");return null!==t&&(e.renderer=this._gl.getParameter(t.UNMASKED_RENDERER_WEBGL),e.vendor=this._gl.getParameter(t.UNMASKED_VENDOR_WEBGL)),e}getAngle(e){const t=this.describeRange(e.getParameter(e.ALIASED_LINE_WIDTH_RANGE));let i="No";return("Win32"===navigator.platform||"Win64"===navigator.platform)&&"Internet Explorer"!==e.getParameter(e.RENDERER)&&"Microsoft Edge"!==e.getParameter(e.RENDERER)&&t===this.describeRange([1,1])&&(i=this.isPowerOfTwo(e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS))&&this.isPowerOfTwo(e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS))?"Yes, D3D11":"Yes, D3D9"),i}isPowerOfTwo(e){return 0!==e&&0==(e&e-1)}describeRange(e){let t="";return t="["+e[0]+","+e[1]+"]",t}getMaxAnisotropy(){let e="n/a";const t=this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic");return t?(e=this.getGLString(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT),"0"===e&&(e="2"),e):e}getFloatIntPrecision(e){return 0!==e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision?"highp":"lowp"}getBrowserInformation(){navigator;const e=navigator.userAgent;let t,i,s,n=navigator.appName,a=""+parseFloat(navigator.appVersion),o=parseInt(navigator.appVersion,10);const r=JSON.parse("{}");return-1!==(i=e.indexOf("MSIE"))||e.match(/Trident\/7\./)||-1!==(i=e.indexOf("Edg"))?(n="Microsoft Internet Explorer",e.match(/Trident\/7\./)?a="11":-1!==(i=e.indexOf("Edg"))?(n="Microsoft Edge",a=e.substring(i+4)):-1!==(i=e.indexOf("Edge"))?(n="Microsoft Edge",a=e.substring(i+5)):a=e.substring(i+5)):-1!==(i=e.indexOf("Chrome"))||-1!==(i=e.indexOf("CriOS"))?(n="Chrome",a=e.match("CriOS")?e.substring(i+6):e.substring(i+7)):-1!==(i=e.indexOf("Firefox"))?(n="Firefox",a=e.substring(i+8)):-1!==(i=e.indexOf("Safari"))?(n="Safari",a=e.substring(i+7)):(t=e.lastIndexOf(" ")+1)<(i=e.lastIndexOf("/"))&&(n=e.substring(t,i),a=e.substring(i+1),n.toLowerCase()===n.toUpperCase()&&(n=navigator.appName)),-1!==(s=a.indexOf(";"))&&(a=a.substring(0,s)),-1!==(s=a.indexOf(" "))&&(a=a.substring(0,s)),o=parseInt(a,10),isNaN(o)&&(a=parseFloat(navigator.appVersion).toString(),o=parseInt(navigator.appVersion,10)),r["Platform Name"]="Browser",r["Browser Name"]=n,r.Version=a,r}}},hlJD:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i("o+o0");t.GDSModel=class{constructor(){this.concurrencyToken="",this.id="",this.name="",this.path="",this.alias="",this.queries=[]}},t.GDSModelQuery=class{constructor(){this.token="",this.id="",this.queryId="",this.name="",this.isUpToDate="",this.scope="",this.alias="",this.url="",this.propertiesURL=""}},t.GDSGraphicData=class{constructor(){this.concurrencyToken="",this.id="",this.moniker="",this.cleaned=""}},t.GDSWebApi=class{constructor(e){this._gdsModels=[],this._modelUrl="",this._gdsModels=new Array,this._modelUrl=e}getModelData(){return s(this,void 0,void 0,(function*(){if(void 0===this._modelUrl||this._modelUrl.length<=0)return this._gdsModels;const e=yield n.McdNetworkIO.fetchModelListWithGet(this._modelUrl+"/v1/Models/");this._gdsModels=this.buildModelDataList(e);for(let t=0;t<this._gdsModels.length;t++){const e=this._modelUrl+"v1/Models('"+this._gdsModels[t].id+"')/Queries",i=yield n.McdNetworkIO.fetchModelListWithGet(e);null!=i&&(this._gdsModels[t].queries=this.buildModelQueryList(this._gdsModels[t].id,i))}return this._gdsModels}))}buildModelDataList(e){if(null==e||void 0===e.value)return[];const t=[];for(let i=0;i<e.value.length;i++)t.push({id:e.value[i].Id,name:e.value[i].Name,alias:e.value[i].Alias,path:e.value[i].Path,concurrencyToken:e.value[i].ConcurrencyToken,queries:[]});return t}buildModelQueryList(e,t){if(null==t||void 0===t.value||""===e)return[];const i=[];for(let s=0;s<t.value.length;s++){const n={id:t.value[s].Id,alias:t.value[s].Alias,token:t.value[s].ConcurrencyToken,isUpToDate:t.value[s].IsUpToDate,name:t.value[s].Name,queryId:t.value[s].QueryId,scope:t.value[s].Scope,url:"",propertiesURL:""};n.url=this.buildUrlData(this._modelUrl,e,t.value[s].Name),i.push(n)}return i}buildUrlData(e,t,i){return void 0===e||void 0===t||void 0===i||e.length<=0||t.length<=0||i.length<=0?"":e+"v2/myVR(Model='"+t+"',Query='"+i+"',Device=0)"}fetchOIDforGraphicId(e,t,i){return s(this,void 0,void 0,(function*(){const s=e+"/RenderIds('"+t+"')";return yield n.McdNetworkIO.fetchResponseWithGet(s,i)}))}}},hvII:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("2T81"),n=i("Khlq");class a{constructor(){this._orientation=new s.Quat(0,0,0,0),this._eye=new s.Vec3(0,0,0),this._distance=0,this._fov=0,this._nearDistance=0,this._farDistance=0,this._orthographic=!1,this._nearClipLocked=!1,this._farClipLocked=!1,this._centerLocked=!1,this._elevationLocked=!1,this._pitchAngleLocked=!1,this._yawAngleLocked=!1,this._minDistBetweenEyeAndCenter=0}toJson(){const e=new Array(4),t=new Array(3);return e[0]=this._orientation.x,e[1]=this._orientation.y,e[2]=this._orientation.z,e[3]=this._orientation.w,t[0]=this._eye.x,t[1]=this._eye.y,t[2]=this._eye.z,JSON.stringify({orientation:e,eye:t,distance:this._distance,fieldOfView:this._fov,nearClipDistance:this._nearDistance,farClipDistance:this._farDistance,isOrthographic:this._orthographic,isNearClipDistanceLocked:this._nearClipLocked,isFarClipDistanceLocked:this._farClipLocked,isCenterLocked:this._centerLocked,isElevationLocked:this._elevationLocked,isPitchAngleLocked:this._pitchAngleLocked,isYawAngleLocked:this._yawAngleLocked,minDistanceBetweenEyeAndCenter:this._minDistBetweenEyeAndCenter})}fromJson(e){const t=JSON.parse(e);if(t.hasOwnProperty("orientation")&&t.hasOwnProperty("eye")&&t.hasOwnProperty("distance")&&t.hasOwnProperty("fieldOfView")&&t.hasOwnProperty("nearClipDistance")&&t.hasOwnProperty("farClipDistance")&&t.hasOwnProperty("isOrthographic")&&t.hasOwnProperty("isNearClipDistanceLocked")&&t.hasOwnProperty("isFarClipDistanceLocked")&&t.hasOwnProperty("isCenterLocked")&&t.hasOwnProperty("isElevationLocked")&&t.hasOwnProperty("isPitchAngleLocked")&&t.hasOwnProperty("isYawAngleLocked")&&t.hasOwnProperty("minDistanceBetweenEyeAndCenter")){const e=t.orientation;this._orientation.x=e[0],this._orientation.y=e[1],this._orientation.z=e[2],this._orientation.w=e[3];const i=t.eye;return this._eye.x=i[0],this._eye.y=i[1],this._eye.z=i[2],this._distance=t.distance,this._fov=t.fieldOfView,this._nearDistance=t.nearClipDistance,this._farDistance=t.farClipDistance,this._orthographic=t.isOrthographic,this._nearClipLocked=t.isNearClipDistanceLocked,this._farClipLocked=t.isFarClipDistanceLocked,this._centerLocked=t.isCenterLocked,this._elevationLocked=t.isElevationLocked,this._pitchAngleLocked=t.isPitchAngleLocked,this._yawAngleLocked=t.isYawAngleLocked,this._minDistBetweenEyeAndCenter=t.minDistanceBetweenEyeAndCenter,!0}return!1}clone(){const e=new a;return e._orientation=new s.Quat(this._orientation.x,this._orientation.y,this._orientation.z,this._orientation.w),e._eye=new s.Vec3(this._eye.x,this._eye.y,this._eye.z),e._distance=this._distance,e._fov=this._fov,e._nearDistance=this._nearDistance,e._farDistance=this._farDistance,e._orthographic=this._orthographic,e._nearClipLocked=this._nearClipLocked,e._farClipLocked=this._farClipLocked,e._centerLocked=this._centerLocked,e._elevationLocked=this._elevationLocked,e._pitchAngleLocked=this._pitchAngleLocked,e._yawAngleLocked=this._yawAngleLocked,e._minDistBetweenEyeAndCenter=this._minDistBetweenEyeAndCenter,e}}t.CamState=a,t.CameraJig=class{constructor(e){this.modularCoreDisplay=e,this._totalDelta=0,this._vecCameraDirection=new s.Vec3(0,0,0),this._finalEye=new s.Vec3(0,0,0),this._finalOrientaion=new s.Quat(0,0,0,0),this._finalDistance=0,this._flyToCameraSpeed=.5,this._flyToStartTime=0,this._flyToEventListeners=new Map,this._flyToPending=!1,this._glm=new s.GlMath,this._modularCoreDisplay=null,this._modularCoreDisplay=e}set flyToPending(e){if(this._flyToPending!==e){if(this._flyToPending=e,!0===e)return this.flyToStartEvent=this._flyToEventListeners[n.MCD_ENUM.FlyToEventNames.FLYTO_START_EVENT],this.flyToStartEvent(),void this.doFlyToAnimation();this.flyToEndEvent=this._flyToEventListeners[n.MCD_ENUM.FlyToEventNames.FLYTO_END_EVENT],this.flyToEndEvent()}}get flyToPending(){return this._flyToPending}addFlyToEventListener(e,t){this._flyToEventListeners[e]=t}deleteFlyToEventListener(e){this._flyToEventListeners.delete(e)}round(e,t){const i=Math.pow(10,t);return Math.round(e*i)/i}setAnimationParameter(){this._radiusDelta=this._from._distance-this._finalDistance;const e=this._glm.eulerAngles(this._from._orientation),t=this._glm.eulerAngles(this._to._orientation);if(this._pitchDelta=e.x-t.x,this._yawDelta=e.y-t.y,this._rollDelta=e.z-t.z,this._nearClipDelta=this._from._nearDistance-this._finalNearClip,this._farClipDelta=this._from._farDistance-this._finalFarClip,this._totalDelta=0,Math.abs(this._radiusDelta)>Number.EPSILON)this._totalDelta=Math.abs(this._radiusDelta),this._animationParameter=n.MCD_ENUM.FlyToParameter.Radius;else if(Math.abs(this._pitchDelta)>Number.EPSILON)this._totalDelta=Math.abs(this._pitchDelta),this._animationParameter=n.MCD_ENUM.FlyToParameter.Pitch;else if(Math.abs(this._yawDelta)>Number.EPSILON)this._totalDelta=Math.abs(this._yawDelta),this._animationParameter=n.MCD_ENUM.FlyToParameter.Yaw;else if(Math.abs(this._rollDelta)>Number.EPSILON)this._totalDelta=Math.abs(this._rollDelta),this._animationParameter=n.MCD_ENUM.FlyToParameter.Roll;else{if(this._eyeDelta=this._glm.distance(this._from._eye,this._finalEye),!(Math.abs(this._eyeDelta)>Number.EPSILON))return!1;this._totalDelta=Math.abs(this._eyeDelta),this._animationParameter=n.MCD_ENUM.FlyToParameter.Distance}return this._vecCameraDirection=this._glm.sub(this._from._eye,this._finalEye),!0}updateIncrementalDeltaValue(e,t){switch(this._animationParameter){case n.MCD_ENUM.FlyToParameter.Radius:this._incrementalDelta+=Math.abs(this._radiusDelta*e);break;case n.MCD_ENUM.FlyToParameter.Yaw:this._incrementalDelta+=Math.abs(this._yawDelta*e);break;case n.MCD_ENUM.FlyToParameter.Pitch:this._incrementalDelta+=Math.abs(this._pitchDelta*e);break;case n.MCD_ENUM.FlyToParameter.Roll:this._incrementalDelta+=Math.abs(this._rollDelta*e);break;case n.MCD_ENUM.FlyToParameter.Distance:{const e=this._glm.distance(t,this._finalEye);this._incrementalDelta=this._incrementalDelta+e<this._totalDelta?this._totalDelta-this.round(e,6):this._totalDelta}}}getEaseInSpeed(e){let t=e;return Math.abs(this._incrementalDelta)>.75*this._totalDelta&&(t=e*((this._totalDelta-Math.abs(this._incrementalDelta))/this._totalDelta)*.15),t<=.1*e&&(t=.1*e),t}getNextState(e){const t=this._current.clone();t._eye=this._glm.sub(this._current._eye,this._glm.mul(this._vecCameraDirection,e)),t._distance=this._current._distance-this._radiusDelta*e;const i=this._glm.eulerAngles(this._current._orientation);return t._orientation=this._glm.QuatFromAngles(i.x-this._pitchDelta*e,i.y-this._yawDelta*e,i.z-this._rollDelta*e),t._nearDistance=this._current._nearDistance-this._nearClipDelta*e,t._farDistance=this._current._farDistance-this._farClipDelta*e,this.updateIncrementalDeltaValue(e,t._eye),this._incrementalDelta>=this._totalDelta&&(t._distance=this._finalDistance,t._orientation=this._finalOrientaion,t._eye=this._finalEye,t._centerLocked=this._finalCenterLocked,t._elevationLocked=this._finalElevationLocked,t._pitchAngleLocked=this._finalPitchAngleLocked,t._yawAngleLocked=this._finalYawAngleLocked,t._orthographic=this._finalOrthographic,this.flyToPending=!1),this._current=t.clone(),t.toJson()}flyTo(e,t,i=.5){this._from=new a,this._from.fromJson(e),this._to=new a,this._to.fromJson(t),this._flyToCameraSpeed=i,this._current=this._from.clone(),this._finalDistance=this._to._distance,this._finalOrientaion=this._to._orientation,this._finalEye=this._to._eye,this._finalNearClip=this._to._nearDistance,this._finalFarClip=this._to._farDistance,this._finalCenterLocked=this._to._centerLocked,this._finalElevationLocked=this._to._elevationLocked,this._finalPitchAngleLocked=this._to._pitchAngleLocked,this._finalYawAngleLocked=this._to._yawAngleLocked,this._finalOrthographic=this._to._orthographic;const s=this.checkClipLocks(),o=this.checkProjection();if(!this.setAnimationParameter())return(s||o)&&(this._current._orthographic=this._finalOrthographic,this._modularCoreDisplay.set("CameraState",this._current.toJson()),this._modularCoreDisplay.commitCameraChanges(n.MCD_ENUM.CommitAction.CT_Immediate)),this.flyToStartEvent=this._flyToEventListeners[n.MCD_ENUM.FlyToEventNames.FLYTO_START_EVENT],this.flyToStartEvent&&this.flyToStartEvent(),this.flyToEndEvent=this._flyToEventListeners[n.MCD_ENUM.FlyToEventNames.FLYTO_END_EVENT],void(this.flyToEndEvent&&this.flyToEndEvent());this._flyToStartTime=Date.now(),this._incrementalDelta=0,this.flyToPending=!0}doFlyToAnimation(){let e=(Date.now()-this._flyToStartTime)/5e3;0===e&&(e=.001);const t=this.getEaseInSpeed(this._flyToCameraSpeed)*e,i=this.getNextState(t);return this._modularCoreDisplay.set("CameraState",i),this._modularCoreDisplay.commitCameraChanges(n.MCD_ENUM.CommitAction.CT_Immediate),this.flyToPending}checkClipLocks(){let e=!1;return this._from._farClipLocked!==this._to._farClipLocked&&(this._current._farClipLocked=this._to._farClipLocked,e=!0),this._from._nearClipLocked!==this._to._nearClipLocked&&(this._current._nearClipLocked=this._to._nearClipLocked,e=!0),e}checkProjection(){let e=!1;return this._from._orthographic!==this._to._orthographic&&(e=!0),e}}},jNbR:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i("JxDP"),a=i("Khlq");t.TouchNavigator=class extends n.MCDViewCommand{constructor(){super(!0),this._2DModeEnabled=!1,this._walkingViewEnabled=!1,this._bearingAngle=0,this._elevation=0}createTouchNavigator(e,t,i){this.addEvent=this.addEvent.bind(this),this.resetEvent=this.resetEvent.bind(this),this.resetAllEvents=this.resetAllEvents.bind(this),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.getEvent=this.getEvent.bind(this),this._modularCoreDisplay=e,this._camera=t,this._eventManager=i,this.cameraChangeCallback=this.onCameraChange.bind(this),this.addEvent(a.MCD_ENUM.CallbackEventNames.CAMERA_CHANGE_EVENT,this.cameraChangeCallback),this._defaultEventMap=this.eventMap}start(){const e=super.start();return e&&this._eventManager.pushPermanentListener(this),e}stop(){const e=super.stop();return e&&this._eventManager.popPermanentListener(this),e}onCameraChange(e){return s(this,void 0,void 0,(function*(){const e=yield this._modularCoreDisplay.getPitch();this.twoDMode=e<-88.5||e>88.5,this.walkingView=this._camera.firstPersonMode,this.bearingAngle=yield this._modularCoreDisplay.getBearing()}))}setBearingAngleChangeCallback(e){this.onBearingAngleChange=e}get twoDMode(){return this._2DModeEnabled}set twoDMode(e){null!==e&&(this._2DModeEnabled=e)}get walkingView(){return this._walkingViewEnabled}set walkingView(e){null!==e&&(this._walkingViewEnabled=e)}get bearingAngle(){return this._bearingAngle}set bearingAngle(e){this._bearingAngle=e+180,this.onBearingAngleChange&&this.onBearingAngleChange()}get elevation(){return this._elevation}set elevation(e){e>90?e=90:e<-90&&(e=-90),this._elevation=e}}},lhyZ:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("Khlq");var n=t.EventSelector=function(e){return e.ALL="ALL",e}(t.EventSelector||{});t.EventRecorder=class{constructor(){this._eventRecord=[],this._isRecording={},this._isExpecting={},this._callbackFor={}}startRecording(e){switch(e){case n.ALL:for(const e in s.MCD_ENUM.EventNames)this._isRecording[e]=!0;for(const e in s.MCD_ENUM.CallbackEventNames)this._isRecording[e]=!0;break;default:this._isRecording[e]=!0}}stopRecording(e){switch(e){case n.ALL:for(const e in s.MCD_ENUM.EventNames)this._isRecording[e]=!1;for(const e in s.MCD_ENUM.CallbackEventNames)this._isRecording[e]=!1;break;default:this._isRecording[e]=!1}}isRecording(e){return this._isRecording[e]||!1}expect({event:e,timeout:t=1e4,initializer:i}){return this._isExpecting[e]=!0,new Promise((s,n)=>{this._callbackFor[e]=(e,t)=>{s({param:e,ret:t})},setTimeout(()=>{n(t)},t),i&&i()})}record({event:e,param:t,ret:i}){this._isRecording[e]&&this._eventRecord.push({event:e,param:t,ret:i}),this._isExpecting[e]&&(this._callbackFor[e]&&(this._callbackFor[e](t,i),delete this._callbackFor[e]),this._isExpecting[e]=!1)}clear(){const e=this._eventRecord;return this._eventRecord=[],e}events(e){let t=[];switch(e){case void 0:case n.ALL:t=this._eventRecord;break;default:for(const i of this._eventRecord)i.event===e&&t.push(i)}return t}contains(e){let t=!1;switch(e){case n.ALL:this.events(e).length>0&&(t=!0);break;default:for(const i of this.events(e))i.event===e&&(t=!0)}return t}find(e){const t=this.events(e);return t[t.length-1]}delete(e){let t;for(let s=this._eventRecord.length-1;0<=s;s--)this._eventRecord[s].event===e&&(t=s);const i=this._eventRecord[t];return void 0!==t&&this._eventRecord.splice(t,1),i}}},mN5u:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Units=function(e){return e[e.METERS=0]="METERS",e[e.CENTIMETERS=1]="CENTIMETERS",e[e.MILLIMETERS=2]="MILLIMETERS",e}(t.Units||{})},ngv1:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e=-1,t){this._id=e,this._range=t}get id(){return this._id}get range(){return this._range}toJsonString(){return'{"id":'+this._id+', "range":'+this._range.toJsonString()+"}"}}t.MCDSelection=s,t.MCDObjectSelection=class extends s{constructor(e){super(),this._moniker=e}get moniker(){return this._moniker}Reset(e,t){this._id=e,this._range=t}}},"o+o0":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.McdNetworkIO=class{static fetchModelListWithGet(e){try{return fetch(e).then(e=>e.json()).then(e=>e).catch(e=>{throw e})}catch(t){console.error("ERROR: "+t)}}static fetchTokenWithPost(e,t,i,s){try{const n={grant_type:"password",username:t,password:i,client_id:"A6EFF8F0-7CD8-4FD9-826A-F9B6A3528396",client_secret:"z7IgEG0CJpXO#9Qo5qau3L0#UQeBWm^!dnWn5_8onjCnF+q1CP}E2JRIM@lcIP(.",scope:s},a=Object.keys(n).map(e=>encodeURIComponent(e)+"="+encodeURIComponent(n[e])).join("&");return fetch(e,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"},body:a}).then(e=>e.json()).then(e=>(e.hasOwnProperty("access_token"),e)).catch(e=>(console.error(e),'{ "error": "Unable to connect to network. Make sure you are connected to the Intergraph domain.", "error_description": '+e.message+" }"))}catch(n){console.error("ERROR: "+n)}}static fetchResponseWithGet(e,t){try{return fetch(e,{method:"GET",headers:{Authorization:"Bearer "+t,"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>e).catch(e=>{throw e})}catch(i){console.error("ERROR: "+i)}}static fetchDataWithGet(e){try{return fetch(e).then(e=>e.json()).then(e=>e).catch(e=>{throw e})}catch(t){console.error("ERROR: "+t)}}static fetchAspects(e,t){let i=e;-1!==e.indexOf("/Queries")&&(i=e.substr(0,e.indexOf("/Queries")),i=i.concat("?$select=Aspects"));try{return fetch(i,{method:"GET",headers:{Authorization:"Bearer "+t,"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>e.Aspects).catch(e=>{throw e})}catch(s){console.error("ERROR: "+s)}}}},oHXl:function(e,t){!function(){"use strict";function e(){var e;this.a0=null,this.a1=null,this.a2=null,this.d=[this],(e=this).a0=null,e.a1=null,e.a2=null}e.prototype.open=function(e){return i=e,o=null,r=null,h=null,null===(o=(t=this).a0)||(o="StringTreeJS.open called when it allready has an open tree. Please call close first",console.warn(o),t.a0=null,t.a1=null),o=new XMLHttpRequest,t.a0=o,r="GET",h=String(i),o.open(r,h,!0),(o=t.a0).responseType=r="arraybuffer",o=t.a0,(r=[{a0:null}])[0].a0=null,(h={a0:null,a1:{a0:null}}).a0=l,h.a1.a0=t,r[0].a0=h,n=s,a=r[0],o.onload=r=function(e){n(a,e)},void(o=t.a0).send();var t,i,n,a,o,r,h},e.prototype.setOnLoad=function(e){this.a2=e},e.prototype.isLoaded=function(){return 0|(null!==this.a1?1:0)},e.prototype.close=function(){return(e=this).a0=null,void(e.a1=null);var e},e.prototype.Find=function(e){return function(e,i){var s=null,n=null,l=null,h=null,c=0,_=0,d=0;if(null===(s=e.a1))return s="String tree not loaded, unable to Find string",n=String(i),console.warn(s,n),null;(function(e,i){var s=null,n=0,a=null,o=0;if((s=e).i0=0,s.i1=0,s.a2=t,r(e,0|(n=i.length)),(0|(n=i.length))>0)for(a=s.a2,n=0;o=i.charCodeAt(0|n),a[n]=0|o,(0|(n=n+1|0))<(0|(o=i.length)););})(s={i0:0,i1:0,a2:t},i),(l=n={a0:t,a0o:0,a1:t,a1o:0,a2:{a0:t,a0o:0}}).a0=t,l.a0o=0,l.a1=t,l.a1o=0,l.a2.a0=t,l.a2.a0o=0,function(e,i,s,n){var r,l=0,h=null,c=null,_=null,d=0,m=null,u=0,p=0,g=0,C=0,M=0,E=0,P=0,y=0,D=0,v=0;if((h=e).i0=0,d=(c=n).a0o,u=c.a1o,(m=c.a1).length===(_=c.a0).length&&m===_&&(0|u)==(0|d)||(c.a1=m,c.a1o=(0|u)+(((Math.imul(0|u,4)-Math.imul(0|d,4)|0)-4|0)>>>2^-1|0)|0),(0|(r=0|h.i2))>0){_=h.a1,d=h.a1o,g=0,p=0;e:for(;;){for(C=0;;){if(h.i0=0|(M=p+1|0),C=127&(E=255&_[(0|d)+p|0])|C<<7,!(E<<24<0)){p=M;break}p=M}for(e.a3.i0=0|C,M=0;;){if(h.i0=0|(E=p+1|0),M=127&(P=255&_[(0|d)+p|0])|M<<7,!(P<<24<0)){p=E;break}p=E}if((0|M)>0)for(m=e.a3.a1,u=e.a3.a1o,E=0;;){for(y=0|i[0+g|0],P=0;;){if(e.a3.i0=0|(D=C+1|0),P=127&(v=255&m[(0|u)+C|0])|P<<7,!(v<<24<0)){C=D;break}C=D}if((0|y)!=(0|P)){l=37;break e}if(g=g+1|0,!((0|(E=E+1|0))<(0|M)))break}for(C=0;;){if(h.i0=0|(M=p+1|0),C=127&(E=255&_[(0|d)+p|0])|C<<7,!(E<<24<0)){p=M;break}p=M}if((0|C)<1){l=19;break}for(E=-1,M=0;;){for(P=0;;){if(h.i0=0|(y=p+1|0),P=127&(D=255&_[(0|d)+p|0])|P<<7,!(D<<24<0)){p=y;break}p=y}for(y=0;;){if(h.i0=0|(D=p+1|0),y=127&(v=255&_[(0|d)+p|0])|y<<7,!(v<<24<0)){p=D;break}p=D}if(E=(0|(D=0|i[0+g|0]))==(0|y)?P:E,!((0|(M=M+1|0))<(0|C)))break}if((0|E)<0){l=38;break}if(g=g+1|0,h.i0=0|(p=E+p|0),!((0|p)<(0|r))){l=38;break}}if(19!==l);else{if((0|(M=1-C|0))>0)for(m=[0],g=0;;){for(C=0;h.i0=0|(E=p+1|0),C=127&(P=255&_[(0|d)+p|0])|C<<7,P<<24<0;)p=E;if(m[0]=0|C,_=c.a1,(0|(d=c.a1o))<(0|c.a2.a0o)?(_[0|d]=0|C,c.a1=_,c.a1o=1+(0|d)|0):o(n,m,0),!((0|(g=g+1|0))<(0|M)))break;p=0|h.i0,_=h.a1,d=h.a1o}!function(e){var i,s,n,o=null,r=null,l=null,h=0,c=0;r=(o=e).a2.a0,i=o.a2.a0o,l=o.a0,h=o.a0o,c=Math.imul(0|h,4),l=o.a1,h=o.a1o,s=Math.imul(0|h,4)-c|0,(Math.imul(0|i,4)-c|0)>>>0>s>>>0&&(c=s>>2,(l=(r={a0:null,a1:t,a1o:0,a2:t,a2o:0,a3:{a0:t,a0o:0,a1:null}}).a3).a0=t,l.a0o=0,l.a1=o.a2,o=0==(0|c)?t:new Int32Array(s/4|0),r.a0=o[0],r.a2=o,r.a2o=0+(0|c)|0,r.a1=o,r.a1o=0+(0|c)|0,l.a0=o,l.a0o=0+(0|c)|0,a(e,r),n=r.a1o,h=r.a2o,((l=r.a2).length!==(o=r.a1).length||l!==o||(0|h)!=(0|n))&&(r.a2=l,r.a2o=(0|h)+(((Math.imul(0|h,4)-Math.imul(0|n,4)|0)-4|0)>>>2^-1|0)|0))}(n)}}}(h=e.a1,s.a2,0,n),n=l.a1,c=l.a1o,h=l.a0,_=l.a0o;do{if((0|Math.imul(0|c,4))==(0|Math.imul(0|_,4)))s=null;else{if(s=s=h,0==(0|(d=0|_)))break;s=s.subarray(+(d>>>0)),h=l.a0,_=l.a0o,n=l.a1,c=l.a1o}}while(0);return 1===h.length&&h===t&&0==(0|_)||n.length===h.length&&n===h&&(0|c)==(0|_)||(l.a1=n,l.a1o=(0|c)+(((Math.imul(0|c,4)-Math.imul(0|_,4)|0)-4|0)>>>2^-1|0)|0),s}(this,e)},e.prototype.ReverseFind=function(e){return i=e,s=null,a=null,null===(s=this.a1)?(s="String tree not loaded, unable to ReverseFind value",a=String(0|i),console.warn(s,a),s=null):(function(e,i,s){var a=null,o=null,l=0;(a=e).i0=0,a.i1=0,a.a2=t,r(e,4096),i.i0=0,function e(i,s,a,o){var r=0,l=null,h=0,c=null,_=0,d=0,m=0,u=0,p=0,g=null,C=0,M=0,E=0,P=0,y=null,D=null,v=null,f=0;if(0==(0|(h=0|(l=i).i2)))return 0;for(h=0|l.i0,c=l.a1,_=l.a1o,d=0;;){if(l.i0=0|(m=h+1|0),d=127&(u=255&c[(0|_)+h|0])|d<<7,!(u<<24<0)){h=m;break}h=m}for(i.a3.i0=0|d,m=0;;){if(l.i0=0|(u=h+1|0),m=127&(p=255&c[(0|_)+h|0])|m<<7,!(p<<24<0)){h=u;break}h=u}if((0|m)>0){for(g=i.a3.a1,C=i.a3.a1o,p=0,u=a;;){for(M=0;;){if(i.a3.i0=0|(E=d+1|0),M=127&(P=255&g[(0|C)+d|0])|M<<7,!(P<<24<0)){d=E;break}d=E}if(E=u+1|0,(y=o.a2)[u]=0|M,!((0|(p=p+1|0))<(0|m)))break;u=E}d=m+a|0}else d=a;for(m=0;;){if(l.i0=0|(u=h+1|0),m=127&(p=255&c[(0|_)+h|0])|m<<7,!(p<<24<0)){h=u;break}h=u}if((0|m)<1){if(!((0|(p=1-m|0))>0))return 0;for(m=0;;){for(u=0;;){if(l.i0=0|(M=h+1|0),u=127&(E=255&c[(0|_)+h|0])|u<<7,!(E<<24<0)){h=M;break}h=M}if(m=m+1|0,(0|u)==(0|s))break;if(!((0|m)<(0|p))){r=38;break}}return 38===r?0|(h=0):(function(e,t,i,s,n){var a,o,r=null,l=0,h=null,c=0;a=(r=t).a2,l=-4&((o=(l=(l=0|r.i1)-0|0)>>>0<s>>>0?l:s)+4|0),r=new Int32Array((l<<2)/4|0),(h=e).a2=r,h.i0=1|l,h.i1=0|o;do{if(0!=(0|o)){if(0==(0|(c=1073741823&o)))break;for(l=0;r[l]=0|a[l+0|0],(0|c)!=(0|(l=l+1|0)););}}while(0);r[o]=0}(c={i0:0,i1:0,a2:t},o,0,0|d),1===(g=(l=o).a2).length&&g===t||(g[0]=0),l.i1=0,function(e){var i,s,n,a=null,o=0,r=null,l=0;if(o=(o=0|(a=e).i0)>>>0<2?0:(-2&o)-1|0,(0|(s=-4&(4+(i=0|a.i1)|0))-1)!=(0|o)){r=new Int32Array((s<<2)/4|0),n=a.a2;do{if(1!==n.length||n!==t){if(0==(0|(o=1+(o=0|a.i1)|0)))break;if(0==(0|(l=1073741823&o)))break;for(o=0;r[o]=0|n[o],(0|l)!=(0|(o=o+1|0)););}}while(0);a.i0=1|s,a.i1=0|i,a.a2=r}}(o),(l=o).i0=0|(g=c).i0,l.i1=0|g.i1,l.a2=y=g.a2,(c=c).i0=0,c.i1=0,c.a2=t,0|(h=1))}for((y=g={a0:t,a0o:0,a1:t,a1o:0,a2:{a0:t,a0o:0}}).a0=t,y.a0o=0,y.a1=t,y.a1o=0,y.a2.a0=t,y.a2.a0o=0,D=[0],u=0;;){for(;;){if(l.i0=0|(p=h+1|0),!((M=255&c[(0|_)+h|0])<<24<0)){h=p;break}h=p}for(p=0;l.i0=0|(M=h+1|0),p=127&(E=255&c[(0|_)+h|0])|p<<7,E<<24<0;)h=M;if(D[0]=0|p,_=y.a1o,(c=y.a1).length===(v=y.a2.a0).length&&c===v&&(0|_)==(0|y.a2.a0o)?n(g,D,0):(c[0|_]=0|p,y.a1=c,y.a1o=1+(0|_)|0),!((0|(u=u+1|0))<(0|m)))break;h=0|l.i0,c=l.a1,_=l.a1o}for(u=d+1|0,h=0;;){if(p=0|(c=y.a0)[(0|(_=y.a0o))+h|0],(c=o.a2)[d]=0|p,h=h+1|0,0|(p=e(i,0|s,0|u,o))){r=40;break}if(!((0|h)<(0|m))){r=36;break}}return 36===r?(_=y.a0o,l=y.a1,f=y.a1o,1===(c=y.a0).length&&c===t&&0==(0|_)||l.length===c.length&&l===c&&(0|f)==(0|_)||(y.a1=l,y.a1o=(0|f)+(((Math.imul(0|f,4)-Math.imul(0|_,4)|0)-4|0)>>>2^-1|0)|0),0|(h=0)):40===r?(_=y.a0o,l=y.a1,f=y.a1o,1===(c=y.a0).length&&c===t&&0==(0|_)||l.length===c.length&&l===c&&(0|f)==(0|_)||(y.a1=l,y.a1o=(0|f)+(((Math.imul(0|f,4)-Math.imul(0|_,4)|0)-4|0)>>>2^-1|0)|0),0|(h=1)):void 0}(i,0|s,0,e),0==(0|(o=a.a2)[l=(l=0|a.i1)-1|0])&&(a.i1=0|l,o[l]=0)}(a={i0:0,i1:0,a2:t},s,0|i),s=function(e,t){var i=null,s=0,n=0,a=null;if(i=String(),0!=(0|(s=0|e[0])))for(n=0;a=String.fromCharCode(0|s),i=i.concat(a),0!=(0|(s=0|e[0+(n=n+1|0)|0])););return String(i)}(s=a.a2));var i,s,a};var t=[null];function i(e){var t,i,s,n=0,a=0,o=0,r=0,l=0,h=0;return(0|(n=0|e.i1))==(0|(a=0|e.i2))?0|(a=-1):(a=(255&(o=255&(t=e.a0)[(0|(i=e.a0o))+(n+1|0)|0]))<<8|255&(a=255&t[(0|i)+n|0])|(255&(r=255&t[(0|i)+(n+2|0)|0]))<<16|(255&(l=255&t[(0|i)+(n+3|0)|0]))<<24,e.i1=0|(o=n+4|0),r=255&t[(0|i)+o|0],o=255&t[(0|i)+(n+5|0)|0],l=255&t[(0|i)+(n+6|0)|0],s=255&t[(0|i)+(n+7|0)|0],e.i1=0|(n=n+8|0),e.i5=0|(h=1+(h=0|e.i5)|0),e.a6[0|h].i0=0|n,e.a6[0|h].i1=(255&o)<<8|255&r|(255&l)<<16|(255&s)<<24|0,0|a)}function s(e,t){var i=null,s=null;(i=[null])[0]=t,(0,(s=e.a0).a0.a6)(s,i[0]),null!==e&&null!==(i=e.a0)&&(s=(s=i.a0).a5)(i)}function n(e,i,s){var n,a,o,r=null,l=null,h=0,c=null,_=0,d=0;l=(r=e).a1,h=r.a1o,c=r.a0,_=r.a0o,d=Math.imul(0|_,4),a=1+(n=(Math.imul(0|h,4)-d|0)>>2)|0,l=r.a2.a0,h=r.a2.a0o,d=(d=Math.imul(0|h,4)-d|0)>>2>>>0<536870911?(d>>=1)>>>0<a>>>0?a:d:1073741823,(c=(l={a0:null,a1:t,a1o:0,a2:t,a2o:0,a3:{a0:t,a0o:0,a1:null}}).a3).a0=t,c.a0o=0,c.a1=r.a2,r=0==(0|d)?t:new Int32Array((d<<2)/4|0),l.a0=r[0],l.a1=r,l.a1o=0+(0|n)|0,c.a0=r,c.a0o=0+(0|d)|0,r[n]=0|i[0|s],l.a2=r,l.a2o=0+(0|n+1)|0,function(e,t){var i,s=null,n=null,a=0,o=null,r=0,l=0,h=0;n=(s=e).a0,a=s.a0o,o=s.a1,r=s.a1o,i=(l=Math.imul(0|r,4)-Math.imul(0|a,4)|0)>>2,r=t.a1o,t.a1=o=t.a1,t.a1o=(0|r)+(0|0-i)|0;do{if((0|l)>0){if(0==(0|(h=l>>>2))){a=(0|r)+(0|0-i)|0,n=o;break}for(l=0;o[(0|r)+(l-i|0)|0]=0|n[(0|a)+l|0],(0|h)!=(0|(l=l+1|0)););n=t.a1,a=t.a1o}else a=(0|r)+(0|0-i)|0,n=o}while(0);o=s.a0,r=s.a0o,s.a0=n,s.a0o=0|a,t.a1=o,t.a1o=0|r,n=s.a1,a=s.a1o,r=t.a2o,s.a1=o=t.a2,s.a1o=0|r,t.a2=n,t.a2o=0|a,n=s.a2.a0,a=s.a2.a0o,r=t.a3.a0o,s.a2.a0=o=t.a3.a0,s.a2.a0o=0|r,t.a3.a0=n,t.a3.a0o=0|a,t.a0=(n=t.a1)[0|(a=t.a1o)]}(e,l),o=l.a1o,_=l.a2o,(c=l.a2).length===(r=l.a1).length&&c===r&&(0|_)==(0|o)||(l.a2=c,l.a2o=(0|_)+(((Math.imul(0|_,4)-Math.imul(0|o,4)|0)-4|0)>>>2^-1|0)|0)}function a(e,t){var i,s=null,n=null,a=0,o=null,r=0,l=0,h=0;n=(s=e).a0,a=s.a0o,o=s.a1,r=s.a1o,i=(l=Math.imul(0|r,4)-Math.imul(0|a,4)|0)>>2,r=t.a1o,t.a1=o=t.a1,t.a1o=(0|r)+(0|0-i)|0;do{if((0|l)>0){if(0==(0|(h=l>>>2))){a=(0|r)+(0|0-i)|0,n=o;break}for(l=0;o[(0|r)+(l-i|0)|0]=0|n[(0|a)+l|0],(0|h)!=(0|(l=l+1|0)););n=t.a1,a=t.a1o}else a=(0|r)+(0|0-i)|0,n=o}while(0);o=s.a0,r=s.a0o,s.a0=n,s.a0o=0|a,t.a1=o,t.a1o=0|r,n=s.a1,a=s.a1o,r=t.a2o,s.a1=o=t.a2,s.a1o=0|r,t.a2=n,t.a2o=0|a,n=s.a2.a0,a=s.a2.a0o,r=t.a3.a0o,s.a2.a0=o=t.a3.a0,s.a2.a0o=0|r,t.a3.a0=n,t.a3.a0o=0|a,t.a0=(n=t.a1)[0|(a=t.a1o)]}function o(e,i,s){var n,o,r,l=null,h=null,c=0,_=null,d=0,m=0;h=(l=e).a1,c=l.a1o,_=l.a0,d=l.a0o,m=Math.imul(0|d,4),o=1+(n=(Math.imul(0|c,4)-m|0)>>2)|0,h=l.a2.a0,c=l.a2.a0o,m=(m=Math.imul(0|c,4)-m|0)>>2>>>0<536870911?(m>>=1)>>>0<o>>>0?o:m:1073741823,(_=(h={a0:null,a1:t,a1o:0,a2:t,a2o:0,a3:{a0:t,a0o:0,a1:null}}).a3).a0=t,_.a0o=0,_.a1=l.a2,l=0==(0|m)?t:new Int32Array((m<<2)/4|0),h.a0=l[0],h.a1=l,h.a1o=0+(0|n)|0,_.a0=l,_.a0o=0+(0|m)|0,l[n]=0|i[0|s],h.a2=l,h.a2o=0+(0|n+1)|0,a(e,h),r=h.a1o,d=h.a2o,(_=h.a2).length===(l=h.a1).length&&_===l&&(0|d)==(0|r)||(h.a2=_,h.a2o=(0|d)+(((Math.imul(0|d,4)-Math.imul(0|r,4)|0)-4|0)>>>2^-1|0)|0)}function r(e,t){var i,s=null,n=0,a=null,o=0;if(0!=(0|t)){for(((n=(n=0|(s=e).i0)>>>0<2?0:(-2&n)-1|0)-(i=0|s.i1)|0)>>>0<t>>>0&&function(e,t,i,s,n){var a,o=null,r=0,l=0,h=null,c=0,_=0;a=(o=e).a2,r=t>>>0<536870887?-4&(((r=i+t|0)>>>0<(l=t<<1)>>>0?l:r)+4|0):1073741807,h=new Int32Array((r<<2)/4|0);do{if(0!=(0|n)){if(0==(0|(c=1073741823&n)))break;for(l=0;h[l]=0|a[l],(0|c)!=(0|(l=l+1|0)););}}while(0);do{if((0|s)!=(0|n)){if(0==(0|(c=1073741823&(s-n|0))))break;for(l=0;h[_=l+n|0]=0|a[_],(0|c)!=(0|(l=l+1|0)););}}while(0);o.a2=h,o.i0=1|r}(e,0|n,0|(t-n|0)+i,0|i,0|i),a=s.a2,n=i,o=0;a[n]=0,(o=o+1|0)>>>0<t>>>0;)n=n+1|0;s.i1=0|(n=i+t|0),a[n]=0}}new Uint8Array([83,116,114,105,110,103,32,116,114,101,101,32,110,111,116,32,108,111,97,100,101,100,44,32,117,110,97,98,108,101,32,116,111,32,82,101,118,101,114,115,101,70,105,110,100,32,118,97,108,117,101,0]),new Uint8Array([83,116,114,105,110,103,32,116,114,101,101,32,110,111,116,32,108,111,97,100,101,100,44,32,117,110,97,98,108,101,32,116,111,32,70,105,110,100,32,115,116,114,105,110,103,0]),new Uint8Array([83,116,114,105,110,103,84,114,101,101,74,83,46,111,112,101,110,32,99,97,108,108,101,100,32,119,104,101,110,32,105,116,32,97,108,108,114,101,97,100,121,32,104,97,115,32,97,110,32,111,112,101,110,32,116,114,101,101,46,32,80,108,101,97,115,101,32,99,97,108,108,32,99,108,111,115,101,32,102,105,114,115,116,0]),new Uint8Array([71,69,84,0]),new Uint8Array([97,114,114,97,121,98,117,102,102,101,114,0]);var l={a0:null,a1:function(e){},a2:function(e){},a3:function(e){var t=null;return(t={a0:null,a1:{a0:null}}).a0=l,t.a1.a0=e.a1.a0,t},a4:function(e){},a5:function(e){},a6:function(e,s){var n=null,a=null,o=null;if(null===(a=(a=(n=e.a1.a0).a0).response))return n="undefined error",void console.log(n);a=new Uint8Array(a),(o={i0:0,a1:t,a1o:0,i2:0,a3:{i0:0,a1:t,a1o:0,i2:0}}).a1=t,o.a1o=0,o.i2=0,o.a3.a1=t,o.a3.a1o=0,o.a3.i2=0,o.i0=0,o.a3.i0=0,n.a1=o,function(e,s,n,a){var o=0,r=null,l=0,c=null,_=0,d=0,m=0,u=null;for(function(e,t,s,n){var a,o,r,l=0,h=0,c=0,_=0,d=0;e.a0=t,e.a0o=0,e.i5=0,e.i1=0,e.i2=0|n,e.i3=0,-1837010076==(0|(l=i(e)))&&1380206662==(0|(l=i(e)))&&(h=255&(a=e.a0)[(0|(o=e.a0o))+(l=0|e.i1)|0],c=255&a[(0|o)+(l+1|0)|0],_=255&a[(0|o)+(l+2|0)|0],d=255&a[(0|o)+(l+3|0)|0],e.i1=0|(r=l+4|0),0==((255&c)<<8|255&h|(255&_)<<16|(255&d)<<24|0)&&(h=255&a[(0|o)+r|0],c=255&a[(0|o)+(l+5|0)|0],_=255&a[(0|o)+(l+6|0)|0],d=255&a[(0|o)+(l+7|0)|0],e.i1=0|l+8,e.i4=(255&c)<<8|255&h|(255&_)<<16|(255&d)<<24|0,e.i5=0|(l=0|e.i5)-1))}(r={a0:t,a0o:0,i1:0,i2:0,i3:0,i4:0,i5:0,a6:h([],0,10)},s,0,0|a);;){if(1480870227==(0|(l=i(r)))||843336019==(0|l)){o=2;break}if(-1==(0|l)){o=4;break}r.i1=0|(m=0|r.a6[0|(l=0|r.i5)].i1)+(d=0|r.a6[0|l].i0),r.i5=0|l+-1}2===o&&(d=(255&(m=255&(c=r.a0)[(0|(_=r.a0o))+(1+(l=0|r.i1)|0)|0]))<<8|255&(d=255&c[(0|_)+l|0])|(255&c[(0|_)+(l+2|0)|0])<<16|(255&c[(0|_)+(l+3|0)|0])<<24,m=(255&c[(0|_)+(l+5|0)|0])<<8|255&(m=255&c[(0|_)+(l+4|0)|0])|(255&c[(0|_)+(l+6|0)|0])<<16|(255&c[(0|_)+(l+7|0)|0])<<24,l=l+8|0,(u=e).i2=0|d,e.a3.i2=0|m,u.a1=c,u.a1o=(0|_)+(0|l)|0,l=d+l|0,e.a3.a1=c,e.a3.a1o=(0|_)+(0|l)|0,r.i1=0|m+l,u.i0=0,e.a3.i0=0,r.i5=0|(l=0|r.i5)-1)}(o,a,0,0|+a.length),null!==(a=n.a2)&&a(),n.a0=null}};function h(e,t,i){for(var s=t;s<i;s++)e[s]={i0:0,i1:0};return e}new Uint8Array([117,110,100,101,102,105,110,101,100,32,101,114,114,111,114,0]),global.StringTreeJS=e}()},paaN:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i("Khlq"),a=i("87hY"),o=i("+kco"),r=i("Vw1h"),l=i("JxDP"),h=i("2T81"),c=i("XHCD");t.CameraMotion=class extends l.MCDViewCommand{constructor(){super(!0),this.firstPersonMode=!1,this._commonView=n.MCD_ENUM.CommonViewOrientation.Undefined,this._homePositionLocked=!1,this.fit=this.fit.bind(this),this.fitAsync=this.fitAsync.bind(this),this.goHome=this.goHome.bind(this),this.undo=this.undo.bind(this),this.redo=this.redo.bind(this),this.onCameraChange=this.onCameraChange.bind(this),this.onGesture=this.onGesture.bind(this)}set commonView(e){this._commonView!==e&&(this._commonView=e)}get homePositionLocked(){return this._homePositionLocked}set homePositionLocked(e){this._homePositionLocked!==e&&(this._homePositionLocked=e,this.homePositionLockedEvent(e))}get isFlyToEnabled(){return this._camera===this._flyToCamera}get isFlyToPending(){return this._flyToCamera.cameraJig.flyToPending}set isFlyToPending(e){this._flyToCamera.cameraJig.flyToPending=e}set onGoHome(e){this._onGoHome=e}get projection(){return this._projection}set projection(e){this._projection=e,this._undoRedoManager.currentCameraProjectionIsOrthographic=n.MCD_ENUM.CameraProjection.ORTHOGRAPHIC===e,this._modularCoreDisplay.commitCameraChanges(1)}createCameraMotion(e,t,i,s,n){this.onCameraMotionStart=this.onCameraMotionStart.bind(this),this.onCameraMotionEnd=this.onCameraMotionEnd.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this._modularCoreDisplay=e,this._defaultCamera=new a.DefaultMotion(this._modularCoreDisplay,this.onCameraMotionStart,this.onCameraMotionEnd),this._defaultCamera.undoRedoEvent=this.saveCameraState.bind(this),this._flyToCamera=new o.FlyToMotion(this._modularCoreDisplay,this.onCameraMotionStart,this.onCameraMotionEnd),this._flyToCamera.undoRedoEvent=this.saveCameraState.bind(this),this._camera=this._defaultCamera,this._undoRedoManager=new r.UndoRedoManager,void 0!==s&&this._undoRedoManager.addEventlistener(r.UndoManagerEvents.CAN_UNDO,e=>s(e)),void 0!==n&&this._undoRedoManager.addEventlistener(r.UndoManagerEvents.CAN_REDO,e=>n(e))}onCameraMotionStart(){this._eventManager.onCameraMotionStart()}onCameraMotionEnd(){this.setCameraProjection(this.projection),this._eventManager.onCameraMotionEnd()}onModelLoaded(e){return s(this,void 0,void 0,(function*(){this._modelLoadedEvent=!0}))}setupDefaultEvents(e){this._eventManager=e,this.addEvent(n.MCD_ENUM.CallbackEventNames.CAMERA_CHANGE_EVENT,this.onCameraChange),this.addEvent(n.MCD_ENUM.EventNames.GESTURE_EVENT,this.onGesture),this.addEvent(n.MCD_ENUM.CallbackEventNames.MODEL_LOADED_EVENT,this.onModelLoaded,!0,!1)}goHome(){return s(this,void 0,void 0,(function*(){return!(!this._camera||!this._modularCoreDisplay||(this._onGoHome&&(yield this._onGoHome()),this._modularCoreDisplay.goHome(!1),yield this._camera.moveTo(),this._eventManager.onTelemetry(c.Telemetry.getTelemetryJson(n.MCD_ENUM.TelemetryEventName.HomeCommand,n.MCD_ENUM.TelemetryEventType.Feature,n.MCD_ENUM.TelemetryMessageType.Discrete)),0))}))}fit(){return!(!this._camera||!this._modularCoreDisplay||(this._modularCoreDisplay.fit(!1),this._camera.moveTo(),this._eventManager.onTelemetry(c.Telemetry.getTelemetryJson(n.MCD_ENUM.TelemetryEventName.FitCommand,n.MCD_ENUM.TelemetryEventType.Feature,n.MCD_ENUM.TelemetryMessageType.Discrete)),0))}moveToCameraState(e,t){if(!this._camera||!this._modularCoreDisplay||!e)return!1;let i;try{i=JSON.stringify(e)}catch(s){return!1}return this._camera.moveTo(i,t),!0}fitAsync(){return s(this,void 0,void 0,(function*(){return!(!this._camera||!this._modularCoreDisplay||(this._modularCoreDisplay.fit(!1),yield this._camera.moveTo(),this._eventManager.onTelemetry(c.Telemetry.getTelemetryJson(n.MCD_ENUM.TelemetryEventName.FitCommand,n.MCD_ENUM.TelemetryEventType.Feature,n.MCD_ENUM.TelemetryMessageType.Discrete)),0))}))}moveToCameraStateAsync(e,t){return s(this,void 0,void 0,(function*(){if(!this._camera||!this._modularCoreDisplay||!e)return!1;let i;try{i=JSON.stringify(e)}catch(s){return!1}return yield this._camera.moveTo(i,t),!0}))}setCameraState(e){return!(!this._modularCoreDisplay||!e||(this._modularCoreDisplay.set("CameraState",JSON.stringify(e)),0))}getCameraState(){return s(this,void 0,void 0,(function*(){if(!this._modularCoreDisplay)return null;const e=yield this._modularCoreDisplay.get("CameraState","");return JSON.parse(e)}))}setCameraPosition(e){return!(!this._modularCoreDisplay||!e||(this._modularCoreDisplay.set("CameraPosition",JSON.stringify(e)),0))}getCameraPosition(){return s(this,void 0,void 0,(function*(){if(!this._modularCoreDisplay)return null;const e=yield this._modularCoreDisplay.get("CameraPosition","");return JSON.parse(e)}))}setHome(){return s(this,void 0,void 0,(function*(){if(!this._modularCoreDisplay)return!1;if(this.homePositionLocked)return!1;{const e=yield this._modularCoreDisplay.get("CameraPosition","");return this._modularCoreDisplay.set("CameraHomePosition",e),this._eventManager.onTelemetry(c.Telemetry.getTelemetryJson(n.MCD_ENUM.TelemetryEventName.SetHomeCommand,n.MCD_ENUM.TelemetryEventType.Feature,n.MCD_ENUM.TelemetryMessageType.Discrete)),!0}}))}resetHome(){return s(this,void 0,void 0,(function*(){return!!this._modularCoreDisplay&&!this.homePositionLocked&&(this._modularCoreDisplay.reset("CameraHomePosition",""),this._eventManager.onTelemetry(c.Telemetry.getTelemetryJson(n.MCD_ENUM.TelemetryEventName.ResetHomeCommand,n.MCD_ENUM.TelemetryEventType.Feature,n.MCD_ENUM.TelemetryMessageType.Discrete)),!0)}))}enableFlyTo(e=.5){return!!this._flyToCamera&&(this._flyToCamera.setCameraSpeed(e),this._camera=this._flyToCamera,!0)}disableFlyTo(){return!!this._defaultCamera&&(this._camera=this._defaultCamera,!0)}stopFlyToMotion(){this.isFlyToPending&&(this._flyToCamera.cameraJig.flyToPending=!1)}enableOptimizedNavigation(){return s(this,void 0,void 0,(function*(){return!!this._modularCoreDisplay&&(this._modularCoreDisplay.optimizeNavigation(!0),!0)}))}disableOptimizedNavigation(){return!!this._modularCoreDisplay&&(this._modularCoreDisplay.optimizeNavigation(!1),!0)}saveCameraState(e){return s(this,void 0,void 0,(function*(){if(!this._camera||!this._modularCoreDisplay)return!1;const t=yield this.getCameraState();return void 0===e||e!==n.MCD_ENUM.GestureEventNames.GESTURE_NONE&&e!==n.MCD_ENUM.GestureEventNames.GESTURE_KEY_UP&&e!==n.MCD_ENUM.GestureEventNames.GESTURE_MOUSE_UP&&e!==n.MCD_ENUM.GestureEventNames.GESTURE_MOUSE_WHEEL&&e!==n.MCD_ENUM.GestureEventNames.GESTURE_TOUCH_END||this._undoRedoManager.setCurrentState(JSON.stringify(t))&&(e===n.MCD_ENUM.GestureEventNames.GESTURE_KEY_UP?this._eventManager.onTelemetry(c.Telemetry.getTelemetryJson(n.MCD_ENUM.TelemetryEventName.KeyboardNavigationCommand,n.MCD_ENUM.TelemetryEventType.Feature,n.MCD_ENUM.TelemetryMessageType.Discrete)):e===n.MCD_ENUM.GestureEventNames.GESTURE_MOUSE_UP||e===n.MCD_ENUM.GestureEventNames.GESTURE_MOUSE_WHEEL?this._eventManager.onTelemetry(c.Telemetry.getTelemetryJson(n.MCD_ENUM.TelemetryEventName.MouseNavigationCommand,n.MCD_ENUM.TelemetryEventType.Feature,n.MCD_ENUM.TelemetryMessageType.Discrete)):e===n.MCD_ENUM.GestureEventNames.GESTURE_TOUCH_END&&this._eventManager.onTelemetry(c.Telemetry.getTelemetryJson(n.MCD_ENUM.TelemetryEventName.TouchNavigationCommand,n.MCD_ENUM.TelemetryEventType.Feature,n.MCD_ENUM.TelemetryMessageType.Discrete))),!0}))}clearUndoRedo(){return!!this._undoRedoManager&&(this._undoRedoManager.resetUndoRedoManager(),!0)}undo(){return s(this,void 0,void 0,(function*(){if(!this._undoRedoManager.canUndo)return!1;const e=JSON.parse(this._undoRedoManager.undo());return this.moveToCameraState(e,!1),this._eventManager.onTelemetry(c.Telemetry.getTelemetryJson(n.MCD_ENUM.TelemetryEventName.UndoCommand,n.MCD_ENUM.TelemetryEventType.Feature,n.MCD_ENUM.TelemetryMessageType.Discrete)),!0}))}redo(){return!!this._undoRedoManager.canRedo&&(this.moveToCameraStateAsync(JSON.parse(this._undoRedoManager.redo()),!1),this._eventManager.onTelemetry(c.Telemetry.getTelemetryJson(n.MCD_ENUM.TelemetryEventName.RedoCommand,n.MCD_ENUM.TelemetryEventType.Feature,n.MCD_ENUM.TelemetryMessageType.Discrete)),!0)}undoRedoStash(){return s(this,void 0,void 0,(function*(){return this._undoRedoManager.stash(JSON.stringify(yield this.getCameraState()))}))}undoRedoWithdraw(){return s(this,void 0,void 0,(function*(){return this._undoRedoManager.withdraw(JSON.stringify(yield this.getCameraState()))}))}setUndoLimit(e){this._undoRedoManager.undoLimit=e}getGoViewCamera(){return s(this,void 0,void 0,(function*(){console.warn("getGoViewCamera is depricated. Please use getCameraPosition / getCameraState.");const e=yield this.getCameraPosition();return'{"m_cameraFrom": {"x": '+e.CameraPosition.eye.x+',"y": '+e.CameraPosition.eye.y+',"z": '+e.CameraPosition.eye.z+'},"m_cameraTo": {"x": '+e.CameraPosition.center.x+',"y": '+e.CameraPosition.center.y+',"z": '+e.CameraPosition.center.z+'},"m_cameraUp": {"x": '+e.CameraPosition.up.x+',"y": '+e.CameraPosition.up.y+',"z": '+e.CameraPosition.up.z+'},"m_nearClip": '+e.CameraPosition["clip-near"]+',"m_farClip": '+e.CameraPosition["clip-far"]+',"m_perspective": '+e.CameraPosition.perspective+"}"}))}setGoViewCamera(e){const t=JSON.parse('{ "CameraPosition": { "eye": {"x": '+e.m_cameraFrom.x+',"y": '+e.m_cameraFrom.y+',"z": '+e.m_cameraFrom.z+'},"center": {"x": '+e.m_cameraTo.x+',"y": '+e.m_cameraTo.y+',"z": '+e.m_cameraTo.z+'},"up": {"x": '+e.m_cameraUp.x+',"y": '+e.m_cameraUp.y+',"z": '+e.m_cameraUp.z+'},"clip-near": '+e.m_nearClip+',"clip-far": '+e.m_farClip+',"perspective": '+e.m_perspective+"}}");this.setCameraPosition(t),this._camera.moveTo()}onCameraChange(){this._modelLoadedEvent&&(this.saveInitialCameraStart(),this._modelLoadedEvent=!1),this._camera.onCameraChange()}saveInitialCameraStart(){return s(this,void 0,void 0,(function*(){const e=yield this.getCameraState();this._undoRedoManager.setCurrentState(JSON.stringify(e))}))}onGesture(e){e!==n.MCD_ENUM.GestureEventNames.GESTURE_NONE&&e!==n.MCD_ENUM.GestureEventNames.GESTURE_MOUSE_UP&&e!==n.MCD_ENUM.GestureEventNames.GESTURE_MOUSE_WHEEL&&e!==n.MCD_ENUM.GestureEventNames.GESTURE_TOUCH_END&&e!==n.MCD_ENUM.GestureEventNames.GESTURE_KEY_UP||this.saveCameraState(e),this._camera.onGesture(e)}canSaveCameraState(){return!!this._camera&&this._camera.canSaveState()}lockCamera(e,t,i=!1){return s(this,void 0,void 0,(function*(){if(!this._camera||!this._modularCoreDisplay)return!1;const s=yield this.getCameraState();s.isCenterLocked=!!s.hasOwnProperty("isCenterLocked")&&s.isCenterLocked,s.isElevationLocked=!!s.hasOwnProperty("isElevationLocked")&&s.isElevationLocked,s.isPitchAngleLocked=!!s.hasOwnProperty("isPitchAngleLocked")&&s.isPitchAngleLocked,s.isYawAngleLocked=!!s.hasOwnProperty("isYawAngleLocked")&&s.isYawAngleLocked;let a=!1;const o=function(e,t,i){let s=!1;switch(e){case n.MCD_ENUM.CameraLock.LOCK_CENTER:t.hasOwnProperty("isCenterLocked")&&(t.isCenterLocked=i,s=!0);break;case n.MCD_ENUM.CameraLock.LOCK_ELEVATION:t.hasOwnProperty("isElevationLocked")&&(t.isElevationLocked=i,s=!0);break;case n.MCD_ENUM.CameraLock.LOCK_PITCH:t.hasOwnProperty("isPitchAngleLocked")&&(t.isPitchAngleLocked=i,s=!0);break;case n.MCD_ENUM.CameraLock.LOCK_YAW:t.hasOwnProperty("isYawAngleLocked")&&(t.isYawAngleLocked=i,s=!0);break;default:return s}return s};if(t instanceof Array)for(let i=0;i<t.length;i++){const n=o(t[i],s,e);!1===a&&(a=n),n||console.warn("An invalid lock value was passed to the lockCamera function: "+t[i])}else a=o(t,s,e);return a&&(a=this.setCameraState(s)),i&&this._modularCoreDisplay.commitCameraChanges(1),a}))}getUserPreferences(){return s(this,void 0,void 0,(function*(){const e={};return e.FlyTo={enable:this.isFlyToEnabled,"camera-speed":this._flyToCamera.getCameraSpeed()},[JSON.stringify(e)]}))}setUserPreferences(e){return s(this,void 0,void 0,(function*(){if(!e)return!1;const t=JSON.parse(e);if(t.hasOwnProperty("FlyTo")){const e=t.FlyTo;if(e.hasOwnProperty("enable")&&e.hasOwnProperty("camera-speed"))return this._camera=e.enable?this._flyToCamera:this._defaultCamera,this._flyToCamera.setCameraSpeed(e["camera-speed"]),!0}return!1}))}fitToRange(e){return!(!this._camera||!this._modularCoreDisplay||(this._modularCoreDisplay.fitToRange(e,!1),this._camera.moveTo(),0))}touchNavZoom(e){return!(!this._camera||!this._modularCoreDisplay||(this._modularCoreDisplay.motionMove(0,0,e>0?1:-1,-1,-1),this._modularCoreDisplay.commitCameraChanges(1),this._eventManager.onTelemetry(c.Telemetry.getTelemetryJson(n.MCD_ENUM.TelemetryEventName.NavigatorZoomCommand,n.MCD_ENUM.TelemetryEventType.Feature,n.MCD_ENUM.TelemetryMessageType.Discrete)),0))}touchNavWalkingView(){return s(this,void 0,void 0,(function*(){return!(!this._camera||!this._modularCoreDisplay||(this._modularCoreDisplay.setPitch(0,!0),!(yield this.lockCamera(!0,n.MCD_ENUM.CameraLock.LOCK_ELEVATION,!0))||(this._camera.moveTo(),this._eventManager.onTelemetry(c.Telemetry.getTelemetryJson(n.MCD_ENUM.TelemetryEventName.NavigatorWalkingCommand,n.MCD_ENUM.TelemetryEventType.Feature,n.MCD_ENUM.TelemetryMessageType.Discrete)),0)))}))}touchNav2D(){return s(this,void 0,void 0,(function*(){if(!this._camera||!this._modularCoreDisplay)return!1;const e=yield this.getCameraPosition();if(e.hasOwnProperty("CameraPosition")){const t=new h.Vec3(e.CameraPosition.center.x,e.CameraPosition.center.y,e.CameraPosition.center.z),i=new h.Vec3(e.CameraPosition.eye.x,e.CameraPosition.eye.y,e.CameraPosition.eye.z),s=(new h.GlMath).distance(t,i);return i.x=t.x,i.y=t.y,i.z=t.z+s,this._modularCoreDisplay.motionMoveTo(i.x,i.y,i.z,t.x,t.y,t.z,!1),this._camera.moveTo(),this._eventManager.onTelemetry(c.Telemetry.getTelemetryJson(n.MCD_ENUM.TelemetryEventName.Navigator2DCommand,n.MCD_ENUM.TelemetryEventType.Feature,n.MCD_ENUM.TelemetryMessageType.Discrete)),!0}return!1}))}touchNav3DRestore(e){return!(!this._camera||!this._modularCoreDisplay||(this._modularCoreDisplay.setPitch(e,!this.firstPersonMode,!1),this._camera.moveTo(),0))}touchNavNorth(){return!(!this._camera||!this._modularCoreDisplay||(this._modularCoreDisplay.setBearing(0,!this.firstPersonMode,!1),this._camera.moveTo(),this._eventManager.onTelemetry(c.Telemetry.getTelemetryJson(n.MCD_ENUM.TelemetryEventName.NavigatorNorthCommand,n.MCD_ENUM.TelemetryEventType.Feature,n.MCD_ENUM.TelemetryMessageType.Discrete)),0))}setCameraProjection(e){return s(this,void 0,void 0,(function*(){const t=yield this.getCameraState();let i=!1;n.MCD_ENUM.CameraProjection.ORTHOGRAPHIC!==e||t.isOrthographic?n.MCD_ENUM.CameraProjection.PERSPECTIVE===e&&t.isOrthographic&&(t.isOrthographic=!1,i=this.setCameraState(t),this.projection=e):(t.isOrthographic=!0,i=this.setCameraState(t),this.projection=e),i&&this._modularCoreDisplay.commitCameraChanges(1)}))}setBearingAndPitch(e,t,i){return!(!this._camera||!this._modularCoreDisplay||(this._modularCoreDisplay.setBearing(e,i),this._modularCoreDisplay.setPitch(t,i),this._camera.moveTo(),0))}setCommonView(e,t){if(!1===t)switch(e){case n.MCD_ENUM.CommonViewOrientation.Top:this.setBearingAndPitch(0,90,!1);break;case n.MCD_ENUM.CommonViewOrientation.Bottom:this.setBearingAndPitch(0,-90,!1);break;case n.MCD_ENUM.CommonViewOrientation.Front:this.setBearingAndPitch(180,0,!1);break;case n.MCD_ENUM.CommonViewOrientation.Back:this.setBearingAndPitch(0,0,!1);break;case n.MCD_ENUM.CommonViewOrientation.Left:this.setBearingAndPitch(270,0,!1);break;case n.MCD_ENUM.CommonViewOrientation.Right:this.setBearingAndPitch(90,0,!1);break;case n.MCD_ENUM.CommonViewOrientation.TopFront:this.setBearingAndPitch(180,45,!1);break;case n.MCD_ENUM.CommonViewOrientation.TopBack:this.setBearingAndPitch(0,45,!1);break;case n.MCD_ENUM.CommonViewOrientation.TopLeft:this.setBearingAndPitch(270,45,!1);break;case n.MCD_ENUM.CommonViewOrientation.TopRight:this.setBearingAndPitch(90,45,!1);break;case n.MCD_ENUM.CommonViewOrientation.BottomFront:this.setBearingAndPitch(180,-45,!1);break;case n.MCD_ENUM.CommonViewOrientation.BottomBack:this.setBearingAndPitch(0,-45,!1);break;case n.MCD_ENUM.CommonViewOrientation.BottomLeft:this.setBearingAndPitch(270,-45,!1);break;case n.MCD_ENUM.CommonViewOrientation.BottomRight:this.setBearingAndPitch(90,-45,!1);break;case n.MCD_ENUM.CommonViewOrientation.FrontLeft:this.setBearingAndPitch(225,0,!1);break;case n.MCD_ENUM.CommonViewOrientation.FrontRight:this.setBearingAndPitch(135,0,!1);break;case n.MCD_ENUM.CommonViewOrientation.BackLeft:this.setBearingAndPitch(315,0,!1);break;case n.MCD_ENUM.CommonViewOrientation.BackRight:this.setBearingAndPitch(45,0,!1);break;case n.MCD_ENUM.CommonViewOrientation.TopFrontLeft:this.setBearingAndPitch(225,35,!1);break;case n.MCD_ENUM.CommonViewOrientation.TopFrontRight:this.setBearingAndPitch(135,35,!1);break;case n.MCD_ENUM.CommonViewOrientation.TopBackLeft:this.setBearingAndPitch(315,35,!1);break;case n.MCD_ENUM.CommonViewOrientation.TopBackRight:this.setBearingAndPitch(45,35,!1);break;case n.MCD_ENUM.CommonViewOrientation.BottomFrontLeft:this.setBearingAndPitch(225,-35,!1);break;case n.MCD_ENUM.CommonViewOrientation.BottomFrontRight:this.setBearingAndPitch(135,-35,!1);break;case n.MCD_ENUM.CommonViewOrientation.BottomBackLeft:this.setBearingAndPitch(315,-35,!1);break;case n.MCD_ENUM.CommonViewOrientation.BottomBackRight:this.setBearingAndPitch(45,-35,!1)}else switch(e){case n.MCD_ENUM.CommonViewOrientation.Top:this.setBearingAndPitch(0,-90,!0);break;case n.MCD_ENUM.CommonViewOrientation.Bottom:this.setBearingAndPitch(0,90,!0);break;case n.MCD_ENUM.CommonViewOrientation.Front:this.setBearingAndPitch(0,0,!0);break;case n.MCD_ENUM.CommonViewOrientation.Back:this.setBearingAndPitch(180,0,!0);break;case n.MCD_ENUM.CommonViewOrientation.Left:this.setBearingAndPitch(90,0,!0);break;case n.MCD_ENUM.CommonViewOrientation.Right:this.setBearingAndPitch(270,0,!0);break;case n.MCD_ENUM.CommonViewOrientation.TopFront:this.setBearingAndPitch(0,-45,!0);break;case n.MCD_ENUM.CommonViewOrientation.TopBack:this.setBearingAndPitch(180,-45,!0);break;case n.MCD_ENUM.CommonViewOrientation.TopLeft:this.setBearingAndPitch(90,-45,!0);break;case n.MCD_ENUM.CommonViewOrientation.TopRight:this.setBearingAndPitch(270,-45,!0);break;case n.MCD_ENUM.CommonViewOrientation.BottomFront:this.setBearingAndPitch(0,45,!0);break;case n.MCD_ENUM.CommonViewOrientation.BottomBack:this.setBearingAndPitch(180,45,!0);break;case n.MCD_ENUM.CommonViewOrientation.BottomLeft:this.setBearingAndPitch(90,45,!0);break;case n.MCD_ENUM.CommonViewOrientation.BottomRight:this.setBearingAndPitch(270,45,!0);break;case n.MCD_ENUM.CommonViewOrientation.FrontLeft:this.setBearingAndPitch(45,0,!0);break;case n.MCD_ENUM.CommonViewOrientation.FrontRight:this.setBearingAndPitch(315,0,!0);break;case n.MCD_ENUM.CommonViewOrientation.BackLeft:this.setBearingAndPitch(135,0,!0);break;case n.MCD_ENUM.CommonViewOrientation.BackRight:this.setBearingAndPitch(225,0,!0);break;case n.MCD_ENUM.CommonViewOrientation.TopFrontLeft:this.setBearingAndPitch(45,-35,!0);break;case n.MCD_ENUM.CommonViewOrientation.TopFrontRight:this.setBearingAndPitch(315,-35,!0);break;case n.MCD_ENUM.CommonViewOrientation.TopBackLeft:this.setBearingAndPitch(135,-35,!0);break;case n.MCD_ENUM.CommonViewOrientation.TopBackRight:this.setBearingAndPitch(225,-35,!0);break;case n.MCD_ENUM.CommonViewOrientation.BottomFrontLeft:this.setBearingAndPitch(45,35,!0);break;case n.MCD_ENUM.CommonViewOrientation.BottomFrontRight:this.setBearingAndPitch(315,35,!0);break;case n.MCD_ENUM.CommonViewOrientation.BottomBackLeft:this.setBearingAndPitch(135,35,!0);break;case n.MCD_ENUM.CommonViewOrientation.BottomBackRight:this.setBearingAndPitch(225,35,!0)}}getCommonview(e){return s(this,void 0,void 0,(function*(){let t=yield this._modularCoreDisplay.getBearing();t=360-t,360===t&&(t=0);let i=yield this._modularCoreDisplay.getPitch();return i=Math.round(i),t=Math.round(t),!1===e?0===t&&90===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.Top:0===t&&-90===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.Bottom:180===t&&0===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.Front:0===t&&0===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.Back:270===t&&0===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.Left:90===t&&0===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.Right:180===t&&45===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.TopFront:0===t&&45===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.TopBack:270===t&&45===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.TopLeft:90===t&&45===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.TopRight:180===t&&-45===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.BottomFront:0===t&&-45===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.BottomBack:270===t&&-45===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.BottomLeft:90===t&&-45===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.BottomRight:225===t&&0===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.FrontLeft:135===t&&0===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.FrontRight:315===t&&0===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.BackLeft:45===t&&0===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.BackRight:225===t&&35===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.TopFrontLeft:135===t&&35===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.TopFrontRight:315===t&&35===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.TopBackLeft:45===t&&35===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.TopBackRight:225===t&&-35===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.BottomFrontLeft:135===t&&-35===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.BottomFrontRight:315===t&&-35===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.BottomBackLeft:45===t&&-35===i&&(this._commonView=n.MCD_ENUM.CommonViewOrientation.BottomBackRight):0===t&&-90===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.Top:0===t&&90===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.Bottom:0===t&&0===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.Front:180===t&&0===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.Back:90===t&&0===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.Left:270===t&&0===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.Right:0===t&&-45===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.TopFront:180===t&&-45===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.TopBack:90===t&&-45===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.TopLeft:270===t&&-45===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.TopRight:0===t&&45===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.BottomFront:180===t&&45===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.BottomBack:90===t&&45===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.BottomLeft:270===t&&45===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.BottomRight:45===t&&0===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.FrontLeft:315===t&&0===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.FrontRight:135===t&&0===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.BackLeft:225===t&&0===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.BackRight:45===t&&-35===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.TopFrontLeft:315===t&&-35===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.TopFrontRight:135===t&&-35===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.TopBackLeft:225===t&&-35===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.TopBackRight:45===t&&35===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.BottomFrontLeft:315===t&&35===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.BottomFrontRight:135===t&&35===i?this._commonView=n.MCD_ENUM.CommonViewOrientation.BottomBackLeft:225===t&&35===i&&(this._commonView=n.MCD_ENUM.CommonViewOrientation.BottomBackRight),this._commonView}))}}},qx5m:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i("bM4Y"),a=i("Y0B9"),o=i("FYTm"),r=i("2T81"),l=i("DCEI");t.Measurement=class extends n.MeasurementBase{constructor(){super(),this._featureLayername="MeasurementLayer",this._featureID=0,this._currentMovingPoint=null,this._currentMovingPointType=a.Point_Type.NONE,this._featuresInEachMeasurment=6,this._measurementLines=new Map,this._currentMeasurementLine=new a.MeasurementLine(this._featureID),this._currentActivePoint=null}get featureLayername(){return this._featureLayername}get measurementLines(){return this._measurementLines}get currentMeasurementLine(){return this._currentMeasurementLine}initMeasurement(){this.createFeatureLayer(),a.MeasurementLine.featureLayer=this._featureLayer,a.MeasurementLine.createdIDs=[],a.MeasurementLine.precision=this._precision,a.MeasurementLine.units=this._units,a.MeasurementLine.showDimesionsAlongXYZ=this._showDimesionsAlongXYZ}updateStylesAndText(){a.MeasurementLine.precision=this._precision,a.MeasurementLine.units=this._units,a.MeasurementLine.showDimesionsAlongXYZ=this._showDimesionsAlongXYZ,this.setDefaultStyle();const e=this.getStyles();for(let t=0;t<e.length;t++)this._featureLayer.createOrUpdateStyle(e[t]);this._measurementLines.forEach(e=>{e.updateText()}),this._currentMeasurementLine.updateText()}incrementFeatureIDForNextMeasurmentLine(){this._featureID=this._featureID+this._featuresInEachMeasurment}createFeatureLayer(){if(!this._featureLayer){const e=this.getStyles();this._featureLayer=new o.FeatureLayer(this._featureLayername,this._modularCoreDisplay,e,2),this.setDefaultStyle()}}destroyLayers(){const e={};e["target-name"]=this._featureLayername,this._modularCoreDisplay.destroy("RenderTarget",JSON.stringify(e)),this._featureLayer=null}getStyles(){const e=[];return e.push({styleID:a.stylesID.DEFAULT_BIGGER_CIRCLE,icon:this._iconPath,"icon-color":this._defaultColor.rgba(),"mesh-scale":.5,billboard:!1,"zoom-scale-rasters":!0,"bitmap-y-align":"vcenter","bitmap-x-align":"hcenter","depth-test":!1,"lighting-fx":!1}),e.push({styleID:a.stylesID.DESELECTED_BIGGER_CIRCLE,icon:this._iconPath,"icon-color":this._deSelectedPointColor.rgba(),"mesh-scale":.5,billboard:!1,"zoom-scale-rasters":!0,"bitmap-y-align":"vcenter","bitmap-x-align":"hcenter","depth-test":!1,"lighting-fx":!1}),e.push({styleID:a.stylesID.SELECTED_BIGGER_CIRCLE,icon:this._iconPath,"icon-color":this._selectedPointColor.rgba(),"mesh-scale":.5,billboard:!1,"zoom-scale-rasters":!0,"bitmap-y-align":"vcenter","bitmap-x-align":"hcenter","depth-test":!1,"lighting-fx":!1}),e.push({styleID:a.stylesID.MOVING_BIGGER_CIRCLE,icon:this._iconPath,"icon-color":this._movingPointColor.rgba(),"mesh-scale":.5,billboard:!1,"zoom-scale-rasters":!0,"bitmap-y-align":"vcenter","bitmap-x-align":"hcenter","depth-test":!1,"lighting-fx":!1}),e.push({styleID:a.stylesID.POINT_WHITE_BORDER,"point-inner-size":10,"point-outer-size":12,"point-inner-color":this._defaultColor.rgba(),"point-outer-color":[1,1,1,1],"zoom-scale-rasters":!0,"zoom-scale-point":!0,billboard:!0,"depth-test":!1,"lighting-fx":!1}),e.push({styleID:a.stylesID.POINT_NO_BORDER,"point-inner-size":6,"point-outer-size":8,"point-inner-color":this._lineColor.rgba(),"point-outer-color":this._lineColor.rgba(),"zoom-scale-rasters":!0,"zoom-scale-point":!0,billboard:!0,"depth-test":!1,"lighting-fx":!1}),e.push({styleID:a.stylesID.LINE,"line-inner-size":3,"line-outer-size":3.5,"line-inner-color":this._lineColor.rgba(),"line-outer-color":this._lineColor.rgba(),"zoom-scale-rasters":!0,"zoom-scale-line":!0,billboard:!0,"depth-test":!1,"lighting-fx":!1}),e}setDefaultStyle(){const e={"point-inner-size":10,"point-outer-size":12,"line-inner-size":3,"line-outer-size":3.5,"point-inner-color":[0,.7,1,1],"point-outer-color":[1,1,1,1],"line-inner-color":[.3,.7,.9,1],"line-outer-color":[1,1,1,1],"text-color":[1,1,1,1],"text-shadow-color":[1,1,1,0],"text-background-color":[0,0,0,.7],"text-point-size":15};e.font=this._fontPath,e["zoom-scale-rasters"]=!0,e.billboard=!0,e["zoom-scale-line"]=!0,e["zoom-scale-point"]=!0,e["enable-shadow"]=!1,e["depth-test"]=!1,e["lighting-fx"]=!1,this._featureLayer.setDefaultStyleToLayer(e)}addPoint(e){this._currentMeasurementLine.startPoint&&this._currentMeasurementLine.endPoint&&(this._currentMeasurementLine.deactivate(),this._currentMeasurementLine.startFeatureID===this._featureID&&this._measurementLines.set(this._featureID,this._currentMeasurementLine),this.incrementFeatureIDForNextMeasurmentLine(),this._currentMeasurementLine=new a.MeasurementLine(this._featureID),this._currentActivePoint&&this._currentMeasurementLine.addPoint(a.Point_Type.START,this._currentActivePoint)),this._currentActivePoint&&this._currentActivePoint.isEqual(e)||(this._currentMeasurementLine.startPoint?this._currentMeasurementLine.endPoint||this._currentMeasurementLine.addPoint(a.Point_Type.END,e):this._currentMeasurementLine.addPoint(a.Point_Type.START,e),this._currentActivePoint=e)}getPointFromFeatureIDS(e){let t=null;for(let i=0;i<e.length;i++){const s=e[i],n=Math.floor(s/this._featuresInEachMeasurment)*this._featuresInEachMeasurment;if(this._measurementLines.get(n)){if(s<=n+a.MeasurementFeatureIDs.START_BIGGER_DISC){t=this._measurementLines.get(n).startPoint;break}if(s<=n+a.MeasurementFeatureIDs.END_BIGGER_DISC){t=this._measurementLines.get(n).endPoint;break}}else if(this._currentMeasurementLine.startFeatureID===n){if(s<=n+a.MeasurementFeatureIDs.START_BIGGER_DISC){t=this._currentMeasurementLine.startPoint;break}if(s<=n+a.MeasurementFeatureIDs.END_BIGGER_DISC){t=this._currentMeasurementLine.endPoint;break}}}return t}useFeatureForPlacingPoint(e){let t=!0;const i=this.getPointFromFeatureIDS(e);return i&&(this.addPoint(i),t=!1),t}selectFeature(e){if(null!==e&&e>-1){const t=Math.floor(e/this._featuresInEachMeasurment)*this._featuresInEachMeasurment;this._measurementLines.get(t)&&(this._currentMeasurementLine.startFeatureID!==t&&(this.deactivateCurrentActiveLine(),this._currentMeasurementLine.startPoint||this._currentMeasurementLine.endPoint||(this._featureID=this._featureID-this._featuresInEachMeasurment),this._currentMeasurementLine=this._measurementLines.get(t),this._currentMeasurementLine.activate()),e<=t+a.MeasurementFeatureIDs.START_BIGGER_DISC?(this._currentMeasurementLine.activatePoint(a.Point_Type.START),this._currentActivePoint=this._currentMeasurementLine.startPoint):e<=t+a.MeasurementFeatureIDs.END_BIGGER_DISC?(this._currentMeasurementLine.activatePoint(a.Point_Type.END),this._currentActivePoint=this._currentMeasurementLine.endPoint):e<=t+a.MeasurementFeatureIDs.TEXT&&(this._currentMeasurementLine.activatePoint(a.Point_Type.BOTH),this._currentActivePoint=null))}}deleteCurrentActive(){let e=!1;return this._currentMeasurementLine.delete(this._currentMeasurementLine.activePoint),this._currentMeasurementLine.startPoint?(this._currentMeasurementLine.activatePoint(a.Point_Type.START),this._currentActivePoint=this._currentMeasurementLine.startPoint,e=!0):this._currentMeasurementLine.endPoint&&(this._currentMeasurementLine.activatePoint(a.Point_Type.END),this._currentActivePoint=this._currentMeasurementLine.endPoint,e=!0),e}clearAll(){this._measurementLines.forEach(e=>{e.delete(a.Point_Type.BOTH)}),this._currentMeasurementLine.delete(a.Point_Type.BOTH),this._measurementLines.clear(),this._featureID=0,a.MeasurementLine.createdIDs=[],this._currentMeasurementLine=new a.MeasurementLine(this._featureID),this._currentActivePoint=null}setVisibility(e){this._featureLayer.visible=e}updatePoint(e){this._currentMovingPointType!==a.Point_Type.START&&this._currentMovingPointType!==a.Point_Type.END||this._currentMeasurementLine.updatePoint(this._currentMovingPointType,e)}createMovingFeature(e){let t=!1;for(let i=0;i<e.length;i++){const s=e[i],n=Math.floor(s/this._featuresInEachMeasurment)*this._featuresInEachMeasurment;if(this._currentMeasurementLine.startFeatureID===n&&(s<=n+a.MeasurementFeatureIDs.START_BIGGER_DISC?(this._currentMovingPointType=a.Point_Type.START,this._currentMovingPoint=this._currentMeasurementLine.startPoint,t=!0):s<=n+a.MeasurementFeatureIDs.END_BIGGER_DISC&&(this._currentMovingPointType=a.Point_Type.END,this._currentMovingPoint=this._currentMeasurementLine.endPoint,t=!0),t)){this._currentMeasurementLine.changePointStyleForMoving(this._currentMovingPointType),this.getCameraPosition();break}}return t}getCameraPosition(){return s(this,void 0,void 0,(function*(){this._sCameraPosition=yield this._modularCoreDisplay.get("CameraPosition",""),this._sCameraMatrices=yield this._modularCoreDisplay.get("CameraMatrices","");const e=JSON.parse(this._sCameraMatrices).CameraMatrices.inverse_projmodelview_matrix;""!==this._sCameraMatrices&&(this._currentInverseCameraMatrix=new r.Mat4(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]))}))}finalizeMovingFeatureAfterUpdate(){this._currentMovingPointType!==a.Point_Type.START&&this._currentMovingPointType!==a.Point_Type.END||this._currentMeasurementLine.resetPointStyleAfterMoving(this._currentMovingPointType),this._currentActivePoint=this._currentMeasurementLine.activePoint===a.Point_Type.START?this._currentMeasurementLine.startPoint:this._currentMeasurementLine.activePoint===a.Point_Type.END?this._currentMeasurementLine.endPoint:null,this._currentMovingPoint=null,this._currentMovingPointType=a.Point_Type.NONE}updateMovingfeatureAtNearClipping(e,t){if(this._currentInverseCameraMatrix){const i=l.MathGeometry.getModelPointForScreenPoint(e,this._height-t,.5,this._width,this._height,this._currentInverseCameraMatrix);let s;if(this._currentMovingPointType===a.Point_Type.START?s=this._currentMeasurementLine.startPoint.orientation:this._currentMovingPointType===a.Point_Type.END&&(s=this._currentMeasurementLine.endPoint.orientation),s){const e=new a.MeasurementPoint(i,s);this.updatePoint(e)}}}useFeatureForUpdatingPoint(e){let t=!0;const i=this.getPointFromFeatureIDS(e);return i&&(this.updatePoint(i),t=!1),t}finalScreenPositionAfterUpdate(){let e;if(this._currentMovingPointType===a.Point_Type.START?e=this._currentMeasurementLine.startPoint:this._currentMovingPointType===a.Point_Type.END&&(e=this._currentMeasurementLine.endPoint),e&&this._sCameraPosition){const t=JSON.parse(this._sCameraMatrices),i=l.MathGeometry.getScreenPointFromModelPointAndMatrices(t.CameraMatrices.projection_matrix,t.CameraMatrices.view_matrix,this._width,this._height,e.position);if(i)return new r.Vec2(i.x,this._height-i.y)}return null}removeMovingPoint(){this._currentMovingPointType===a.Point_Type.START?(this._featureLayer.removeFeature(this._currentMeasurementLine.startFeatureID),this._featureLayer.removeFeature(this._currentMeasurementLine.startFeatureID+1),a.MeasurementLine.createdIDs[this._currentMeasurementLine.startFeatureID]=!1,a.MeasurementLine.createdIDs[this._currentMeasurementLine.startFeatureID+1]=!1):(this._featureLayer.removeFeature(this._currentMeasurementLine.startFeatureID+2),this._featureLayer.removeFeature(this._currentMeasurementLine.startFeatureID+3),a.MeasurementLine.createdIDs[this._currentMeasurementLine.startFeatureID+2]=!1,a.MeasurementLine.createdIDs[this._currentMeasurementLine.startFeatureID+3]=!1)}resetMovingPointPositionToOrginal(){this._currentMovingPoint&&this.updatePoint(this._currentMovingPoint),this._currentActivePoint=null}deactivateCurrentActiveLine(){this._currentMeasurementLine.startPoint&&this._currentMeasurementLine.endPoint?(this._currentMeasurementLine.deactivate(),this._measurementLines.set(this._currentMeasurementLine.startFeatureID,this._currentMeasurementLine),this.incrementFeatureIDForNextMeasurmentLine(),this._currentMeasurementLine=new a.MeasurementLine(this._featureID)):this._currentMeasurementLine.startPoint?this._currentMeasurementLine.delete(a.Point_Type.START):this._currentMeasurementLine.endPoint&&this._currentMeasurementLine.delete(a.Point_Type.END),this._currentActivePoint=null}}},rFol:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});class n{}t.LevelVisibilityChangedEventArgs=n,t.Levels=class{constructor(){this._mcd=null}initialize(e){if(this._mcd=e,!this._mcd)throw new Error("The MCD parameter provided is NULL")}getLevelNames(e){return s(this,void 0,void 0,(function*(){let t=[];if(void 0===e||""===e)return t;const i={property:"LevelNames","target-name":this._mcd.modelName,"sheet-name":e},s=yield this._mcd.get("Levels",JSON.stringify(i));if(void 0!==s&&""!==s){const e=JSON.parse(s);null!==e&&e.hasOwnProperty("level-names")&&(t=e["level-names"])}return t}))}getLevelVisibility(e){return s(this,void 0,void 0,(function*(){let t=!1;if(void 0===e||""===e)return t;const i={property:"LevelVisibility","target-name":this._mcd.modelName,"level-name":e},s=yield this._mcd.get("Levels",JSON.stringify(i));if(void 0!==s&&""!==s){const e=JSON.parse(s);null!==e&&e.hasOwnProperty("visibility")&&(t=e.visibility)}return t}))}setLevelVisibility(e,t){return s(this,void 0,void 0,(function*(){if(void 0===e||""===e)return;const i={property:"LevelVisibility","target-name":this._mcd.modelName,"level-name":e,visibility:t},s=yield this._mcd.set("Levels",JSON.stringify(i));if(JSON.parse(s).hasOwnProperty("success")&&this.levelVisibilityChangedEvent){const i=new n;i.levelName=e,i.visibility=t,this.levelVisibilityChangedEvent(i)}}))}}},sinj:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.RenderingEffects=class{constructor(e){this._isEffectsDisabled=!1,this._modularCoreDisplay=e,this._areEffectsAreSet=!1,this._isEffectsDisabled=!1}set enableRenderingEffects(e){this._isEffectsDisabled!==!e&&(this._isEffectsDisabled=!e,!0===e?(this.toggleEffects(!0),this._effects={}):(this._effects={},this.toggleEffects(!1)))}get enableRenderingEffects(){return!this._isEffectsDisabled}toggleEffects(e){return s(this,void 0,void 0,(function*(){if(!e){const e=yield this._modularCoreDisplay.getRenderEffects(),t=JSON.parse(e);for(const i in t)t[i].hasOwnProperty("enable")&&t[i].enable&&(this._effects[i]=i)}if(!0===this._isEffectsDisabled&&!1===this._areEffectsAreSet||!1===this._isEffectsDisabled&&!0===this._areEffectsAreSet){let t="{",i=Object.keys(this._effects).length;for(const s in this._effects)t+="ClipPlanes"===s?'"'+this._effects[s]+'": { "enable": '+!0+" }":'"'+this._effects[s]+'": { "enable": '+e+" }",i-1>0&&(t+=","),i--;t+="}",this._modularCoreDisplay.setRenderEffects(t),this._areEffectsAreSet=!this._areEffectsAreSet}}))}}},uKvH:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("IQbp");t.MCDLocalize=class{constructor(e){this._mcdLocalize=null!=e?e:{strLocale:"en-US",localeJSON:s}}getLocaleString(e,t){let i;return i=t,null!==e&&this._mcdLocalize&&null!==this._mcdLocalize.localeJSON&&this._mcdLocalize.localeJSON[e]&&(i=this._mcdLocalize.localeJSON[e]),i}getLocaleDateString(e){let t;return null!==e&&(t=e.toDateString(),this._mcdLocalize&&(t=e.toLocaleDateString(this._mcdLocalize.strLocale,this._mcdLocalize.dateFormat))),t}getLocaleNumberString(e){let t=e.toString();return this._mcdLocalize&&(t=e.toLocaleString(this._mcdLocalize.strLocale,this._mcdLocalize.numberFormat)),t}}},uZBq:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RedirectSnapshotCallback=class{constructor(e,t,i){this._jsonString=e,this.redirectFunction=i,this._modularCoreDistplay=t}get redirect(){return this.redirectFunction}set redirect(e){this.redirectFunction=e}get json(){return this._jsonString}set json(e){this._jsonString=e}get mcd(){return this._modularCoreDistplay}set mcd(e){this._modularCoreDistplay=e}};class s{constructor(e){this.executeCallback=this.executeCallback.bind(this),this._callbackFunction=e}get callBackFunction(){return this._callbackFunction}executeCallback(e){if(null==this._callbackFunction)return!1;const t=JSON.parse(e);return this._callbackFunction.call(this,t),!1}}t.Callback=s,t.CallbackHandler=function(e){return Module.MCDCallback.extend("MCDCallback",new s(e))}},v99T:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function r(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i((function(t){t(e.value)})).then(o,r)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i("aZWK"),a=i("Khlq"),o=i("JxDP"),r=i("b7LP"),l=i("fx83"),h=i("XHCD");t.ClipPlanesBase=class extends o.MCDViewCommand{constructor(){super(!0)}set width(e){this._width=e,this._clipPlanes.aspectRatio=this._width/this._height,this._clipPlanes.setViewSize(this._width,this._height)}get width(){return this._width}set height(e){this._height=e,this._clipPlanes.aspectRatio=this._width/this._height,this._clipPlanes.setViewSize(this._width,this._height)}get height(){return this._height}getStartOn3PlanesClipping(){return this._clipPlanes.startOn3PlanesClipping}setStartOn3PlanesClipping(e){this._clipPlanes.startOn3PlanesClipping=e}getClipVolumeRangeMax(){return this._clipPlanes.clipVolumeRangeMax}setClipVolumeRangeMax(e){this._clipPlanes.clipVolumeRangeMax=e}getClipVolumeRangeMin(){return this._clipPlanes.clipVolumeRangeMin}setClipVolumeRangeMin(e){this._clipPlanes.clipVolumeRangeMin=e}setModelRange(e,t){this._clipPlanes.modelRangeMin=e,this._clipPlanes.modelRangeMax=t}createClipPlanes(e,t,i,s,o){this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.pause=this.pause.bind(this),this.resume=this.resume.bind(this),this._modularCoreDisplay=e,this._eventManager=o,this._clipPlanes=new n.ClipPlanes(e,t),this._currentRange=new r.MCDRange(0,0,0,0,0,0),this._originalRange=new r.MCDRange(0,0,0,0,0,0),this._currentIds=[],this._initialized=!1,this._shouldInvertPlanes=!1,this._isInsideClipping=!0,this._objectClipping=!1,this._width=i,this._height=s,this._clipPlanes.setViewSize(i,s),this._clipPlanes.enableDisplayModelClippingPlanes=!1,this._firstSelection=!0,this.manipulationStartCallback=this.onManipulationStartEvent.bind(this),this.manipulationUpdateCallback=this.onManipulationUpdateEvent.bind(this),this.surfaceLocateCallback=this.onSurfaceLocate.bind(this),this.mouseDoubleClickCallback=this.onMouseDoubleClick.bind(this),this.doubleTapCallback=this.onDoubleTap.bind(this),this.locateCallback=this.onLocate.bind(this),this.onLayout=this.onLayout.bind(this),this.isInitialized=this.isInitialized.bind(this),this.addEvent(a.MCD_ENUM.EventNames.MANIPULATION_START_EVENT,this.manipulationStartCallback),this.addEvent(a.MCD_ENUM.EventNames.MANIPULATION_UPDATE_EVENT,this.manipulationUpdateCallback),this.addEvent(a.MCD_ENUM.EventNames.DOUBLE_TAP_EVENT,this.doubleTapCallback),this.addEvent(a.MCD_ENUM.EventNames.MOUSE_DOUBLE_CLICK_EVENT,this.mouseDoubleClickCallback),this.addEvent(a.MCD_ENUM.CallbackEventNames.LOCATE_ELEMENT_EVENT,this.locateCallback),this.addEvent(a.MCD_ENUM.CallbackEventNames.LOCATE_EVENT,this.surfaceLocateCallback,!1,!1),this._defaultEventMap=this._eventMap,this._keyMappings=this.createKeyMappings()}createKeyMappings(){return[new l.MCDKey(27,a.MCD_ENUM.KeyEventType.KEY_UP,this.stop)]}start(e,t){const i=super.start();return i&&(e&&t&&this.setModelRange(e,t),this.isInitialized()?this.showPlanes(this.getEnabledPlanes()):this.showPlanes(),this._eventManager.onTelemetry(h.Telemetry.getTelemetryJson(a.MCD_ENUM.TelemetryEventName.ClipCommand,a.MCD_ENUM.TelemetryEventType.Feature,a.MCD_ENUM.TelemetryMessageType.Start))),i}stop(){const e=super.stop();return e&&(this.hidePlanes(),this.disableClipping(),this._eventManager.onTelemetry(h.Telemetry.getTelemetryJson(a.MCD_ENUM.TelemetryEventName.ClipCommand,a.MCD_ENUM.TelemetryEventType.Feature,a.MCD_ENUM.TelemetryMessageType.End))),e}pause(){const e=super.pause();return e&&(this.hidePlanes(),this._eventManager.onTelemetry(h.Telemetry.getTelemetryJson(a.MCD_ENUM.TelemetryEventName.ClipCommand,a.MCD_ENUM.TelemetryEventType.Feature,a.MCD_ENUM.TelemetryMessageType.Pause))),e}resume(){const e=super.resume();return e&&(this.isInitialized()?this.showPlanes(this.getEnabledPlanes()):this.showPlanes(),this._eventManager.onTelemetry(h.Telemetry.getTelemetryJson(a.MCD_ENUM.TelemetryEventName.ClipCommand,a.MCD_ENUM.TelemetryEventType.Feature,a.MCD_ENUM.TelemetryMessageType.Resume))),e}isInitialized(){return!!this._clipPlanes&&this._initialized}isEqualLists(e,t){if(e.sort(),t.sort(),e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}initializeClipPlanePosition(e){return s(this,void 0,void 0,(function*(){if(!this._clipPlanes)return!1;let t;if(e)t=[[-1],e];else{const e=yield this._modularCoreDisplay.getSelectedObjectsAndRange();if(e){const i=[];for(let t=0;t<e[0].length;t++)for(let s=0;s<e[0][t].ids.length;s++)i.push(e[0][t].ids[s]);Math.abs(e[1].maxx-e[1].minx)<.3&&(e[1].maxx+=.005,e[1].minx-=.005),Math.abs(e[1].maxy-e[1].miny)<.3&&(e[1].maxy+=.005,e[1].miny-=.005),Math.abs(e[1].maxz-e[1].minz)<.3&&(e[1].maxz+=.005,e[1].minz-=.005),t=[i,e[1]]}else t=void 0}if(!t||this._initialized||this.isEqualLists(t[0],this._currentIds)&&this._currentRange.minx===t[1].minx&&this._currentRange.miny===t[1].miny&&this._currentRange.minz===t[1].minz&&this._currentRange.maxx===t[1].maxx&&this._currentRange.maxy===t[1].maxy&&this._currentRange.maxz===t[1].maxz){if(!t&&!this._initialized&&-1!==this._currentRange.minx&&-1!==this._currentRange.miny&&-1!==this._currentRange.minz&&-1!==this._currentRange.maxx&&-1!==this._currentRange.maxy&&-1!==this._currentRange.maxz){this._objectClipping=!1;const e=new r.MCDRange(-1,-1,-1,-1,-1,-1);this.setCurrentClippingRange(e),yield this._clipPlanes.initializeClipPlanes()}}else this._currentIds=t[0],this.setCurrentClippingRange(t[1]),this._clipPlanes.inverseClipping=!0,0===this._originalRange.minx&&0===this._originalRange.miny&&0===this._originalRange.minz&&0===this._originalRange.maxx&&0===this._originalRange.maxy&&0===this._originalRange.maxz&&this.setOriginalClippingRange(t[1]),this._objectClipping=!0,yield this._clipPlanes.initializeClipPlanes(t[1]);return this._initialized=!0,this._isInsideClipping=!0,this._eventManager.onClipPlanesInitialized(),!0}))}setCurrentClippingRange(e){return!!this._currentRange&&(this._currentRange.minx=e.minx,this._currentRange.miny=e.miny,this._currentRange.minz=e.minz,this._currentRange.maxx=e.maxx,this._currentRange.maxy=e.maxy,this._currentRange.maxz=e.maxz,!0)}setOriginalClippingRange(e){return!!this._originalRange&&(this._originalRange.minx=e.minx,this._originalRange.miny=e.miny,this._originalRange.minz=e.minz,this._originalRange.maxx=e.maxx,this._originalRange.maxy=e.maxy,this._originalRange.maxz=e.maxz,!0)}enableClipping(){return!!this._clipPlanes&&(this._clipPlanes.enableModelPlanesClipping(!0),this._clipPlanes.display(!0),!0)}disableClipping(){if(!this._clipPlanes)return!1;this._initialized=!1;const e=new r.MCDRange(0,0,0,0,0,0);return this.setCurrentClippingRange(e),this.setOriginalClippingRange(e),this._clipPlanes.display(this._clipPlanes.enableDisplayModelClippingPlanes),this._clipPlanes.enableModelPlanesClipping(!1),!0}isPlanesShowing(){return!!this._clipPlanes&&this._clipPlanes.enableDisplayModelClippingPlanes}getSelectedPlaneIds(){if(!this._clipPlanes)return[];if(this._clipPlanes.selection>a.MCD_ENUM.ClippingPlaneSelection.None&&this._clipPlanes.selection<=a.MCD_ENUM.ClippingPlaneSelection.Plane5)return[this._clipPlanes.selection];if(this._clipPlanes.selection>a.MCD_ENUM.ClippingPlaneSelection.Plane5&&this._clipPlanes.selection<=a.MCD_ENUM.ClippingPlaneSelection.Edge11){const e=[];for(let t=0;t<a.MCD_ENUM.EventConstants.MAX_CLIP_PLANES;t++)this._clipPlanes.getPlaneEnabled(t)&&e.push(t);return e}return this._clipPlanes.selection===a.MCD_ENUM.ClippingPlaneSelection.Corner0?[a.MCD_ENUM.ClippingPlaneSelection.Plane0,a.MCD_ENUM.ClippingPlaneSelection.Plane1,a.MCD_ENUM.ClippingPlaneSelection.Plane2]:this._clipPlanes.selection===a.MCD_ENUM.ClippingPlaneSelection.Corner1?[a.MCD_ENUM.ClippingPlaneSelection.Plane0,a.MCD_ENUM.ClippingPlaneSelection.Plane1,a.MCD_ENUM.ClippingPlaneSelection.Plane5]:this._clipPlanes.selection===a.MCD_ENUM.ClippingPlaneSelection.Corner2?[a.MCD_ENUM.ClippingPlaneSelection.Plane0,a.MCD_ENUM.ClippingPlaneSelection.Plane4,a.MCD_ENUM.ClippingPlaneSelection.Plane5]:this._clipPlanes.selection===a.MCD_ENUM.ClippingPlaneSelection.Corner3?[a.MCD_ENUM.ClippingPlaneSelection.Plane0,a.MCD_ENUM.ClippingPlaneSelection.Plane2,a.MCD_ENUM.ClippingPlaneSelection.Plane4]:this._clipPlanes.selection===a.MCD_ENUM.ClippingPlaneSelection.Corner4?[a.MCD_ENUM.ClippingPlaneSelection.Plane1,a.MCD_ENUM.ClippingPlaneSelection.Plane2,a.MCD_ENUM.ClippingPlaneSelection.Plane3]:this._clipPlanes.selection===a.MCD_ENUM.ClippingPlaneSelection.Corner5?[a.MCD_ENUM.ClippingPlaneSelection.Plane1,a.MCD_ENUM.ClippingPlaneSelection.Plane3,a.MCD_ENUM.ClippingPlaneSelection.Plane5]:this._clipPlanes.selection===a.MCD_ENUM.ClippingPlaneSelection.Corner6?[a.MCD_ENUM.ClippingPlaneSelection.Plane3,a.MCD_ENUM.ClippingPlaneSelection.Plane4,a.MCD_ENUM.ClippingPlaneSelection.Plane5]:this._clipPlanes.selection===a.MCD_ENUM.ClippingPlaneSelection.Corner7?[a.MCD_ENUM.ClippingPlaneSelection.Plane2,a.MCD_ENUM.ClippingPlaneSelection.Plane4,a.MCD_ENUM.ClippingPlaneSelection.Plane3]:[]}getEnabledPlanes(){if(!this._clipPlanes)return[];const e=[];for(let t=0;t<a.MCD_ENUM.EventConstants.MAX_CLIP_PLANES;t++)this._clipPlanes.getPlaneEnabled(t)&&e.push(t);return e}showPlanes(e){return s(this,void 0,void 0,(function*(){if(!this._clipPlanes)return!1;if(e&&0!==e.length){for(let t=0;t<e.length;t++)this._clipPlanes.enablePlane(e[t],!0);this._clipPlanes.display(!0),this.enableClipping()}else this._initialized||(yield this.initializeClipPlanePosition()),this._clipPlanes.enableAllPlanes(),this._clipPlanes.display(!0),this.enableClipping();return this._objectClipping&&this._shouldInvertPlanes&&this._isInsideClipping?(this._clipPlanes.invert(),this._shouldInvertPlanes=!1):this._objectClipping||!this._shouldInvertPlanes||this._isInsideClipping||(this._clipPlanes.invert(),this._shouldInvertPlanes=!1),this._selectedPlane=this._clipPlanes.selection,!0}))}hidePlanes(e){if(!this._clipPlanes)return!1;if(e&&0!==e.length){for(let t=0;t<e.length;t++)this._clipPlanes.enablePlane(e[t],!1);this._objectClipping&&6===e.length?this._shouldInvertPlanes=!0:this._objectClipping||3!==e.length||(this._shouldInvertPlanes=!0),this._objectClipping&&1===e.length&&0===this._clipPlanes.getEnablePlaneCount()?this._isInsideClipping=!1:this._objectClipping||this._isInsideClipping||1!==e.length||0!==this._clipPlanes.getEnablePlaneCount()||(this._shouldInvertPlanes=!0),this._clipPlanes.display(!0),this.enableClipping()}else this._clipPlanes.display(!1);return this._clipPlanes.highlightPlane(-1),!0}isPlaneEnabled(e){return this._clipPlanes.getPlaneEnabled(e)}unselectPlanes(){return!!this._clipPlanes&&(this._firstSelection=!0,!0)}invertClipping(){return!!this._clipPlanes&&(this._clipPlanes.invert(),this._isInsideClipping=!this._isInsideClipping,!0)}resetClippingPlanes(){return!(!this._clipPlanes||!this.isActive||(0!==this._originalRange.minx&&0!==this._originalRange.miny&&0!==this._originalRange.minz&&0!==this._originalRange.maxx&&0!==this._originalRange.maxy&&0!==this._originalRange.maxz?this._clipPlanes.initializeClipPlanes(this._originalRange):this._clipPlanes.resetThreePlaneClipPlanes(),this._clipPlanes.display(!0),this._isInsideClipping||this.invertClipping(),this._shouldInvertPlanes=!1,this._clipPlanes.enableModelPlanesClipping(this._clipPlanes.inverseClipping),0))}locate(e){return s(this,void 0,void 0,(function*(){return this._clipPlanes?(this._selectedPlane=yield this._clipPlanes.locateClipPlane(e),-1===this._selectedPlane?(this.eventMap[a.MCD_ENUM.EventNames.MANIPULATION_START_EVENT].useDefault=!0,this.eventMap[a.MCD_ENUM.EventNames.MANIPULATION_UPDATE_EVENT].useDefault=!0,this.eventMap[a.MCD_ENUM.CallbackEventNames.LOCATE_ELEMENT_EVENT].useDefault=!0,this.eventMap[a.MCD_ENUM.CallbackEventNames.LOCATE_EVENT].recursive=!0,this._firstSelection=!0):-1!==this._selectedPlane&&this._firstSelection&&(this.eventMap[a.MCD_ENUM.EventNames.MANIPULATION_START_EVENT].useDefault=!1,this.eventMap[a.MCD_ENUM.EventNames.MANIPULATION_UPDATE_EVENT].useDefault=!1,this.eventMap[a.MCD_ENUM.CallbackEventNames.LOCATE_ELEMENT_EVENT].useDefault=!1,this.eventMap[a.MCD_ENUM.CallbackEventNames.LOCATE_EVENT].recursive=!1,this._firstSelection=!1),this._selectedPlane):-1}))}isFirstSelectionOfPlane(){return this._firstSelection}updateViewSize(e,t){return!!this._clipPlanes&&(this._width=e,this._height=t,this._clipPlanes.setViewSize(e,t),this._clipPlanes.aspectRatio=this._width/this._height,!0)}onManipulationUpdateEvent(e){return!!this._clipPlanes&&((e.mouseButtonType&a.MCD_ENUM.EventConstants.MOUSE_LBUTTON)!==a.MCD_ENUM.EventConstants.MOUSE_LBUTTON&&1!==e.touchCount||this._clipPlanes.onManipulationUpdate(e.x,e.y),!0)}onManipulationStartEvent(e){return!!this._clipPlanes&&(this._clipPlanes.onManipulationStart(e.x,e.y),this._modularCoreDisplay.locateAsync(JSON.stringify({LocateType:a.MCD_ENUM.LocateType.SurfacePoint,ScreenPosition:{x:e.x,y:e.y}})),!0)}onMouseDoubleClick(){0===this.getSelectedPlaneIds().length?this.invertClipping():this.hidePlanes(this.getSelectedPlaneIds())}onDoubleTap(){0===this.getSelectedPlaneIds().length?this.invertClipping():this.hidePlanes(this.getSelectedPlaneIds())}onLayout(e,t){this._width=e,this._height=t,this._clipPlanes.setViewSize(e,t)}onLocate(e){}onSurfaceLocate(e){return s(this,void 0,void 0,(function*(){this.locate(JSON.stringify(e))}))}}},vXm2:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("FYTm"),n=i("2T81"),a=i("o+o0"),o=i("Khlq");t.ViewAxis=class{constructor(e,t,i){this._dynamicMeshLayerName="Axis",this._featureLayerName="AxisText",this._fontPath="",this._axisPath="",this._jsonData=null,this._modularCoreDisplay=null,this._featureLayer=null,this._visibilty=!1,this._modularCoreDisplay=e||this.throwError("MCD recieved was null for ModularCoreDisplay"),this._fontPath=i||this.throwError("Font path recieved was null"),this._axisPath=t||this.throwError("Axis path recieved was null"),this.createDynamicMeshLayer(),this._featureLayer=new s.FeatureLayer(this._featureLayerName,this._modularCoreDisplay,[],0,!1,"secondary"),this.setFeatureLayerDefaultStyle()}throwError(e){throw e}get visibility(){return this._visibilty}requestData(e){return a.McdNetworkIO.fetchDataWithGet(e).then(e=>e)}createDynamicMeshLayer(){const e={"target-composite":"secondary"};e["target-name"]=this._dynamicMeshLayerName,e["target-type"]="DynamicMesh",e.hidden=!1,e.config={"overlay-rendering":!1},this._modularCoreDisplay.create("RenderTarget",JSON.stringify(e))}setMeshData(){if(this._jsonData.Geometry){const e=this._jsonData.Geometry,t={},i={};i.vertices=e.Vertices,i.colorindices=e.ColorIndices,i.colortable=e.ColorTable,i.triangleindices=e.TriangleIndices,t.setMesh=i,t["target-name"]=this._dynamicMeshLayerName,this._modularCoreDisplay.set("RenderTarget",JSON.stringify(t))}}setFeatureLayerDefaultStyle(){const e={"text-color":[.5,.5,.5,1],"text-shadow-color":[0,0,0,0],"text-background-color":[0,0,0,0],"text-point-size":12};e.font=this._fontPath,e["zoom-scale-rasters"]=!0,e.billboard=!0,e["zoom-scale-line"]=!0,e["zoom-scale-point"]=!0,e["enable-shadow"]=!1,this._featureLayer.setDefaultStyleToLayer(e)}setFeatureLayerData(){const e=this._jsonData.Geometry?this._jsonData.Geometry:{};if(e.Axis){const t=e.Axis,i=new n.Vec3(t.X.pos[0],t.X.pos[1],t.X.pos[2]),s=new n.Vec3(t.Y.pos[0],t.Y.pos[1],t.Y.pos[2]),a=new n.Vec3(t.Z.pos[0],t.Z.pos[1],t.Z.pos[2]),r="E"===t.X.text.toUpperCase()?o.MCD_ENUM.ViewAxisLocaleText.AXIS_E:o.MCD_ENUM.ViewAxisLocaleText.AXIS_X,l="N"===t.Y.text.toUpperCase()?o.MCD_ENUM.ViewAxisLocaleText.AXIS_N:o.MCD_ENUM.ViewAxisLocaleText.AXIS_Y,h="EL"===t.Z.text.toUpperCase()?o.MCD_ENUM.ViewAxisLocaleText.AXIS_El:o.MCD_ENUM.ViewAxisLocaleText.AXIS_Z,c=this._modularCoreDisplay.getLocaleString(r,"E"),_=this._modularCoreDisplay.getLocaleString(l,"N"),d=this._modularCoreDisplay.getLocaleString(h,"El");this._featureLayer.addText(1,c,i,"CENTRE"),this._featureLayer.addText(2,_,s,"CENTRE"),this._featureLayer.addText(3,d,a,"CENTRE")}}setAxisVisibilty(){const e={};e["target-name"]=this._dynamicMeshLayerName,e.visibility=this._visibilty,this._modularCoreDisplay.set("RenderTarget",JSON.stringify(e)),this._featureLayer.visible=this._visibilty,this._visibilty&&this._modularCoreDisplay.commitCameraChanges(o.MCD_ENUM.CommitAction.CT_Immediate)}display(e){this._visibilty=e,!this._jsonData&&this._visibilty?this.requestData(this._axisPath).then(e=>{this._jsonData=e,this.setMeshData(),this.setFeatureLayerData(),this.setAxisVisibilty()}):this.setAxisVisibilty()}clearLayers(){const e={};e["target-name"]=this._featureLayerName,this._modularCoreDisplay.destroy("RenderTarget",JSON.stringify(e)),e["target-name"]=this._dynamicMeshLayerName,this._modularCoreDisplay.destroy("RenderTarget",JSON.stringify(e))}updateLayers(e,t){this._fontPath=t||this._fontPath,this._axisPath=e||this._axisPath;const i={};i.font=this._fontPath,this._featureLayer.setDefaultStyleToLayer(i),this._jsonData=null,this.requestData(this._axisPath).then(e=>{this._jsonData=e,this.setMeshData(),this._featureLayer.removeFeature(1),this._featureLayer.removeFeature(2),this._featureLayer.removeFeature(3),this.setFeatureLayerData()})}}},xVJr:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var s=i("LRne"),n=i("eIep"),a=i("IzEk"),o=i("WjcW"),r=i("qSfU"),l=i("UVhF"),h=i("J7mc"),c=i("hqbt"),_=i("BltP"),d=i("ONOH"),m=i("fXoL");let u=(()=>{class e{constructor(e,t,i,s){this.dataService=e,this.securityService=t,this.configService=i,this.formService=s,this.IGDSWORKSPACEDEFINITION="IGDSWorkspaceDefinition",this.GDSWORKSPACEDEFINITION="GDSWorkspaceDefinition"}getWorkspaceDefinitions(e){const t=[`contains(Interfaces,'${this.IGDSWORKSPACEDEFINITION}')`];Object.keys(e).forEach(i=>{if(void 0!==e[i])switch(i){case"WorkspaceDefinitionFilterLastUpdatedDate":t.push(`${i} ge ${e[i]}`);break;case"WorkspaceDefinitionQuerySelectedConfigOnly":t.push(`${i} eq ${e[i]}`);break;default:t.push(`${i} eq '${e[i]}'`)}});const i=t.join(" and ");return this.dataService.get(`Objects?$filter=${i}&$top=1000`)}getWorkspaceDefinitionByName(e){return e?this.dataService.get(`Objects?$filter=(Name eq '${e}') and contains(Interfaces,'${this.IGDSWORKSPACEDEFINITION}')&$top=1`):Object(s.a)([])}getWorkspaceDefinitionQueryParams(e,t){const i={WorkspaceDefinitionName:e,WorkspaceDefinitionConfigUID:t},a=this.configService.getConfigLevel([t])[0].value===_.a.PROJECT;return i.WorkspaceDefinitionQuerySelectedConfigOnly=a?this.configService.queryBySelectedConfigs.toString():void 0,i.MarkedForRemovalBehaviour=a?"e1IncludeMarkedForRemoval":"e1ExcludeMarkedForRemoval",this.getCurrentUserOrganization().pipe(Object(n.a)(t=>(i.WorkspaceDefinitionOrganization=t,this.getFilterLastUpdateDate(e).pipe(Object(n.a)(e=>(i.WorkspaceDefinitionFilterLastUpdatedDate=e,Object(s.a)(i)))))))}createWorkspaceDefinition(e,t,i){const s=new o.a(this.GDSWORKSPACEDEFINITION);s.properties.push(new r.a("Name",e)),s.properties.push(new r.a("Description",t)),i.WorkspaceDefinitionName&&s.properties.push(new r.a("WorkspaceDefinitionName",i.WorkspaceDefinitionName)),i.WorkspaceDefinitionConfigUID&&s.properties.push(new r.a("WorkspaceDefinitionConfigUID",i.WorkspaceDefinitionConfigUID)),i.WorkspaceDefinitionOrganization&&s.properties.push(new r.a("WorkspaceDefinitionOrganization",i.WorkspaceDefinitionOrganization)),i.MarkedForRemovalBehaviour&&s.properties.push(new r.a("MarkedForRemovalBehaviour",i.MarkedForRemovalBehaviour));const n=i.WorkspaceDefinitionQuerySelectedConfigOnly,a=void 0===n?"False":"true"===n.toLowerCase()?"True":"False";return s.properties.push(new r.a("WorkspaceDefinitionQuerySelectedConfigOnly",a)),this.formService.createObjectFromCRUDObject(s)}ensureWorkspaceDefinitionForFilter(e,t){return this.getWorkspaceDefinitionQueryParams(e,t).pipe(Object(a.a)(1),Object(n.a)(t=>this.getWorkspaceDefinitions(t).pipe(Object(a.a)(1),Object(n.a)(i=>{if((null==i?void 0:i.length)>0)return Object(s.a)(i[0]);{const i=Date.now().toString();return this.createWorkspaceDefinition(`${e}${i}`,"",t).pipe(Object(a.a)(1),Object(n.a)(e=>Object(s.a)(e)))}}))))}getWorkspaceDefinitionFilter(e){return this.dataService.get(`Objects?$filter=(Name eq '${e}') and contains(Interfaces,'${this.IGDSWORKSPACEDEFINITION}')&$select=WorkspaceDefinitionName`).pipe(Object(n.a)(e=>Object(s.a)((null==e?void 0:e.length)>0?e[0].WorkspaceDefinitionName:void 0)))}getFilterLastUpdateDate(e){return this.dataService.get(`Objects?$filter=(UID eq '${e}')and contains(Interfaces,'ISDxiHubAdvanced3DFilter')&$select=LastUpdatedDate`).pipe(Object(a.a)(1),Object(n.a)(e=>(null==e?void 0:e.length)>0?Object(s.a)(e[0].LastUpdatedDate):Object(s.a)(void 0)))}getCurrentUserOrganization(){const e=this.securityService.getUserName();return this.dataService.get(`Objects?$filter=contains(Interfaces,'ISPFOrganization') and SPFUserOrganization_21/any(u:u/Name eq '${e}')`).pipe(Object(a.a)(1),Object(n.a)(e=>(null==e?void 0:e.length)>0?Object(s.a)(e[0].Name):Object(s.a)(void 0)))}}return e.\u0275fac=function(t){return new(t||e)(m.dc(h.a),m.dc(c.a),m.dc(d.a),m.dc(l.a))},e.\u0275prov=m.Ob({token:e,factory:e.\u0275fac}),e})()}}]);