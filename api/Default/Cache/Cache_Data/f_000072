(window.webpackJsonp=window.webpackJsonp||[]).push([[138],{GJmQ:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var o=i("7o/Q");function r(e,t=!1){return i=>i.lift(new n(e,t))}class n{constructor(e,t){this.predicate=e,this.inclusive=t}call(e,t){return t.subscribe(new s(e,this.predicate,this.inclusive))}}class s extends o.a{constructor(e,t,i){super(e),this.predicate=t,this.inclusive=i,this.index=0}_next(e){const t=this.destination;let i;try{i=this.predicate(e,this.index++)}catch(o){return void t.error(o)}this.nextOrComplete(e,i)}nextOrComplete(e,t){const i=this.destination;Boolean(t)?i.next(e):(this.inclusive&&i.next(e),i.complete())}}},s2r3:function(e,t,i){"use strict";i.r(t),i.d(t,"ViewReportsRoutingModule",(function(){return Q}));var o=i("ofXK"),r=i("3Pt+"),n=i("NFeN"),s=i("l3mi"),a=i("PMIr"),c=i("jc7h"),d=i("Z5SQ"),l=i("tyNb"),p=i("z6cu"),g=i("LRne"),h=i("IzEk"),_=i("JIr8"),u=i("5+tZ"),b=i("4B5/"),v=i("YwUS"),w=i("Z9D8"),f=i("LUpO"),m=i("JgG9"),S=i("c+03"),O=i("I2fW"),x=i("dEBh"),y=i("kx0E"),P=i("iwlc"),E=i("DG5G"),C=i("Ejbi"),I=i("OdF/"),T=i("XwBL"),R=i("yzqN"),G=i("yAwn"),M=i("ONOH"),D=i("08BJ"),A=i("fXoL"),k=i("DdQY"),L=i("FcA5"),F=i("yISo");function N(e,t){if(1&e){const e=A.Zb();A.Yb(0,"li",15),A.Yb(1,"a",16),A.hc("click",(function(){A.Kc(e);const i=t.$implicit;return A.lc(2).currentGrid=i})),A.Uc(2),A.Xb(),A.Xb()}if(2&e){const e=t.$implicit,i=A.lc(2);A.Ib("ui-tabview-selected",i.currentGrid===e)("ui-state-active",i.currentGrid===e),A.Eb(2),A.Wc(" ",i.configNames[e]," ")}}function X(e,t){if(1&e&&(A.Yb(0,"div",12),A.Yb(1,"ul",13),A.Sc(2,N,3,5,"li",14),A.Xb(),A.Xb()),2&e){const e=A.lc();A.Eb(2),A.sc("ngForOf",e.configs)}}function U(e,t){if(1&e){const e=A.Zb();A.Yb(0,"sda-button-primary",17),A.hc("click",(function(){A.Kc(e);const t=A.lc();return t.showDropdown=!t.showDropdown}))("mouseover",(function(){return A.Kc(e),A.lc().dropdownButtonHover=!0}))("mouseout",(function(){return A.Kc(e),A.lc().dropdownButtonHover=!1})),A.Xb()}if(2&e){const e=A.lc();A.sc("displayName",e.EDIT_PARAMETERS)}}function Y(e,t){if(1&e){const e=A.Zb();A.Yb(0,"button",21),A.hc("click",(function(){return A.Kc(e),A.lc(2).popoutWindow()})),A.Tb(1,"mat-icon",22),A.Xb()}}function z(e,t){if(1&e){const e=A.Zb();A.Yb(0,"div",18),A.Yb(1,"button",19),A.hc("click",(function(){A.Kc(e);const t=A.lc();return t.changePageSize("all"===t.grids[t.configsForGrids[t.currentGrid]].pageSize?"paginate":"all",t.configsForGrids[t.currentGrid])})),A.Uc(2),A.Xb(),A.Sc(3,Y,2,0,"button",20),A.Xb()}if(2&e){const e=A.lc();A.Eb(2),A.Wc(" ","all"===e.grids[e.configsForGrids[e.currentGrid]].pageSize?e.SHOW_X_PER_PAGE:e.SHOW_ALL," "),A.Eb(1),A.sc("ngIf",e.configs.length>1)}}function B(e,t){if(1&e&&A.Tb(0,"sda-kendo-grid",25),2&e){const e=A.lc().$implicit,t=A.lc();A.sc("gridOptions",t.grids[t.configsForGrids[e]].gridOptions)("disableSelectAll","all"===t.grids[t.configsForGrids[t.currentGrid]].pageSize)("gridId",t.configsForGrids[e])("configDataProperty","configUID")}}function j(e,t){if(1&e&&(A.Yb(0,"div",23),A.Sc(1,B,1,4,"sda-kendo-grid",24),A.Xb()),2&e){const e=t.$implicit,i=A.lc();A.Ib("view-report__content--active",i.currentGrid===e)("view-report__content--with-tabs",i.configs.length>1||i.showTabs),A.Eb(1),A.sc("ngIf",i.grids[i.configsForGrids[e]])}}const H=[{path:"",component:(()=>{class e{constructor(e,t,i,o,r,n,s,a,c,d,l,p,g,h,_,u,b){this.route=e,this.router=t,this.reportsService=i,this.windowService=o,this.loadingOverlayService=r,this.applicationSettingsService=n,this.sdaTranslateService=s,this.gridDataService=a,this.actionMenuProvider=c,this.helpService=d,this.columnService=l,this.objectIconService=p,this.exceptionService=g,this.filterQueryService=h,this.dataFormatService=_,this.configService=u,this.configDataService=b,this.dropdownButtonHover=!1,this.showDropdown=!1,this.showTabs=!1,this.configNames={},this.configs=[],this.configsForGrids={},this.EDIT_PARAMETERS=this.sdaTranslateService.get("EDIT_PARAMETERS","Edit Parameters"),this.LOADING_REPORT=this.sdaTranslateService.get("LOADING_REPORT","Loading Report..."),this.CURRENTLY_SHOWING_ALL=this.sdaTranslateService.get("CURRENTLY_SHOWING_ALL","Currently showing all"),this.SHOW_ALL=this.sdaTranslateService.get("SHOW_ALL","Show All"),this.IS_EQUAL_TO=this.sdaTranslateService.get("IS_EQUAL_TO","Is equal to");const v=Settings.application.defaultPageSize.toString();this.SHOW_X_PER_PAGE=this.sdaTranslateService.getFormatted("SHOW_X_PER_PAGE-PAGE_SIZE","Show {0} per page",[v]),this.CURRENTLY_SHOWING_X_PER_PAGE=this.sdaTranslateService.getFormatted("CURRENTLY_SHOWING_X_PER_PAGE-PAGE_SIZE","Currently showing {0} per page",[v]),this.helpService.setHandlers(R.F)}ngOnInit(){this.configSubscription=this.configDataService.configs$.pipe(Object(h.a)(1)).subscribe(e=>{e.forEach(e=>{this.configNames[e.ConfigUID]=e.DisplayName})}),this.route.params.subscribe(e=>{setTimeout(()=>{this.configs=[]},0),this.showDropdown=!1,this.grids={};const{obid:t,config:i,tabs:o}=e;o&&(this.showTabs=!0);const r=JSON.parse(i);this.reportsService.getReportDetails(t).subscribe(e=>{this.details=e.value,this.applicationSettingsService.setPageTitle(this.details.DisplayName),r.forEach(e=>{this.executeReport(e)})})})}ngOnDestroy(){this.configSubscription&&this.configSubscription.unsubscribe()}changePageSize(e,t){const i=this.grids[t];i.pageSize=e,setTimeout(()=>{this.getColumns(t).subscribe(e=>{i.gridOptions=Object.assign({},i.gridOptions,{dataSource:{data:i.data.Results,pageSize:"all"===i.pageSize?i.data.Results.length:Settings.application.defaultPageSize},columns:e})})}),this.actionMenuProvider.clearMultiSelectedItemHighlights()}editParameters(){const{params:e}=this.route.snapshot.params;this.router.navigate([`reports/${this.details.Id}/enter-params`,{params:e}])}executeReport(e){const{params:t}=this.route.snapshot.params;let i;t&&(i=JSON.parse(t)),this.loadingOverlayService.showLoadingOverlay(this.LOADING_REPORT),this.reportsService.executeReport(this.details,e,i).pipe(Object(_.a)(e=>{this.loadingOverlayService.hideLoadingOverlay();const t=new w.a(e,void 0,"view-report","executeReport");return Object(p.a)(t)}),Object(u.a)(t=>this.objectIconService.showIcons&&t.value.Results&&t.value.Results.length?this.gridDataService.setObjectIcons(t.value,"Results",e).pipe(Object(_.a)(e=>{const i=new w.a(e,void 0,"ViewReportComponent","executeReport");return this.exceptionService.handleException(i),Object(g.a)(t.value)})):Object(g.a)(t.value))).subscribe(t=>{this.setupGridOptions(e,t)})}popoutWindow(){const e=new RegExp('(;config=\\[".*"])');let t=decodeURIComponent(this.windowService.Window.location.href);t=t.replace(e,`;config=["${encodeURIComponent(this.currentGrid)}"];tabs=true`),this.windowService.Window.open(t);const i=this.configs.indexOf(this.currentGrid);this.configs.splice(i,1);const{params:o}=this.route.snapshot.params;this.currentGrid=this.configs[0],this.router.navigate([`/reports/${this.details.Id}/view-report`,{params:void 0!==o?o:"",config:JSON.stringify(this.configs),tabs:!0}])}closeDropdown(){this.showDropdown=!1}setupGridOptions(e,t){const i=e;e=T.a.encodeSpecialCharactersToUnicode(e),this.configsForGrids[i]=e,this.grids[e]={pageSize:"paginate"},this.grids[e].data=t,this.getColumns(e).subscribe(t=>{this.grids[e].gridOptions={dataSource:{data:this.grids[e].data.Results.map(t=>{for(const i of Object.keys(t))if(this.grids[e].data.ResultColumns){const o=this.grids[e].data.ResultColumns.filter(e=>e.Id===i);o&&o.length>0&&"UoMListType"===o[0].ScopedByType&&(t[i]=this.dataFormatService.convertToLocalUom(t[i],I.a.DOUBLE))}return t.configUID=i,t}),pageSize:Settings.application.defaultPageSize,schema:{model:{fields:this.getColumnSchema(e)}}},columns:t,sortable:!0,scrollable:!0,filterable:{operators:{nullableBoolean:{eq:this.IS_EQUAL_TO}}},filter:e=>(e.filter&&e.filter.filters.forEach(e=>{"true"===e.value?e.value=!0:"false"===e.value?e.value=!1:"nullableBooleanNull"===e.value&&(e.operator="isnull")}),e.filter),pageable:{input:!0,numeric:!1},columnMenu:{columns:!1},resizable:!0,page:()=>{this.resetSelectallButton()}},this.configs.push(i),this.sortForTabs(this.configs),this.currentGrid=this.configs[0],this.loadingOverlayService.hideLoadingOverlay()})}getColumnSchema(e){const t={};return this.grids[e].data.ResultColumns.forEach(e=>{t[e.Id]={edmModelType:e.ScopedByType,type:this.filterQueryService.parseTypeForGrid(e.ScopedByType)}}),t}getColumns(e){const t={};return this.grids[e].data.ResultColumns.map(e=>{let t;switch(e.ScopedByType){case"DoubleType":t="Edm.Double";break;case"DateTimeType":t="Edm.DateTimeOffset";break;case"YMDType":t="Edm.Date";break;case"IntType":t="Edm.Int";break;case"BooleanType":t="Edm.Boolean";break;default:t="Edm.String"}return{name:e.Id,displayName:e.DisplayAs,dateTimeAsString:e.IsDateTimeAsString,dateAsString:e.IsDateAsString,type:t,nullable:!1,sortable:!0,filterable:!0,filterableProperty:e.SelectList}}).forEach(e=>{t[e.name]=e}),this.columnService.create(t,!1,!1,!0,!0)}resetSelectallButton(){this.actionMenuProvider.clearMultiSelectedItemHighlights()}sortForTabs(e){if(e.length>1&&(e.sort((e,t)=>{const i=e.toUpperCase(),o=t.toUpperCase();return i.localeCompare(o,this.sdaTranslateService.locale)}),this.configService.selectedCreateConfig&&e[0]!==this.configService.selectedCreateConfig)){const t=e.findIndex(e=>e===this.configService.selectedCreateConfig);if(-1!==t){const i=e[t];e.splice(t,1),e.unshift(i)}}}}return e.\u0275fac=function(t){return new(t||e)(A.Sb(l.a),A.Sb(l.g),A.Sb(D.a),A.Sb(x.a),A.Sb(S.a),A.Sb(v.a),A.Sb(C.a),A.Sb(c.a),A.Sb(b.a),A.Sb(P.a),A.Sb(m.a),A.Sb(O.a),A.Sb(f.a),A.Sb(E.a),A.Sb(y.a),A.Sb(M.a),A.Sb(G.a))},e.\u0275cmp=A.Mb({type:e,selectors:[["sda-view-report-view"]],decls:13,vars:15,consts:[[1,"view-report"],["class","view-report__tabs ui-tabview ui-widget ui-widget-content ui-corner-all ui-tabview-top",4,"ngIf"],[1,"view-report__toolbar"],[1,"view-report__toolbar__buttons"],["class","view-report__toolbar__button",3,"displayName","click","mouseover","mouseout",4,"ngIf"],[1,"view-report__dropdown__container"],[1,"view-report__dropdown"],[1,"view-report__dropdown__header"],["svgIcon","close",1,"view-report__dropdown__close-button",3,"click"],["type","component"],["class","view-report__toggle",4,"ngIf"],["class","view-report__content",3,"view-report__content--active","view-report__content--with-tabs",4,"ngFor","ngForOf"],[1,"view-report__tabs","ui-tabview","ui-widget","ui-widget-content","ui-corner-all","ui-tabview-top"],[1,"ui-tabview-nav","ui-helper-reset","ui-helper-clearfix","ui-widget-header","ui-corner-all"],["class","ui-state-default ui-corner-top",3,"ui-tabview-selected","ui-state-active",4,"ngFor","ngForOf"],[1,"ui-state-default","ui-corner-top"],[3,"click"],[1,"view-report__toolbar__button",3,"displayName","click","mouseover","mouseout"],[1,"view-report__toggle"],[1,"view-report__toggle__button","sda-button","sda-button--red",3,"click"],["class","view-report__toggle__button view-report__toggle__button--external sda-button",3,"click",4,"ngIf"],[1,"view-report__toggle__button","view-report__toggle__button--external","sda-button",3,"click"],["svgIcon","external-link",1,"view-report__toggle__icon"],[1,"view-report__content"],[3,"gridOptions","disableSelectAll","gridId","configDataProperty",4,"ngIf"],[3,"gridOptions","disableSelectAll","gridId","configDataProperty"]],template:function(e,t){1&e&&(A.Yb(0,"div",0),A.Sc(1,X,3,1,"div",1),A.Yb(2,"div",2),A.Yb(3,"div",3),A.Sc(4,U,1,1,"sda-button-primary",4),A.Yb(5,"div",5),A.Yb(6,"div",6),A.Yb(7,"div",7),A.Uc(8),A.Yb(9,"mat-icon",8),A.hc("click",(function(){return t.closeDropdown()})),A.Xb(),A.Xb(),A.Tb(10,"sda-enter-params-view",9),A.Xb(),A.Xb(),A.Xb(),A.Sc(11,z,4,2,"div",10),A.Xb(),A.Sc(12,j,2,5,"div",11),A.Xb()),2&e&&(A.Eb(1),A.sc("ngIf",t.configs.length>1||t.showTabs),A.Eb(1),A.Ib("view-report__toolbar--loaded",null==t.grids[t.configsForGrids[t.currentGrid]]?null:t.grids[t.configsForGrids[t.currentGrid]].gridOptions)("view-report__toolbar--with-tabs",t.configs.length>1||t.showTabs),A.Eb(2),A.sc("ngIf",t.details&&t.details["ReportParameters@odata.count"]>0),A.Eb(1),A.Ib("view-report__dropdown__container--hidden",!t.showDropdown)("view-report__dropdown__container--active",t.showDropdown),A.Eb(2),A.Ib("view-report__dropdown__header--light-blue",t.dropdownButtonHover),A.Eb(1),A.Wc(" ",t.EDIT_PARAMETERS," "),A.Eb(3),A.sc("ngIf",null==t.grids[t.configsForGrids[t.currentGrid]]?null:t.grids[t.configsForGrids[t.currentGrid]].data.Results.length),A.Eb(1),A.sc("ngForOf",t.configs))},directives:[o.t,n.a,k.a,o.s,L.a,F.a],styles:["[_nghost-%COMP%]     .view-report__dropdown .enter-params__fields{overflow-x:hidden;overflow-y:auto}[_nghost-%COMP%], [_nghost-%COMP%]     .view-report, [_nghost-%COMP%]     .view-report__content{position:relative;display:flex;flex:1;flex-direction:column;overflow:hidden}[_nghost-%COMP%]     .view-report__tabs{position:absolute;top:0;left:0;right:0;height:42px;z-index:100!important}[_nghost-%COMP%]     .view-report__content{display:none}[_nghost-%COMP%]     .view-report__content--active{display:flex}[_nghost-%COMP%]     .view-report__content--with-tabs{margin-top:42px}[_nghost-%COMP%]     .view-report__toolbar{position:absolute;top:7px;left:78px;right:368px;display:none;height:34px;z-index:100!important}@media screen and (max-width:36.25em){[_nghost-%COMP%]     .view-report__toolbar{display:none!important}}[_nghost-%COMP%]     .view-report__toolbar--loaded{display:flex}[_nghost-%COMP%]     .view-report__toolbar--with-tabs{top:49px}@media screen and (max-width:54.375em){[_nghost-%COMP%]     .view-report__toolbar__button{display:none!important}}[_nghost-%COMP%]     .view-report__dropdown{background-color:#fff;width:645px;height:360px}[_nghost-%COMP%]     .view-report__dropdown__container{position:absolute;background-color:#fff;border:1px solid #0087c8;box-shadow:0 5px 10px rgba(0,0,0,.1);border-radius:3px;visibility:hidden;width:177px;height:34px;margin-top:-34px;-webkit-transform:translateZ(0);transform:translateZ(0);overflow:hidden;z-index:300!important}[_nghost-%COMP%]     .view-report__dropdown__container--active{visibility:visible;width:647px;height:360px;border-color:#cad0d7;transition:visibility 0s,width .2s linear,height .2s linear,border-color .2s linear}[_nghost-%COMP%]     .view-report__dropdown__container--active .view-report__dropdown__header{background-color:#ebedf0;color:#697a8b}[_nghost-%COMP%]     .view-report__dropdown__container--active .view-report__dropdown__close-button{opacity:1}[_nghost-%COMP%]     .view-report__dropdown__container--hidden{visibility:hidden;width:148px;height:34px;transition:visibility 0s .3s,width .2s linear,height .2s linear,border-color .2s linear}[_nghost-%COMP%]     .view-report__dropdown__close-button{width:18px;height:18px;cursor:pointer}[_nghost-%COMP%]     .view-report__dropdown__header{display:flex;justify-content:space-between;background-color:#007faa;text-transform:uppercase;border-bottom:1px solid rgba(0,0,0,.1);padding:8px 12px;font-size:14px;font-weight:500;color:#fff;transition:background .2s linear,color .2s linear}[_nghost-%COMP%]     .view-report__dropdown__header--light-blue{background-color:#006691}[_nghost-%COMP%]     .view-report__dropdown sda-enter-params-view{overflow:hidden}[_nghost-%COMP%]     .view-report__dropdown .enter-params__container{width:auto!important;border:none!important;padding:0!important}[_nghost-%COMP%]     .view-report__dropdown .enter-params__container__title, [_nghost-%COMP%]     .view-report__dropdown .enter-params__toolbar{display:none}[_nghost-%COMP%]     .view-report__dropdown .enter-params__fields{height:269px;padding:15px 18px}[_nghost-%COMP%]     .view-report__dropdown .enter-params-actions{height:55px;padding:0 15px;background-color:rgba(0,0,0,.05);border-top:1px solid rgba(0,0,0,.1)}[_nghost-%COMP%]     .view-report__toggle{margin-left:auto}[_nghost-%COMP%]     .view-report__toggle__button{margin-left:15px;padding:8px 10px 6px;font-size:14px}@media screen and (max-width:54.375em){[_nghost-%COMP%]     .view-report__toggle__button{display:none}}[_nghost-%COMP%]     .view-report__toggle__button--external{min-width:0;margin-left:5px;padding-right:10px;padding-left:10px}@media screen and (max-width:54.375em){[_nghost-%COMP%]     .view-report__toggle__button--external{display:block}}[_nghost-%COMP%]     .view-report__toggle__icon{width:18px;height:18px;vertical-align:middle}"]}),e})()}];let W=(()=>{class e{}return e.\u0275mod=A.Qb({type:e}),e.\u0275inj=A.Pb({factory:function(t){return new(t||e)},imports:[[l.k.forChild(H)],l.k]}),e})(),Q=(()=>{class e{}return e.\u0275mod=A.Qb({type:e}),e.\u0275inj=A.Pb({factory:function(t){return new(t||e)},providers:[c.a],imports:[[o.c,s.a,r.j,a.a,d.a,W,n.b]]}),e})()}}]);