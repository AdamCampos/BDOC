(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{"/d3C":function(e,t,s){"use strict";s.d(t,"a",(function(){return T}));var i=s("fXoL"),n=s("LRne"),a=s("vkgz"),o=s("eIep"),r=s("5+tZ"),l=s("IzEk"),c=s("7c1w"),h=s("ONOH"),d=s("POgZ"),u=s("ayYE"),p=s("TvZe"),b=s("Sj5/"),f=s("ghPn"),g=s("N/AQ"),S=s("A3La"),m=s("Teex"),O=s("Ejbi"),D=s("UVhF"),y=s("ZW2Q"),I=s("pyKC"),C=s("XcX5"),w=s("raf2"),v=s("Dmzp");let T=(()=>{class e extends C.a{constructor(e,t,s,n,a,o,r){super(e,t,s),this.sdaTranslateService=e,this.relationshipItemsService=t,this.formService=s,this.odataService=n,this.configService=a,this.relDetailsService=o,this.columnSetRepository=r,this.objectsViewMode=w.a.Grid,this.allResults=[],this.preSelectedObjects=[],this.RELATIONSHIP_FILTER_ADD=this.sdaTranslateService.get("RELATIONSHIP_FILTER_ADD","ADD"),this.REQUIRES_PARENT_SELECTION=this.sdaTranslateService.get("REQUIRES_PARENT_SELECTION","Requires parent selection"),this.searchTerm="*",this.clearSelectedItems=!1,this.resetResultsTriggered=new i.o,this.NAME_LABEL=this.sdaTranslateService.get("FILE_UPLOAD_NAME","Name"),this.DESCRIPTION_LABEL=this.sdaTranslateService.get("DESCRIPTION_LABEL","Description"),this.addedOptions=[],this.peekResults=new p.a(void 0),this.peekFunction=e=>this.peekSearchQuery(e)}ngOnInit(){this.initializeComponent(),this.placeholder=this.sdaTranslateService.getFormatted("RELATIONSHIP_FILTER_SEARCH_PLACEHOLDER","Search {0}",[this.field.DisplayName]),this.searchTooltip=this.sdaTranslateService.getFormatted("RELATIONSHIP_FILTER_SEARCH_TOOLTIP","Filter {0}",[this.field.DisplayName]),this.navigationPath=this.field.EdgeDefUID?this.field.EdgeDefUID:this.field.NavigationPath,this.searchFilters=[new b.a("Name",this.NAME_LABEL,!0,!0),new b.a("Description",this.DESCRIPTION_LABEL,!1,!1)],this.getFilterColumnsetDetails().pipe(Object(a.a)(e=>{this.filterColumnSetUID=e}),Object(o.a)(()=>this.columnSetRepository.getColumnSetByRel(this.relDetailsService.getRelDefDirection(this.navigationPath)))).subscribe(e=>{e.ColumnItems.forEach(e=>{"CI_Name"!==e.UID&&"CI_Description"!==e.UID&&this.searchFilters.push(new b.a(e.UID,e.FriendlyName,!1,!1))})}),this.field.refreshOptionsEvent=new i.o,this.fieldOptionsRefreshSubscription=this.field.refreshOptionsEvent.subscribe(()=>this.onParentChanged()),this.setPreselectedOptions(),this.addPreselectedObjects()}ngOnDestroy(){this.fieldOptionsRefreshSubscription&&this.fieldOptionsRefreshSubscription.unsubscribe()}peekSearchQuery(e){const t=this.getStringArrayFromFilters(e.selectedFilters);return this.getDropDownOptions(e.searchTerm,t,!!e.selectedOptions&&!!e.selectedOptions.length,e.top,e.skip,e.loadMore).pipe(Object(r.a)(t=>this.onPeekCompleted(t,e.loadMore)))}onPeekCompleted(e,t){const s=new p.a(void 0);if(s.results=[],e&&e.value.length>0){const i=[],n=[];s.displayedCount=e.value.length,e.value.forEach(e=>{i.push(new y.a(e.OBID,e.Name,e.Name,!1,"",!1,"",e.ClassDef,e.SecondaryDisplayValue));const t=new f.b(e.Name,e.DisplayValue);t.secondaryDisplayName=e.SecondaryDisplayValue,s.results.push(t),n.push({OBID:e.OBID,Name:e.Name,UID:e.UID,ClassDef:e.ClassDef})}),t?(this.allResults=this.allResults.concat(n),this.clearSelectedItems=!1,this.field.dropDownOptions=this.field.dropDownOptions.concat(i),this.peekResults.results=this.peekResults.results.concat(s.results),this.peekResults.displayedCount=this.peekResults.displayedCount+s.displayedCount):(s.totalCount=e.count,this.allResults=n,this.clearSelectedItems=!0,this.field.dropDownOptions=i,this.peekResults=s)}else this.peekResults=s;return Object(n.a)(this.peekResults)}handleAddedObjects(e){this.addedOptions=[],e.forEach(e=>{const t=new y.a(e.OBID,e.Name,e.Name,!1,"",!1,"",e.ClassDef);this.addedOptions.push(t)}),this.handleSelectedItemsChange(this.addedOptions)}searchTermUpdated(e){this.searchTerm=e}onParentChanged(){this.resetResultsTriggered.emit()}getFilterColumnsetDetails(){return this.getDisplayItemFilterColumnsetDetails().pipe(Object(l.a)(1),Object(o.a)(e=>{if(e&&e.value){const t=e.value[0].SPFDisplayItemFilterColumnset_12;return t&&t.UID?Object(n.a)(t.UID):Object(n.a)("CS_SPFNameDescription")}return Object(n.a)("CS_SPFNameDescription")}))}getDisplayItemFilterColumnsetDetails(){return this.odataService.get("Objects?$filter=Class eq 'SPFDisplayItem' and UID eq '"+this.field.UID+"'&$expand=SPFDisplayItemFilterColumnset_12",this.configService.selectedCreateConfig)}addPreselectedObjects(){if(this.field.Value&&!this.field.ReadOnly||this.field.ContextOBIDs&&this.field.ContextOBIDs.length>0){this.field.showLoadingIndicator=!0;const e=this.field.ContextOBIDs&&this.field.ContextOBIDs.length>0?this.field.ContextOBIDs:this.dropDownOptionsOBIDs,t=e.map(e=>e).join("~");this.formService.getFormDropDownOptionsWithSearch(this.field.UID,t,this.field.NavigationPath,["OBID"],!0).pipe(Object(l.a)(1)).subscribe(t=>{this.preSelectDropDownOptionsFromValue(t.value,e)})}}preSelectDropDownOptionsFromValue(e,t){if(e&&e.length>0){const s=e.filter(e=>t.filter(t=>e.OBID===t).length>0);let i;i=s?s.map(e=>new y.a(e.OBID,e.DisplayValue,e.DisplayValue,!1,e.Description,!1,"",e.ClassDef,e.SecondaryDisplayValue)):this.selectedItems,this.setPreselectedObjects(i)}this.field.showLoadingIndicator=!1,this.field.awaitingParentSelection=!0}setPreselectedObjects(e){const t=[];e.forEach(e=>{t.push({OBID:e.obid,Name:e.name,UID:e.uid,ClassDef:e.classDef})}),this.preSelectedObjects=t}}return e.\u0275fac=function(t){return new(t||e)(i.Sb(O.a),i.Sb(I.a),i.Sb(D.a),i.Sb(S.a),i.Sb(h.a),i.Sb(m.a),i.Sb(u.a))},e.\u0275cmp=i.Mb({type:e,selectors:[["sda-relationship-filter-type"]],inputs:{objectsViewMode:"objectsViewMode"},features:[i.Db([c.a,d.a,g.a]),i.Bb],decls:1,vars:17,consts:[[3,"searchTerm","searchPlaceholder","filters","searchTooltip","isDisabled","actionButtonDisplayName","disabledPlaceholder","filterColumnSetUID","navigationPath","isLoading","preSelectedObjects","objectsViewMode","peekFunction","clearSelectedItems","allResults","field","resetResultsTriggered","onAddObjects","searchTermUpdated"]],template:function(e,t){1&e&&(i.Yb(0,"sda-relationship-filter-wrapper",0),i.hc("onAddObjects",(function(e){return t.handleAddedObjects(e)}))("searchTermUpdated",(function(e){return t.searchTermUpdated(e)})),i.Xb()),2&e&&i.sc("searchTerm",t.searchTerm)("searchPlaceholder",t.placeholder)("filters",t.searchFilters)("searchTooltip",t.searchTooltip)("isDisabled",!1===t.field.awaitingParentSelection)("actionButtonDisplayName",t.RELATIONSHIP_FILTER_ADD)("disabledPlaceholder",t.REQUIRES_PARENT_SELECTION)("filterColumnSetUID",t.filterColumnSetUID)("navigationPath",t.navigationPath)("isLoading",t.field.showLoadingIndicator)("preSelectedObjects",t.preSelectedObjects)("objectsViewMode",t.objectsViewMode)("peekFunction",t.peekFunction)("clearSelectedItems",t.clearSelectedItems)("allResults",t.allResults)("field",t.field)("resetResultsTriggered",t.resetResultsTriggered)},directives:[v.a],styles:["[_nghost-%COMP%]{display:flex;width:100%}"]}),e})()},"4JBC":function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var i=function(e){return e[e.Info=0]="Info",e[e.Success=1]="Success",e[e.Warning=2]="Warning",e[e.Error=3]="Error",e[e.Dark=4]="Dark",e}({})},"7CaW":function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var i=s("fXoL"),n=s("ofXK"),a=s("7zfz");s("R0Ic");let o=(()=>{let e=class{};return e.\u0275mod=i.Qb({type:e}),e.\u0275inj=i.Pb({factory:function(t){return new(t||e)},imports:[[n.c],a.e]}),e})()},"8/aj":function(e,t,s){"use strict";s.d(t,"a",(function(){return g}));var i=s("fXoL"),n=(s("4JBC"),s("ofXK")),a=s("NFeN");function o(e,t){if(1&e&&i.Tb(0,"mat-icon",11),2&e){const e=i.lc(3);i.sc("svgIcon",e.bannerIcon)}}function r(e,t){if(1&e&&(i.Yb(0,"h4",9),i.Sc(1,o,1,1,"mat-icon",10),i.Uc(2),i.Xb()),2&e){const e=i.lc(2);i.Eb(1),i.sc("ngIf",e.showBannerIcon),i.Eb(1),i.Wc(" ",e.bannerTypeText," ")}}function l(e,t){if(1&e&&(i.Yb(0,"p",12),i.Uc(1),i.Xb()),2&e){const e=i.lc(2);i.Eb(1),i.Vc(e.bannerText)}}function c(e,t){if(1&e&&(i.Yb(0,"li",15),i.Uc(1),i.Xb()),2&e){const e=t.$implicit;i.Eb(1),i.Vc(e)}}function h(e,t){if(1&e&&(i.Yb(0,"ul",13),i.Sc(1,c,2,1,"li",14),i.Xb()),2&e){const e=i.lc(2);i.Eb(1),i.sc("ngForOf",e.bannerList)}}function d(e,t){if(1&e&&(i.Yb(0,"p",12),i.Uc(1),i.Xb()),2&e){const e=i.lc(2);i.Eb(1),i.Vc(e.bannerExtraText)}}function u(e,t){if(1&e){const e=i.Zb();i.Yb(0,"mat-icon",16),i.hc("click",(function(){return i.Kc(e),i.lc(2).closeBanner()})),i.Xb()}2&e&&i.sc("svgIcon","close")}function p(e,t){if(1&e&&(i.Yb(0,"div",1),i.Yb(1,"div",2),i.Yb(2,"div",3),i.Sc(3,r,3,2,"h4",4),i.Sc(4,l,2,1,"p",5),i.Sc(5,h,2,1,"ul",6),i.qc(6),i.Sc(7,d,2,1,"p",5),i.Xb(),i.Sc(8,u,1,1,"mat-icon",7),i.Xb(),i.Yb(9,"div",8),i.qc(10,1),i.Xb(),i.Xb()),2&e){const e=i.lc();i.Rc("max-width",e.maxWidth,"px"),i.Ib("banner--compact",e.isCompact)("banner--full",e.isFullWidth)("banner--info",0===e.bannerType)("banner--warning",2===e.bannerType),i.Eb(3),i.sc("ngIf",e.showBannerType),i.Eb(1),i.sc("ngIf",e.bannerText),i.Eb(1),i.sc("ngIf",(null==e.bannerList?null:e.bannerList.length)>0),i.Eb(2),i.sc("ngIf",e.bannerExtraText),i.Eb(1),i.sc("ngIf",e.showCloseIcon)}}const b=[[["",8,"sda-banner-content-hook"]],[["",8,"sda-banner-actions-hook"]]],f=[".sda-banner-content-hook",".sda-banner-actions-hook"];let g=(()=>{class e{constructor(){this.isCompact=!1,this.isFullWidth=!1,this.bannerIcon="error",this.showBannerType=!0,this.showBannerIcon=!0,this.showCloseIcon=!1,this.bannerClosed=!1,this.onBannerClosed=new i.o}closeBanner(){this.bannerClosed=!0,this.onBannerClosed.emit(this.bannerClosed)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Mb({type:e,selectors:[["sda-banner"]],inputs:{isCompact:"isCompact",isFullWidth:"isFullWidth",maxWidth:"maxWidth",bannerType:"bannerType",bannerTypeText:"bannerTypeText",bannerText:"bannerText",bannerExtraText:"bannerExtraText",bannerList:"bannerList",bannerIcon:"bannerIcon",showBannerType:"showBannerType",showBannerIcon:"showBannerIcon",showCloseIcon:"showCloseIcon",bannerClosed:"bannerClosed"},outputs:{onBannerClosed:"onBannerClosed"},ngContentSelectors:f,decls:1,vars:1,consts:[["class","banner",3,"banner--compact","banner--full","banner--info","banner--warning","maxWidth",4,"ngIf"],[1,"banner"],[1,"banner-header"],[1,"banner-header__content"],["class","banner-header__type",4,"ngIf"],["class","banner-header__message",4,"ngIf"],["class","banner-list",4,"ngIf"],["class","banner-header__close",3,"svgIcon","click",4,"ngIf"],[1,"banner-actions"],[1,"banner-header__type"],["class","banner-header__icon",3,"svgIcon",4,"ngIf"],[1,"banner-header__icon",3,"svgIcon"],[1,"banner-header__message"],[1,"banner-list"],["class","banner-list__item",4,"ngFor","ngForOf"],[1,"banner-list__item"],[1,"banner-header__close",3,"svgIcon","click"]],template:function(e,t){1&e&&(i.rc(b),i.Sc(0,p,11,15,"div",0)),2&e&&i.sc("ngIf",!t.bannerClosed)},directives:[n.t,a.a,n.s],styles:["[_nghost-%COMP%]{display:flex;flex-shrink:0;justify-content:center}.banner[_ngcontent-%COMP%]{align-self:center;margin:10px;border:1px solid #8997a5;border-radius:2px;overflow:hidden;box-shadow:0 2px 1px -1px rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 1px 3px 0 rgba(0,0,0,.12)}.banner--full[_ngcontent-%COMP%]{width:100%}.banner--compact[_ngcontent-%COMP%]   .banner-header__content[_ngcontent-%COMP%]{flex-direction:row;align-items:center}.banner--compact[_ngcontent-%COMP%]   .banner-header__type[_ngcontent-%COMP%]{margin-bottom:0}.banner--info[_ngcontent-%COMP%]{border-color:#0087c8}.banner--info[_ngcontent-%COMP%]   .banner-header[_ngcontent-%COMP%]{background-color:#e8f7ff}.banner--info[_ngcontent-%COMP%]   .banner-header__icon[_ngcontent-%COMP%]{color:#02adff}.banner--info[_ngcontent-%COMP%]   .banner-actions[_ngcontent-%COMP%]{border-top-color:#0087c8}.banner--warning[_ngcontent-%COMP%]{border-color:#d1a00c}.banner--warning[_ngcontent-%COMP%]   .banner-header[_ngcontent-%COMP%]{background-color:#fcefc7}.banner--warning[_ngcontent-%COMP%]   .banner-header__icon[_ngcontent-%COMP%]{color:#f2bf25}.banner--warning[_ngcontent-%COMP%]   .banner-actions[_ngcontent-%COMP%]{border-top-color:#d1a00c}.banner-header[_ngcontent-%COMP%]{display:flex;flex-shrink:0;padding:8px;background-color:#ebedf0}.banner-header__content[_ngcontent-%COMP%]{display:flex;flex-flow:column wrap;width:100%}.banner-header__type[_ngcontent-%COMP%]{display:flex;align-items:center;margin-right:5px;margin-bottom:5px;color:#1f2429;font-weight:500}.banner-header__icon[_ngcontent-%COMP%]{flex-shrink:0;width:18px;height:18px;margin-right:8px}.banner-header__message[_ngcontent-%COMP%]{font-size:14px}.banner-header__message[_ngcontent-%COMP%]:not(:first-of-type){width:100%;margin-top:8px}.banner-header__message[_ngcontent-%COMP%] + .banner-list[_ngcontent-%COMP%]{margin-top:8px}.banner-header__close[_ngcontent-%COMP%]{flex-shrink:0;align-self:flex-start;width:16px;height:16px;margin-left:15px;cursor:pointer;opacity:.6;transition:opacity .15s linear}.banner-header__close[_ngcontent-%COMP%]:hover{opacity:1}.banner-list[_ngcontent-%COMP%]{width:100%;padding-left:20px;font-size:14px}.banner-list__item[_ngcontent-%COMP%]{list-style:circle}.banner-list[_ngcontent-%COMP%] + .banner-header__message[_ngcontent-%COMP%]{margin-top:8px}.banner-actions[_ngcontent-%COMP%]:not(:empty){display:flex;justify-content:flex-end;padding:8px;border-top:1px solid #8997a5}.banner-actions[_ngcontent-%COMP%]:not(:empty)     .sda-banner-actions-hook{display:flex;flex:1;justify-content:flex-end;flex-wrap:wrap;align-items:center}.banner-actions[_ngcontent-%COMP%]:not(:empty)     .button{margin-left:10px}"]}),e})()},"9X43":function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var i=s("WG3B"),n=s("fXoL");let a=(()=>{class e{}return e.\u0275mod=n.Qb({type:e}),e.\u0275inj=n.Pb({factory:function(t){return new(t||e)},imports:[[i.o]]}),e})()},AujL:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var i=s("ofXK"),n=s("NFeN"),a=s("fXoL");let o=(()=>{class e{}return e.\u0275mod=a.Qb({type:e}),e.\u0275inj=a.Pb({factory:function(t){return new(t||e)},imports:[[i.c,n.b]]}),e})()},CakU:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var i=s("GDd0"),n=s("fXoL");let a=(()=>{class e{}return e.\u0275mod=n.Qb({type:e}),e.\u0275inj=n.Pb({factory:function(t){return new(t||e)},imports:[[i.a]]}),e})()},"HPu/":function(e,t,s){"use strict";s.d(t,"a",(function(){return O}));var i=s("ofXK"),n=s("3Pt+"),a=s("bTqV"),o=s("bSwM"),r=s("NFeN"),l=s("STbY"),c=s("Qu3c"),h=s("8yBR"),d=s("BMkO"),u=s("l3mi"),p=s("mQCr"),b=s("wA8e"),f=s("2wiT"),g=s("mZKE"),S=s("VL22"),m=s("fXoL");let O=(()=>{class e{}return e.\u0275mod=m.Qb({type:e}),e.\u0275inj=m.Pb({factory:function(t){return new(t||e)},providers:[S.a,g.a],imports:[[o.b,h.e,o.b,i.c,n.j,f.a,a.b,b.a,p.a,u.a,r.b,d.a,l.c,c.b]]}),e})()},ILbM:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var i=s("ofXK"),n=s("3Pt+"),a=s("72+7"),o=s("fXoL");let r=(()=>{class e{}return e.\u0275mod=o.Qb({type:e}),e.\u0275inj=o.Pb({factory:function(t){return new(t||e)},imports:[[i.c,n.j,a.a]]}),e})()},VoKn:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var i=s("l3mi"),n=s("fXoL");let a=(()=>{class e{}return e.\u0275mod=n.Qb({type:e}),e.\u0275inj=n.Pb({factory:function(t){return new(t||e)},imports:[[i.a]]}),e})()},XcX5:function(e,t,s){"use strict";s.d(t,"a",(function(){return u}));var i=s("tk/3"),n=s("itXk"),a=s("lJxs"),o=s("4vCl"),r=s("Ejbi"),l=s("UVhF"),c=s("pyKC"),h=s("xNQ3"),d=s("fXoL");let u=(()=>{class e extends h.a{constructor(e,t,s){super(e,t),this.sdaTranslateService=e,this.relationshipItemsService=t,this.formService=s}getStringArrayFromFilters(e){const t=[];return e.forEach(e=>{t.push(e.name)}),t}getDropDownOptions(e,t,s,i,n,a=!0){return this.field.selectedParentItems?this.getFormDependentOptionsForDependentItemsWithSearch(e,t,s,i,n):this.getFormDropDownOptionsWithSearch(e,t,s,i,n,a)}getFormDependentOptionsForDependentItemsWithSearch(e,t,s,i,n){return this.formService.getFormDropDownOptionsForDependentItemWithSearch(this.field.UID,e,this.field.selectedParentItems,t,s,i,n)}getFormDropDownOptionsWithSearch(e,t,s,r,l,c=!0){if(c)return this.formService.getFormDropDownOptionsWithSearch(this.field.UID,e,this.field.NavigationPath,t,s,r,l,!1);{const c=this.formService.getFormDropDownOptionsWithSearch(this.field.UID,e,this.field.NavigationPath,t,s,r,l,!0),h=this.formService.getFormDropDownOptionsWithSearch(this.field.UID,e,this.field.NavigationPath,t,s,r,l,!1);return Object(n.a)(c,h).pipe(Object(a.a)(([e,t])=>{const s=new o.a(new i.e);return s.count=e.count,s.value=t.value,s}))}}}return e.\u0275fac=function(t){return new(t||e)(d.Sb(r.a),d.Sb(c.a),d.Sb(l.a))},e.\u0275dir=d.Nb({type:e,features:[d.Bb]}),e})()},c4zF:function(e,t,s){"use strict";s.d(t,"a",(function(){return F}));var i=s("XNiG"),n=s("LRne"),a=s("IzEk"),o=s("vkgz"),r=s("eIep"),l=s("YwUS"),c=s("m8I0"),h=s("Z9D8"),d=s("LUpO"),u=s("C4gn"),p=s("c+03"),b=s("UwO9"),f=s("jNCI"),g=s("PEjJ"),S=s("wpY2"),m=s("cee5"),O=s("Ejbi"),D=s("NEWU"),y=s("f9sw"),I=s("gBNM"),C=s("41Lq"),w=s("biIz"),v=s("hFXt"),T=s("fXoL"),_=s("tyNb"),E=s("ofXK"),R=s("pQW9"),P=s("HXFx");function x(e,t){if(1&e&&T.Tb(0,"sda-tabbed-grid-view",3),2&e){const e=T.lc();T.sc("tabs",e.roleTabs)("layout",e.layout)}}function B(e,t){if(1&e&&T.Tb(0,"sda-tabbed-grid-view",3),2&e){const e=T.lc();T.sc("tabs",e.userTabs)("layout",e.layout)}}let F=(()=>{class e extends v.a{constructor(e,t,s,n,a,o,r,l,h,d,u,p,b,f){super(e,t,s,n,a,o,r,l,h),this.modalService=e,this.exceptionService=t,this.notificationService=s,this.dataRefreshService=n,this.todoListService=a,this.sdaTranslateService=o,this.router=r,this.timeoutService=l,this.lockService=h,this.route=d,this.featureSetNavigationService=u,this.loadingOverlayService=p,this.saveChangesDialogService=b,this.applicationSettingsService=f,this.layout=y.a.List,this.roleTabs=[],this.userTabs=[],this.selectedRoles=[],this.selectedUsers=[],this.finishButtonType=c.a.Primary,this.rolesConfigured="",this.displayRolesTab=!1,this.stepDefName="",this.initialized=!1,this.getUsersForSelectedRoleSubject=new i.a,this.multiUserSelection=!1}ngOnInit(){this.applicationSettingsService.setPageTitle(this.TITLE),this.setUpRoles(),this.setUpGridTabsSubscription()}ngOnDestroy(){this.getUsersForSelectedRoleSubject&&this.getUsersForSelectedRoleSubject.unsubscribe()}canDeactivate(){let e=Promise.resolve(!0);return this.selectedUsers.length>0&&(e=this.saveChangesDialogService.showDialog()),e}onFinish(){this.loadingOverlayService.showLoadingOverlay(),this.processStep().subscribe(()=>{this.selectedUsers.splice(0),this.notificationService.success(this.SUCCESS),this.featureSetNavigationService.navigateBack(),this.onFinishComplete(),this.loadingOverlayService.hideLoadingOverlay()},e=>{this.exceptionService.handleException(new h.a(e,this.ERROR)),this.onFinishComplete(),this.loadingOverlayService.hideLoadingOverlay()})}setUpRouteData(e){this.steps=JSON.parse(e.get(D.u)),e.has(D.k)&&e.get(D.k)&&(this.displayRolesTab="true"===e.get(D.k).toLocaleLowerCase()),e.has(D.a)&&e.get(D.a)&&(this.rolesConfigured=e.get(D.a)),this.multiUserSelection=!1}processStep(){return this.todoListService.reassignStepsToUser(this.steps,this.selectedUsers[0])}onInitialize(){this.SUCCESS=this.sdaTranslateService.get("WORKFLOW_STEPS_REASSIGNED","Workflow step(s) reassigned"),this.ERROR=this.sdaTranslateService.get("REASSIGN_ERROR","Error occurred when reassigning"),this.TITLE=this.sdaTranslateService.get("REASSIGN_TITLE","Reassign")}setUpRoles(){this.initialized=!1,this.loadingOverlayService.showLoadingOverlay(),this.route.paramMap.pipe(Object(a.a)(1),Object(o.a)(e=>this.setUpRouteData(e)),Object(r.a)(()=>this.todoListService.doNotShowRolesPane(this.rolesConfigured,this.steps)),Object(r.a)(e=>e.value||!this.displayRolesTab?(this.displayRolesTab=!1,this.todoListService.getRoleOBIDs(this.steps,this.rolesConfigured)):Object(n.a)([]))).subscribe(e=>{this.selectedRoles=e,this.initializeTabs(),this.initialized=!0,this.loadingOverlayService.hideLoadingOverlay()})}initializeTabs(){if(this.displayRolesTab){const e=[];e.push(this.createRolesTab()),this.roleTabs=e}const e=[];e.push(this.createUsersTab()),this.userTabs=e}createRolesTab(){const e=`GetRolesForWorkflowSteps?WorkFlowStepOBIDs=${JSON.stringify(this.steps)}&RolesToDisplay='${this.rolesConfigured}'`,t=new I.a(this.sdaTranslateService.get("ROLE","Role"),e,"","CS_SPFObject");return t.id="rolesGrid",t.showRowSelectionCheckbox=!0,t.showSelectAllCheckBox=!0,t.showInfoMapButton=!1,t.onRowSelectedChanged=e=>{this.selectedRoles=e,this.getUsersForSelectedRoleSubject.next()},t.onPageChange=()=>{this.selectedRoles=[],this.getUsersForSelectedRoleSubject.next()},t.isRowSelectable=!0,t.isFilterable=!0,t.sortable=!1,t}createUsersTab(){const e=`GetUsersForWorkflowSteps?WorkFlowStepOBIDs=${JSON.stringify(this.steps)}&SelectedRoles=${JSON.stringify(this.selectedRoles)}&StepDefName='${this.stepDefName}'`,t=new I.a(this.sdaTranslateService.get("USER","USER"),e,"","CS_SPFObject");return t.id="usersGrid",t.showRowSelectionCheckbox=this.multiUserSelection,t.showSelectAllCheckBox=this.multiUserSelection,t.onRowSelectedChanged=e=>{this.selectedUsers=e},t.isRowSelectable=!0,t.isFilterable=!0,t.showInfoMapButton=!1,t.sortable=!1,t}setUpGridTabsSubscription(){this.getUsersForSelectedRoleSubject.subscribe(()=>{const e=`GetUsersForWorkflowSteps?WorkFlowStepOBIDs=${JSON.stringify(this.steps)}&SelectedRoles=${JSON.stringify(this.selectedRoles)}&StepDefName='${this.stepDefName}'`;this.userTabs[0].selectedRows=[],this.userTabs[0].odataUrl=e,this.userTabs[0].refresh()})}onFinishComplete(){this.lockService.unlockItems(this.steps),this.todoListService.refreshToDoListCount()}}return e.\u0275fac=function(t){return new(t||e)(T.Sb(f.a),T.Sb(d.a),T.Sb(C.a),T.Sb(g.a),T.Sb(w.a),T.Sb(O.a),T.Sb(_.g),T.Sb(m.a),T.Sb(b.a),T.Sb(_.a),T.Sb(u.a),T.Sb(p.a),T.Sb(S.a),T.Sb(l.a))},e.\u0275cmp=T.Mb({type:e,selectors:[["sda-step-reassign"]],features:[T.Bb],decls:4,vars:6,consts:[[3,"tabs","layout",4,"ngIf"],[1,"users-layout"],[3,"displayFinishButton","displayCloseButton","disableFinishButton","finishButtonType","onClose","onFinish"],[3,"tabs","layout"]],template:function(e,t){1&e&&(T.Sc(0,x,1,2,"sda-tabbed-grid-view",0),T.Yb(1,"div",1),T.Sc(2,B,1,2,"sda-tabbed-grid-view",0),T.Yb(3,"sda-close-and-finish-bar",2),T.hc("onClose",(function(){return t.featureSetNavigationService.navigateBack()}))("onFinish",(function(){return t.onFinish()})),T.Xb(),T.Xb()),2&e&&(T.sc("ngIf",t.initialized&&t.displayRolesTab),T.Eb(2),T.sc("ngIf",t.initialized),T.Eb(1),T.sc("displayFinishButton",!0)("displayCloseButton",!0)("disableFinishButton",!(null!=t.selectedUsers&&t.selectedUsers.length))("finishButtonType",t.finishButtonType))},directives:[E.t,R.a,P.a],styles:["[_nghost-%COMP%]{display:flex;flex:1;height:100%;overflow:hidden}.users-layout[_ngcontent-%COMP%]{display:flex;flex:1;flex-direction:column}"]}),e})()},dNA2:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var i=s("Qu3c"),n=s("l3mi"),a=s("fXoL");let o=(()=>{class e{}return e.\u0275mod=a.Qb({type:e}),e.\u0275inj=a.Pb({factory:function(t){return new(t||e)},imports:[[n.a,i.b]]}),e})()},hFXt:function(e,t,s){"use strict";s.d(t,"a",(function(){return g}));var i=s("Z9D8"),n=s("LUpO"),a=s("UwO9"),o=s("8ihU"),r=s("IUya"),l=s("jNCI"),c=s("PEjJ"),h=s("cee5"),d=s("Ejbi"),u=s("41Lq"),p=s("biIz"),b=s("fXoL"),f=s("tyNb");let g=(()=>{class e extends o.a{constructor(e,t,s,i,n,a,o,r,l){super(e),this.modalService=e,this.exceptionService=t,this.notificationService=s,this.dataRefreshService=i,this.todoListService=n,this.sdaTranslateService=a,this.router=o,this.timeoutService=r,this.lockService=l,this.titleText="",this.submitText="",this.comment="",this.nextStepComment="",this.NEXT_STEP_TEXT="",this.SUCCESS="",this.ERROR="",this.COMMENTS=this.sdaTranslateService.get("COMMENTS","Comments:"),this.DEFAULT_TIMEOUT=3e3,this.onInitialize()}ngOnInit(){this.selectedObjects=this.getData()}ok(){this.steps=this.selectedObjects.map(e=>e.obid),this.canContinue()&&(this.lockService.lockItems(this.steps),this.showLoadingIndicator(),this.timeout=this.timeoutService.setTimeout(()=>this.processBackgroundTask(),this.DEFAULT_TIMEOUT),this.processStep().subscribe(()=>{},e=>{this.onComplete(),this.exceptionService.handleException(new i.a(e))},()=>{this.onComplete(),this.notificationService.success(this.SUCCESS)}))}canContinue(){return!0}onComplete(){this.closeModal.next(new r.a(!0)),this.hideLoadingIndicator(),this.timeoutService.clearTimeout(this.timeout),this.timeout=void 0,this.lockService.unlockItems(this.steps),(this.router.url.startsWith("/todo-list")||this.router.url.startsWith("/showInboxForObject"))&&this.dataRefreshService.refreshData(),this.todoListService.refreshToDoListCount()}processBackgroundTask(){this.closeModal.next(new r.a(!0)),this.hideLoadingIndicator(),this.notificationService.info(this.sdaTranslateService.get("TODO_LIST_STEP_BACKGROUND_TASK_START","The task will complete in the background"))}}return e.\u0275fac=function(t){return new(t||e)(b.Sb(l.a),b.Sb(n.a),b.Sb(u.a),b.Sb(c.a),b.Sb(p.a),b.Sb(d.a),b.Sb(f.g),b.Sb(h.a),b.Sb(a.a))},e.\u0275dir=b.Nb({type:e,features:[b.Bb]}),e})()},mZKE:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var i=s("fXoL");let n=(()=>{class e{convertFlatListToTree(e){const t={},s=[];let i,n;for(i=0;i<e.length;i+=1)t[e[i].OBID]=i,e[i].Children=[];for(i=0;i<e.length;i+=1)n=e[i],n.parentNodeObid&&void 0!==t[n.parentNodeObid]&&e[t[n.parentNodeObid]]?e[t[n.parentNodeObid]].Children.push(n):s.push(n);return s}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=i.Ob({token:e,factory:e.\u0275fac}),e})()},pQW9:function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var i=s("fXoL"),n=s("m8I0"),a=s("QkNQ"),o=s("ti2P"),r=s("Ejbi"),l=s("lUp+");let c=(()=>{class e{constructor(e){this.sdaTranslateService=e,this.displayFinishButton=!0,this.disableFinishButton=!1,this.finishButtonType=n.a.Default,this.finishButtonText=this.sdaTranslateService.get("FINISH","Finish"),this.displayCloseButton=!0,this.closeButtonText=this.sdaTranslateService.get("CLOSE","Close"),this.onFinish=new i.o,this.onClose=new i.o,this.rightPowerBarControls=[],this.backgroundStyle=a.a.Transparent}ngOnInit(){this.initialisePowerBar()}ngOnChanges(e){this.finishButton&&(e.disableFinishButton&&(this.finishButton.isDisabled=e.disableFinishButton.currentValue),e.finishButtonText&&(this.finishButton.displayName=e.finishButtonText.currentValue),e.finishButtonType&&(this.finishButton.type=e.finishButtonType.currentValue))}initialisePowerBar(){this.displayCloseButton&&this.rightPowerBarControls.push(new o.a(()=>{this.onClose.emit(void 0)},this.closeButtonText,"",void 0,n.a.Abort)),this.displayFinishButton&&(this.finishButton=new o.a(()=>{this.onFinish.emit(void 0)},this.finishButtonText,"",void 0,this.finishButtonType,this.disableFinishButton),this.rightPowerBarControls.push(this.finishButton))}}return e.\u0275fac=function(t){return new(t||e)(i.Sb(r.a))},e.\u0275cmp=i.Mb({type:e,selectors:[["sda-close-and-finish-bar"]],inputs:{displayFinishButton:"displayFinishButton",disableFinishButton:"disableFinishButton",finishButtonType:"finishButtonType",finishButtonText:"finishButtonText",displayCloseButton:"displayCloseButton",closeButtonText:"closeButtonText"},outputs:{onFinish:"onFinish",onClose:"onClose"},features:[i.Cb],decls:1,vars:3,consts:[[1,"power-bar",3,"rightControls","background","disableOverflow"]],template:function(e,t){1&e&&i.Tb(0,"sda-power-bar-view",0),2&e&&i.sc("rightControls",t.rightPowerBarControls)("background",t.backgroundStyle)("disableOverflow",!0)},directives:[l.a],styles:["[_nghost-%COMP%]     sda-power-bar-view .power-bar{justify-content:flex-end;margin-right:10px}"]}),e})()},uJvP:function(e,t,s){"use strict";s.d(t,"a",(function(){return B}));var i=s("rDax"),n=s("+rOU"),a=s("ofXK"),o=s("3Pt+"),r=s("bSwM"),l=s("NFeN"),c=s("qFsG"),h=s("wZkO"),d=s("Qu3c"),u=s("WG3B"),p=s("7CaW"),b=s("BMkO"),f=s("9Abt"),g=s("l3mi"),S=s("ILbM"),m=s("0GHy"),O=s("VtiV"),D=s("F+hv"),y=s("wA8e"),I=s("MX5F"),C=s("GDd0"),w=s("2wiT"),v=s("HPu/"),T=s("dNA2"),_=s("fXoL");let E=(()=>{class e{}return e.\u0275mod=_.Qb({type:e}),e.\u0275inj=_.Pb({factory:function(t){return new(t||e)},imports:[[a.c,u.o]]}),e})();var R=s("9X43"),P=s("VoKn");let x=(()=>{class e{}return e.\u0275mod=_.Qb({type:e}),e.\u0275inj=_.Pb({factory:function(t){return new(t||e)},imports:[[g.a,l.b,c.b,d.b,r.b,a.c,o.j,u.o,D.a,m.a,y.a,I.a,O.a,R.a,b.a,P.a,T.a,E]]}),e})(),B=(()=>{class e{}return e.\u0275mod=_.Qb({type:e}),e.\u0275inj=_.Pb({factory:function(t){return new(t||e)},imports:[[f.a,g.a,h.e,l.b,c.b,d.b,r.b,a.c,o.j,D.a,u.o,p.a,m.a,C.a,n.g,i.f,y.a,w.a,I.a,v.a,S.a,O.a,R.a,b.a,P.a,T.a,x,E]]}),e})()},wA8e:function(e,t,s){"use strict";s.d(t,"a",(function(){return u}));var i=s("ofXK"),n=s("NFeN"),a=s("qFsG"),o=s("STbY"),r=s("d3UM"),l=s("Qu3c"),c=s("l3mi"),h=s("2wiT"),d=s("fXoL");let u=(()=>{class e{}return e.\u0275mod=d.Qb({type:e}),e.\u0275inj=d.Pb({factory:function(t){return new(t||e)},imports:[[i.c,h.a,r.b,o.c,n.b,c.a,a.b,l.b]]}),e})()},xNQ3:function(e,t,s){"use strict";s.d(t,"a",(function(){return h}));var i=s("fXoL"),n=s("Ejbi"),a=s("FedY"),o=s("ZW2Q"),r=s("KkJr"),l=s("pyKC"),c=s("5mBa");let h=(()=>{class e extends c.a{constructor(e,t){super(),this.sdaTranslateService=e,this.relationshipItemsService=t,this.DROPDOWN_PLACE_HOLDER=this.sdaTranslateService.get("DROPDOWN_PLACE_HOLDER","Please select..."),this.SELECT_ALL=this.sdaTranslateService.get("SELECT_ALL","Select All"),this.NO_RESULTS_FOUND=this.sdaTranslateService.get("NO_RESULTS_FOUND","No results found..."),this.resultsOverlay=!1,this.isOpen=new i.o,this.collided=!1,this.isMultiSelect=!1,this.dropDownOptionsOBIDs=[]}get selectedItem(){return this.field.selectedItem}set selectedItem(e){this.field.selectedItem!==e&&(this.field.selectedItem=e,this.selectedItemsChanged([e]))}get showEditable(){return this.showEditableValue}set showEditable(e){this.showEditableValue=e,this.isOpen.emit(e)}get displayValue(){let e="";return this.field.RelObjects&&this.field.RelObjects.forEach(t=>{if(!t.Terminate){e&&(e+=", ");const s=this.field.dropDownOptions.find(e=>e.obid===t.Key);s&&s.displayValue&&(e+=s.displayValue)}}),e}get selectedItems(){let e=[];return this.field.RelObjects&&this.field.RelObjects.length>0&&this.field.dropDownOptions&&(e=this.field.dropDownOptions.filter(e=>{const t=this.field.RelObjects.filter(t=>e.obid===t.Key&&!t.Terminate);return t&&t.length>0})),e}handleSelectedItemsChange(e){let t=[];e&&e.length>0&&(t=e.map(e=>e.obid)),this.selectedItemsChanged(t)}displayEditableControls(){return this.isEditable&&!this.singleLine||this.singleLine&&this.showEditable}clickSingleReadOnlyInput(){this.showEditable=!this.showEditable}displaySingleReadOnlyInput(){return!this.showEditable&&this.singleLine}displayFieldSize(){return this.isEditable&&this.field.FieldSize>0?this.field.FieldSize:void 0}selectedItemsChanged(e){this.field.RelObjects=this.relationshipItemsService.selectedItemsChanged(e,this.dropDownOptionsOBIDs),this.valueChanged.emit(this.field)}setCardinality(){this.field.MaxRels&&(this.isMultiSelect=!("0"===this.field.MaxRels||"1"===this.field.MaxRels))}setPreselectedOptions(){this.field.Value&&(this.dropDownOptionsOBIDs=this.field.Value.split("~"))}parseMaxSingleDropDownOptions(e,t){let s=[];if(e&&(s=e.map(e=>new o.a(e.OBID,e.DisplayValue,e.DisplayValue,!1,e.Description,!0,e.UID,e.ClassDef,e.SecondaryDisplayValue))),this.field.dropDownOptions&&this.field.dropDownOptions.length>0&&this.field.selectedItem!==r.b&&this.field.selectedItem!==r.a){const e=this.field.dropDownOptions.find(e=>e.obid===this.field.selectedItem);e&&(s.some(t=>t.obid===e.obid)||s.push(e))}if(s=s.sort((e,t)=>a.a.sortByString(e.displayValue,t.displayValue)),this.field.IsMandatory||s.unshift(new o.a(r.a,"","")),s.unshift(new o.a(r.b,this.DROPDOWN_PLACE_HOLDER,this.DROPDOWN_PLACE_HOLDER,!0,this.DROPDOWN_PLACE_HOLDER)),t||this.setInitialSelectedItem(s),this.field.dropDownOptions=s,t){const e=s.filter(e=>e.obid===t)[0];e&&(this.selectedItem=e.obid)}}parseMaxMultiRelDropDownOptions(e,t){let s,i=[];e&&(i=e.map(e=>new o.a(e.OBID,e.DisplayValue,e.DisplayValue,!1,e.Description,!0,e.UID,e.ClassDef,e.SecondaryDisplayValue))),s=t?t.map(e=>new o.a(e.OBID,e.DisplayValue,e.DisplayValue,!1,e.Description,!0,e.UID,e.ClassDef,e.SecondaryDisplayValue)):this.selectedItems,i=i.sort((e,t)=>a.a.sortByString(e.displayValue,t.displayValue)),s=s.sort((e,t)=>a.a.sortByString(e.displayValue,t.displayValue)),this.field.dropDownOptions=i;for(let n=s.length-1;n>=0;n--)this.field.dropDownOptions.unshift(s[n]);this.handleSelectedItemsChange(s)}setInitialSelectedItem(e){this.selectedItem=2!==e.length&&this.field.IsMandatory?e[0].obid:e[1].obid}}return e.\u0275fac=function(t){return new(t||e)(i.Sb(n.a),i.Sb(l.a))},e.\u0275dir=i.Nb({type:e,inputs:{field:"field",singleLine:"singleLine",showEditableValue:"showEditableValue",resultsOverlay:"resultsOverlay"},outputs:{isOpen:"isOpen"},features:[i.Bb]}),e})()}}]);