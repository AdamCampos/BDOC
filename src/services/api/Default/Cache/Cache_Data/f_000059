(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{"+T9e":function(e,t,s){"use strict";s.d(t,"a",(function(){return E}));var n=s("mrSG"),i=s("IzEk"),a=s("ONOH"),o=s("Z9D8"),r=s("LUpO"),c=s("PoZZ"),l=s("d74k"),d=s("Ejbi"),h=s("W5cs"),p=s("gBNM"),g=s("UVhF"),u=s("zewe"),b=s("fXoL"),S=s("ofXK"),f=s("TLn4"),m=s("qx4N"),v=s("+qkj");function M(e,t){if(1&e&&b.Tb(0,"sda-loading-indicator",3),2&e){const e=b.lc();b.sc("message",e.OBJECT_DETAILS_LOADING)("centered",!0)}}function I(e,t){if(1&e&&(b.Yb(0,"div",4),b.Tb(1,"sda-form-controls",5),b.Xb()),2&e){const e=b.lc();b.Ib("object-details--fixed-height",e.relatedItemTabs.length>0),b.Eb(1),b.sc("form",e.form)("isEditable",!1)}}function O(e,t){if(1&e&&b.Tb(0,"sda-related-items-section",6),2&e){const e=b.lc();b.sc("tabs",e.relatedItemTabs)}}let E=(()=>{class e{constructor(e,t,s,n,i,a,o){this.formService=e,this.exceptionService=t,this.filterService=s,this.objectDetailsService=n,this.sdaTranslateService=i,this.changeDetection=a,this.configService=o,this.relatedItemTabs=[],this.initialized=!1,this.OBJECT_DETAILS_LOADING=this.sdaTranslateService.get("OBJECT_DETAILS_LOADING","Loading object details, please wait..."),this.OBJECT_DETAILS_ERROR=this.sdaTranslateService.get("INITIALISATION_ERROR","An error occurred whilst initializing"),this.showTodoListForm=!1}ngOnChanges(){this.getFormSubscription&&this.getFormSubscription.unsubscribe(),this.buildForm()}ngOnDestroy(){this.getFormSubscription&&this.getFormSubscription.unsubscribe()}buildForm(){try{this.id&&this.config&&(this.initialized=!1,this.getFormSubscription=this.formService.getForm(this.id,this.config,this.methodOBID,this.showTodoListForm).pipe(Object(i.a)(1)).subscribe(e=>{this.relatedItemTabs=[];const t=this.formService.filterDisplayItemsByDisplayType(e,"RelationshipMaintenance"),{filteredItems:s=[]}=t,i=Object(n.a)(t,["filteredItems"]);this.form=i,this.generateGridTabs(s),this.initialized=!0,this.changeDetection.detectChanges()}))}catch(e){const t=new o.a(e,this.OBJECT_DETAILS_ERROR,"ObjectDetailsComponent","buildForm");this.exceptionService.handleException(t)}}generateGridTabs(e){e.forEach(e=>{const t=e.navigation?new p.a(e.name,`Objects('${e.obid}')/${e.navigation}?$count=true`,this.config,void 0,e.obid,e.navigation):new p.a(e.name,void 0,this.config);t.isRowSelectable=!0,t.config=this.config,t.onCellClicked=e=>this.routeToDetailsView(e),this.relatedItemTabs.push(t)})}routeToDetailsView(e){this.objectDetailsService.showObjectDetailsForm(this.filterService.createLinkOdataQueryFilter(this.getDataSource(e),e.parentTab.parentOBID,e.parentTab.parentRelDef,void 0),e.object.OBID,this.configService.selectedQueryConfigs,e.parentTab.columnSetUID)}getDataSource(e){const t=new kendo.data.DataSource,s=new h.a,n=[new l.a(e.parentTab.state.sort[0].field,e.parentTab.state.sort[0].dir)];return t.filter(s),t.page=()=>e.parentTab.currentPageNumber,t.sort=()=>n,t}}return e.\u0275fac=function(t){return new(t||e)(b.Sb(g.a),b.Sb(r.a),b.Sb(c.a),b.Sb(u.a),b.Sb(d.a),b.Sb(b.h),b.Sb(a.a))},e.\u0275cmp=b.Mb({type:e,selectors:[["sda-object-details"]],inputs:{id:"id",config:"config",methodOBID:"methodOBID",showTodoListForm:"showTodoListForm"},features:[b.Cb],decls:3,vars:3,consts:[[3,"message","centered",4,"ngIf"],["class","object-details",3,"object-details--fixed-height",4,"ngIf"],[3,"tabs",4,"ngIf"],[3,"message","centered"],[1,"object-details"],[3,"form","isEditable"],[3,"tabs"]],template:function(e,t){1&e&&(b.Sc(0,M,1,2,"sda-loading-indicator",0),b.Sc(1,I,2,4,"div",1),b.Sc(2,O,1,1,"sda-related-items-section",2)),2&e&&(b.sc("ngIf",!t.initialized),b.Eb(1),b.sc("ngIf",t.initialized),b.Eb(1),b.sc("ngIf",t.initialized&&t.relatedItemTabs.length>0))},directives:[S.t,f.a,m.a,v.a],styles:[".object-details[_ngcontent-%COMP%]{overflow-x:hidden;overflow-y:auto}[_nghost-%COMP%]{display:flex;flex:1;flex-direction:column;height:100%}.object-details[_ngcontent-%COMP%]{display:flex;flex:1 1 100%;flex-direction:column;border-bottom:1px solid #cad0d7}"]}),e})()},"+qkj":function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n=s("Ejbi"),i=s("fXoL"),a=s("7EHt"),o=s("HXFx");let r=(()=>{class e{constructor(e){this.sdaTranslateService=e,this.FORM_RELATED_ITEMS=this.sdaTranslateService.get("FORM_RELATED_ITEMS","Related Items")}}return e.\u0275fac=function(t){return new(t||e)(i.Sb(n.a))},e.\u0275cmp=i.Mb({type:e,selectors:[["sda-related-items-section"]],inputs:{tabs:"tabs"},decls:6,vars:5,consts:[["displayMode","flat"],[1,"related-items-panel",3,"expanded"],["collapsedHeight","38px","expandedHeight","38px"],[3,"tabs","openInfoMapInNewTab","showItemCount"]],template:function(e,t){1&e&&(i.Yb(0,"mat-accordion",0),i.Yb(1,"mat-expansion-panel",1),i.Yb(2,"mat-expansion-panel-header",2),i.Yb(3,"mat-panel-title"),i.Uc(4),i.Xb(),i.Xb(),i.Tb(5,"sda-tabbed-grid-view",3),i.Xb(),i.Xb()),2&e&&(i.Eb(1),i.sc("expanded",!0),i.Eb(3),i.Wc(" ",t.FORM_RELATED_ITEMS," "),i.Eb(1),i.sc("tabs",t.tabs)("openInfoMapInNewTab",!0)("showItemCount",!0))},directives:[a.a,a.c,a.g,a.h,o.a],styles:[".related-items-panel[_ngcontent-%COMP%]{border-radius:0!important;box-shadow:none!important}.related-items-panel.mat-expanded[_ngcontent-%COMP%]{overflow:visible;-webkit-animation:delay-overflow 1s;animation:delay-overflow 1s}.related-items-panel[_ngcontent-%COMP%]   mat-expansion-panel-header[_ngcontent-%COMP%]{background-color:#ebedf0!important}.related-items-panel[_ngcontent-%COMP%]     .mat-expansion-panel-body{padding:0}.related-items-panel[_ngcontent-%COMP%]     sda-tabbed-grid-view{flex:none;height:auto}.related-items-panel[_ngcontent-%COMP%]     sda-tabbed-grid-view mat-tab-group{height:40vh;min-height:250px;border-top:1px solid #cad0d7}"]}),e})()},"2CD4":function(e,t,s){"use strict";s.d(t,"a",(function(){return g}));var n=s("qxoO"),i=s("zHoD"),a=s("8ihU"),o=s("IUya"),r=s("jNCI"),c=s("PEjJ"),l=s("20dk"),d=s("+eYH"),h=s("fXoL");const p=["filemanagement"];let g=(()=>{class e extends a.a{constructor(e,t){super(e),this.dataRefreshService=t,this.existingFilesColumnSet="CS_CopyToLocalColumnSet",this.mode=i.a.None,this.reviewObjects=[]}ngOnInit(){this.supportingInformationEditorModel=this.getData(),this.supportingInformationEditorModel&&this.reviewObjects.push(new d.a(this.supportingInformationEditorModel.parentOBID,"",this.supportingInformationEditorModel.config)),this.disableOkayButton()}ok(){this.fileManagementComponent.onFinish()}filesPendingForUploadOrDelete(){this.fileManagementComponent.disableFinishButton?this.disableOkayButton():this.enableOkayButton()}onUploadOrDeleteSuccess(e){e&&this.refreshAttachedFiles()}cancel(){this.refreshAttachedFiles()}refreshAttachedFiles(){const e=new o.a(!1);this.closeModal.next(e),this.dataRefreshService.refreshData(new l.a(this.reviewObjects,!1,"SDASupportingInformation"))}}return e.\u0275fac=function(t){return new(t||e)(h.Sb(r.a),h.Sb(c.a))},e.\u0275cmp=h.Mb({type:e,selectors:[["sda-supporting-information-editor"]],viewQuery:function(e,t){var s;1&e&&h.bd(p,!0),2&e&&h.Gc(s=h.ic())&&(t.fileManagementComponent=s.first)},features:[h.Bb],decls:2,vars:7,consts:[[3,"uploadMode","objects","columnSet","canDeleteFiles","showFooter","navigateBack","ignoreResRefsForNonDocs","filesPendingForUploadOrDelete","uploadOrDeleteSuccess"],["filemanagement",""]],template:function(e,t){1&e&&(h.Yb(0,"sda-file-management",0,1),h.hc("filesPendingForUploadOrDelete",(function(){return t.filesPendingForUploadOrDelete()}))("uploadOrDeleteSuccess",(function(e){return t.onUploadOrDeleteSuccess(e)})),h.Xb()),2&e&&h.sc("uploadMode",t.mode)("objects",t.reviewObjects)("columnSet",t.existingFilesColumnSet)("canDeleteFiles",!0)("showFooter",!1)("navigateBack",!1)("ignoreResRefsForNonDocs",!0)},directives:[n.a],styles:["[_nghost-%COMP%]{margin-bottom:10px}sda-searchbar[_ngcontent-%COMP%]{display:flex;max-width:670px;margin:auto;padding:20px 15px}sda-kendo-grid[_ngcontent-%COMP%]{height:calc(90vh - 240px)}"]}),e})()},"47Ra":function(e,t,s){"use strict";s.d(t,"a",(function(){return d}));var n=s("fXoL"),i=s("ofXK"),a=s("3Pt+"),o=s("dO6S"),r=s("8OmR");function c(e,t){if(1&e&&(n.Tb(0,"p",3),n.mc(1,"sdaConvertURLsToHREF")),2&e){const e=n.lc();n.sc("innerHTML",n.nc(1,1,e.text),n.Lc)}}function l(e,t){if(1&e){const e=n.Zb();n.Yb(0,"textarea",4),n.hc("ngModelChange",(function(t){return n.Kc(e),n.lc().text=t})),n.Uc(1,"    "),n.Xb()}if(2&e){const e=n.lc();n.sc("sdaFocus",e.isEditable)("ngModel",e.text)}}let d=(()=>{class e{constructor(){this.textChange=new n.o,this.textValue=""}get text(){return this.textValue}set text(e){this.textValue=e,this.textChange.emit(this.textValue)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=n.Mb({type:e,selectors:[["sda-card-template-content-view"]],inputs:{isEditable:"isEditable",text:"text"},outputs:{textChange:"textChange"},decls:3,vars:2,consts:[[1,"card-content"],["class","card-content__text",3,"innerHTML",4,"ngIf"],["class","card-content__textarea",3,"sdaFocus","ngModel","ngModelChange",4,"ngIf"],[1,"card-content__text",3,"innerHTML"],[1,"card-content__textarea",3,"sdaFocus","ngModel","ngModelChange"]],template:function(e,t){1&e&&(n.Yb(0,"div",0),n.Sc(1,c,2,3,"p",1),n.Sc(2,l,2,2,"textarea",2),n.Xb()),2&e&&(n.Eb(1),n.sc("ngIf",!t.isEditable),n.Eb(1),n.sc("ngIf",t.isEditable))},directives:[i.t,a.c,o.a,a.p,a.s],pipes:[r.a],styles:[".card-content__text[_ngcontent-%COMP%]{overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;overflow-x:hidden;overflow-y:auto}[_nghost-%COMP%]{flex:1}.card-content__text[_ngcontent-%COMP%]{max-height:200px;font-size:14px;line-height:1.4;white-space:pre-line}.card-content__textarea[_ngcontent-%COMP%]{width:100%;min-height:200px;line-height:1.4;font-size:14px;white-space:pre-wrap;-webkit-appearance:none;appearance:none}.card-content__textarea[_ngcontent-%COMP%]:hover{border-color:#a9b4be}.card-content__textarea[_ngcontent-%COMP%]:focus{border-color:#02adff}.card-content__textarea[disabled][_ngcontent-%COMP%]{background:#fff;border-color:#fff}"]}),e})()},"9bno":function(e,t,s){"use strict";s.d(t,"a",(function(){return S}));var n=s("itXk"),i=s("NEWU"),a=s("iAId"),o=s("fXoL"),r=s("YwUS"),c=s("xc+7"),l=s("Ejbi"),d=s("tyNb"),h=s("/esn"),p=s("c+03"),g=s("LUpO"),u=s("iwlc"),b=s("Z2F1");let S=(()=>{class e{constructor(e,t,s,a,o,r,c,l,d,h){this.applicationSettingsService=e,this.featureSetService=t,this.sdaTranslateService=s,this.router=a,this.responseManagementService=o,this.route=r,this.loadingOverlayService=c,this.exceptionService=l,this.helpService=d,this.modeService=h,this.revisionOrWorkflowStepOBID="",this.navigateBackOnCompletion=!0,this.createTechnicalQueryMethodUID="",this.routeSubscription=Object(n.a)(this.route.paramMap,this.route.data).subscribe(([e,t])=>{this.revisionSummary=void 0;let s=e.get(i.a);s||(s=this.sdaTranslateService.get("RESPONSE_MANAGEMENT_CLIENT_API_TITLE","Response Management Details")),this.applicationSettingsService.setPageTitle(s),this.createTechnicalQueryMethodUID=e.get(i.o);const n=e.get(i.d);n&&(this.updateRevisionMethodUID=n),this.parentMethodOBID=e.get(i.y),this.parentObjects=t[i.z],this.parentClientAPI=e.get(i.s),this.apiConfig=this.modeService.getConfigurationForModeFromString(e.get(i.p)),this.apiConfig.helpID&&this.helpService.setHandlers(this.apiConfig.helpID),this.revisionOrWorkflowStepOBID=JSON.parse(e.get(i.u))[0],this.initialise()})}ngOnDestroy(){this.routeSubscription&&this.routeSubscription.unsubscribe()}onActivate(e){e.params.subscribe(e=>{e.revision&&(this.selectedRevision=JSON.parse(e.revision))})}onSelectedRevisionChanged(e){if(e&&e.revisionOBID){const t=this.revisionSummary.Revisions.filter(t=>t.OBID===e.revisionOBID)[0],s=new a.a(t.OBID,t.DisplayName,t.Config,t.IsLatest);this.router.navigate(["body",JSON.stringify(s),e.state],{relativeTo:this.route}).then(t=>{t?e.onSuccessCallback(e.revisionOBID):e.onCancelCallback&&e.onCancelCallback()})}}initialise(){this.loadingOverlayService.showLoadingOverlay(),this.getResponseManagementSummary().subscribe(e=>{this.selectedRevision&&e.Revisions.every(e=>e.OBID!==this.selectedRevision.obid)&&(this.selectedRevision=void 0),this.revisionSummary=e,this.loadingOverlayService.hideLoadingOverlay()},e=>{this.exceptionService.handleException(e),this.loadingOverlayService.hideLoadingOverlay()})}}return e.\u0275fac=function(t){return new(t||e)(o.Sb(r.a),o.Sb(c.a),o.Sb(l.a),o.Sb(d.g),o.Sb(h.a),o.Sb(d.a),o.Sb(p.a),o.Sb(g.a),o.Sb(u.a),o.Sb(b.a))},e.\u0275dir=o.Nb({type:e}),e})()},K9v4:function(e,t,s){"use strict";s.d(t,"a",(function(){return T}));var n=s("ofXK"),i=s("3Pt+"),a=s("tyNb"),o=s("F+hv"),r=s("txXS"),c=s("Tfoa"),l=s("uD/B"),d=s("BLqR"),h=s("+T9e"),p=s("fXoL"),g=s("TLn4"),u=s("ue3H"),b=s("qx4N"),S=s("+qkj"),f=s("RY2J"),m=s("HDO1"),v=s("4dwF"),M=s("dLJk"),I=s("F8dI"),O=s("rrPm"),E=s("8OmR"),R=s("ltBE"),C=s("XwBL");let D=(()=>{class e{transform(e){return C.a.replaceUnderscore(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=p.Rb({name:"sdaFormatEntityType",type:e,pure:!0}),e})();var _=s("7Ihv");let T=(()=>{class e{}return e.\u0275mod=p.Qb({type:e}),e.\u0275inj=p.Pb({factory:function(t){return new(t||e)},imports:[[n.c,i.j,r.a,a.k,o.a,l.a,c.a]]}),e})();p.Nc(d.a,[n.q,n.r,n.s,n.t,n.A,n.w,n.x,n.y,n.z,n.u,n.v,i.F,i.u,i.E,i.c,i.v,i.y,i.a,i.B,i.C,i.x,i.p,i.q,i.A,i.l,i.k,i.w,i.b,i.d,i.s,i.t,i.r,a.l,a.h,a.j,a.i,a.n,g.a,u.a,b.a,S.a,h.a,d.a],[n.b,n.G,n.p,n.k,n.E,n.g,n.C,n.F,n.d,n.f,n.i,n.j,n.l,f.a,m.a,v.a,M.a,I.a,O.a,E.a,R.a,D,_.a])},KQs8:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));class n{constructor(e,t){this.config=e,this.parentOBID=t}}},d74k:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));class n{constructor(e,t){this.field=e,this.dir=t}}},"g+yd":function(e,t,s){"use strict";s.d(t,"a",(function(){return He}));var n=s("itXk"),i=s("lJxs"),a=s("4B5/"),o=s("zewe"),r=s("Z9D8"),c=s("LUpO"),l=s("C4gn"),d=s("xc+7"),h=s("c+03"),p=s("+ooB"),g=s("jNCI"),u=s("QkNQ"),b=s("PEjJ"),S=s("cee5"),f=s("dEBh"),m=s("tCxB"),v=s("F8JD"),M=s("J7mc"),I=s("z0XX"),O=s("Ejbi"),E=s("+eYH"),R=s("NEWU"),C=s("KQs8"),D=s("2CD4"),_=s("QF+H"),T=s("xiba"),w=function(e){return e[e.Review=0]="Review",e[e.Response=1]="Response",e}({}),A=s("C3Sv"),P=s("Z2F1"),N=s("Ojuo"),y=s("/esn"),k=s("dp0o"),x=s("fXoL"),L=s("B5lr"),B=s("JrsU"),F=s("4JBC"),j=s("FedY"),U=(s("jZ6j"),s("ofXK")),Y=s("wZkO"),G=s("lUp+"),V=s("niUd"),X=s("IzEk"),W=s("m8I0"),H=s("WjcW"),z=s("qSfU"),K=s("wN6G"),q=s("9iV3"),J=s("ti2P"),Z=s("mqkv"),$=s("ZnZs"),Q=s("41Lq"),ee=s("t1Kn");let te=(()=>{class e{constructor(e,t,s,n,i,a){this.sdaTranslationService=e,this.relatedItemService=t,this.responseService=s,this.exceptionService=n,this.crudService=i,this.notificationService=a,this.onViewResponseDetails=new x.o,this.onManageRelatedItems=new x.o,this.onManageRelatedFiles=new x.o,this.onChangeResponseState=new x.o,this.onManageSupportingInformation=new x.o,this.powerBarOverflowControls=[],this.badge="",this.summaryItems=[],this.powerBarOverflowCloseOnAllClicks=!0,this.previousStatusOfResponse=""}ngOnChanges(e){e&&e.exceptionResponse&&this.exceptionResponse===this.response?this.resetExceptionResponse():(this.badge=this.apiConfig.canShowConsolidatorBadge&&this.response.initiatedUser.IsCurrentUser?this.sdaTranslationService.get("RESPONSE_MANAGEMENT_CONSOLIDATOR","Consolidator"):"",this.response&&(this.apiConfig.header.showRevisions&&this.initialiseAdditionalInformation(),this.initializePowerBarOptions()))}addPowerBarButtons(){if(!this.apiConfig.canConsolidateObservationItems&&this.response.isEditable||this.apiConfig.canConsolidateObservationItems&&this.response.isEditable&&this.response.initiatedUser.IsCurrentUser){this.addResponseMarkupLayerMethod();const e=new J.a(()=>{this.onManageResponseRelatedFiles()},this.sdaTranslationService.get("RESPONSE_MANAGEMENT_MANAGE_RELATED_FILES_TOOLTIP","Manage related files"),"fa-upload",void 0,W.a.Plain);e.tooltip=this.sdaTranslationService.get("RESPONSE_MANAGEMENT_MANAGE_RELATED_FILES_TOOLTIP","Manage related files"),e.hidden=!this.apiConfig.header.showRevisions,this.verticalPowerBarSection.controls.push(e),this.addResponseRelatedItemsMethod(),this.editResponseBtn=new J.a(()=>{this.onEditResponse()},this.sdaTranslationService.get("EDIT","Edit"),"fa-pencil",void 0,W.a.Plain),this.editResponseBtn.tooltip=this.sdaTranslationService.get("EDIT","Edit"),this.verticalPowerBarSection.controls.push(this.editResponseBtn),this.cancelEditResponseBtn=new J.a(()=>{this.onCancelEditResponse()},"","fa-close",void 0,W.a.Destroy),this.cancelEditResponseBtn.tooltip=this.sdaTranslationService.get("CANCEL","Cancel"),this.cancelEditResponseBtn.hidden=!0,this.revisionPowerBarRHSControls.push(this.cancelEditResponseBtn),this.approveEditResponseBtn=new J.a(()=>{this.onSaveResponse()},"","fa-check",void 0,W.a.Primary),this.approveEditResponseBtn.tooltip=this.sdaTranslationService.get("SAVE","Save"),this.approveEditResponseBtn.hidden=!0,this.revisionPowerBarRHSControls.push(this.approveEditResponseBtn)}else if((this.apiConfig.isViewOnly||this.apiConfig.canManageResponseMarkupLayers)&&this.manageResponseMarkupLayersMethod){const e=new J.a(()=>{this.onManageResponseMarkupLayers()},this.sdaTranslationService.get("MANAGE_MARKUP_LAYERS_MODAL_TITLE","Manage Markup Layers"),"fa-object-ungroup",void 0,W.a.Plain);e.tooltip=this.sdaTranslationService.get("MANAGE_MARKUP_LAYERS_MODAL_TITLE","Manage Markup Layers"),e.isDisabled="e1SDAObsStatusInitiated"!==this.response.Status&&"e1SDAObsStatusDraft"!==this.response.Status,this.verticalPowerBarSection.controls.push(e)}}addResponseMarkupLayerMethod(){if(this.manageResponseMarkupLayersMethod){const e=new J.a(()=>{this.onManageResponseMarkupLayers()},this.sdaTranslationService.get("MANAGE_MARKUP_LAYERS_MODAL_TITLE","Manage Markup Layers"),"fa-object-ungroup",void 0,W.a.Plain);e.tooltip=this.sdaTranslationService.get("MANAGE_MARKUP_LAYERS_MODAL_TITLE","Manage Markup Layers"),e.isDisabled="e1SDAObsStatusInitiated"!==this.response.Status&&"e1SDAObsStatusDraft"!==this.response.Status,e.hidden=!this.apiConfig.header.showRevisions,this.verticalPowerBarSection.controls.push(e)}}addResponseRelatedItemsMethod(){if(this.manageResponseRelatedItemsMethod){const e=new J.a(()=>{this.onManageResponseRelatedObjects()},this.sdaTranslationService.get("RESPONSE_MANAGEMENT_MANAGE_RELATED_INFO_TOOLTIP","Manage related information"),"fa-link",void 0,W.a.Plain);e.tooltip=this.sdaTranslationService.get("RESPONSE_MANAGEMENT_MANAGE_RELATED_INFO_TOOLTIP","Manage related information"),e.hidden=!this.apiConfig.header.showRevisions,this.verticalPowerBarSection.controls.push(e)}}checkAndRunConsolidatonMode(){this.apiConfig.canConsolidateObservationItems&&!this.response.initiatedUser.IsCurrentUser&&"e1SDAObsStatusWaived"!==this.response.Status&&"e1SDAObsStatusRejected"!==this.response.Status&&(this.consolidateResponsesToggle=new $.a(()=>{this.onConsolidateToggleChanged()},"e1SDAObsStatusInitiated"===this.response.Status||"e1SDAObsStatusCompleted"===this.response.Status,this.sdaTranslationService.get("RESPONSE_MANAGEMENT_REMOVE_FROM_CONSOLIDATE_LABEL","Remove From Consolidate"),this.sdaTranslationService.get("RESPONSE_MANAGEMENT_ADD_TO_CONSOLIDATE_LABEL","Add To Consolidate"),"fa fa-minus","fa fa-plus"),this.consolidateResponsesToggle.onTooltip=this.sdaTranslationService.get("RESPONSE_MANAGEMENT_REMOVE_FROM_CONSOLIDATE_TOOLTIP","Remove the response from consolidation"),this.consolidateResponsesToggle.offTooltip=this.sdaTranslationService.get("RESPONSE_MANAGEMENT_ADD_TO_CONSOLIDATE_TOOLTIP","Add the response to consolidation"),"e1SDAObsStatusCompleted"!==this.response.Status&&"e1SDAObsStatusConsolidated"!==this.response.Status||this.setBanner(),this.verticalPowerBarSection.controls.push(this.consolidateResponsesToggle))}checkAndRunInternalApprovalMode(){this.apiConfig.canSuppressInternalReviews&&!this.response.initiatedUser.IsCurrentUser&&"e1SDAObsStatusWaived"!==this.response.Status&&(this.preventResponseReturnToggle=new $.a(()=>{this.onSuppressToggleChanged()},!0===this.response.IsReviewSuppressed,"Suppress","Suppress (undo)","fa fa-eye","fa fa-eye-slash"),this.preventResponseReturnToggle.offTooltip=this.sdaTranslationService.get("RESPONSE_MANAGEMENT_SUPPRESS_REVIEW_TOOLTIP","Prevent the review from being shown to users other than creator"),this.preventResponseReturnToggle.onTooltip=this.sdaTranslationService.get("RESPONSE_MANAGEMENT_UNDO_SUPPRESS_REVIEW_TOOLTIP","Undo suppress of the review"),!0===this.response.IsReviewSuppressed&&this.setReviewBanner(),this.verticalPowerBarSection.controls.push(this.preventResponseReturnToggle))}onConsolidateToggleChanged(){this.previousStatusOfResponse=this.response.Status,this.consolidateResponsesToggle.checked?(this.isToConsolidate=!1,this.response.Status="e1SDAObsStatusCompleted",this.response.StatusDisplay=this.sdaTranslationService.get("RESPONSE_MANAGEMENT_RESPONSE_COMPLETED_STATUS_DISPLAY","COMPLETED")):(this.isToConsolidate=!0,this.response.Status="e1SDAObsStatusConsolidated",this.response.StatusDisplay=this.sdaTranslationService.get("RESPONSE_MANAGEMENT_RESPONSE_CONSOLIDATED_STATUS_DISPLAY","CONSOLIDATED")),this.responseService.save(this.response,this.apiConfig.observationType,this.apiConfig.observationType2).subscribe(()=>{this.setBanner(),this.initialiseAdditionalInformation(),this.onManageResponseSupportingInformationOnConsolidator(),this.onChangeResponseStatus()},e=>{this.exceptionService.handleException(e)})}onSuppressToggleChanged(){this.response.IsReviewSuppressed=!!this.preventResponseReturnToggle.checked;const e=new H.a(void 0);e.properties.push(new z.a("SCLBProjComsIsReviewSuppressed",this.response.IsReviewSuppressed)),this.crudService.update(this.response.OBID,e).pipe(Object(X.a)(1)).subscribe(()=>{this.notificationService.success(this.sdaTranslationService.get("REVIEW_UPDATE_SUCCESS","Review successfully updated")),this.setReviewBanner()},e=>{this.exceptionService.handleException(e)})}setBanner(){this.consolidateResponsesToggle.checked&&"e1SDAObsStatusInitiated"!==this.response.Status||!this.consolidateResponsesToggle.checked&&"e1SDAObsStatusCompleted"===this.response.Status?(this.response.bannerTitle=this.sdaTranslationService.get("RESPONSE_MANAGEMENT_REMOVED","Removed"),this.response.bannerContent=[this.sdaTranslationService.get("RESPONSE_MANAGEMENT_REMOVED_FROM_CONSOLIDATE_DESCRIPTION","Removed the response from consolidation")],this.response.bannerType=F.a.Info):this.consolidateResponsesToggle.checked||"e1SDAObsStatusConsolidated"!==this.response.Status?(this.response.bannerTitle="",this.response.bannerContent=[],this.response.bannerType=void 0):(this.response.bannerTitle=this.sdaTranslationService.get("RESPONSE_MANAGEMENT_CONSOLIDATED","Consolidated"),this.response.bannerContent=[this.sdaTranslationService.get("RESPONSE_MANAGEMENT_ADDED_TO_CONSOLIDATE_DESCRIPTION","Added the response to consolidation")],this.response.bannerType=F.a.Info)}setReviewBanner(){this.preventResponseReturnToggle&&this.preventResponseReturnToggle.checked?(this.response.bannerTitle=this.sdaTranslationService.get("RESPONSE_MANAGEMENT_SUPPRESSED","Suppressed"),this.response.bannerContent=[this.sdaTranslationService.get("RESPONSE_MANAGEMENT_SUPPRESSED_REVIEW_DESCRIPTION","Review will be suppressed for users other than creator")],this.response.bannerType=F.a.Info):(this.response.bannerTitle="",this.response.bannerContent=[],this.response.bannerType=void 0)}onPreventReturnChanged(){this.preventResponseReturnToggle.checked?(this.response.Status="e1SDAObsStatusCompleted",this.response.StatusDisplay=this.sdaTranslationService.get("RESPONSE_MANAGEMENT_RESPONSE_COMPLETED_STATUS_DISPLAY","COMPLETED"),this.response.bannerTitle=this.sdaTranslationService.get("RESPONSE_MANAGEMENT_SUPPRESSED","Suppressed"),this.response.bannerContent=[this.sdaTranslationService.get("RESPONSE_MANAGEMENT_SUPPRESSED_DESCRIPTION","Response will not be sent to the originating organization")],this.response.bannerType=F.a.Info,this.response.isEditable=!1):(this.response.initiatedUser.IsCurrentUser?(this.response.Status="e1SDAObsStatusDraft",this.response.StatusDisplay=this.sdaTranslationService.get("RESPONSE_MANAGEMENT_RESPONSE_DRAFT_STATUS_DISPLAY","DRAFT"),this.response.isEditable=!0):(this.response.Status="e1SDAObsStatusInitiated",this.response.StatusDisplay=this.sdaTranslationService.get("RESPONSE_MANAGEMENT_RESPONSE_INITIATED_STATUS_DISPLAY","INITIATED")),this.response.bannerTitle="",this.response.bannerContent=[],this.response.bannerType=void 0),this.responseService.save(this.response,this.apiConfig.observationType,this.apiConfig.observationType2).subscribe(()=>{this.initialiseAdditionalInformation(),this.initializePowerBarOptions(),this.onChangeResponseStatus()},e=>{this.exceptionService.handleException(e)})}initialiseAdditionalInformation(){this.summaryItems=[new B.a(this.sdaTranslationService.get("RESPONSE_MANAGEMENT_RESPONSE_STATUS_TITLE","Issue State"),this.response.StatusDisplay)]}initializePowerBarOptions(){this.verticalPowerBarSection=new Z.a,this.verticalPowerBarSection.overflowOrientation=q.a.Vertical,this.revisionPowerBarRHSControls=[],this.isLatest&&(this.apiConfig.canSuppressObservationItems&&"e1SDAObsStatusWaived"!==this.response.Status&&"e1SDAObsStatusRejected"!==this.response.Status&&(this.preventResponseReturnToggle=new $.a(()=>{this.onPreventReturnChanged()},"e1SDAObsStatusCompleted"===this.response.Status,"Suppress","Suppress (undo)","fa fa-eye","fa fa-eye-slash"),this.preventResponseReturnToggle.tooltip=this.sdaTranslationService.get("RESPONSE_MANAGEMENT_PREVENT_SEND_TO_EXT_ORG_TOOLTIP","Prevent the response from being sent to the originating organization"),this.verticalPowerBarSection.controls.push(this.preventResponseReturnToggle)),this.checkAndRunInternalApprovalMode(),this.checkAndRunConsolidatonMode(),this.addPowerBarButtons()),this.verticalPowerBarSection.controls.length>0&&(this.powerBarOverflowControls=[this.verticalPowerBarSection]),this.onCancelEditResponseControls()}onEditResponse(){this.response.isInEdit=!0,this.powerBarIsOverflowHidden=!0,this.approveEditResponseBtn.hidden=!1,this.cancelEditResponseBtn.hidden=!1,this.preventResponseReturnToggle&&(this.preventResponseReturnToggle.hidden=!0),this.response.titleValue=this.response.Title?this.response.Title.substring(0):"",this.response.detailsValue=this.response.Details?this.response.Details.substring(0):""}onCancelEditResponse(){this.onCancelEditResponseControls(),this.preventResponseReturnToggle&&(this.preventResponseReturnToggle.hidden=!1),this.response.Title=this.response.titleValue?this.response.titleValue.substring(0):"",this.response.Details=this.response.detailsValue?this.response.detailsValue.substring(0):""}onCancelEditResponseControls(){this.response.isInEdit=!1,this.powerBarIsOverflowHidden=!1,this.approveEditResponseBtn&&(this.approveEditResponseBtn.hidden=!0),this.cancelEditResponseBtn&&(this.cancelEditResponseBtn.hidden=!0)}onSaveResponse(){this.response.isInEdit=!1,this.powerBarIsOverflowHidden=!1,this.approveEditResponseBtn.hidden=!0,this.cancelEditResponseBtn.hidden=!0,this.preventResponseReturnToggle&&(this.preventResponseReturnToggle.hidden=!1),this.responseService.save(this.response,this.apiConfig.observationType,this.apiConfig.observationType2).subscribe()}onManageResponseMarkupLayers(){const e=new _.a;e.currentMarkupContextOBIDs=this.allResponseOBIDs,this.relatedItemService.onExecuteMethod(this.manageResponseMarkupLayersMethod,new E.a(this.response.OBID,"",this.response.Config),[this.response.OBID],this.parentClientAPI,this.parentMethodOBID,this.parentObjects,!0,e)}onManageResponseRelatedFiles(){this.onManageRelatedFiles.emit(this.response)}onChangeResponseStatus(){this.onChangeResponseState.emit()}onManageResponseRelatedObjects(){this.relatedItemService.onExecuteMethod(this.manageResponseRelatedItemsMethod,new E.a(this.response.OBID,this.response.Name,this.response.Config),[this.response.OBID],"","",[],!0)}onManageResponseSupportingInformationOnConsolidator(){this.onManageSupportingInformation.emit({response:this.response,isToConsolidate:this.isToConsolidate})}resetExceptionResponse(){this.response.Status=this.previousStatusOfResponse,this.consolidateResponsesToggle&&(this.consolidateResponsesToggle.checked=!this.consolidateResponsesToggle.checked,!1===this.consolidateResponsesToggle.checked?this.consolidateResponsesToggle.tooltip=this.sdaTranslationService.get("RESPONSE_MANAGEMENT_REMOVE_FROM_CONSOLIDATE_TOOLTIP","Remove the response from consolidation"):!0===this.consolidateResponsesToggle.checked&&(this.consolidateResponsesToggle.tooltip=this.sdaTranslationService.get("RESPONSE_MANAGEMENT_ADD_TO_CONSOLIDATE_TOOLTIP","Add the response to consolidation")),this.resetStatusDisplay(this.response),this.setBanner(),this.initialiseAdditionalInformation(),this.responseService.save(this.response,this.apiConfig.observationType,this.apiConfig.observationType2).subscribe())}resetStatusDisplay(e){switch(e.Status){case"e1SDAObsStatusCompleted":e.StatusDisplay=this.sdaTranslationService.get("RESPONSE_MANAGEMENT_RESPONSE_COMPLETED_STATUS_DISPLAY","COMPLETED");break;case"e1SDAObsStatusDraft":e.StatusDisplay=this.sdaTranslationService.get("RESPONSE_MANAGEMENT_RESPONSE_DRAFT_STATUS_DISPLAY","DRAFT");break;case"e1SDAObsStatusInitiated":e.StatusDisplay=this.sdaTranslationService.get("RESPONSE_MANAGEMENT_RESPONSE_INITIATED_STATUS_DISPLAY","INITIATED");break;case"e1SDAObsStatusConsolidated":e.StatusDisplay=this.sdaTranslationService.get("RESPONSE_MANAGEMENT_RESPONSE_CONSOLIDATED_STATUS_DISPLAY","CONSOLIDATED")}}}return e.\u0275fac=function(t){return new(t||e)(x.Sb(O.a),x.Sb(I.a),x.Sb(N.a),x.Sb(c.a),x.Sb(K.a),x.Sb(Q.a))},e.\u0275cmp=x.Mb({type:e,selectors:[["sda-observation-header-details-view"]],inputs:{response:"response",manageResponseMarkupLayersMethod:"manageResponseMarkupLayersMethod",manageResponseRelatedItemsMethod:"manageResponseRelatedItemsMethod",apiConfig:"apiConfig",isLatest:"isLatest",allResponseOBIDs:"allResponseOBIDs",exceptionResponse:"exceptionResponse",parentMethodOBID:"parentMethodOBID",parentObjects:"parentObjects",parentClientAPI:"parentClientAPI"},outputs:{onViewResponseDetails:"onViewResponseDetails",onManageRelatedItems:"onManageRelatedItems",onManageRelatedFiles:"onManageRelatedFiles",onChangeResponseState:"onChangeResponseState",onManageSupportingInformation:"onManageSupportingInformation"},features:[x.Cb],decls:1,vars:17,consts:[[3,"user","header","headerIsEditable","bannerTitle","badge","bannerContent","bannerType","powerBarOverflowIsHidden","powerBarRHSControls","powerBarOverflowControls","creationDate","markupsIdentified","rejectReason","rejectUser","rejectDate","additionalInformation","powerBarOverflowCloseOnAllClicks","descriptionClicked","headerChange"]],template:function(e,t){1&e&&(x.Yb(0,"sda-card-template-user-info-view",0),x.hc("descriptionClicked",(function(){return t.onViewResponseDetails.emit(t.response)}))("headerChange",(function(e){return t.response.Title=e})),x.Xb()),2&e&&x.sc("user",t.response.initiatedUser)("header",t.response.Title)("headerIsEditable",t.response.isInEdit)("bannerTitle",t.response.bannerTitle)("badge",t.badge)("bannerContent",t.response.bannerContent)("bannerType",t.response.bannerType)("powerBarOverflowIsHidden",t.powerBarIsOverflowHidden)("powerBarRHSControls",t.revisionPowerBarRHSControls)("powerBarOverflowControls",t.powerBarOverflowControls)("creationDate",t.response.ModifiedDate)("markupsIdentified",t.response.HasRelatedMarkups)("rejectReason",t.response.RejectDetails?t.response.RejectDetails.RejectReason:"")("rejectUser",t.response.RejectDetails?t.response.RejectDetails.RejectUser:"")("rejectDate",t.response.RejectDetails?t.response.RejectDetails.RejectDate:"")("additionalInformation",t.summaryItems)("powerBarOverflowCloseOnAllClicks",t.powerBarOverflowCloseOnAllClicks)},directives:[ee.a],encapsulation:2}),e})();var se=s("47Ra"),ne=s("oe3R"),ie=s("2wkq"),ae=s("b/tf"),oe=s("gBNM"),re=s("7LiV"),ce=s("HXFx");function le(e,t){if(1&e){const e=x.Zb();x.Yb(0,"p-accordion",2),x.hc("onOpen",(function(t){return x.Kc(e),x.lc().onShowSupportingInformation.emit(t)})),x.Yb(1,"p-accordionTab",3),x.Tb(2,"sda-tabbed-grid-view",4),x.Xb(),x.Xb()}if(2&e){const e=x.lc();x.sc("activeIndex",e.activeTabIndex),x.Eb(1),x.sc("header",e.CARD_SUPPORTING_INFO_TITLE),x.Eb(1),x.sc("tabs",e.tabs)("openInfoMapInNewTab",e.openInfoMapInNewTab)}}function de(e,t){if(1&e&&x.Tb(0,"sda-tabbed-grid-view",4),2&e){const e=x.lc();x.sc("tabs",e.tabs)("openInfoMapInNewTab",e.openInfoMapInNewTab)}}let he=(()=>{class e{constructor(e,t){this.sdaTranslate=e,this.preferencesService=t,this.onFileClicked=new x.o,this.onDocumentFileClicked=new x.o,this.onRenditionClicked=new x.o,this.onObjectClicked=new x.o,this.onShowSupportingInformation=new x.o,this.activeTabIndex=void 0,this.CARD_SUPPORTING_INFO_TITLE=this.sdaTranslate.get("REVIEW_SUPPORTING_INFORMATION_HEADER","Supporting Information"),this.preferencesSubscription=this.preferencesService.preferencesChanged$.subscribe(e=>{e&&(this.openInfoMapInNewTab=!1!==e.SDXOpsOpenInfoMapInNewTab)})}ngOnChanges(e){e.data?this.data&&(this.tabs=this.data.map(e=>this.transformToTab(e)),this.expandAccordian()):e.isTabExpanded&&this.expandAccordian()}ngOnDestroy(){this.preferencesSubscription&&this.preferencesSubscription.unsubscribe()}transformToTab(e){let t="Objects('"+this.parentObjectOBID+"')/"+e.RelWithDirection+"?$count=true";e.IsExpandable&&e.DetailsRelWithDirection&&(t+="&$expand="+e.DetailsRelWithDirection+"($top=0;$count=true)");const s=new oe.a(e.Name,t,this.config,e.ColumnSetUID,this.parentObjectOBID,e.RelWithDirection);return e.ClassDef&&(s.odataUrl+="&$filter=Class eq '"+e.ClassDef+"'"),s.onCellClicked=t=>this.onCellClicked(t,e.IsFiles),s.isCellViewOnlyQuery=this.isCellViewOnly(e.IsFiles),s.isExpandable=e.IsExpandable,s.isStale=e.isDirty,s.apiContextMenu=new ie.a,e.ContextMenuClientAPIs&&e.ContextMenuClientAPIs.length>0&&(s.apiContextMenu.menuOptionAPIs=e.ContextMenuClientAPIs.map(t=>{const s=t.split("~");let n,i=!1;if(e.contextMenuClientAPIFilters){const t=e.contextMenuClientAPIFilters.find(e=>e.apiName===s[0]);t&&(n=t.argFilters,i=t.excludeAllMethods)}return 1===s.length?new ne.a(t,n,void 0,i):new ne.a(s[0],n,{relDefTOSecondaryObjParamKey:s[1],ObjectOBID:this.parentObjectOBID},i)})),e.ContextMenuURL&&(s.apiContextMenu.menuOptionURL=e.ContextMenuURL),e.IsExpandable&&(s.onExpandRowClicked=e=>this.onExpandRowClicked(e,s)),s}isCellViewOnly(e){return e?"Objects?$filter=SPFViewInd eq 'True' and OBID eq '{0}' &$select=OBID":""}onCellClicked(e,t){e&&(0===e.gridLevel&&t?this.onFileClicked.emit(new E.a(e.object.OBID,e.object.Name,e.object.Config)):1===e.gridLevel||t?e.object&&e.object.ClassDef&&"SDARenditionFile"===e.object.ClassDef?this.onRenditionClicked.emit(new E.a(e.object.OBID,e.object.Name,e.object.Config)):this.onDocumentFileClicked.emit(new E.a(e.object.OBID,e.object.Name,e.object.Config)):this.onObjectClicked.emit(new E.a(e.object.OBID,e.object.Name,e.object.Config)))}onExpandRowClicked(e,t){return"GetDocumentRelatedFileInfo(DocumentOBID='"+e.OBID+"', ParentOBID='"+t.parentOBID+"', ParentDocumentRel='"+t.parentRelDef+"')"}expandAccordian(){this.isTabExpanded&&(this.activeTabIndex=0)}}return e.\u0275fac=function(t){return new(t||e)(x.Sb(O.a),x.Sb(ae.a))},e.\u0275cmp=x.Mb({type:e,selectors:[["sda-card-template-supporting-info-view"]],inputs:{data:"data",parentObjectOBID:"parentObjectOBID",config:"config",isTabExpanded:"isTabExpanded",hideAccordian:"hideAccordian"},outputs:{onFileClicked:"onFileClicked",onDocumentFileClicked:"onDocumentFileClicked",onRenditionClicked:"onRenditionClicked",onObjectClicked:"onObjectClicked",onShowSupportingInformation:"onShowSupportingInformation"},features:[x.Cb],decls:2,vars:2,consts:[[3,"activeIndex","onOpen",4,"ngIf"],[3,"tabs","openInfoMapInNewTab",4,"ngIf"],[3,"activeIndex","onOpen"],[3,"header"],[3,"tabs","openInfoMapInNewTab"]],template:function(e,t){1&e&&(x.Sc(0,le,3,4,"p-accordion",0),x.Sc(1,de,1,2,"sda-tabbed-grid-view",1)),2&e&&(x.sc("ngIf",!t.hideAccordian),x.Eb(1),x.sc("ngIf",t.hideAccordian&&(null==t.tabs?null:t.tabs.length)>0))},directives:[U.t,re.a,re.c,ce.a],styles:["[_nghost-%COMP%]{display:flex;height:100%}[_nghost-%COMP%]     .ui-accordion, [_nghost-%COMP%]     p-accordion{flex:1;margin-bottom:1px;overflow:hidden}[_nghost-%COMP%]     .ui-accordion-header{background:#fff;border-top:1px solid #d9dde2;transition:none}[_nghost-%COMP%]     .ui-accordion-header.ui-state-hover{background:#fff}[_nghost-%COMP%]     .ui-accordion-header.ui-state-active{background:#e7eaed;border-bottom:1px solid #d9dde2}[_nghost-%COMP%]     .ui-accordion-header.ui-state-active+.ui-accordion-content-wrapper{margin-bottom:10px}[_nghost-%COMP%]     .ui-accordion-content-wrapper{max-height:450px;overflow-x:hidden}.card-support[_ngcontent-%COMP%]:not(:only-child):not(:first-of-type){margin-top:10px}.card-support__title[_ngcontent-%COMP%]{margin-bottom:5px;font-size:16px;font-weight:500}.support-info__button[_ngcontent-%COMP%]{margin-bottom:10px;padding:8px 10px 6px;font-size:14px!important;box-shadow:none}.support-info__button[_ngcontent-%COMP%]:not(:only-child):not(:last-of-type){margin-right:10px}.support-info__text[_ngcontent-%COMP%]{margin-left:5px}"]}),e})();function pe(e,t){if(1&e&&x.Tb(0,"sda-power-bar-view",2),2&e){const e=x.lc();x.sc("leftControls",e.filters)}}function ge(e,t){if(1&e&&(x.Yb(0,"div",12),x.kc(),x.Yb(1,"svg",13),x.Yb(2,"title"),x.Uc(3),x.Xb(),x.Tb(4,"path",14),x.Xb(),x.Uc(5),x.Xb()),2&e){const e=x.lc().$implicit,t=x.lc();x.Ib("tab-status--completed","e1SDAObsStatusCompleted"===e.Status)("tab-status--draft","e1SDAObsStatusDraft"===e.Status)("tab-status--issued","e1SDAObsStatusIssued"===e.Status)("tab-status--rejected","e1SDAObsStatusRejected"===e.Status)("tab-status--closed-auto","e1SDAObsStatusAutoClosed"===e.Status)("tab-status--verified","e1SDAObsStatusVerified"===e.Status)("tab-status--initiated","e1SDAObsStatusInitiated"===e.Status)("tab-status--waived","e1SDAObsStatusWaived"===e.Status)("tab-status--draft-rejected","e1XmtlIssueStateDRAFTREJECTED"===e.Status),x.tc("title",e.StatusDisplay),x.Eb(3),x.Vc(e.StatusDisplay),x.Eb(2),x.Wc(" ",e.initiatedUser.IsCurrentUser?t.YOU:e.initiatedUser.DisplayName," ")}}function ue(e,t){if(1&e){const e=x.Zb();x.Yb(0,"sda-card-template-supporting-info-view",15),x.hc("onFileClicked",(function(t){return x.Kc(e),x.lc(2).launchMarkupMethod(t)}))("onDocumentFileClicked",(function(t){return x.Kc(e),x.lc(2).launchMarkupMethod(t)}))("onRenditionClicked",(function(t){return x.Kc(e),x.lc(2).launchMarkupMethod(t)}))("onObjectClicked",(function(t){return x.Kc(e),x.lc(2).onViewObjectDetails.emit(t)}))("onShowSupportingInformation",(function(){x.Kc(e);const t=x.lc().$implicit;return x.lc().onShowSupportingInformation(t)})),x.Xb()}if(2&e){const e=x.lc().$implicit,t=x.lc();x.sc("data",e.SupportingInformationSkeleton)("config",t.config)("parentObjectOBID",e.OBID)}}function be(e,t){if(1&e){const e=x.Zb();x.Yb(0,"mat-tab"),x.Sc(1,ge,6,21,"ng-template",3),x.Yb(2,"div",4),x.Yb(3,"sda-card-view",5),x.Yb(4,"div",6),x.Yb(5,"sda-observation-header-details-view",7),x.hc("onViewResponseDetails",(function(t){return x.Kc(e),x.lc().viewItemDetails(t)}))("onManageRelatedFiles",(function(t){return x.Kc(e),x.lc().manageItemFiles(t)}))("onManageSupportingInformation",(function(t){return x.Kc(e),x.lc().manageResponseSupportingInformationOnConsolidatorResponse(t)}))("onChangeResponseState",(function(){return x.Kc(e),x.lc().refreshResponseStatusFilters()})),x.Xb(),x.Xb(),x.Yb(6,"div",8),x.Yb(7,"sda-card-template-content-view",9),x.hc("textChange",(function(s){return x.Kc(e),t.$implicit.Details=s})),x.Xb(),x.Xb(),x.Yb(8,"div",10),x.Sc(9,ue,1,3,"sda-card-template-supporting-info-view",11),x.Xb(),x.Xb(),x.Xb(),x.Xb()}if(2&e){const e=t.$implicit,s=x.lc();x.Eb(3),x.sc("styleClass","comm-item-card"),x.Eb(2),x.sc("response",e)("apiConfig",s.apiConfig)("isLatest",s.isLatest)("parentMethodOBID",s.parentMethodOBID)("parentObjects",s.parentObjects)("parentClientAPI",s.parentClientAPI)("allResponseOBIDs",s.allResponseOBIDs)("manageResponseMarkupLayersMethod",s.manageMarkupLayersMethod)("manageResponseRelatedItemsMethod",s.manageRelatedItemsMethod)("exceptionResponse",s.exceptionResponse),x.Eb(2),x.sc("text",e.Details)("isEditable",e.isInEdit),x.Eb(2),x.sc("ngIf",s.apiConfig.header.showRevisions)}}let Se=(()=>{class e{constructor(e,t,s,n,i,a){this.sdaTranslateService=e,this.responseManagementDataService=t,this.loadingOverlayService=s,this.dataRefreshService=n,this.modeService=i,this.exceptionService=a,this.onManageRelatedFiles=new x.o,this.onLaunchMarkupMethod=new x.o,this.onViewObjectDetails=new x.o,this.YOU=this.sdaTranslateService.get("YOU","YOU"),this.activeFilterCount=0,this.filters=[],this.allResponseOBIDs=[],this.refreshDataSubscription=this.dataRefreshService.refreshData$.subscribe(e=>{e&&e.objectsToRefresh&&1===e.objectsToRefresh.length&&(this.data.every(t=>t.OBID!==e.objectsToRefresh[0].obid)||this.refreshSupportingInformation(e.objectsToRefresh[0].obid,!0,e.origin))})}ngOnChanges(e){e.data&&(this.intializeData(),this.initializeFilters())}ngOnDestroy(){this.refreshDataSubscription&&this.refreshDataSubscription.unsubscribe()}launchMarkupMethod(e){this.onLaunchMarkupMethod&&this.onLaunchMarkupMethod.emit(e)}viewItemDetails(e){this.onViewObjectDetails&&this.onViewObjectDetails.emit(new E.a(e.OBID,"",e.Config))}manageItemFiles(e){this.onManageRelatedFiles&&this.onManageRelatedFiles.emit(e)}onShowSupportingInformation(e){e.SupportingInformationSkeleton||this.refreshSupportingInformation(e.OBID,!1)}manageResponseSupportingInformationOnConsolidatorResponse(e){this.loadingOverlayService.showLoadingOverlay(),this.data.filter(e=>e.initiatedUser.IsCurrentUser).forEach(t=>{this.responseManagementDataService.manageResponseSupportingInformationOnConsolidatorResponse(t.OBID,e.response.OBID,e.isToConsolidate).subscribe(()=>{this.refreshSupportingInformation(t.OBID,!0)},t=>{const s=new r.a(t,t.message,"ObservationItemsComponent","manageResponseSupportingInformationOnConsolidatorResponse");this.exceptionService.handleException(s),this.exceptionResponse=e.response,this.loadingOverlayService.hideLoadingOverlay()})}),this.exceptionResponse=void 0}refreshResponseStatusFilters(){this.initializeFilters()}intializeData(){this.data.forEach(e=>{e.initiatedUser=this.responders.filter(t=>t.OBID===e.UserOBID)[0],e.isEditable=this.isObservationItemEditable(e),e.isInEdit=!1,e.Details=e.Details?e.Details:"",this.allResponseOBIDs.push(e.OBID),"e1SDAObsStatusCompleted"===e.Status?(e.bannerTitle=this.sdaTranslateService.get("RESPONSE_MANAGEMENT_SUPPRESSED","Suppressed"),e.bannerContent=[this.sdaTranslateService.get("RESPONSE_MANAGEMENT_SUPPRESSED_DESCRIPTION","Response will not be sent to the originating organization")],e.bannerType=F.a.Info):"e1SCLBObsStatusSUPPRESSED"===e.Status?(e.bannerTitle=this.sdaTranslateService.get("RESPONSE_MANAGEMENT_SUPPRESSED","Suppressed"),e.bannerContent=[this.sdaTranslateService.get("RESPONSE_MANAGEMENT_SUPPRESSED_REVIEW_DESCRIPTION","Review will be suppressed for users other than creator")],e.bannerType=F.a.Info):"e1SDAObsStatusWaived"===e.Status&&(e.bannerTitle=this.sdaTranslateService.get("RESPONSE_MANAGEMENT_WAIVED","Waived"),e.bannerContent=[this.sdaTranslateService.get("RESPONSE_MANAGEMENT_WAIVED_DESCRIPTION","Response/Review has been waived by the responder")],e.bannerType=F.a.Warning)})}isObservationItemEditable(e){let t=!1;return this.apiConfig.canEditAnyObservationItem?t="e1SDAObsStatusInitiated"===e.Status||"e1SDAObsStatusDraft"===e.Status&&e.initiatedUser.IsCurrentUser:(e.type===w.Response&&this.apiConfig.canEditMyResponse||e.type===w.Review&&this.apiConfig.canEditMyReview)&&(t=e.initiatedUser.IsCurrentUser),t}refreshSupportingInformation(e,t=!1,s=""){this.loadingOverlayService.showLoadingOverlay(),this.responseManagementDataService.getSupportingInformationSkeletonForObject(e).subscribe(n=>{n&&(t&&n.filter(e=>e.IsFiles===("SDASupportingInformation"===s)).forEach(e=>e.isDirty=!0),(this.modeService.isConsolidateResponse(this.apiConfig.mode)?this.getConsolidateResponse().find(t=>t.OBID===e):this.data.find(t=>t.OBID===e)).SupportingInformationSkeleton=n),this.loadingOverlayService.hideLoadingOverlay()})}initializeFilters(){this.filters=[];const e=new L.a(e=>this.filterItems(e),"ALL",!0,void 0,"filter filter--all");e.uid="ALL",this.filters.push(e),this.getUniqueValues().sort((e,t)=>j.a.sortByString(e.value,t.value)).forEach(e=>{const t=new L.a(e=>this.filterItems(e),e.value,!0,void 0,"filter filter--"+e.key);t.uid=e.key,this.filters.push(t)}),this.filteredData=this.modeService.isConsolidateResponse(this.apiConfig.mode)?this.getConsolidateResponse():this.data}getUniqueValues(){const e=[];return this.data.forEach(t=>{e.every(e=>e.key!==t.Status)&&e.push(new B.a(t.Status,t.StatusDisplay))}),e}filterItems(e){if("ALL"===e.displayName)this.filters.forEach(t=>t.checked=e.checked),this.activeFilterCount=0,this.filteredData=e.checked?this.modeService.isConsolidateResponse(this.apiConfig.mode)?this.getConsolidateResponse():this.data:[];else{const e=this.filters[0];e.checked=this.filters.filter(e=>"ALL"!==e.uid).every(e=>e.checked);const t=this.filters.filter(e=>e.checked).map(e=>e.uid);this.filteredData=this.modeService.isConsolidateResponse(this.apiConfig.mode)?this.getConsolidateResponse().filter(e=>t.find(t=>e.Status===t)):this.data.filter(e=>t.find(t=>e.Status===t)),this.showFilters&&(this.activeFilterCount=e.checked?0:t.length)}}getConsolidateResponse(){return this.data.filter(e=>e.IsConsolidatedResponse)}}return e.\u0275fac=function(t){return new(t||e)(x.Sb(O.a),x.Sb(y.a),x.Sb(h.a),x.Sb(b.a),x.Sb(P.a),x.Sb(c.a))},e.\u0275cmp=x.Mb({type:e,selectors:[["sda-observation-items"]],inputs:{data:"data",responders:"responders",apiConfig:"apiConfig",isLatest:"isLatest",manageMarkupLayersMethod:"manageMarkupLayersMethod",manageRelatedItemsMethod:"manageRelatedItemsMethod",parentMethodOBID:"parentMethodOBID",config:"config",parentObjects:"parentObjects",parentClientAPI:"parentClientAPI"},outputs:{onManageRelatedFiles:"onManageRelatedFiles",onLaunchMarkupMethod:"onLaunchMarkupMethod",onViewObjectDetails:"onViewObjectDetails"},features:[x.Cb],decls:3,vars:2,consts:[["class","tab-filters",3,"leftControls",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"tab-filters",3,"leftControls"],["mat-tab-label",""],[1,"tab-content"],[3,"styleClass"],[1,"sda-card-header"],[3,"response","apiConfig","isLatest","parentMethodOBID","parentObjects","parentClientAPI","allResponseOBIDs","manageResponseMarkupLayersMethod","manageResponseRelatedItemsMethod","exceptionResponse","onViewResponseDetails","onManageRelatedFiles","onManageSupportingInformation","onChangeResponseState"],[1,"sda-card-body"],[3,"text","isEditable","textChange"],[1,"sda-card-footer"],[3,"data","config","parentObjectOBID","onFileClicked","onDocumentFileClicked","onRenditionClicked","onObjectClicked","onShowSupportingInformation",4,"ngIf"],[1,"tab-label-content","tab-status",3,"title"],["viewBox","0 0 1792 1792",0,"xml","space","preserve","width","20","height","20","xmlns","http://www.w3.org/2000/svg",1,"tab-status__icon"],["d","M1523 1339q-22-155-87.5-257.5t-184.5-118.5q-67 74-159.5 115.5t-195.5 41.5-195.5-41.5-159.5-115.5q-119 16-184.5 118.5t-87.5 257.5q106 150 271 237.5t356 87.5 356-87.5 271-237.5zm-243-699q0-159-112.5-271.5t-271.5-112.5-271.5 112.5-112.5 271.5 112.5 271.5 271.5 112.5 271.5-112.5 112.5-271.5zm512 256q0 182-71 347.5t-190.5 286-285.5 191.5-349 71q-182 0-348-71t-286-191-191-286-71-348 71-348 191-286 286-191 348-71 348 71 286 191 191 286 71 348z"],[3,"data","config","parentObjectOBID","onFileClicked","onDocumentFileClicked","onRenditionClicked","onObjectClicked","onShowSupportingInformation"]],template:function(e,t){1&e&&(x.Sc(0,pe,1,1,"sda-power-bar-view",0),x.Yb(1,"mat-tab-group"),x.Sc(2,be,10,14,"mat-tab",1),x.Xb()),2&e&&(x.sc("ngIf",(null==t.filters?null:t.filters.length)>0&&t.showFilters),x.Eb(2),x.sc("ngForOf",t.filteredData))},directives:[U.t,Y.c,U.s,G.a,Y.a,Y.d,V.a,te,se.a,he],styles:["[_nghost-%COMP%]{display:flex;flex:1;flex-direction:column}[_nghost-%COMP%], [_nghost-%COMP%]     .comm-item-card{height:100%}.tab-filters[_ngcontent-%COMP%]     .power-bar{height:auto;padding:10px 0 0}.tab-filters[_ngcontent-%COMP%]     .power-bar-switch{margin-left:10px!important}.tab-filters[_ngcontent-%COMP%]     .power-bar-controls{flex-wrap:wrap}.tab-filters[_ngcontent-%COMP%]     .filter{margin:0 0 10px;padding:0 6px;background-color:#fff;border-left:6px solid #cad0d7}.tab-filters[_ngcontent-%COMP%]     .filter--all{border-left-color:transparent}.tab-filters[_ngcontent-%COMP%]     .filter--e1SDAObsStatusCompleted{border-left-color:#00608f}.tab-filters[_ngcontent-%COMP%]     .filter--e1SDAObsStatusDraft{border-left-color:#a9b4be}.tab-filters[_ngcontent-%COMP%]     .filter--e1SDAObsStatusIssued{border-left-color:#afe5ff}.tab-filters[_ngcontent-%COMP%]     .filter--e1SDAObsStatusRejected{border-left-color:#a30f21}.tab-filters[_ngcontent-%COMP%]     .filter--e1SDAObsStatusAutoClosed{border-left-color:#f2bf25}.tab-filters[_ngcontent-%COMP%]     .filter--e1SDAObsStatusVerified{border-left-color:#92cf7a}.tab-filters[_ngcontent-%COMP%]     .filter--e1SDAObsStatusInitiated{border-left-color:#3cc0ff}.tab-filters[_ngcontent-%COMP%]     .filter--e1SDAObsStatusWaived{border-left-color:#d1a00c}.tab-filters[_ngcontent-%COMP%]     .filter--e1XmtlIssueStateDRAFTREJECTED{border-left-color:#f16c7d}.tab-status__icon[_ngcontent-%COMP%]{margin-right:5px}.tab-status__icon[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#8997a5}.tab-status--completed[_ngcontent-%COMP%]   .tab-status__icon[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#00608f}.tab-status--draft[_ngcontent-%COMP%]   .tab-status__icon[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#a9b4be}.tab-status--issued[_ngcontent-%COMP%]   .tab-status__icon[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#afe5ff}.tab-status--rejected[_ngcontent-%COMP%]   .tab-status__icon[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#a30f21}.tab-status--closed-auto[_ngcontent-%COMP%]   .tab-status__icon[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#f2bf25}.tab-status--verified[_ngcontent-%COMP%]   .tab-status__icon[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#92cf7a}.tab-status--initiated[_ngcontent-%COMP%]   .tab-status__icon[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#3cc0ff}.tab-status--waived[_ngcontent-%COMP%]   .tab-status__icon[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#d1a00c}.tab-status--draft-rejected[_ngcontent-%COMP%]   .tab-status__icon[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#f16c7d}"]}),e})();var fe=s("tyNb"),me=s("k1qZ"),ve=s("kx0E"),Me=s("9eFW");let Ie=(()=>{class e{constructor(e,t,s,n,i){this.revisionService=e,this.sdaTranslateService=t,this.dataFormatService=s,this.workflowService=n,this.dataRefreshService=i,this.onManageRelatedItems=new x.o,this.onManageRelatedFiles=new x.o,this.onObjectClicked=new x.o,this.onHeaderEdited=new x.o,this.RESPONSE_MANAGEMENT_BODY_LATEST=this.sdaTranslateService.get("RESPONSE_MANAGEMENT_BODY_LATEST","LATEST"),this.ACTIONS_MENU_SHOW_CONDITIONS_ERROR=this.sdaTranslateService.get("ACTIONS_MENU_SHOW_CONDITIONS_ERROR","An error occurred evaluating shortcut availability"),this.summaryItems=[],this.badge="",this.refreshDataSubscription=this.dataRefreshService.refreshData$.subscribe(e=>{e&&e.objectsToRefresh&&1===e.objectsToRefresh.length&&this.initializeRevisionPowerBar()})}ngOnChanges(){this.initializeRevisionPowerBar()}ngOnInit(){this.revisionUpdateSubscription=this.revisionService.revisionUpdatedChange.subscribe(e=>{e&&this.onHeaderEdited.emit()}),this.workflowExceptionSubscription=this.workflowService.exceptionCaught.subscribe(e=>{e&&this.initializeRevisionPowerBar()})}ngOnDestroy(){this.refreshDataSubscription&&this.refreshDataSubscription.unsubscribe(),this.revisionUpdateSubscription&&this.revisionUpdateSubscription.unsubscribe(),this.workflowExceptionSubscription&&this.workflowExceptionSubscription.unsubscribe()}initializeRevisionPowerBar(){this.badge=this.revision.IsLatest?this.RESPONSE_MANAGEMENT_BODY_LATEST:"",this.revision.IsLatest&&(this.responderIndicationMessage&&this.identifyRespondersMethodUID&&this.identifyRespondersMethodUID.length>0&&(this.bannerTitle=this.sdaTranslateService.get("WARNING","Warning"),this.bannerContent=[this.responderIndicationMessage],this.bannerType=F.a.Warning),this.checkforWarning()),this.formatSummaryItems()}checkforWarning(){this.apiConfig.header.showRevisions&&this.apiConfig.header.showPropertyWarning&&(this.bannerTitle=void 0,(this.projectIndicationMessage||this.documentIndicationMessage)&&(this.bannerTitle=this.sdaTranslateService.get("WARNING","Warning"),this.getBannerContent(),this.bannerType=F.a.Warning))}getBannerContent(){this.projectIndicationMessage&&(this.bannerContent=this.projectIndicationMessage),this.documentIndicationMessage&&(this.bannerContent=[this.documentIndicationMessage])}formatSummaryItems(){this.summaryItems=[],this.revision.ColumnSetProperties&&this.revision.ColumnSetProperties.forEach(e=>{this.summaryItems.push(new B.a(e.DisplayName,this.formatDisplayItem(e.Value,e.ScopedById)))})}formatDisplayItem(e,t){let s="";switch(t){case"DateTimeType":s=this.dataFormatService.convertToLocalDateTimeFormat(e);break;case"YMDType":s=this.dataFormatService.convertToLocalDateFormat(e);break;default:s=e}return s}}return e.\u0275fac=function(t){return new(t||e)(x.Sb(k.a),x.Sb(O.a),x.Sb(ve.a),x.Sb(Me.a),x.Sb(b.a))},e.\u0275cmp=x.Mb({type:e,selectors:[["sda-revision-header-details-view"]],inputs:{revision:"revision",apiConfig:"apiConfig",parentMethodOBID:"parentMethodOBID",parentObjects:"parentObjects",parentClientAPI:"parentClientAPI",identifyRespondersMethodUID:"identifyRespondersMethodUID",responderIndicationMessage:"responderIndicationMessage",projectIndicationMessage:"projectIndicationMessage",documentIndicationMessage:"documentIndicationMessage"},outputs:{onManageRelatedItems:"onManageRelatedItems",onManageRelatedFiles:"onManageRelatedFiles",onObjectClicked:"onObjectClicked",onHeaderEdited:"onHeaderEdited"},features:[x.Cb],decls:1,vars:9,consts:[[3,"user","header","description","additionalInformation","bannerTitle","bannerContent","bannerType","headerIsEditable","badge","headerChange","descriptionChange","descriptionClicked"]],template:function(e,t){1&e&&(x.Yb(0,"sda-card-template-user-info-view",0),x.hc("headerChange",(function(e){return t.revision.Title=e}))("descriptionChange",(function(e){return t.revision.DisplayName=e}))("descriptionClicked",(function(e){return t.onObjectClicked.emit(e)})),x.Xb()),2&e&&x.sc("user",t.revision.InitiatedUser)("header",t.revision.Title)("description",t.revision.DisplayName)("additionalInformation",t.summaryItems)("bannerTitle",t.bannerTitle)("bannerContent",t.bannerContent)("bannerType",t.bannerType)("headerIsEditable",t.revision.isInEdit)("badge",t.badge)},directives:[ee.a],styles:["[_nghost-%COMP%]     .card-header__title{white-space:pre-line}"]}),e})();var Oe=s("3UNK"),Ee=s("NFeN"),Re=s("zCQ7");const Ce=["responseItems"],De=["reviewItems"],_e=["responseContainer"],Te=["responseCollapsedContainer"],we=["reviewContainer"],Ae=["reviewCollapsedContainer"];function Pe(e,t){if(1&e){const e=x.Zb();x.Yb(0,"div"),x.Yb(1,"sda-response-management-sidepanel-view",3),x.hc("onManageRelatedFiles",(function(){return x.Kc(e),x.lc().onManageComsObjectFiles()})),x.Xb(),x.Xb()}if(2&e){const e=x.lc();x.Eb(1),x.sc("revision",e.responseManagementDetails.Revision)("apiConfig",e.apiConfig)("parentMethodOBID",e.parentMethodOBID)("parentObjects",e.parentObjects)("parentClientAPI",e.parentClientAPI)("updateCommunicationMethodUID",e.updateCommunicationMethodUID)("manageRevisionMarkupLayersMethod",e.responseManagementDetails.ManageRevisionMarkupLayersMethod)("manageRevisionMarkupLayersMethodUID",e.manageObjectMarkupLayersMethodUID)("manageRevisionRelatedItemsMethodUID",e.manageRevisionRelatedItemsMethodUID)("viewItemIn3DMethodUID",e.viewItemIn3DMethodUID)("viewItemIn2DMethodUID",e.viewItemIn2DMethodUID)("viewImpactAnalysisMethodUID",e.viewImpactAnalysisMethodUID)("identifyRespondersMethodUID",e.identifyRespondersMethodUID)("conflictResolutionMethodUID",e.conflictResolutionMethodUID)}}function Ne(e,t){if(1&e&&x.Tb(0,"sda-reject-summary",21),2&e){const e=x.lc(2);x.sc("rejectDetails",e.responseManagementDetails.Revision.RejectDetails)}}function ye(e,t){1&e&&x.Tb(0,"mat-icon",23)}function ke(e,t){if(1&e&&(x.Sc(0,ye,1,0,"mat-icon",22),x.Uc(1)),2&e){const e=x.lc(2);x.sc("ngIf",e.responderIndicationMessage&&e.identifyRespondersMethodUID),x.Eb(1),x.Wc(" ",e.responseManagementDetails.Revision.ClassDef," ")}}function xe(e,t){if(1&e){const e=x.Zb();x.Yb(0,"sda-button",28),x.hc("click",(function(){return x.Kc(e),x.lc(4).toggleResponseFilters()})),x.Xb()}if(2&e){const e=x.lc(4);x.Ib("tab-filter--active",e.responseItems.showFilters)("tab-filter--all",0===e.responseItems.activeFilterCount),x.sc("styleClassIcon","fa-filter")("isCompact",!0),x.Fb("data-filter-count",e.responseItems.activeFilterCount)}}function Le(e,t){if(1&e&&(x.Yb(0,"div",26),x.Uc(1),x.Sc(2,xe,1,7,"sda-button",27),x.Xb()),2&e){const e=x.lc(3);x.Eb(1),x.Wc(" ",e.RESPONSE_MANAGEMENT_BODY_RESPONSES_HEADER2," "),x.Eb(1),x.sc("ngIf",1===e.containerActiveTab)}}function Be(e,t){1&e&&(x.Yb(0,"mat-tab"),x.Sc(1,Le,3,2,"ng-template",10),x.Tb(2,"div",24,25),x.Xb())}function Fe(e,t){if(1&e){const e=x.Zb();x.Yb(0,"sda-button",28),x.hc("click",(function(){return x.Kc(e),x.lc(4).toggleReviewFilters()})),x.Xb()}if(2&e){const e=x.lc(4);x.Ib("tab-filter--active",e.reviewItems.showFilters)("tab-filter--all",0===e.reviewItems.activeFilterCount),x.sc("styleClassIcon","fa-filter")("isCompact",!0),x.Fb("data-filter-count",e.reviewItems.activeFilterCount)}}function je(e,t){if(1&e&&(x.Yb(0,"div",26),x.Uc(1),x.Sc(2,Fe,1,7,"sda-button",27),x.Xb()),2&e){const e=x.lc(3);x.Eb(1),x.Wc(" ",e.RESPONSE_MANAGEMENT_BODY_REVIEWS_HEADER2," "),x.Eb(1),x.sc("ngIf",2===e.containerActiveTab)}}function Ue(e,t){1&e&&(x.Yb(0,"mat-tab"),x.Sc(1,je,3,2,"ng-template",10),x.Tb(2,"div",24,29),x.Xb())}function Ye(e,t){if(1&e){const e=x.Zb();x.Yb(0,"div",26),x.Uc(1),x.Yb(2,"sda-button",35),x.hc("click",(function(){return x.Kc(e),x.lc(3).toggleResponseFilters()})),x.Xb(),x.Xb()}if(2&e){x.lc();const e=x.Hc(9),t=x.lc(2);x.Eb(1),x.Wc(" ",t.responsesHeader," "),x.Eb(1),x.Ib("tab-filter--active",e.showFilters)("tab-filter--all",0===e.activeFilterCount),x.sc("styleClassIcon","fa-filter")("styleClassButton",e.showFilters?"button--active":"")("isCompact",!0),x.Fb("data-filter-count",e.activeFilterCount)}}function Ge(e,t){if(1&e){const e=x.Zb();x.Yb(0,"section",30),x.Yb(1,"div",8),x.Yb(2,"mat-tab-group"),x.Yb(3,"mat-tab",31),x.Sc(4,Ye,3,9,"ng-template",10),x.Yb(5,"div",24,32),x.Yb(7,"div",24),x.Yb(8,"sda-observation-items",33,34),x.hc("onManageRelatedFiles",(function(t){return x.Kc(e),x.lc(2).onManageCommunicationItemFiles(t)}))("onViewObjectDetails",(function(t){return x.Kc(e),x.lc(2).onViewObjectDetails(t)}))("onLaunchMarkupMethod",(function(t){return x.Kc(e),x.lc(2).onLaunchMarkupMethod(t,!1,!1)})),x.Xb(),x.Xb(),x.Xb(),x.Xb(),x.Xb(),x.Xb(),x.Xb()}if(2&e){const e=x.lc(2);x.Ib("rm-section--empty",e.collapseResponsesIntoTab),x.Eb(3),x.tc("label",e.responsesHeader),x.Eb(5),x.sc("parentMethodOBID",e.parentMethodOBID)("config",e.config)("parentObjects",e.parentObjects)("parentClientAPI",e.parentClientAPI)("data",e.responseManagementDetails.Responses)("responders",e.responseManagementDetails.Responders)("apiConfig",e.apiConfig)("isLatest",e.responseManagementDetails.Revision.IsLatest)("manageMarkupLayersMethod",e.responseManagementDetails.ManageResponseMarkupLayersMethod)("manageRelatedItemsMethod",e.responseManagementDetails.ManageObservationRelatedItemsMethod)}}function Ve(e,t){if(1&e){const e=x.Zb();x.Yb(0,"div",26),x.Uc(1),x.Yb(2,"sda-button",28),x.hc("click",(function(){return x.Kc(e),x.lc(3).toggleReviewFilters()})),x.Xb(),x.Xb()}if(2&e){x.lc();const e=x.Hc(9),t=x.lc(2);x.Eb(1),x.Wc(" ",t.reviewsHeader," "),x.Eb(1),x.Ib("tab-filter--active",e.showFilters)("tab-filter--all",0===e.activeFilterCount),x.sc("styleClassIcon","fa-filter")("isCompact",!0),x.Fb("data-filter-count",e.activeFilterCount)}}function Xe(e,t){if(1&e){const e=x.Zb();x.Yb(0,"section",36),x.Yb(1,"div",8),x.Yb(2,"mat-tab-group"),x.Yb(3,"mat-tab",31),x.Sc(4,Ve,3,8,"ng-template",10),x.Yb(5,"div",24,37),x.Yb(7,"div",24),x.Yb(8,"sda-observation-items",38,39),x.hc("onManageRelatedFiles",(function(t){return x.Kc(e),x.lc(2).onManageCommunicationItemFiles(t)}))("onViewObjectDetails",(function(t){return x.Kc(e),x.lc(2).onViewObjectDetails(t)}))("onLaunchMarkupMethod",(function(t){return x.Kc(e),x.lc(2).onLaunchMarkupMethod(t,!1,!1)})),x.Xb(),x.Xb(),x.Xb(),x.Xb(),x.Xb(),x.Xb(),x.Xb()}if(2&e){const e=x.lc(2);x.Ib("rm-section--empty",e.collapseReviewsIntoTab),x.Eb(3),x.tc("label",e.reviewsHeader),x.Eb(5),x.sc("data",e.responseManagementDetails.Reviews)("responders",e.responseManagementDetails.Reviewers)("apiConfig",e.apiConfig)("config",e.config)("isLatest",e.responseManagementDetails.Revision.IsLatest)("manageMarkupLayersMethod",e.responseManagementDetails.ManageReviewMarkupLayersMethod)("manageRelatedItemsMethod",e.responseManagementDetails.ManageObservationRelatedItemsMethod)}}function We(e,t){if(1&e){const e=x.Zb();x.Yb(0,"div",4),x.Sc(1,Ne,1,1,"sda-reject-summary",5),x.Yb(2,"div",6),x.Yb(3,"section",7),x.Yb(4,"div",8),x.Yb(5,"mat-tab-group",9),x.hc("selectedIndexChange",(function(t){return x.Kc(e),x.lc().containerActiveTab=t}))("selectedIndexChange",(function(t){return x.Kc(e),x.lc().selectedTabIndexChange(t)})),x.Yb(6,"mat-tab"),x.Sc(7,ke,2,2,"ng-template",10),x.Yb(8,"div",11),x.Yb(9,"sda-card-view",12),x.Yb(10,"div",13),x.Yb(11,"sda-revision-header-details-view",14),x.hc("onObjectClicked",(function(){return x.Kc(e),x.lc().onViewRevisionDetails()}))("onHeaderEdited",(function(){return x.Kc(e),x.lc().refreshObjectDetails()}))("onManageRelatedFiles",(function(){return x.Kc(e),x.lc().onManageComsObjectFiles()})),x.Xb(),x.Xb(),x.Yb(12,"div",15),x.Yb(13,"sda-card-template-content-view",16),x.hc("textChange",(function(t){return x.Kc(e),x.lc().responseManagementDetails.Revision.Details=t})),x.Xb(),x.Xb(),x.Xb(),x.Xb(),x.Xb(),x.Sc(14,Be,4,0,"mat-tab",1),x.Sc(15,Ue,4,0,"mat-tab",1),x.Xb(),x.Xb(),x.Xb(),x.Sc(16,Ge,10,13,"section",17),x.Sc(17,Xe,10,10,"section",18),x.Yb(18,"section",19),x.Yb(19,"div",8),x.Yb(20,"div",11),x.Yb(21,"sda-card-template-supporting-info-view",20),x.hc("onFileClicked",(function(t){return x.Kc(e),x.lc().onLaunchMarkupMethod(t,!0,!0)}))("onDocumentFileClicked",(function(t){return x.Kc(e),x.lc().onLaunchMarkupMethod(t,!0,!1)}))("onRenditionClicked",(function(t){return x.Kc(e),x.lc().onLaunchMarkupMethod(t,!0,!0)}))("onObjectClicked",(function(t){return x.Kc(e),x.lc().onViewObjectDetails(t)})),x.Xb(),x.Xb(),x.Xb(),x.Xb(),x.Xb(),x.Xb()}if(2&e){const e=x.lc();x.Eb(1),x.sc("ngIf",e.responseManagementDetails.Revision.RejectDetails),x.Eb(1),x.Ib("rm-panel--full",1===e.sectionCount)("rm-panel--split",2===e.sectionCount)("rm-panel--divided",3===e.sectionCount&&(null==e.responseManagementDetails?null:e.responseManagementDetails.Responses.length)>0&&(null==e.responseManagementDetails?null:e.responseManagementDetails.Reviews.length)>0)("rm-panel--quad",4===e.sectionCount),x.Eb(3),x.Ib("rm-tabs--empty",!e.collapseResponsesIntoTab&&!e.collapseReviewsIntoTab),x.sc("selectedIndex",e.containerActiveTab),x.Eb(4),x.sc("styleClass","rm-rev-card"),x.Eb(2),x.sc("revision",e.responseManagementDetails.Revision)("apiConfig",e.apiConfig)("parentMethodOBID",e.parentMethodOBID)("parentObjects",e.parentObjects)("parentClientAPI",e.parentClientAPI)("identifyRespondersMethodUID",e.identifyRespondersMethodUID)("responderIndicationMessage",e.responderIndicationMessage)("projectIndicationMessage",e.propertyIndicationMessage)("documentIndicationMessage",e.documentIndicationMessage),x.Eb(2),x.sc("text",e.responseManagementDetails.Revision.Details)("isEditable",e.responseManagementDetails.Revision.isInEdit),x.Eb(1),x.sc("ngIf",(null==e.responseManagementDetails.Responses?null:e.responseManagementDetails.Responses.length)>0),x.Eb(1),x.sc("ngIf",(null==e.responseManagementDetails.Reviews?null:e.responseManagementDetails.Reviews.length)>0),x.Eb(1),x.sc("ngIf",(null==e.responseManagementDetails.Responses?null:e.responseManagementDetails.Responses.length)>0),x.Eb(1),x.sc("ngIf",(null==e.responseManagementDetails.Reviews?null:e.responseManagementDetails.Reviews.length)>0),x.Eb(1),x.Ib("rm-section--empty",0===(null==e.responseManagementDetails.SupportingInformationSkeleton?null:e.responseManagementDetails.SupportingInformationSkeleton.length)),x.Eb(3),x.sc("data",e.responseManagementDetails.SupportingInformationSkeleton)("parentObjectOBID",e.responseManagementDetails.Revision.OBID)("config",e.config)("hideAccordian",!0)}}let He=(()=>{class e{constructor(e,t,s,n,i,a,o,r,c,l,d,h,p,g,b,S,f,m,v,M,I,O){this.route=e,this.sdaTranslateService=t,this.featureSetService=s,this.loadingOverlayService=n,this.objectDetailsService=i,this.actionMenuProvider=a,this.componentFactoryResolver=o,this.injector=r,this.modalService=c,this.exceptionService=l,this.observationService=d,this.responseManagementDataService=h,this.relatedItemService=p,this.dataRefreshService=g,this.loggingService=b,this.windowService=S,this.dataService=f,this.modeService=m,this.timeoutService=v,this.featureSetNavigationService=M,this.methodService=I,this.revisionService=O,this.RESPONSE_MANAGEMENT_BODY_RESPONSES_HEADER=this.sdaTranslateService.get("RESPONSE_MANAGEMENT_BODY_RESPONSES_HEADER","RESPONSE"),this.RESPONSE_MANAGEMENT_BODY_RESPONSES_HEADER2=this.sdaTranslateService.get("RESPONSE_MANAGEMENT_BODY_RESPONSES_HEADER2","RESPONSES"),this.RESPONSE_MANAGEMENT_BODY_REVIEWS_HEADER2=this.sdaTranslateService.get("RESPONSE_MANAGEMENT_BODY_REVIEWS_HEADER2","REVIEWS"),this.RESPONSE_MANAGEMENT_BODY_REVIEWS_HEADER=this.sdaTranslateService.get("RESPONSE_MANAGEMENT_BODY_REVIEWS_HEADER","REVIEW"),this.RESPONSE_MANAGEMENT_BODY_RELATEDINFO_TAB=this.sdaTranslateService.get("RESPONSE_MANAGEMENT_BODY_RELATEDINFO_TAB","RELATED INFORMATION"),this.REVIEW_SUPPORTING_INFORMATION_TERMINATE_FILE_MODAL_MSG=this.sdaTranslateService.get("REVIEW_SUPPORTING_INFORMATION_TERMINATE_FILE_MODAL_MSG-NAME","Are you sure you want to terminate the file {0}?"),this.REVIEW_SUPPORTING_INFORMATION_TERMINATE_REL_MODAL_TITLE=this.sdaTranslateService.get("REVIEW_SUPPORTING_INFORMATION_TERMINATE_REL_MODAL_TITLE","Terminate Relationship"),this.REVIEW_SUPPORTING_INFORMATION_TERMINATE_FILE_MODAL_TITLE=this.sdaTranslateService.get("REVIEW_SUPPORTING_INFORMATION_TERMINATE_FILE_MODAL_TITLE","Terminate File"),this.REVIEW_SUPPORTING_INFORMATION_TERMINATE_REL_SUCCESS=this.sdaTranslateService.get("REVIEW_SUPPORTING_INFORMATION_TERMINATE_REL_SUCCESS","Relationship successfully terminated"),this.REVIEW_SUPPORTING_INFORMATION_TERMINATE_FILE_SUCCESS=this.sdaTranslateService.get("REVIEW_SUPPORTING_INFORMATION_TERMINATE_FILE_SUCCESS","File successfully terminated"),this.hideRelatedInfoInTab=!0,this.responsesHeader="",this.reviewsHeader="",this.conflictResolutionMethodUID="",this.viewImpactAnalysisMethodUID="",this.collapseResponsesIntoTab=!1,this.collapseReviewsIntoTab=!1,this.containerActiveTab=0,this.powerBarBackgroundStyle=u.a.Transparent,this.propertyIndicationMessage=[],this.viewItemIn3DMethodUID="",this.viewItemIn2DMethodUID="",this.manageObjectMarkupLayersMethodUID="",this.columnSetUID="",this.launchMarkupMethodUID="",this.launchMarkupViewOnlyMethodUID="",this.manageResponseMarkupLayersMethodUID="",this.manageResponseRelatedItemsMethodUID="",this.manageReviewMarkupLayersMethodUID="",this.defaultResponseClassification="",this.defaultResponseRelationship="",this.largeScrnBreakpoint=950,this.route.paramMap.subscribe(e=>{e.has("revision")&&e.has("state")?(this.navigationState=JSON.parse(e.get("state")),this.revision=JSON.parse(e.get("revision")),this.navigationState===T.a.Default&&this.parseParentRouteParameters()):this.parseParentRouteParameters()}),this.refreshDataSubscription=this.dataRefreshService.refreshData$.subscribe(e=>{e&&e.objectsToRefresh&&1===e.objectsToRefresh.length?(this.initializeActionsMenu(),e.objectsToRefresh[0].obid===this.responseManagementDetails.Revision.OBID&&this.refreshUpdatedObject(e.objectsToRefresh[0],e.origin)):this.initialiseView()})}toggleResponseFilters(){this.responseItems.showFilters=!this.responseItems.showFilters}toggleReviewFilters(){this.reviewItems.showFilters=!this.reviewItems.showFilters}canDeactivate(e){let t=!0;if(this.apiConfig&&this.apiConfig.validateOnNavigateAway&&this.responseManagementDetails){const s=this.parseFutureUrl(e),n=[];if(s!==T.a.Default){if(this.responseManagementDetails.Revision.isEditable&&this.responseManagementDetails.Revision.isInEdit&&n.push(this.revisionService.saveRevision(this.responseManagementDetails.Revision,!0).toPromise()),(this.responseManagementDetails.Responses.length>0||this.responseManagementDetails.Reviews.length>0)&&(this.responseManagementDetails.Reviews.filter(e=>e.isEditable&&e.isInEdit&&e.Details).forEach(e=>n.push(this.observationService.save(e,this.apiConfig.observationType,this.apiConfig.observationType2).toPromise())),this.responseManagementDetails.Responses.filter(e=>e.isEditable&&e.isInEdit&&e.Details).forEach(e=>n.push(this.observationService.save(e,this.apiConfig.observationType,this.apiConfig.observationType2).toPromise())),t=this.validateObservationsHaveValue(s)),t)return n.push(this.areAllVersionsCheckedIn()),Promise.all(n).then(e=>e.every(e=>!0===e));{const e=this.getObservationWorkflowMessage(s);this.modalService.alert(e,this.sdaTranslateService.get("WARNING","Warning"))}}else if(t=![...this.responseManagementDetails.Responses,...this.responseManagementDetails.Reviews].filter(e=>e.isEditable&&e.isInEdit).some(e=>e.Details!==e.detailsValue||e.titleValue!==e.Title),!t)return this.modalService.confirm(this.sdaTranslateService.get("WARNING","Warning"),this.sdaTranslateService.getFormatted("RESPONSE_MANAGEMENT_UNSAVED_OBSERVATION_COMPLETE_MESSAGE","Your {0} has not been saved. You will lose any pending changes by leaving this page. Would you like to continue?",[this.apiConfig.observationType2]))}return Promise.resolve(t)}ngOnDestroy(){this.actionMenuProvider.clearAndCloseActionsMenu(),this.refreshDataSubscription&&this.refreshDataSubscription.unsubscribe()}onResize(e){this.resizeComponent(e.target.innerWidth)}selectedTabIndexChange(e){e>0&&!this.windowService.isBrowserIE()&&this.windowService.Window.dispatchEvent(new Event("resize"))}onLaunchMarkupMethod(e,t,s){this.launchMarkupViewOnlyMethodUID&&this.modeService.checkForLaunchingMarkupViewOnlyMethod(this.apiConfig.mode,t,s)?this.launchMarkupViewOnlyMethod?this.LaunchMarkupMethod(e,this.launchMarkupViewOnlyMethod):this.methodService.getMethodByUID(this.launchMarkupViewOnlyMethodUID).subscribe(t=>{this.launchMarkupViewOnlyMethod=t,this.LaunchMarkupMethod(e,this.launchMarkupViewOnlyMethod)},e=>{this.exceptionService.handleException(new r.a(e))}):this.LaunchMarkupMethod(e,this.responseManagementDetails.LaunchMarkupMethod)}LaunchMarkupMethod(e,t){const s=new _.a;s.markupContextOBID=this.modeService.getMarkupContextOBID(this.apiConfig.mode,this.responseManagementDetails),s.objectOBIDForRenditionGeneration=this.modeService.getObjectOBIDForRenditionGeneration(this.apiConfig.mode,this.responseManagementDetails),e&&this.relatedItemService.onExecuteMethod(t,e,[e.obid],this.parentClientAPI,this.parentMethodOBID,void 0,!1,s)}onManageCommunicationItemFiles(e){this.onManageFiles(e.Config,e.OBID)}onManageComsObjectFiles(){this.onManageFiles(this.responseManagementDetails.Revision.Config,this.responseManagementDetails.Revision.OBID)}onViewRevisionDetails(){this.objectDetailsService.showObjectDetailsModal(this.componentFactoryResolver,this.injector,new E.a(this.responseManagementDetails.Revision.OBID,"",this.responseManagementDetails.Revision.Config))}onViewResponseDetails(e){this.objectDetailsService.showObjectDetailsModal(this.componentFactoryResolver,this.injector,new E.a(e.OBID,"",e.Config))}refreshObjectDetails(){this.initialiseView()}onViewObjectDetails(e){this.loadingOverlayService.showLoadingOverlay(),this.featureSetService.getFeatureSetsByObjectByClientApi([e],["SCLBCommunicationManagementDetails","SOPSCommunicationManagementDetails"]).subscribe(t=>{t.length>0&&t[0].object?(t[0].object.contextObjectOBIDs=[e.obid],t[0].object.objects=[e],this.featureSetNavigationService.navigateToFeature(t[0].object)):this.objectDetailsService.showObjectDetailsModal(this.componentFactoryResolver,this.injector,e),this.loadingOverlayService.hideLoadingOverlay()},e=>{this.exceptionService.handleException(e),this.loadingOverlayService.hideLoadingOverlay()})}setSectionDisplayCount(){this.responseManagementDetails&&(this.sectionCount=1,this.responseManagementDetails.Responses&&this.responseManagementDetails.Responses.length>0&&!this.collapseResponsesIntoTab&&(this.sectionCount=this.sectionCount+1),this.responseManagementDetails.Reviews&&this.responseManagementDetails.Reviews.length>0&&!this.collapseReviewsIntoTab&&(this.sectionCount=this.sectionCount+1),this.responseManagementDetails.SupportingInformationSkeleton&&this.responseManagementDetails.SupportingInformationSkeleton.length>0&&(this.sectionCount=this.sectionCount+1))}areAllVersionsCheckedIn(){let e=!1,t="";const s=this.responseManagementDetails.SupportingInformationSkeleton.find(e=>e.IsPrimary);return s&&(t=s.RelWithDirection),t&&0!==t.length?this.dataService.get("Objects('"+this.responseManagementDetails.Revision.OBID+"')/"+t+"?$filter=SPFIsDocVersionCheckedOut eq true or SPFRevisionVersions_21/any(x0: x/SPFRevisionVersions_12/any(x1: x/SPFIsDocVersionCheckedOut eq true))").pipe(Object(i.a)(t=>(e=0===t.length,e||this.modalService.alert(this.sdaTranslateService.get("RESPONSE_MANAGEMENT_CHECKED_OUT_DOCUMENT_MESSAGE","Related primary document(s) must be checked in before the response can be completed."),this.sdaTranslateService.get("WARNING","Warning")),e))).toPromise():Promise.resolve(!0)}onManageFiles(e,t){const s=new p.a(this.sdaTranslateService.get("REVIEW_SUPPORTING_INFORMATION_TITLE","Attach files"),D.a,this.componentFactoryResolver,this.injector);s.data=new C.a(e,t),s.size="xlarge",s.disableOk=!0,this.modalService.showModal(s).catch(e=>{this.loggingService.error(new r.a(e))})}parseParentRouteParameters(){Object(n.a)(this.route.parent.paramMap,this.route.parent.data).subscribe(([e,t])=>{this.columnSetUID=e.get(R.k);const s=e.get(R.l);if(s){const e=s.split(",");this.launchMarkupMethodUID=e[0],this.launchMarkupViewOnlyMethodUID=2===e.length?e[1]:e[0]}this.manageObjectMarkupLayersMethodUID=this.nullCheck(e.get(R.m)),this.manageResponseMarkupLayersMethodUID=this.nullCheck(e.get(R.n)),this.defaultResponseClassification=this.nullCheck(e.get(R.q)),this.defaultResponseRelationship=this.nullCheck(e.get(R.r)),this.manageResponseRelatedItemsMethodUID=this.nullCheck(e.get(R.b)),this.manageRevisionRelatedItemsMethodUID=this.nullCheck(e.get(R.c)),this.updateCommunicationMethodUID=this.nullCheck(e.get(R.d)),this.manageReviewMarkupLayersMethodUID=this.nullCheck(e.get(R.e)),this.viewImpactAnalysisMethodUID=this.nullCheck(e.get(R.f)),this.identifyRespondersMethodUID=this.nullCheck(e.get(R.g)),this.conflictResolutionMethodUID=this.nullCheck(e.get(R.h)),this.viewItemIn3DMethodUID=this.nullCheck(e.get(R.i)),this.viewItemIn2DMethodUID=this.nullCheck(e.get(R.j)),this.parentMethodOBID=this.nullCheck(e.get(R.y)),this.parentClientAPI=this.nullCheck(e.get(R.s)),this.parentObjects=t[R.z],this.config=JSON.parse(e.get(R.t))[0],this.apiConfig=this.modeService.getConfigurationForModeFromString(e.get(R.p)),this.revision||(this.revision=this.parentObjects[0]),this.responseManagementDetails&&this.responseManagementDetails.Revision.OBID===this.revision.obid?this.setSectionDisplayCount():this.initialiseView()})}nullCheck(e){return null===e?"":e}validateObservationsHaveValue(e){const t=[...this.responseManagementDetails.Responses,...this.responseManagementDetails.Reviews];let s=!t.filter(e=>e.isEditable).some(e=>""===e.Details||void 0===e.Details);return e===T.a.Complete&&(s=s&&this.validateResponseWillBeSentToOriginatingOrg(t)),s}validateResponseWillBeSentToOriginatingOrg(e){return e.some(e=>e.isEditable)}parseFutureUrl(e){let t=T.a.Default;if(e&&e.url&&e.url.startsWith("/response-management;"))try{t=JSON.parse(e.url.substring(e.url.length-1))}catch(s){t=T.a.Default}return t}refreshUpdatedObject(e,t=""){this.loadingOverlayService.showLoadingOverlay(),this.responseManagementDataService.getSupportingInformationSkeletonForObject(e.obid).subscribe(e=>{e&&(e.filter(e=>e.IsFiles===("SDASupportingInformation"===t)).forEach(e=>e.isDirty=!0),this.checkSkeletonClientAPIs(this.responseManagementDetails.Revision.IsLatest,e),this.responseManagementDetails.SupportingInformationSkeleton=e,this.timeoutService.setTimeout(()=>{this.resizeComponent(this.windowService.Window.innerWidth)},1)),this.loadingOverlayService.hideLoadingOverlay()})}checkSkeletonClientAPIs(e,t){this.apiConfig.enableSupportingInformationContextMenu&&e?this.apiConfig.contextMenuItemFilters&&this.apiConfig.contextMenuItemFilters.length>0&&t.forEach(e=>{const t=this.apiConfig.contextMenuItemFilters.find(t=>t.RelDefUID===e.RelWithDirection);t&&(e.contextMenuClientAPIFilters=t.MenuFilters)}):t.forEach(e=>{e.ContextMenuClientAPIs=void 0})}initialiseView(){this.loadingOverlayService.showLoadingOverlay();try{this.modeService.getAPIRequestForMode(this.apiConfig.mode,this.revision.obid,this.columnSetUID,this.launchMarkupMethodUID,this.manageObjectMarkupLayersMethodUID,this.manageResponseMarkupLayersMethodUID,this.defaultResponseClassification,this.defaultResponseRelationship,this.manageResponseRelatedItemsMethodUID,this.manageReviewMarkupLayersMethodUID,this.viewItemIn3DMethodUID,this.viewItemIn2DMethodUID).subscribe(e=>{e&&(this.initializeRevision(e),this.initializeResponses(e),this.initializeReviews(e),this.responseManagementDetails=e,this.initializeActionsMenu(),this.loadingOverlayService.hideLoadingOverlay(),this.featureSetNavigationService.removeCurrentRouteFromHistory(),this.timeoutService.setTimeout(()=>{this.resizeComponent(this.windowService.Window.innerWidth)},1))})}catch(e){throw this.loadingOverlayService.hideLoadingOverlay(),new r.a(e,this.sdaTranslateService.get("RESPONSE_MANAGEMENT_BODY_LOAD_ERROR","Failed to load communication management details for revision"),"response-management-body","onExecute")}}resizeComponent(e){this.responseCollapsed(e),this.reviewCollapsed(e),this.setSectionDisplayCount()}responseCollapsed(e){if(this.responseContainerElement&&this.responseCollapsedContainerElement)if(e<this.largeScrnBreakpoint&&!this.collapseResponsesIntoTab){this.collapseResponsesIntoTab=!0;const e=this.responseContainerElement.nativeElement.children[0];this.responseContainerElement.nativeElement.removeChild(e),this.responseCollapsedContainerElement.nativeElement.appendChild(e)}else if(e>this.largeScrnBreakpoint&&this.collapseResponsesIntoTab){this.collapseResponsesIntoTab=!1;const e=this.responseCollapsedContainerElement.nativeElement.children[0];this.responseCollapsedContainerElement.nativeElement.removeChild(e),this.responseContainerElement.nativeElement.appendChild(e),this.containerActiveTab=0}}reviewCollapsed(e){if(this.reviewContainerElement&&this.reviewCollapsedContainerElement)if(e<this.largeScrnBreakpoint&&!this.collapseReviewsIntoTab){this.collapseReviewsIntoTab=!0;const e=this.reviewContainerElement.nativeElement.children[0];this.reviewContainerElement.nativeElement.removeChild(e),this.reviewCollapsedContainerElement.nativeElement.appendChild(e)}else if(e>this.largeScrnBreakpoint&&this.collapseReviewsIntoTab){this.collapseReviewsIntoTab=!1;const e=this.reviewCollapsedContainerElement.nativeElement.children[0];this.reviewCollapsedContainerElement.nativeElement.removeChild(e),this.reviewContainerElement.nativeElement.appendChild(e),this.containerActiveTab=0}}initializeResponses(e){if(e.Responses){const t=this.modeService.isConsolidateResponse(this.apiConfig.mode),s=1!==e.Responses.length&&!0!==t?this.RESPONSE_MANAGEMENT_BODY_RESPONSES_HEADER2:this.RESPONSE_MANAGEMENT_BODY_RESPONSES_HEADER;this.responsesHeader=t?"1 "+s:e.Responses.length+" "+s,e.Responses.forEach(e=>e.type=w.Response)}}initializeReviews(e){if(e.Reviews){let t;t=1!==e.Reviews.length?this.RESPONSE_MANAGEMENT_BODY_REVIEWS_HEADER2:this.RESPONSE_MANAGEMENT_BODY_REVIEWS_HEADER,this.reviewsHeader=e.Reviews.length+" "+t,e.Reviews.forEach(e=>e.type=w.Review)}}initializeRevision(e){e.Revision.RejectDetails&&this.setRejectionProperties(e),e.Revision.IsLatest&&(this.responderIndicationMessage=this.modeService.getResponderDetails(this.apiConfig.mode,e.IdentifiedResponders,e.IdentifiedConsolidator)),this.apiConfig.header.showRevisions&&(this.propertyIndicationMessage=void 0,e.Revision.MandatoryProperties.length>0&&(this.propertyIndicationMessage=e.Revision.MandatoryProperties),this.documentIndicationMessage=this.modeService.checkForActionOnDocs(this.apiConfig.mode,e.Revision.HasNoActionOrContract,e.Revision.Project)),this.checkSkeletonClientAPIs(e.Revision.IsLatest,e.SupportingInformationSkeleton)}initializeActionsMenu(){this.actionMenuProvider.clearItems();const e=new E.a(this.responseManagementDetails.Revision.OBID,this.responseManagementDetails.Revision.DisplayName,this.responseManagementDetails.Revision.Config);this.actionMenuProvider.addItem(e)}setRejectionProperties(e){e.Revision.RejectDetails.header=this.apiConfig&&this.apiConfig.mode&&(this.apiConfig.mode===A.a.PrepareSchemaChangeRequest||this.apiConfig.mode===A.a.ReviewSchemaChangeRequest)?this.sdaTranslateService.get("REWORK","Rework"):this.sdaTranslateService.get("RESPONSE_MANAGEMENT_REJECT_SUMMARY_TITLE","Rejected"),e.Revision.RejectDetails.SubRejectDetails&&(e.Revision.RejectDetails.SubRejectDetails.header=this.sdaTranslateService.get("RESPONSE_MANAGEMENT_DISPUTED_SUMMARY_TITLE","Disputed"),e.Revision.RejectDetails.SubRejectDetails.footer=this.sdaTranslateService.get("RESPONSE_MANAGEMENT_DISPUTED_SUMMARY_FOOTER","A new revision has been created."))}getObservationWorkflowMessage(e){let t="";switch(e){case T.a.Complete:t=this.apiConfig.warningMessages.onComplete;break;case T.a.Waive:t=this.apiConfig.warningMessages.onWaive;break;case T.a.Reject:t=this.apiConfig.warningMessages.onReject}return t}}return e.\u0275fac=function(t){return new(t||e)(x.Sb(fe.a),x.Sb(O.a),x.Sb(d.a),x.Sb(h.a),x.Sb(o.a),x.Sb(a.a),x.Sb(x.j),x.Sb(x.s),x.Sb(g.a),x.Sb(c.a),x.Sb(N.a),x.Sb(y.a),x.Sb(I.a),x.Sb(b.a),x.Sb(m.a),x.Sb(f.a),x.Sb(M.a),x.Sb(P.a),x.Sb(S.a),x.Sb(l.a),x.Sb(v.a),x.Sb(k.a))},e.\u0275cmp=x.Mb({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){var s;1&e&&(x.bd(Ce,!0),x.bd(De,!0),x.bd(_e,!0),x.bd(Te,!0),x.bd(we,!0),x.bd(Ae,!0)),2&e&&(x.Gc(s=x.ic())&&(t.responseItems=s.first),x.Gc(s=x.ic())&&(t.reviewItems=s.first),x.Gc(s=x.ic())&&(t.responseContainerElement=s.first),x.Gc(s=x.ic())&&(t.responseCollapsedContainerElement=s.first),x.Gc(s=x.ic())&&(t.reviewContainerElement=s.first),x.Gc(s=x.ic())&&(t.reviewCollapsedContainerElement=s.first))},decls:3,vars:2,consts:[[1,"rm-container",3,"resize"],[4,"ngIf"],["class","rm-body",4,"ngIf"],[3,"revision","apiConfig","parentMethodOBID","parentObjects","parentClientAPI","updateCommunicationMethodUID","manageRevisionMarkupLayersMethod","manageRevisionMarkupLayersMethodUID","manageRevisionRelatedItemsMethodUID","viewItemIn3DMethodUID","viewItemIn2DMethodUID","viewImpactAnalysisMethodUID","identifyRespondersMethodUID","conflictResolutionMethodUID","onManageRelatedFiles"],[1,"rm-body"],[3,"rejectDetails",4,"ngIf"],[1,"rm-panel"],[1,"rm-section","rm-section--query"],[1,"rm-section__inner"],[1,"rm-tabs",3,"selectedIndex","selectedIndexChange"],["mat-tab-label",""],[1,"tab-content"],[3,"styleClass"],[1,"sda-card-header"],[3,"revision","apiConfig","parentMethodOBID","parentObjects","parentClientAPI","identifyRespondersMethodUID","responderIndicationMessage","projectIndicationMessage","documentIndicationMessage","onObjectClicked","onHeaderEdited","onManageRelatedFiles"],[1,"sda-card-body"],[3,"text","isEditable","textChange"],["class","rm-section rm-section--response",3,"rm-section--empty",4,"ngIf"],["class","rm-section rm-section--reviews",3,"rm-section--empty",4,"ngIf"],[1,"rm-section","rm-section--grid"],[3,"data","parentObjectOBID","config","hideAccordian","onFileClicked","onDocumentFileClicked","onRenditionClicked","onObjectClicked"],[3,"rejectDetails"],["class","rm-tabs__icon","svgIcon","blockage",4,"ngIf"],["svgIcon","blockage",1,"rm-tabs__icon"],[1,"tab-container"],["responseCollapsedContainer",""],[1,"tab-label-content"],["class","tab-filter",3,"tab-filter--active","tab-filter--all","styleClassIcon","isCompact","click",4,"ngIf"],[1,"tab-filter",3,"styleClassIcon","isCompact","click"],["reviewCollapsedContainer",""],[1,"rm-section","rm-section--response"],[3,"label"],["responseContainer",""],[3,"parentMethodOBID","config","parentObjects","parentClientAPI","data","responders","apiConfig","isLatest","manageMarkupLayersMethod","manageRelatedItemsMethod","onManageRelatedFiles","onViewObjectDetails","onLaunchMarkupMethod"],["responseItems",""],[1,"tab-filter",3,"styleClassIcon","styleClassButton","isCompact","click"],[1,"rm-section","rm-section--reviews"],["reviewContainer",""],[3,"data","responders","apiConfig","config","isLatest","manageMarkupLayersMethod","manageRelatedItemsMethod","onManageRelatedFiles","onViewObjectDetails","onLaunchMarkupMethod"],["reviewItems",""]],template:function(e,t){1&e&&(x.Yb(0,"div",0),x.hc("resize",(function(e){return t.onResize(e)}),!1,x.Jc),x.Sc(1,Pe,2,14,"div",1),x.Sc(2,We,22,34,"div",2),x.Xb()),2&e&&(x.Eb(1),x.sc("ngIf",t.responseManagementDetails&&t.responseManagementDetails.Revision.IsLatest),x.Eb(1),x.sc("ngIf",t.responseManagementDetails))},directives:[U.t,me.a,Y.c,Y.a,Y.d,V.a,Ie,se.a,he,Oe.a,Ee.a,Re.a,Se],styles:['.rm-body[_ngcontent-%COMP%], [_nghost-%COMP%]     .tab-content{overflow-x:hidden;overflow-y:auto}[_nghost-%COMP%]{display:flex;flex:1;min-height:0}[_nghost-%COMP%]     .ui-accordion{flex:1;border:none!important}[_nghost-%COMP%]     .ui-accordion .ui-accordion-header{margin-top:0}[_nghost-%COMP%]     .card .power-bar-controls{flex-basis:auto}[_nghost-%COMP%]     .card .power-bar__overlay .overlay-panel{width:300px}[_nghost-%COMP%]     .card .power-bar__overlay .overlay-panel .power-bar-button{display:flex}[_nghost-%COMP%]     .card .power-bar__overlay .overlay-panel .power-bar-switch{width:100%}[_nghost-%COMP%]     .card .power-bar__overlay .overlay-panel .power-bar-toggle .ui-button{display:flex;align-items:center;padding:0 12px;background:transparent;border:none}[_nghost-%COMP%]     .card .power-bar__overlay .overlay-panel .power-bar-toggle .ui-button:not([disabled]):hover{background:#ebedf0}[_nghost-%COMP%]     .card .power-bar__overlay .overlay-panel .power-bar-toggle .ui-button .ui-button-icon-left{margin-left:4px}[_nghost-%COMP%]     .card .power-bar__overlay .overlay-panel .power-bar-toggle .ui-button .ui-button-text{padding:0 0 0 28px!important}[_nghost-%COMP%]     .rm-rev-card.card{margin:0;border:none;padding:0}[_nghost-%COMP%]     .rm-rev-card .power-bar{margin:0}[_nghost-%COMP%]     .rm-rev-card .card-content__text{max-height:100%}[_nghost-%COMP%]     .comm-item-card.card{margin:0;padding:0;border:none}[_nghost-%COMP%]     .comm-item-card .power-bar{margin:0}[_nghost-%COMP%]     .comm-item-card .card-footer{margin-top:auto}[_nghost-%COMP%]     .tab-container{height:100%}[_nghost-%COMP%]     .tab-content{display:flex;flex-direction:column;height:100%;padding:15px}[_nghost-%COMP%]     .tab-label-content{text-transform:uppercase}[_nghost-%COMP%]     .tab-label-content   .button{margin-left:10px}.rm-container[_ngcontent-%COMP%]{display:flex;flex:1}.rm-body[_ngcontent-%COMP%]{flex-grow:1;background:#fff;border-left:1px solid #cad0d7}.rm-panel[_ngcontent-%COMP%]{display:flex;flex:1;flex-wrap:wrap}.rm-panel[_ngcontent-%COMP%], .rm-panel--full[_ngcontent-%COMP%]   .rm-section[_ngcontent-%COMP%]{height:100%}@media screen and (max-width:75em){.rm-panel--split[_ngcontent-%COMP%]{flex-direction:column}}.rm-panel--split[_ngcontent-%COMP%]   .rm-section[_ngcontent-%COMP%]{flex-basis:50%;height:100%}.rm-panel--quad[_ngcontent-%COMP%]   .rm-section[_ngcontent-%COMP%]{flex-basis:50%;height:50%}.rm-panel--quad[_ngcontent-%COMP%]   .rm-section--reviews[_ngcontent-%COMP%]{order:4}.rm-panel--divided[_ngcontent-%COMP%]{flex-direction:column}.rm-panel--divided[_ngcontent-%COMP%]   .rm-section--query[_ngcontent-%COMP%]{flex-basis:100%}.rm-section[_ngcontent-%COMP%]{display:flex;flex:1 1 50%;height:55%;min-height:200px}.rm-section--empty[_ngcontent-%COMP%]{display:none}.rm-section--grid[_ngcontent-%COMP%]{flex-basis:100%;height:45%}.rm-section--grid[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]{padding:0}.rm-section--response[_ngcontent-%COMP%]     sda-card-view, .rm-section--reviews[_ngcontent-%COMP%]     sda-card-view{flex:1}.rm-section--response[_ngcontent-%COMP%]     .tab-content, .rm-section--reviews[_ngcontent-%COMP%]     .tab-content{padding-bottom:0}.rm-section__inner[_ngcontent-%COMP%]{flex:1;width:300px;margin:5px;border:1px solid #cad0d7}.rm-section[_ngcontent-%COMP%]     .k-grid-content{background-color:initial}.tab-filter[_ngcontent-%COMP%]:after{content:attr(data-filter-count);position:absolute;top:0;right:0;display:flex;align-items:center;justify-content:center;width:auto;height:15px;padding:0 5px;background:#0087c8;border-radius:4px;color:#fff;font-size:10px;-webkit-transform:translate3d(6px,-6px,0);transform:translate3d(6px,-6px,0)}.tab-filter--active[_ngcontent-%COMP%]:after, .tab-filter--all[_ngcontent-%COMP%]:after{content:none}.tab-filter[_ngcontent-%COMP%]     .button__icon:after{content:"\\f078";display:inline-flex;font-size:12px;transition:-webkit-transform .15s linear;transition:transform .15s linear;transition:transform .15s linear,-webkit-transform .15s linear}.tab-filter--active[_ngcontent-%COMP%]     .button__icon:after{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.rm-tabs--empty[_ngcontent-%COMP%]     .mat-tab-label:not(:first-of-type){display:none}.rm-tabs__icon[_ngcontent-%COMP%]{color:#f2bf25}.badge[_ngcontent-%COMP%]{padding:4px 6px;background:#697a8b;border-radius:3px;font-size:12px;font-weight:500;line-height:1.4;color:#fff;text-transform:uppercase;-webkit-user-select:none;-ms-user-select:none;user-select:none}.badge--success[_ngcontent-%COMP%]{background:#559d39}']}),e})()},ltBE:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var n=s("fXoL");let i=(()=>{class e{transform(e,t,s){return e?s?e.filter(e=>e[t].toLowerCase().includes(s.toLowerCase())):e:[]}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=n.Rb({name:"sdaFilter",type:e,pure:!0}),e})()}}]);